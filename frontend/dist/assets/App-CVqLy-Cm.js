import{r as _,R as Ew,j as a,a as Kn}from"./index-CDWxGUQb.js";/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Za(){return Za=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},Za.apply(this,arguments)}var dn;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(dn||(dn={}));const fm="popstate";function Iw(s){s===void 0&&(s={});function e(n,r){let{pathname:i,search:o,hash:l}=n.location;return Wc("",{pathname:i,search:o,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:Wp(r)}return Sw(e,t,null,s)}function Vt(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function Yd(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Tw(){return Math.random().toString(36).substr(2,8)}function gm(s,e){return{usr:s.state,key:s.key,idx:e}}function Wc(s,e,t,n){return t===void 0&&(t=null),Za({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?sa(e):e,{state:t,key:e&&e.key||n||Tw()})}function Wp(s){let{pathname:e="/",search:t="",hash:n=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function sa(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let n=s.indexOf("?");n>=0&&(e.search=s.substr(n),s=s.substr(0,n)),s&&(e.pathname=s)}return e}function Sw(s,e,t,n){n===void 0&&(n={});let{window:r=document.defaultView,v5Compat:i=!1}=n,o=r.history,l=dn.Pop,c=null,u=h();u==null&&(u=0,o.replaceState(Za({},o.state,{idx:u}),""));function h(){return(o.state||{idx:null}).idx}function m(){l=dn.Pop;let g=h(),S=g==null?null:g-u;u=g,c&&c({action:l,location:I.location,delta:S})}function p(g,S){l=dn.Push;let C=Wc(I.location,g,S);u=h()+1;let T=gm(C,u),V=I.createHref(C);try{o.pushState(T,"",V)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;r.location.assign(V)}i&&c&&c({action:l,location:I.location,delta:1})}function N(g,S){l=dn.Replace;let C=Wc(I.location,g,S);u=h();let T=gm(C,u),V=I.createHref(C);o.replaceState(T,"",V),i&&c&&c({action:l,location:I.location,delta:0})}function v(g){let S=r.location.origin!=="null"?r.location.origin:r.location.href,C=typeof g=="string"?g:Wp(g);return C=C.replace(/ $/,"%20"),Vt(S,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,S)}let I={get action(){return l},get location(){return s(r,o)},listen(g){if(c)throw new Error("A history only accepts one active listener");return r.addEventListener(fm,m),c=g,()=>{r.removeEventListener(fm,m),c=null}},createHref(g){return e(r,g)},createURL:v,encodeLocation(g){let S=v(g);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:p,replace:N,go(g){return o.go(g)}};return I}var pm;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(pm||(pm={}));function Aw(s,e,t){return t===void 0&&(t="/"),kw(s,e,t)}function kw(s,e,t,n){let r=typeof e=="string"?sa(e):e,i=Jp(r.pathname||"/",t);if(i==null)return null;let o=Kp(s);Pw(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=zw(i);l=$w(o[c],u)}return l}function Kp(s,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let r=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(Vt(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=Hn([n,c.relativePath]),h=t.concat(c);i.children&&i.children.length>0&&(Vt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),Kp(i.children,e,h,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:Ow(u,i.index),routesMeta:h})};return s.forEach((i,o)=>{var l;if(i.path===""||!((l=i.path)!=null&&l.includes("?")))r(i,o);else for(let c of Hp(i.path))r(i,o,c)}),e}function Hp(s){let e=s.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),i=t.replace(/\?$/,"");if(n.length===0)return r?[i,""]:[i];let o=Hp(n.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),r&&l.push(...o),l.map(c=>s.startsWith("/")&&c===""?"/":c)}function Pw(s){s.sort((e,t)=>e.score!==t.score?t.score-e.score:Fw(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const Cw=/^:[\w-]+$/,Rw=3,Dw=2,Vw=1,Mw=10,Lw=-2,xm=s=>s==="*";function Ow(s,e){let t=s.split("/"),n=t.length;return t.some(xm)&&(n+=Lw),e&&(n+=Dw),t.filter(r=>!xm(r)).reduce((r,i)=>r+(Cw.test(i)?Rw:i===""?Vw:Mw),n)}function Fw(s,e){return s.length===e.length&&s.slice(0,-1).every((n,r)=>n===e[r])?s[s.length-1]-e[e.length-1]:0}function $w(s,e,t){let{routesMeta:n}=s,r={},i="/",o=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,h=i==="/"?e:e.slice(i.length)||"/",m=Uw({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},h),p=c.route;if(!m)return null;Object.assign(r,m.params),o.push({params:r,pathname:Hn([i,m.pathname]),pathnameBase:Hw(Hn([i,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(i=Hn([i,m.pathnameBase]))}return o}function Uw(s,e){typeof s=="string"&&(s={path:s,caseSensitive:!1,end:!0});let[t,n]=Bw(s.path,s.caseSensitive,s.end),r=e.match(t);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:n.reduce((u,h,m)=>{let{paramName:p,isOptional:N}=h;if(p==="*"){let I=l[m]||"";o=i.slice(0,i.length-I.length).replace(/(.)\/+$/,"$1")}const v=l[m];return N&&!v?u[p]=void 0:u[p]=(v||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:s}}function Bw(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Yd(s==="*"||!s.endsWith("*")||s.endsWith("/*"),'Route path "'+s+'" will be treated as if it were '+('"'+s.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+s.replace(/\*$/,"/*")+'".'));let n=[],r="^"+s.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return s.endsWith("*")?(n.push({paramName:"*"}),r+=s==="*"||s==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":s!==""&&s!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function zw(s){try{return s.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Yd(!1,'The URL path "'+s+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),s}}function Jp(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=s.charAt(t);return n&&n!=="/"?null:s.slice(t)||"/"}const Gw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qw=s=>Gw.test(s);function Ww(s,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:r=""}=typeof s=="string"?sa(s):s,i;if(t)if(qw(t))i=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),Yd(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?i=ym(t.substring(1),"/"):i=ym(t,e)}else i=e;return{pathname:i,search:Jw(n),hash:Qw(r)}}function ym(s,e){let t=e.replace(/\/+$/,"").split("/");return s.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function uc(s,e,t,n){return"Cannot include a '"+s+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Kw(s){return s.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Qp(s,e){let t=Kw(s);return e?t.map((n,r)=>r===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function Yp(s,e,t,n){n===void 0&&(n=!1);let r;typeof s=="string"?r=sa(s):(r=Za({},s),Vt(!r.pathname||!r.pathname.includes("?"),uc("?","pathname","search",r)),Vt(!r.pathname||!r.pathname.includes("#"),uc("#","pathname","hash",r)),Vt(!r.search||!r.search.includes("#"),uc("#","search","hash",r)));let i=s===""||r.pathname==="",o=i?"/":r.pathname,l;if(o==null)l=t;else{let m=e.length-1;if(!n&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),m-=1;r.pathname=p.join("/")}l=m>=0?e[m]:"/"}let c=Ww(r,l),u=o&&o!=="/"&&o.endsWith("/"),h=(i||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(u||h)&&(c.pathname+="/"),c}const Hn=s=>s.join("/").replace(/\/\/+/g,"/"),Hw=s=>s.replace(/\/+$/,"").replace(/^\/*/,"/"),Jw=s=>!s||s==="?"?"":s.startsWith("?")?s:"?"+s,Qw=s=>!s||s==="#"?"":s.startsWith("#")?s:"#"+s;function Yw(s){return s!=null&&typeof s.status=="number"&&typeof s.statusText=="string"&&typeof s.internal=="boolean"&&"data"in s}const Xp=["post","put","patch","delete"];new Set(Xp);const Xw=["get",...Xp];new Set(Xw);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ei(){return ei=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},ei.apply(this,arguments)}const Xd=_.createContext(null),Zw=_.createContext(null),Ii=_.createContext(null),bl=_.createContext(null),In=_.createContext({outlet:null,matches:[],isDataRoute:!1}),Zp=_.createContext(null);function Ti(){return _.useContext(bl)!=null}function Tn(){return Ti()||Vt(!1),_.useContext(bl).location}function e0(s){_.useContext(Ii).static||_.useLayoutEffect(s)}function ft(){let{isDataRoute:s}=_.useContext(In);return s?mN():eN()}function eN(){Ti()||Vt(!1);let s=_.useContext(Xd),{basename:e,future:t,navigator:n}=_.useContext(Ii),{matches:r}=_.useContext(In),{pathname:i}=Tn(),o=JSON.stringify(Qp(r,t.v7_relativeSplatPath)),l=_.useRef(!1);return e0(()=>{l.current=!0}),_.useCallback(function(u,h){if(h===void 0&&(h={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let m=Yp(u,JSON.parse(o),i,h.relative==="path");s==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Hn([e,m.pathname])),(h.replace?n.replace:n.push)(m,h.state,h)},[e,n,o,i,s])}function tN(){let{matches:s}=_.useContext(In),e=s[s.length-1];return e?e.params:{}}function sN(s,e){return nN(s,e)}function nN(s,e,t,n){Ti()||Vt(!1);let{navigator:r}=_.useContext(Ii),{matches:i}=_.useContext(In),o=i[i.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=Tn(),h;if(e){var m;let g=typeof e=="string"?sa(e):e;c==="/"||(m=g.pathname)!=null&&m.startsWith(c)||Vt(!1),h=g}else h=u;let p=h.pathname||"/",N=p;if(c!=="/"){let g=c.replace(/^\//,"").split("/");N="/"+p.replace(/^\//,"").split("/").slice(g.length).join("/")}let v=Aw(s,{pathname:N}),I=lN(v&&v.map(g=>Object.assign({},g,{params:Object.assign({},l,g.params),pathname:Hn([c,r.encodeLocation?r.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?c:Hn([c,r.encodeLocation?r.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,t,n);return e&&I?_.createElement(bl.Provider,{value:{location:ei({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:dn.Pop}},I):I}function rN(){let s=hN(),e=Yw(s)?s.status+" "+s.statusText:s instanceof Error?s.message:JSON.stringify(s),t=s instanceof Error?s.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:r},t):null,null)}const aN=_.createElement(rN,null);class iN extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?_.createElement(In.Provider,{value:this.props.routeContext},_.createElement(Zp.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function oN(s){let{routeContext:e,match:t,children:n}=s,r=_.useContext(Xd);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(In.Provider,{value:e},n)}function lN(s,e,t,n){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),s==null){var i;if(!t)return null;if(t.errors)s=t.matches;else if((i=n)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)s=t.matches;else return null}let o=s,l=(r=t)==null?void 0:r.errors;if(l!=null){let h=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);h>=0||Vt(!1),o=o.slice(0,Math.min(o.length,h+1))}let c=!1,u=-1;if(t&&n&&n.v7_partialHydration)for(let h=0;h<o.length;h++){let m=o[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(u=h),m.route.id){let{loaderData:p,errors:N}=t,v=m.route.loader&&p[m.route.id]===void 0&&(!N||N[m.route.id]===void 0);if(m.route.lazy||v){c=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((h,m,p)=>{let N,v=!1,I=null,g=null;t&&(N=l&&m.route.id?l[m.route.id]:void 0,I=m.route.errorElement||aN,c&&(u<0&&p===0?(fN("route-fallback"),v=!0,g=null):u===p&&(v=!0,g=m.route.hydrateFallbackElement||null)));let S=e.concat(o.slice(0,p+1)),C=()=>{let T;return N?T=I:v?T=g:m.route.Component?T=_.createElement(m.route.Component,null):m.route.element?T=m.route.element:T=h,_.createElement(oN,{match:m,routeContext:{outlet:h,matches:S,isDataRoute:t!=null},children:T})};return t&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?_.createElement(iN,{location:t.location,revalidation:t.revalidation,component:I,error:N,children:C(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):C()},null)}var t0=function(s){return s.UseBlocker="useBlocker",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s}(t0||{}),s0=function(s){return s.UseBlocker="useBlocker",s.UseLoaderData="useLoaderData",s.UseActionData="useActionData",s.UseRouteError="useRouteError",s.UseNavigation="useNavigation",s.UseRouteLoaderData="useRouteLoaderData",s.UseMatches="useMatches",s.UseRevalidator="useRevalidator",s.UseNavigateStable="useNavigate",s.UseRouteId="useRouteId",s}(s0||{});function cN(s){let e=_.useContext(Xd);return e||Vt(!1),e}function dN(s){let e=_.useContext(Zw);return e||Vt(!1),e}function uN(s){let e=_.useContext(In);return e||Vt(!1),e}function n0(s){let e=uN(),t=e.matches[e.matches.length-1];return t.route.id||Vt(!1),t.route.id}function hN(){var s;let e=_.useContext(Zp),t=dN(),n=n0();return e!==void 0?e:(s=t.errors)==null?void 0:s[n]}function mN(){let{router:s}=cN(t0.UseNavigateStable),e=n0(s0.UseNavigateStable),t=_.useRef(!1);return e0(()=>{t.current=!0}),_.useCallback(function(r,i){i===void 0&&(i={}),t.current&&(typeof r=="number"?s.navigate(r):s.navigate(r,ei({fromRouteId:e},i)))},[s,e])}const bm={};function fN(s,e,t){bm[s]||(bm[s]=!0)}function gN(s,e){s==null||s.v7_startTransition,s==null||s.v7_relativeSplatPath}function zo(s){let{to:e,replace:t,state:n,relative:r}=s;Ti()||Vt(!1);let{future:i,static:o}=_.useContext(Ii),{matches:l}=_.useContext(In),{pathname:c}=Tn(),u=ft(),h=Yp(e,Qp(l,i.v7_relativeSplatPath),c,r==="path"),m=JSON.stringify(h);return _.useEffect(()=>u(JSON.parse(m),{replace:t,state:n,relative:r}),[u,m,r,t,n]),null}function Ze(s){Vt(!1)}function pN(s){let{basename:e="/",children:t=null,location:n,navigationType:r=dn.Pop,navigator:i,static:o=!1,future:l}=s;Ti()&&Vt(!1);let c=e.replace(/^\/*/,"/"),u=_.useMemo(()=>({basename:c,navigator:i,static:o,future:ei({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);typeof n=="string"&&(n=sa(n));let{pathname:h="/",search:m="",hash:p="",state:N=null,key:v="default"}=n,I=_.useMemo(()=>{let g=Jp(h,c);return g==null?null:{location:{pathname:g,search:m,hash:p,state:N,key:v},navigationType:r}},[c,h,m,p,N,v,r]);return I==null?null:_.createElement(Ii.Provider,{value:u},_.createElement(bl.Provider,{children:t,value:I}))}function xN(s){let{children:e,location:t}=s;return sN(Kc(e),t)}new Promise(()=>{});function Kc(s,e){e===void 0&&(e=[]);let t=[];return _.Children.forEach(s,(n,r)=>{if(!_.isValidElement(n))return;let i=[...e,r];if(n.type===_.Fragment){t.push.apply(t,Kc(n.props.children,i));return}n.type!==Ze&&Vt(!1),!n.props.index||!n.props.children||Vt(!1);let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Kc(n.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const yN="6";try{window.__reactRouterVersion=yN}catch{}const bN="startTransition",vm=Ew[bN];function vN(s){let{basename:e,children:t,future:n,window:r}=s,i=_.useRef();i.current==null&&(i.current=Iw({window:r,v5Compat:!0}));let o=i.current,[l,c]=_.useState({action:o.action,location:o.location}),{v7_startTransition:u}=n||{},h=_.useCallback(m=>{u&&vm?vm(()=>c(m)):c(m)},[c,u]);return _.useLayoutEffect(()=>o.listen(h),[o,h]),_.useEffect(()=>gN(n),[n]),_.createElement(pN,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:o,future:n})}var wm;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(wm||(wm={}));var Nm;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(Nm||(Nm={}));const wN=({type:s,message:e,onClose:t,duration:n=4e3})=>{const[r,i]=_.useState(!1);_.useEffect(()=>{if(setTimeout(()=>i(!0),10),n>0){const h=setTimeout(()=>{o()},n);return()=>clearTimeout(h)}},[n]);const o=()=>{i(!1),setTimeout(()=>{t&&t()},300)},l=()=>{const h="fixed top-0 left-0 right-0 z-[9999] transition-all duration-300 ease-in-out";return r?`${h} translate-y-0 opacity-100`:`${h} -translate-y-full opacity-0`},c=()=>s==="success"?"bg-green-600 text-white":"bg-red-600 text-white",u=()=>s==="success"?a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})});return a.jsx("div",{className:l(),children:a.jsx("div",{className:`${c()} shadow-lg`,children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[u(),a.jsx("p",{className:"text-sm font-medium",children:e})]}),a.jsx("button",{onClick:o,className:"ml-4 text-white hover:text-gray-200 focus:outline-none transition-colors","aria-label":"Close",children:a.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})})})},r0=_.createContext(null),NN=({children:s})=>{const[e,t]=_.useState(null),n=_.useCallback(({type:o,message:l,duration:c=4e3})=>{t({type:o,message:l,duration:c})},[]),r=_.useCallback(()=>{t(null)},[]),i={showNotification:n,clearNotification:r};return a.jsxs(r0.Provider,{value:i,children:[s,e&&a.jsx(wN,{type:e.type,message:e.message,duration:e.duration,onClose:r})]})},yt=()=>{const s=_.useContext(r0);if(!s)throw new Error("useNotification must be used within a NotificationProvider");return s},a0=_.createContext(null),_N=({children:s})=>{const[e,t]=_.useState(()=>{if(typeof window<"u"&&window.localStorage){const i=localStorage.getItem("theme");return i?i==="dark":!0}return!0});_.useEffect(()=>{typeof window>"u"||!document||(e?(document.documentElement.classList.add("dark"),window.localStorage&&localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),window.localStorage&&localStorage.setItem("theme","light")))},[e]);const r={isDarkMode:e,toggleTheme:()=>{t(!e)},setIsDarkMode:t};return a.jsx(a0.Provider,{value:r,children:s})},Tt=()=>{const s=_.useContext(a0);if(!s)throw new Error("useTheme must be used within a ThemeProvider");return s};function i0(s,e){return function(){return s.apply(e,arguments)}}const{toString:jN}=Object.prototype,{getPrototypeOf:Zd}=Object,{iterator:vl,toStringTag:o0}=Symbol,wl=(s=>e=>{const t=jN.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Es=s=>(s=s.toLowerCase(),e=>wl(e)===s),Nl=s=>e=>typeof e===s,{isArray:na}=Array,Br=Nl("undefined");function Si(s){return s!==null&&!Br(s)&&s.constructor!==null&&!Br(s.constructor)&&rs(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const l0=Es("ArrayBuffer");function EN(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&l0(s.buffer),e}const IN=Nl("string"),rs=Nl("function"),c0=Nl("number"),Ai=s=>s!==null&&typeof s=="object",TN=s=>s===!0||s===!1,jo=s=>{if(wl(s)!=="object")return!1;const e=Zd(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(o0 in s)&&!(vl in s)},SN=s=>{if(!Ai(s)||Si(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},AN=Es("Date"),kN=Es("File"),PN=Es("Blob"),CN=Es("FileList"),RN=s=>Ai(s)&&rs(s.pipe),DN=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||rs(s.append)&&((e=wl(s))==="formdata"||e==="object"&&rs(s.toString)&&s.toString()==="[object FormData]"))},VN=Es("URLSearchParams"),[MN,LN,ON,FN]=["ReadableStream","Request","Response","Headers"].map(Es),$N=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ki(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let n,r;if(typeof s!="object"&&(s=[s]),na(s))for(n=0,r=s.length;n<r;n++)e.call(null,s[n],n,s);else{if(Si(s))return;const i=t?Object.getOwnPropertyNames(s):Object.keys(s),o=i.length;let l;for(n=0;n<o;n++)l=i[n],e.call(null,s[l],l,s)}}function d0(s,e){if(Si(s))return null;e=e.toLowerCase();const t=Object.keys(s);let n=t.length,r;for(;n-- >0;)if(r=t[n],e===r.toLowerCase())return r;return null}const Gn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,u0=s=>!Br(s)&&s!==Gn;function Hc(){const{caseless:s,skipUndefined:e}=u0(this)&&this||{},t={},n=(r,i)=>{const o=s&&d0(t,i)||i;jo(t[o])&&jo(r)?t[o]=Hc(t[o],r):jo(r)?t[o]=Hc({},r):na(r)?t[o]=r.slice():(!e||!Br(r))&&(t[o]=r)};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&ki(arguments[r],n);return t}const UN=(s,e,t,{allOwnKeys:n}={})=>(ki(e,(r,i)=>{t&&rs(r)?s[i]=i0(r,t):s[i]=r},{allOwnKeys:n}),s),BN=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),zN=(s,e,t,n)=>{s.prototype=Object.create(e.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},GN=(s,e,t,n)=>{let r,i,o;const l={};if(e=e||{},s==null)return e;do{for(r=Object.getOwnPropertyNames(s),i=r.length;i-- >0;)o=r[i],(!n||n(o,s,e))&&!l[o]&&(e[o]=s[o],l[o]=!0);s=t!==!1&&Zd(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},qN=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const n=s.indexOf(e,t);return n!==-1&&n===t},WN=s=>{if(!s)return null;if(na(s))return s;let e=s.length;if(!c0(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},KN=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&Zd(Uint8Array)),HN=(s,e)=>{const n=(s&&s[vl]).call(s);let r;for(;(r=n.next())&&!r.done;){const i=r.value;e.call(s,i[0],i[1])}},JN=(s,e)=>{let t;const n=[];for(;(t=s.exec(e))!==null;)n.push(t);return n},QN=Es("HTMLFormElement"),YN=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),_m=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),XN=Es("RegExp"),h0=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),n={};ki(t,(r,i)=>{let o;(o=e(r,i,s))!==!1&&(n[i]=o||r)}),Object.defineProperties(s,n)},ZN=s=>{h0(s,(e,t)=>{if(rs(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=s[t];if(rs(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},e1=(s,e)=>{const t={},n=r=>{r.forEach(i=>{t[i]=!0})};return na(s)?n(s):n(String(s).split(e)),t},t1=()=>{},s1=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e;function n1(s){return!!(s&&rs(s.append)&&s[o0]==="FormData"&&s[vl])}const r1=s=>{const e=new Array(10),t=(n,r)=>{if(Ai(n)){if(e.indexOf(n)>=0)return;if(Si(n))return n;if(!("toJSON"in n)){e[r]=n;const i=na(n)?[]:{};return ki(n,(o,l)=>{const c=t(o,r+1);!Br(c)&&(i[l]=c)}),e[r]=void 0,i}}return n};return t(s,0)},a1=Es("AsyncFunction"),i1=s=>s&&(Ai(s)||rs(s))&&rs(s.then)&&rs(s.catch),m0=((s,e)=>s?setImmediate:e?((t,n)=>(Gn.addEventListener("message",({source:r,data:i})=>{r===Gn&&i===t&&n.length&&n.shift()()},!1),r=>{n.push(r),Gn.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",rs(Gn.postMessage)),o1=typeof queueMicrotask<"u"?queueMicrotask.bind(Gn):typeof process<"u"&&process.nextTick||m0,l1=s=>s!=null&&rs(s[vl]),te={isArray:na,isArrayBuffer:l0,isBuffer:Si,isFormData:DN,isArrayBufferView:EN,isString:IN,isNumber:c0,isBoolean:TN,isObject:Ai,isPlainObject:jo,isEmptyObject:SN,isReadableStream:MN,isRequest:LN,isResponse:ON,isHeaders:FN,isUndefined:Br,isDate:AN,isFile:kN,isBlob:PN,isRegExp:XN,isFunction:rs,isStream:RN,isURLSearchParams:VN,isTypedArray:KN,isFileList:CN,forEach:ki,merge:Hc,extend:UN,trim:$N,stripBOM:BN,inherits:zN,toFlatObject:GN,kindOf:wl,kindOfTest:Es,endsWith:qN,toArray:WN,forEachEntry:HN,matchAll:JN,isHTMLForm:QN,hasOwnProperty:_m,hasOwnProp:_m,reduceDescriptors:h0,freezeMethods:ZN,toObjectSet:e1,toCamelCase:YN,noop:t1,toFiniteNumber:s1,findKey:d0,global:Gn,isContextDefined:u0,isSpecCompliantForm:n1,toJSONObject:r1,isAsyncFn:a1,isThenable:i1,setImmediate:m0,asap:o1,isIterable:l1};function We(s,e,t,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}te.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:te.toJSONObject(this.config),code:this.code,status:this.status}}});const f0=We.prototype,g0={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{g0[s]={value:s}});Object.defineProperties(We,g0);Object.defineProperty(f0,"isAxiosError",{value:!0});We.from=(s,e,t,n,r,i)=>{const o=Object.create(f0);te.toFlatObject(s,o,function(h){return h!==Error.prototype},u=>u!=="isAxiosError");const l=s&&s.message?s.message:"Error",c=e==null&&s?s.code:e;return We.call(o,l,c,t,n,r),s&&o.cause==null&&Object.defineProperty(o,"cause",{value:s,configurable:!0}),o.name=s&&s.name||"Error",i&&Object.assign(o,i),o};const c1=null;function Jc(s){return te.isPlainObject(s)||te.isArray(s)}function p0(s){return te.endsWith(s,"[]")?s.slice(0,-2):s}function jm(s,e,t){return s?s.concat(e).map(function(r,i){return r=p0(r),!t&&i?"["+r+"]":r}).join(t?".":""):e}function d1(s){return te.isArray(s)&&!s.some(Jc)}const u1=te.toFlatObject(te,{},null,function(e){return/^is[A-Z]/.test(e)});function _l(s,e,t){if(!te.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=te.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,g){return!te.isUndefined(g[I])});const n=t.metaTokens,r=t.visitor||h,i=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&te.isSpecCompliantForm(e);if(!te.isFunction(r))throw new TypeError("visitor must be a function");function u(v){if(v===null)return"";if(te.isDate(v))return v.toISOString();if(te.isBoolean(v))return v.toString();if(!c&&te.isBlob(v))throw new We("Blob is not supported. Use a Buffer instead.");return te.isArrayBuffer(v)||te.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function h(v,I,g){let S=v;if(v&&!g&&typeof v=="object"){if(te.endsWith(I,"{}"))I=n?I:I.slice(0,-2),v=JSON.stringify(v);else if(te.isArray(v)&&d1(v)||(te.isFileList(v)||te.endsWith(I,"[]"))&&(S=te.toArray(v)))return I=p0(I),S.forEach(function(T,V){!(te.isUndefined(T)||T===null)&&e.append(o===!0?jm([I],V,i):o===null?I:I+"[]",u(T))}),!1}return Jc(v)?!0:(e.append(jm(g,I,i),u(v)),!1)}const m=[],p=Object.assign(u1,{defaultVisitor:h,convertValue:u,isVisitable:Jc});function N(v,I){if(!te.isUndefined(v)){if(m.indexOf(v)!==-1)throw Error("Circular reference detected in "+I.join("."));m.push(v),te.forEach(v,function(S,C){(!(te.isUndefined(S)||S===null)&&r.call(e,S,te.isString(C)?C.trim():C,I,p))===!0&&N(S,I?I.concat(C):[C])}),m.pop()}}if(!te.isObject(s))throw new TypeError("data must be an object");return N(s),e}function Em(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function eu(s,e){this._pairs=[],s&&_l(s,this,e)}const x0=eu.prototype;x0.append=function(e,t){this._pairs.push([e,t])};x0.toString=function(e){const t=e?function(n){return e.call(this,n,Em)}:Em;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function h1(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function y0(s,e,t){if(!e)return s;const n=t&&t.encode||h1;te.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let i;if(r?i=r(e,t):i=te.isURLSearchParams(e)?e.toString():new eu(e,t).toString(n),i){const o=s.indexOf("#");o!==-1&&(s=s.slice(0,o)),s+=(s.indexOf("?")===-1?"?":"&")+i}return s}class Im{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){te.forEach(this.handlers,function(n){n!==null&&e(n)})}}const b0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},m1=typeof URLSearchParams<"u"?URLSearchParams:eu,f1=typeof FormData<"u"?FormData:null,g1=typeof Blob<"u"?Blob:null,p1={isBrowser:!0,classes:{URLSearchParams:m1,FormData:f1,Blob:g1},protocols:["http","https","file","blob","url","data"]},tu=typeof window<"u"&&typeof document<"u",Qc=typeof navigator=="object"&&navigator||void 0,x1=tu&&(!Qc||["ReactNative","NativeScript","NS"].indexOf(Qc.product)<0),y1=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",b1=tu&&window.location.href||"http://localhost",v1=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tu,hasStandardBrowserEnv:x1,hasStandardBrowserWebWorkerEnv:y1,navigator:Qc,origin:b1},Symbol.toStringTag,{value:"Module"})),Ht={...v1,...p1};function w1(s,e){return _l(s,new Ht.classes.URLSearchParams,{visitor:function(t,n,r,i){return Ht.isNode&&te.isBuffer(t)?(this.append(n,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function N1(s){return te.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function _1(s){const e={},t=Object.keys(s);let n;const r=t.length;let i;for(n=0;n<r;n++)i=t[n],e[i]=s[i];return e}function v0(s){function e(t,n,r,i){let o=t[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=i>=t.length;return o=!o&&te.isArray(r)?r.length:o,c?(te.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!l):((!r[o]||!te.isObject(r[o]))&&(r[o]=[]),e(t,n,r[o],i)&&te.isArray(r[o])&&(r[o]=_1(r[o])),!l)}if(te.isFormData(s)&&te.isFunction(s.entries)){const t={};return te.forEachEntry(s,(n,r)=>{e(N1(n),r,t,0)}),t}return null}function j1(s,e,t){if(te.isString(s))try{return(e||JSON.parse)(s),te.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(s)}const Pi={transitional:b0,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=te.isObject(e);if(i&&te.isHTMLForm(e)&&(e=new FormData(e)),te.isFormData(e))return r?JSON.stringify(v0(e)):e;if(te.isArrayBuffer(e)||te.isBuffer(e)||te.isStream(e)||te.isFile(e)||te.isBlob(e)||te.isReadableStream(e))return e;if(te.isArrayBufferView(e))return e.buffer;if(te.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return w1(e,this.formSerializer).toString();if((l=te.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return _l(l?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),j1(e)):e}],transformResponse:[function(e){const t=this.transitional||Pi.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(te.isResponse(e)||te.isReadableStream(e))return e;if(e&&te.isString(e)&&(n&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(l){if(o)throw l.name==="SyntaxError"?We.from(l,We.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ht.classes.FormData,Blob:Ht.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};te.forEach(["delete","get","head","post","put","patch"],s=>{Pi.headers[s]={}});const E1=te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),I1=s=>{const e={};let t,n,r;return s&&s.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!t||e[t]&&E1[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Tm=Symbol("internals");function ja(s){return s&&String(s).trim().toLowerCase()}function Eo(s){return s===!1||s==null?s:te.isArray(s)?s.map(Eo):String(s)}function T1(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(s);)e[n[1]]=n[2];return e}const S1=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function hc(s,e,t,n,r){if(te.isFunction(n))return n.call(this,e,t);if(r&&(e=t),!!te.isString(e)){if(te.isString(n))return e.indexOf(n)!==-1;if(te.isRegExp(n))return n.test(e)}}function A1(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function k1(s,e){const t=te.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+t,{value:function(r,i,o){return this[n].call(this,e,r,i,o)},configurable:!0})})}let as=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(l,c,u){const h=ja(c);if(!h)throw new Error("header name must be a non-empty string");const m=te.findKey(r,h);(!m||r[m]===void 0||u===!0||u===void 0&&r[m]!==!1)&&(r[m||c]=Eo(l))}const o=(l,c)=>te.forEach(l,(u,h)=>i(u,h,c));if(te.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(te.isString(e)&&(e=e.trim())&&!S1(e))o(I1(e),t);else if(te.isObject(e)&&te.isIterable(e)){let l={},c,u;for(const h of e){if(!te.isArray(h))throw TypeError("Object iterator must return a key-value pair");l[u=h[0]]=(c=l[u])?te.isArray(c)?[...c,h[1]]:[c,h[1]]:h[1]}o(l,t)}else e!=null&&i(t,e,n);return this}get(e,t){if(e=ja(e),e){const n=te.findKey(this,e);if(n){const r=this[n];if(!t)return r;if(t===!0)return T1(r);if(te.isFunction(t))return t.call(this,r,n);if(te.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ja(e),e){const n=te.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||hc(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let r=!1;function i(o){if(o=ja(o),o){const l=te.findKey(n,o);l&&(!t||hc(n,n[l],l,t))&&(delete n[l],r=!0)}}return te.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];(!e||hc(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return te.forEach(this,(r,i)=>{const o=te.findKey(n,i);if(o){t[o]=Eo(r),delete t[i];return}const l=e?A1(i):String(i).trim();l!==i&&delete t[i],t[l]=Eo(r),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return te.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&te.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[Tm]=this[Tm]={accessors:{}}).accessors,r=this.prototype;function i(o){const l=ja(o);n[l]||(k1(r,o),n[l]=!0)}return te.isArray(e)?e.forEach(i):i(e),this}};as.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);te.reduceDescriptors(as.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(n){this[t]=n}}});te.freezeMethods(as);function mc(s,e){const t=this||Pi,n=e||t,r=as.from(n.headers);let i=n.data;return te.forEach(s,function(l){i=l.call(t,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function w0(s){return!!(s&&s.__CANCEL__)}function ra(s,e,t){We.call(this,s??"canceled",We.ERR_CANCELED,e,t),this.name="CanceledError"}te.inherits(ra,We,{__CANCEL__:!0});function N0(s,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?s(t):e(new We("Request failed with status code "+t.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function P1(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function C1(s,e){s=s||10;const t=new Array(s),n=new Array(s);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),h=n[i];o||(o=u),t[r]=c,n[r]=u;let m=i,p=0;for(;m!==r;)p+=t[m++],m=m%s;if(r=(r+1)%s,r===i&&(i=(i+1)%s),u-o<e)return;const N=h&&u-h;return N?Math.round(p*1e3/N):void 0}}function R1(s,e){let t=0,n=1e3/e,r,i;const o=(u,h=Date.now())=>{t=h,r=null,i&&(clearTimeout(i),i=null),s(...u)};return[(...u)=>{const h=Date.now(),m=h-t;m>=n?o(u,h):(r=u,i||(i=setTimeout(()=>{i=null,o(r)},n-m)))},()=>r&&o(r)]}const Go=(s,e,t=3)=>{let n=0;const r=C1(50,250);return R1(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,c=o-n,u=r(c),h=o<=l;n=o;const m={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:u||void 0,estimated:u&&l&&h?(l-o)/u:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};s(m)},t)},Sm=(s,e)=>{const t=s!=null;return[n=>e[0]({lengthComputable:t,total:s,loaded:n}),e[1]]},Am=s=>(...e)=>te.asap(()=>s(...e)),D1=Ht.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,Ht.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(Ht.origin),Ht.navigator&&/(msie|trident)/i.test(Ht.navigator.userAgent)):()=>!0,V1=Ht.hasStandardBrowserEnv?{write(s,e,t,n,r,i,o){if(typeof document>"u")return;const l=[`${s}=${encodeURIComponent(e)}`];te.isNumber(t)&&l.push(`expires=${new Date(t).toUTCString()}`),te.isString(n)&&l.push(`path=${n}`),te.isString(r)&&l.push(`domain=${r}`),i===!0&&l.push("secure"),te.isString(o)&&l.push(`SameSite=${o}`),document.cookie=l.join("; ")},read(s){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+s+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(s){this.write(s,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function M1(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function L1(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function _0(s,e,t){let n=!M1(e);return s&&(n||t==!1)?L1(s,e):e}const km=s=>s instanceof as?{...s}:s;function tr(s,e){e=e||{};const t={};function n(u,h,m,p){return te.isPlainObject(u)&&te.isPlainObject(h)?te.merge.call({caseless:p},u,h):te.isPlainObject(h)?te.merge({},h):te.isArray(h)?h.slice():h}function r(u,h,m,p){if(te.isUndefined(h)){if(!te.isUndefined(u))return n(void 0,u,m,p)}else return n(u,h,m,p)}function i(u,h){if(!te.isUndefined(h))return n(void 0,h)}function o(u,h){if(te.isUndefined(h)){if(!te.isUndefined(u))return n(void 0,u)}else return n(void 0,h)}function l(u,h,m){if(m in e)return n(u,h);if(m in s)return n(void 0,u)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(u,h,m)=>r(km(u),km(h),m,!0)};return te.forEach(Object.keys({...s,...e}),function(h){const m=c[h]||r,p=m(s[h],e[h],h);te.isUndefined(p)&&m!==l||(t[h]=p)}),t}const j0=s=>{const e=tr({},s);let{data:t,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:l}=e;if(e.headers=o=as.from(o),e.url=y0(_0(e.baseURL,e.url,e.allowAbsoluteUrls),s.params,s.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),te.isFormData(t)){if(Ht.hasStandardBrowserEnv||Ht.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(te.isFunction(t.getHeaders)){const c=t.getHeaders(),u=["content-type","content-length"];Object.entries(c).forEach(([h,m])=>{u.includes(h.toLowerCase())&&o.set(h,m)})}}if(Ht.hasStandardBrowserEnv&&(n&&te.isFunction(n)&&(n=n(e)),n||n!==!1&&D1(e.url))){const c=r&&i&&V1.read(i);c&&o.set(r,c)}return e},O1=typeof XMLHttpRequest<"u",F1=O1&&function(s){return new Promise(function(t,n){const r=j0(s);let i=r.data;const o=as.from(r.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:u}=r,h,m,p,N,v;function I(){N&&N(),v&&v(),r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function S(){if(!g)return;const T=as.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),P={data:!l||l==="text"||l==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:T,config:s,request:g};N0(function(b){t(b),I()},function(b){n(b),I()},P),g=null}"onloadend"in g?g.onloadend=S:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(S)},g.onabort=function(){g&&(n(new We("Request aborted",We.ECONNABORTED,s,g)),g=null)},g.onerror=function(V){const P=V&&V.message?V.message:"Network Error",k=new We(P,We.ERR_NETWORK,s,g);k.event=V||null,n(k),g=null},g.ontimeout=function(){let V=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const P=r.transitional||b0;r.timeoutErrorMessage&&(V=r.timeoutErrorMessage),n(new We(V,P.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,s,g)),g=null},i===void 0&&o.setContentType(null),"setRequestHeader"in g&&te.forEach(o.toJSON(),function(V,P){g.setRequestHeader(P,V)}),te.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),l&&l!=="json"&&(g.responseType=r.responseType),u&&([p,v]=Go(u,!0),g.addEventListener("progress",p)),c&&g.upload&&([m,N]=Go(c),g.upload.addEventListener("progress",m),g.upload.addEventListener("loadend",N)),(r.cancelToken||r.signal)&&(h=T=>{g&&(n(!T||T.type?new ra(null,s,g):T),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const C=P1(r.url);if(C&&Ht.protocols.indexOf(C)===-1){n(new We("Unsupported protocol "+C+":",We.ERR_BAD_REQUEST,s));return}g.send(i||null)})},$1=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let n=new AbortController,r;const i=function(u){if(!r){r=!0,l();const h=u instanceof Error?u:this.reason;n.abort(h instanceof We?h:new ra(h instanceof Error?h.message:h))}};let o=e&&setTimeout(()=>{o=null,i(new We(`timeout ${e} of ms exceeded`,We.ETIMEDOUT))},e);const l=()=>{s&&(o&&clearTimeout(o),o=null,s.forEach(u=>{u.unsubscribe?u.unsubscribe(i):u.removeEventListener("abort",i)}),s=null)};s.forEach(u=>u.addEventListener("abort",i));const{signal:c}=n;return c.unsubscribe=()=>te.asap(l),c}},U1=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let n=0,r;for(;n<t;)r=n+e,yield s.slice(n,r),n=r},B1=async function*(s,e){for await(const t of z1(s))yield*U1(t,e)},z1=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},Pm=(s,e,t,n)=>{const r=B1(s,e);let i=0,o,l=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:u,value:h}=await r.next();if(u){l(),c.close();return}let m=h.byteLength;if(t){let p=i+=m;t(p)}c.enqueue(new Uint8Array(h))}catch(u){throw l(u),u}},cancel(c){return l(c),r.return()}},{highWaterMark:2})},Cm=64*1024,{isFunction:lo}=te,G1=(({Request:s,Response:e})=>({Request:s,Response:e}))(te.global),{ReadableStream:Rm,TextEncoder:Dm}=te.global,Vm=(s,...e)=>{try{return!!s(...e)}catch{return!1}},q1=s=>{s=te.merge.call({skipUndefined:!0},G1,s);const{fetch:e,Request:t,Response:n}=s,r=e?lo(e):typeof fetch=="function",i=lo(t),o=lo(n);if(!r)return!1;const l=r&&lo(Rm),c=r&&(typeof Dm=="function"?(v=>I=>v.encode(I))(new Dm):async v=>new Uint8Array(await new t(v).arrayBuffer())),u=i&&l&&Vm(()=>{let v=!1;const I=new t(Ht.origin,{body:new Rm,method:"POST",get duplex(){return v=!0,"half"}}).headers.has("Content-Type");return v&&!I}),h=o&&l&&Vm(()=>te.isReadableStream(new n("").body)),m={stream:h&&(v=>v.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(v=>{!m[v]&&(m[v]=(I,g)=>{let S=I&&I[v];if(S)return S.call(I);throw new We(`Response type '${v}' is not supported`,We.ERR_NOT_SUPPORT,g)})});const p=async v=>{if(v==null)return 0;if(te.isBlob(v))return v.size;if(te.isSpecCompliantForm(v))return(await new t(Ht.origin,{method:"POST",body:v}).arrayBuffer()).byteLength;if(te.isArrayBufferView(v)||te.isArrayBuffer(v))return v.byteLength;if(te.isURLSearchParams(v)&&(v=v+""),te.isString(v))return(await c(v)).byteLength},N=async(v,I)=>{const g=te.toFiniteNumber(v.getContentLength());return g??p(I)};return async v=>{let{url:I,method:g,data:S,signal:C,cancelToken:T,timeout:V,onDownloadProgress:P,onUploadProgress:k,responseType:b,headers:x,withCredentials:w="same-origin",fetchOptions:E}=j0(v),A=e||fetch;b=b?(b+"").toLowerCase():"text";let D=$1([C,T&&T.toAbortSignal()],V),j=null;const K=D&&D.unsubscribe&&(()=>{D.unsubscribe()});let X;try{if(k&&u&&g!=="get"&&g!=="head"&&(X=await N(x,S))!==0){let z=new t(I,{method:"POST",body:S,duplex:"half"}),le;if(te.isFormData(S)&&(le=z.headers.get("content-type"))&&x.setContentType(le),z.body){const[he,Ne]=Sm(X,Go(Am(k)));S=Pm(z.body,Cm,he,Ne)}}te.isString(w)||(w=w?"include":"omit");const W=i&&"credentials"in t.prototype,se={...E,signal:D,method:g.toUpperCase(),headers:x.normalize().toJSON(),body:S,duplex:"half",credentials:W?w:void 0};j=i&&new t(I,se);let M=await(i?A(j,E):A(I,se));const L=h&&(b==="stream"||b==="response");if(h&&(P||L&&K)){const z={};["status","statusText","headers"].forEach(_e=>{z[_e]=M[_e]});const le=te.toFiniteNumber(M.headers.get("content-length")),[he,Ne]=P&&Sm(le,Go(Am(P),!0))||[];M=new n(Pm(M.body,Cm,he,()=>{Ne&&Ne(),K&&K()}),z)}b=b||"text";let Y=await m[te.findKey(m,b)||"text"](M,v);return!L&&K&&K(),await new Promise((z,le)=>{N0(z,le,{data:Y,headers:as.from(M.headers),status:M.status,statusText:M.statusText,config:v,request:j})})}catch(W){throw K&&K(),W&&W.name==="TypeError"&&/Load failed|fetch/i.test(W.message)?Object.assign(new We("Network Error",We.ERR_NETWORK,v,j),{cause:W.cause||W}):We.from(W,W&&W.code,v,j)}}},W1=new Map,E0=s=>{let e=s&&s.env||{};const{fetch:t,Request:n,Response:r}=e,i=[n,r,t];let o=i.length,l=o,c,u,h=W1;for(;l--;)c=i[l],u=h.get(c),u===void 0&&h.set(c,u=l?new Map:q1(e)),h=u;return u};E0();const su={http:c1,xhr:F1,fetch:{get:E0}};te.forEach(su,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const Mm=s=>`- ${s}`,K1=s=>te.isFunction(s)||s===null||s===!1;function H1(s,e){s=te.isArray(s)?s:[s];const{length:t}=s;let n,r;const i={};for(let o=0;o<t;o++){n=s[o];let l;if(r=n,!K1(n)&&(r=su[(l=String(n)).toLowerCase()],r===void 0))throw new We(`Unknown adapter '${l}'`);if(r&&(te.isFunction(r)||(r=r.get(e))))break;i[l||"#"+o]=r}if(!r){const o=Object.entries(i).map(([c,u])=>`adapter ${c} `+(u===!1?"is not supported by the environment":"is not available in the build"));let l=t?o.length>1?`since :
`+o.map(Mm).join(`
`):" "+Mm(o[0]):"as no adapter specified";throw new We("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return r}const I0={getAdapter:H1,adapters:su};function fc(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new ra(null,s)}function Lm(s){return fc(s),s.headers=as.from(s.headers),s.data=mc.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),I0.getAdapter(s.adapter||Pi.adapter,s)(s).then(function(n){return fc(s),n.data=mc.call(s,s.transformResponse,n),n.headers=as.from(n.headers),n},function(n){return w0(n)||(fc(s),n&&n.response&&(n.response.data=mc.call(s,s.transformResponse,n.response),n.response.headers=as.from(n.response.headers))),Promise.reject(n)})}const T0="1.13.2",jl={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{jl[s]=function(n){return typeof n===s||"a"+(e<1?"n ":" ")+s}});const Om={};jl.transitional=function(e,t,n){function r(i,o){return"[Axios v"+T0+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,l)=>{if(e===!1)throw new We(r(o," has been removed"+(t?" in "+t:"")),We.ERR_DEPRECATED);return t&&!Om[o]&&(Om[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,l):!0}};jl.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function J1(s,e,t){if(typeof s!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let r=n.length;for(;r-- >0;){const i=n[r],o=e[i];if(o){const l=s[i],c=l===void 0||o(l,i,s);if(c!==!0)throw new We("option "+i+" must be "+c,We.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new We("Unknown option "+i,We.ERR_BAD_OPTION)}}const Io={assertOptions:J1,validators:jl},Is=Io.validators;let Jn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Im,response:new Im}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=tr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&Io.assertOptions(n,{silentJSONParsing:Is.transitional(Is.boolean),forcedJSONParsing:Is.transitional(Is.boolean),clarifyTimeoutError:Is.transitional(Is.boolean)},!1),r!=null&&(te.isFunction(r)?t.paramsSerializer={serialize:r}:Io.assertOptions(r,{encode:Is.function,serialize:Is.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Io.assertOptions(t,{baseUrl:Is.spelling("baseURL"),withXsrfToken:Is.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&te.merge(i.common,i[t.method]);i&&te.forEach(["delete","get","head","post","put","patch","common"],v=>{delete i[v]}),t.headers=as.concat(o,i);const l=[];let c=!0;this.interceptors.request.forEach(function(I){typeof I.runWhen=="function"&&I.runWhen(t)===!1||(c=c&&I.synchronous,l.unshift(I.fulfilled,I.rejected))});const u=[];this.interceptors.response.forEach(function(I){u.push(I.fulfilled,I.rejected)});let h,m=0,p;if(!c){const v=[Lm.bind(this),void 0];for(v.unshift(...l),v.push(...u),p=v.length,h=Promise.resolve(t);m<p;)h=h.then(v[m++],v[m++]);return h}p=l.length;let N=t;for(;m<p;){const v=l[m++],I=l[m++];try{N=v(N)}catch(g){I.call(this,g);break}}try{h=Lm.call(this,N)}catch(v){return Promise.reject(v)}for(m=0,p=u.length;m<p;)h=h.then(u[m++],u[m++]);return h}getUri(e){e=tr(this.defaults,e);const t=_0(e.baseURL,e.url,e.allowAbsoluteUrls);return y0(t,e.params,e.paramsSerializer)}};te.forEach(["delete","get","head","options"],function(e){Jn.prototype[e]=function(t,n){return this.request(tr(n||{},{method:e,url:t,data:(n||{}).data}))}});te.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,l){return this.request(tr(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Jn.prototype[e]=t(),Jn.prototype[e+"Form"]=t(!0)});let Q1=class S0{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const n=this;this.promise.then(r=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](r);n._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(l=>{n.subscribe(l),i=l}).then(r);return o.cancel=function(){n.unsubscribe(i)},o},e(function(i,o,l){n.reason||(n.reason=new ra(i,o,l),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new S0(function(r){e=r}),cancel:e}}};function Y1(s){return function(t){return s.apply(null,t)}}function X1(s){return te.isObject(s)&&s.isAxiosError===!0}const Yc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Yc).forEach(([s,e])=>{Yc[e]=s});function A0(s){const e=new Jn(s),t=i0(Jn.prototype.request,e);return te.extend(t,Jn.prototype,e,{allOwnKeys:!0}),te.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return A0(tr(s,r))},t}const ce=A0(Pi);ce.Axios=Jn;ce.CanceledError=ra;ce.CancelToken=Q1;ce.isCancel=w0;ce.VERSION=T0;ce.toFormData=_l;ce.AxiosError=We;ce.Cancel=ce.CanceledError;ce.all=function(e){return Promise.all(e)};ce.spread=Y1;ce.isAxiosError=X1;ce.mergeConfig=tr;ce.AxiosHeaders=as;ce.formToJSON=s=>v0(te.isHTMLForm(s)?new FormData(s):s);ce.getAdapter=I0.getAdapter;ce.HttpStatusCode=Yc;ce.default=ce;const{Axios:g3,AxiosError:p3,CanceledError:x3,isCancel:y3,CancelToken:b3,VERSION:v3,all:w3,Cancel:N3,isAxiosError:_3,spread:j3,toFormData:E3,AxiosHeaders:I3,HttpStatusCode:T3,formToJSON:S3,getAdapter:A3,mergeConfig:k3}=ce,Z1=()=>{const[s,e]=_.useState({email:"",password:""}),[t,n]=_.useState({}),[r,i]=_.useState(!1),[o,l]=_.useState(""),c=ft(),{showNotification:u}=yt();_.useEffect(()=>{const v=localStorage.getItem("token"),I=localStorage.getItem("user");if(v&&I)try{const S=JSON.parse(I).role;S==="admin"?c("/admin-dashboard",{replace:!0}):S==="employee"?c("/employee-dashboard",{replace:!0}):c("/dashboard",{replace:!0})}catch{localStorage.removeItem("token"),localStorage.removeItem("user")}},[c]);const h=v=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v),m=v=>{const{name:I,value:g}=v.target;e(S=>({...S,[I]:g})),t[I]&&n(S=>({...S,[I]:""}))},p=()=>{const v={};return s.email?h(s.email)||(v.email="Please enter a valid email address"):v.email="Email is required",s.password||(v.password="Password is required"),n(v),Object.keys(v).length===0},N=async v=>{var I,g,S,C,T,V;if(v.preventDefault(),l(""),!p()){if(!s.email||!s.password){const P="Please fill in all required fields";l(P),u({type:"error",message:P})}else if(!h(s.email)){const P="Please enter a valid email address";l(P),u({type:"error",message:P})}return}i(!0),l("");try{console.log("Attempting login...",{email:s.email});const P=await ce.post("http://localhost:3000/api/auth/login",{email:s.email,password:s.password},{timeout:1e4});if(console.log("Login response:",P.data),P.data.success){(I=P.data.data)!=null&&I.token&&(localStorage.setItem("token",P.data.data.token),console.log("Token stored")),(g=P.data.data)!=null&&g.user&&(localStorage.setItem("user",JSON.stringify(P.data.data.user)),console.log("User data stored:",P.data.data.user));const k=((C=(S=P.data.data)==null?void 0:S.user)==null?void 0:C.role)||"user";console.log("Redirecting to dashboard for role:",k),k==="admin"?c("/admin-dashboard",{replace:!0}):k==="employee"?c("/employee-dashboard",{replace:!0}):c("/dashboard",{replace:!0})}else{const k=P.data.message||"Login failed. Please check your credentials and try again.";console.error("Login failed:",k),l(k),u({type:"error",message:k})}}catch(P){console.error("Login error:",P),console.error("Error details:",{message:P.message,response:(T=P.response)==null?void 0:T.data,status:(V=P.response)==null?void 0:V.status,code:P.code});let k="An error occurred. Please try again.";if(P.response){const b=P.response.status,x=P.response.data;x!=null&&x.message?k=x.message:b===401?k="Invalid email or password":b===404?k="User not found. Please check your email.":b===403?k="Access denied. Please contact support.":b===500?k="Server error. Please try again later.":b===503?k="Service unavailable. Please check your connection.":k=`Login failed (${b}). Please try again.`}else P.request?P.code==="ECONNABORTED"||P.message.includes("timeout")?k="Request timeout. Please check your connection and try again.":P.code==="ERR_NETWORK"||P.message.includes("Network Error")?k="Network error. Please check your internet connection.":P.code==="ECONNREFUSED"?k="Cannot connect to server. Make sure the backend is running on http://localhost:3000":k="Network error. Please check your connection and try again.":k=P.message||"An unexpected error occurred. Please try again.";l(k),u({type:"error",message:k})}finally{i(!1)}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 px-4 py-8 sm:py-12",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl p-8 sm:p-10 space-y-8 border border-white/20",children:[a.jsxs("div",{className:"text-center space-y-3",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-2xl shadow-lg mb-2",children:a.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),a.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent",children:"Welcome Back"}),a.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Achieve your fitness goals with us."})]}),o&&a.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 rounded-xl animate-fade-in",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-red-500 mt-0.5",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsx("div",{className:"ml-3 flex-1",children:a.jsx("p",{className:"text-sm text-red-700 font-medium",children:o})})]})}),a.jsxs("form",{onSubmit:N,className:"space-y-6",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-700",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),a.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:m,className:`w-full pl-12 pr-4 py-3.5 rounded-xl border-2 transition-all duration-200 ${t.email?"border-red-300 focus:ring-2 focus:ring-red-500 focus:border-red-500":"border-gray-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-400"} focus:outline-none bg-gray-50/50 hover:bg-gray-50 placeholder:text-gray-400`,placeholder:"your.email@example.com",autoComplete:"email"})]}),t.email&&a.jsxs("p",{className:"mt-1.5 text-sm text-red-600 flex items-center",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.email]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700",children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),a.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:m,className:`w-full pl-12 pr-4 py-3.5 rounded-xl border-2 transition-all duration-200 ${t.password?"border-red-300 focus:ring-2 focus:ring-red-500 focus:border-red-500":"border-gray-200 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-400"} focus:outline-none bg-gray-50/50 hover:bg-gray-50 placeholder:text-gray-400`,placeholder:"Enter your password",autoComplete:"current-password"})]}),t.password&&a.jsxs("p",{className:"mt-1.5 text-sm text-red-600 flex items-center",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.password]})]}),a.jsx("button",{type:"submit",disabled:r,className:`w-full py-4 px-6 rounded-xl font-semibold text-white text-base transition-all duration-300 ${r?"bg-emerald-400 cursor-not-allowed":"bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0"} focus:outline-none focus:ring-4 focus:ring-emerald-300 focus:ring-offset-2`,children:r?a.jsxs("span",{className:"flex items-center justify-center",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Logging in..."]}):a.jsxs("span",{className:"flex items-center justify-center",children:["Sign In",a.jsx("svg",{className:"ml-2 w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]}),a.jsx("div",{className:"text-center pt-4 border-t border-gray-100",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",a.jsx("button",{onClick:()=>c("/contact-admin"),className:"text-emerald-600 hover:text-teal-600 font-semibold transition-colors duration-200 hover:underline focus:outline-none focus:ring-2 focus:ring-emerald-300 rounded px-1",children:"Hutle Get an Account"})]})})]})})})},e_=()=>{console.log("LoginTwoColumn component rendering...");const[s,e]=_.useState({email:"",password:""}),[t,n]=_.useState({}),[r,i]=_.useState(!1),[o,l]=_.useState(""),[c,u]=_.useState(!1),[h,m]=_.useState(!1),p=ft(),{showNotification:N}=yt();_.useEffect(()=>{e({email:"",password:""}),n({}),l(""),setTimeout(()=>m(!0),100),setTimeout(()=>u(!0),300)},[]),_.useEffect(()=>{const C=localStorage.getItem("token"),T=localStorage.getItem("user");if(C&&T)try{const V=JSON.parse(T);if(V&&V.role){const P=V.role;if(P==="admin")p("/admin",{replace:!0});else if(P==="employee"){const k=V.uid||"";p(`/employee/${k}`,{replace:!0})}else P==="user"?p("/dashboard",{replace:!0}):(localStorage.removeItem("token"),localStorage.removeItem("user"))}else localStorage.removeItem("token"),localStorage.removeItem("user")}catch(V){console.error("Error parsing user data:",V),localStorage.removeItem("token"),localStorage.removeItem("user")}},[p]);const v=C=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C),I=C=>{const{name:T,value:V}=C.target;e(P=>({...P,[T]:V})),t[T]&&n(P=>({...P,[T]:""})),o&&l("")},g=()=>{const C={};return s.email?v(s.email)||(C.email="Please enter a valid email address"):C.email="Email is required",s.password?s.password.length<6&&(C.password="Password must be at least 6 characters"):C.password="Password is required",n(C),Object.keys(C).length===0},S=async C=>{var T,V,P,k,b,x;if(C.preventDefault(),l(""),!g()){if(!s.email||!s.password){const w="Please fill in all required fields";l(w),N({type:"error",message:w})}return}i(!0);try{const w=await ce.post("http://localhost:3000/api/auth/login",{email:s.email,password:s.password},{timeout:1e4});if(w.data.success){(T=w.data.data)!=null&&T.token&&localStorage.setItem("token",w.data.data.token),(V=w.data.data)!=null&&V.user&&localStorage.setItem("user",JSON.stringify(w.data.data.user)),N({type:"success",message:"Login successful!"});const E=((k=(P=w.data.data)==null?void 0:P.user)==null?void 0:k.role)||"user",A=((x=(b=w.data.data)==null?void 0:b.user)==null?void 0:x.uid)||"";setTimeout(()=>{E==="admin"?p("/admin",{replace:!0}):E==="employee"?p(`/employee/${A}`,{replace:!0}):p("/dashboard",{replace:!0})},500)}else{const E=w.data.message||"Login failed. Please check your credentials.";l(E),N({type:"error",message:E})}}catch(w){let E="An error occurred. Please try again.";if(w.response){const A=w.response.status,D=w.response.data;D!=null&&D.message?E=D.message:A===401?E="Invalid email or password":A===404?E="User not found. Please check your email.":E=`Login failed (${A}). Please try again.`}else w.request&&(w.code==="ECONNABORTED"||w.message.includes("timeout")?E="Request timeout. Please check your connection.":w.code==="ERR_NETWORK"?E="Network error. Please check your internet connection.":w.code==="ECONNREFUSED"&&(E="Cannot connect to server. Make sure the backend is running."));l(E),N({type:"error",message:E})}finally{i(!1)}};return a.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 sm:p-6 lg:p-8 text-white",children:a.jsxs("div",{className:"w-full max-w-6xl bg-black border border-gray-800 rounded-3xl shadow-2xl overflow-hidden flex flex-col lg:flex-row",children:[a.jsxs("div",{className:"relative w-full lg:w-1/2 bg-gradient-to-br from-black via-gray-900 to-black p-8 lg:p-12 flex flex-col justify-between min-h-[500px] lg:min-h-auto",children:[a.jsx("div",{className:"mb-8",children:a.jsxs("div",{className:"inline-flex items-center space-x-2",children:[a.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),a.jsx("span",{className:"text-white text-xl font-bold",children:"FitFix"})]})}),a.jsx("div",{className:"flex-1 flex items-center",children:a.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white leading-tight",children:"Software which fits your need perfectly"})}),a.jsx("div",{className:`absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/4 lg:translate-x-1/3 transition-all duration-1000 ease-out ${h?"opacity-100 translate-x-1/4 lg:translate-x-1/3":"opacity-0 translate-x-0"}`,children:a.jsxs("div",{className:"w-64 h-64 lg:w-80 lg:h-80 rounded-full overflow-hidden shadow-2xl hover:scale-105 transition-transform duration-300 ring-4 ring-white/20",children:[a.jsx("img",{src:"/hero-image.png",alt:"Fitness hero illustration",className:"w-full h-full object-cover",onError:C=>{C.target.style.display="none",C.target.nextElementSibling.style.display="flex"}}),a.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/20 to-white/5 backdrop-blur-md flex items-center justify-center hidden",children:a.jsx("svg",{className:"w-32 h-32 lg:w-40 lg:h-40 text-white/80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),a.jsx("div",{className:"w-full lg:w-1/2 bg-black p-8 lg:p-12 flex items-center border-t lg:border-t-0 lg:border-l border-gray-800",children:a.jsxs("div",{className:`w-full max-w-md mx-auto transition-all duration-700 ${c?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[o&&a.jsx("div",{className:"mb-6 bg-red-500/10 border-l-4 border-red-500 p-4 rounded-r-lg",children:a.jsx("p",{className:"text-sm text-red-200 font-medium",children:o})}),a.jsxs("form",{onSubmit:S,className:"space-y-6",noValidate:!0,autoComplete:"off",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-200 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),a.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:I,className:`w-full pl-12 pr-4 py-3.5 rounded-xl border-2 transition-all duration-200 ${t.email?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":"border-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"} focus:outline-none bg-gray-900 text-white placeholder:text-gray-500`,placeholder:"Enter your email",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:"false","aria-label":"Email address","aria-invalid":t.email?"true":"false","aria-describedby":t.email?"email-error":void 0})]}),t.email&&a.jsxs("p",{id:"email-error",className:"mt-2 text-sm text-red-400 flex items-center",role:"alert",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.email]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2",children:a.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-200",children:"Password"})}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),a.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:I,className:`w-full pl-12 pr-4 py-3.5 rounded-xl border-2 transition-all duration-200 ${t.password?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":"border-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"} focus:outline-none bg-gray-900 text-white placeholder:text-gray-500`,placeholder:"Enter your password",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:"false","aria-label":"Password","aria-invalid":t.password?"true":"false","aria-describedby":t.password?"password-error":void 0})]}),t.password&&a.jsxs("p",{id:"password-error",className:"mt-2 text-sm text-red-400 flex items-center",role:"alert",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t.password]})]}),a.jsx("button",{type:"submit",disabled:r,className:`w-full py-4 px-6 rounded-xl font-semibold text-white text-base transition-all duration-300 ${r?"bg-emerald-700/60 cursor-not-allowed":"bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98]"} focus:outline-none focus:ring-4 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-black`,"aria-label":"Sign in to your account",children:r?a.jsxs("span",{className:"flex items-center justify-center",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Logging in..."]}):"LOGIN"}),a.jsx("div",{className:"mt-6 pt-6 border-t border-gray-800/70",children:a.jsxs("p",{className:"text-center text-sm text-gray-300",children:["Don't have an account?"," ",a.jsx("button",{type:"button",onClick:()=>p("/contact-admin"),className:"text-emerald-400 hover:text-emerald-300 font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 rounded px-1","aria-label":"Contact admin to create an account",children:"Get Account"})]})})]})]})})]})})},ut=({children:s,requiredRole:e=null,allowRoles:t=null})=>{const n=localStorage.getItem("token"),r=localStorage.getItem("user");let i=null;try{i=r?JSON.parse(r):null}catch(m){console.error("Error parsing user data from localStorage:",m)}const o=m=>{try{if(!m)return null;const p=m.split(".");if(p.length!==3)return null;const N=p[1];return JSON.parse(atob(N))}catch(p){return console.error("Error decoding token:",p),null}},l=()=>{if(i!=null&&i.role)return i.role;if(n){const m=o(n);return(m==null?void 0:m.role)||null}return null},c=()=>!!n&&!!i,u=()=>{if(!e&&!t)return!0;const m=l();return m?e?m===e:t&&Array.isArray(t)?t.includes(m):!1:!1},h=m=>{switch(m){case"admin":return"/admin-dashboard";case"employee":return"/employee-dashboard";case"user":return"/dashboard";default:return"/login"}};if(!c())return a.jsx(zo,{to:"/login",replace:!0});if(!u()){const m=l(),p=h(m);return a.jsx(zo,{to:p,replace:!0,state:{message:`Access denied. This page requires ${e||(t==null?void 0:t.join(" or "))} role.`}})}return a.jsx(a.Fragment,{children:s})};var Fm={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let r=s.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},t_=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const r=s[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const i=s[t++];e[n++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=s[t++],o=s[t++],l=s[t++],c=((r&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const i=s[t++],o=s[t++];e[n++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},P0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<s.length;r+=3){const i=s[r],o=r+1<s.length,l=o?s[r+1]:0,c=r+2<s.length,u=c?s[r+2]:0,h=i>>2,m=(i&3)<<4|l>>4;let p=(l&15)<<2|u>>6,N=u&63;c||(N=64,o||(p=64)),n.push(t[h],t[m],t[p],t[N])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(k0(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):t_(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<s.length;){const i=t[s.charAt(r++)],l=r<s.length?t[s.charAt(r)]:0;++r;const u=r<s.length?t[s.charAt(r)]:64;++r;const m=r<s.length?t[s.charAt(r)]:64;if(++r,i==null||l==null||u==null||m==null)throw new s_;const p=i<<2|l>>4;if(n.push(p),u!==64){const N=l<<4&240|u>>2;if(n.push(N),m!==64){const v=u<<6&192|m;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class s_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const n_=function(s){const e=k0(s);return P0.encodeByteArray(e,!0)},qo=function(s){return n_(s).replace(/\./g,"")},C0=function(s){try{return P0.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a_=()=>r_().__FIREBASE_DEFAULTS__,i_=()=>{if(typeof process>"u"||typeof Fm>"u")return;const s=Fm.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},o_=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&C0(s[1]);return e&&JSON.parse(e)},El=()=>{try{return a_()||i_()||o_()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},R0=s=>{var e,t;return(t=(e=El())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[s]},l_=s=>{const e=R0(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},D0=()=>{var s;return(s=El())===null||s===void 0?void 0:s.config},V0=s=>{var e;return(e=El())===null||e===void 0?void 0:e[`_${s}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d_(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=s.iat||0,i=s.sub||s.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},s);return[qo(JSON.stringify(t)),qo(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function u_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Lt())}function h_(){var s;const e=(s=El())===null||s===void 0?void 0:s.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function m_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function f_(){const s=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof s=="object"&&s.id!==void 0}function g_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function p_(){const s=Lt();return s.indexOf("MSIE ")>=0||s.indexOf("Trident/")>=0}function M0(){return!h_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L0(){try{return typeof indexedDB=="object"}catch{return!1}}function x_(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_="FirebaseError";class Js extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=y_,Object.setPrototypeOf(this,Js.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ci.prototype.create)}}class Ci{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?b_(i,n):"Error",l=`${this.serviceName}: ${o} (${r}).`;return new Js(r,l,n)}}function b_(s,e){return s.replace(v_,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const v_=/\{\$([^}]+)}/g;function w_(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}function Wo(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const i=s[r],o=e[r];if($m(i)&&$m(o)){if(!Wo(i,o))return!1}else if(i!==o)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function $m(s){return s!==null&&typeof s=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(s){const e=[];for(const[t,n]of Object.entries(s))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function N_(s,e){const t=new __(s,e);return t.subscribe.bind(t)}class __{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");j_(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:n},r.next===void 0&&(r.next=gc),r.error===void 0&&(r.error=gc),r.complete===void 0&&(r.complete=gc);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function j_(s,e){if(typeof s!="object"||s===null)return!1;for(const t of e)if(t in s&&typeof s[t]=="function")return!0;return!1}function gc(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function us(s){return s&&s._delegate?s._delegate:s}class sr{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ln="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new c_;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(T_(e))try{this.getOrInitializeService({instanceIdentifier:Ln})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});n.resolve(i)}catch{}}}}clearInstance(e=Ln){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ln){return this.instances.has(e)}getOptions(e=Ln){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);n===l&&o.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(r))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:I_(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Ln){return this.component?this.component.multipleInstances?e:Ln:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function I_(s){return s===Ln?void 0:s}function T_(s){return s.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new E_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(Ye||(Ye={}));const A_={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},k_=Ye.INFO,P_={[Ye.DEBUG]:"log",[Ye.VERBOSE]:"log",[Ye.INFO]:"info",[Ye.WARN]:"warn",[Ye.ERROR]:"error"},C_=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),r=P_[e];if(r)console[r](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class nu{constructor(e){this.name=e,this._logLevel=k_,this._logHandler=C_,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?A_[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ye.DEBUG,...e),this._logHandler(this,Ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ye.VERBOSE,...e),this._logHandler(this,Ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ye.INFO,...e),this._logHandler(this,Ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ye.WARN,...e),this._logHandler(this,Ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ye.ERROR,...e),this._logHandler(this,Ye.ERROR,...e)}}const R_=(s,e)=>e.some(t=>s instanceof t);let Um,Bm;function D_(){return Um||(Um=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function V_(){return Bm||(Bm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const O0=new WeakMap,Xc=new WeakMap,F0=new WeakMap,pc=new WeakMap,ru=new WeakMap;function M_(s){const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("success",i),s.removeEventListener("error",o)},i=()=>{t(hn(s.result)),r()},o=()=>{n(s.error),r()};s.addEventListener("success",i),s.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&O0.set(t,s)}).catch(()=>{}),ru.set(e,s),e}function L_(s){if(Xc.has(s))return;const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",o),s.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",i),s.addEventListener("error",o),s.addEventListener("abort",o)});Xc.set(s,e)}let Zc={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return Xc.get(s);if(e==="objectStoreNames")return s.objectStoreNames||F0.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return hn(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function O_(s){Zc=s(Zc)}function F_(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(xc(this),e,...t);return F0.set(n,e.sort?e.sort():[e]),hn(n)}:V_().includes(s)?function(...e){return s.apply(xc(this),e),hn(O0.get(this))}:function(...e){return hn(s.apply(xc(this),e))}}function $_(s){return typeof s=="function"?F_(s):(s instanceof IDBTransaction&&L_(s),R_(s,D_())?new Proxy(s,Zc):s)}function hn(s){if(s instanceof IDBRequest)return M_(s);if(pc.has(s))return pc.get(s);const e=$_(s);return e!==s&&(pc.set(s,e),ru.set(e,s)),e}const xc=s=>ru.get(s);function U_(s,e,{blocked:t,upgrade:n,blocking:r,terminated:i}={}){const o=indexedDB.open(s,e),l=hn(o);return n&&o.addEventListener("upgradeneeded",c=>{n(hn(o.result),c.oldVersion,c.newVersion,hn(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),r&&c.addEventListener("versionchange",u=>r(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const B_=["get","getKey","getAll","getAllKeys","count"],z_=["put","add","delete","clear"],yc=new Map;function zm(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(yc.get(e))return yc.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=z_.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||B_.includes(t)))return;const i=async function(o,...l){const c=this.transaction(o,r?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[t](...l),r&&c.done]))[0]};return yc.set(e,i),i}O_(s=>({...s,get:(e,t,n)=>zm(e,t)||s.get(e,t,n),has:(e,t)=>!!zm(e,t)||s.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(q_(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function q_(s){const e=s.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ed="@firebase/app",Gm="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zs=new nu("@firebase/app"),W_="@firebase/app-compat",K_="@firebase/analytics-compat",H_="@firebase/analytics",J_="@firebase/app-check-compat",Q_="@firebase/app-check",Y_="@firebase/auth",X_="@firebase/auth-compat",Z_="@firebase/database",ej="@firebase/data-connect",tj="@firebase/database-compat",sj="@firebase/functions",nj="@firebase/functions-compat",rj="@firebase/installations",aj="@firebase/installations-compat",ij="@firebase/messaging",oj="@firebase/messaging-compat",lj="@firebase/performance",cj="@firebase/performance-compat",dj="@firebase/remote-config",uj="@firebase/remote-config-compat",hj="@firebase/storage",mj="@firebase/storage-compat",fj="@firebase/firestore",gj="@firebase/vertexai-preview",pj="@firebase/firestore-compat",xj="firebase",yj="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const td="[DEFAULT]",bj={[ed]:"fire-core",[W_]:"fire-core-compat",[H_]:"fire-analytics",[K_]:"fire-analytics-compat",[Q_]:"fire-app-check",[J_]:"fire-app-check-compat",[Y_]:"fire-auth",[X_]:"fire-auth-compat",[Z_]:"fire-rtdb",[ej]:"fire-data-connect",[tj]:"fire-rtdb-compat",[sj]:"fire-fn",[nj]:"fire-fn-compat",[rj]:"fire-iid",[aj]:"fire-iid-compat",[ij]:"fire-fcm",[oj]:"fire-fcm-compat",[lj]:"fire-perf",[cj]:"fire-perf-compat",[dj]:"fire-rc",[uj]:"fire-rc-compat",[hj]:"fire-gcs",[mj]:"fire-gcs-compat",[fj]:"fire-fst",[pj]:"fire-fst-compat",[gj]:"fire-vertex","fire-js":"fire-js",[xj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ti=new Map,vj=new Map,sd=new Map;function qm(s,e){try{s.container.addComponent(e)}catch(t){zs.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function zr(s){const e=s.name;if(sd.has(e))return zs.debug(`There were multiple attempts to register component ${e}.`),!1;sd.set(e,s);for(const t of ti.values())qm(t,s);for(const t of vj.values())qm(t,s);return!0}function au(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function Ms(s){return s.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mn=new Ci("app","Firebase",wj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nj{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new sr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ia=yj;function $0(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n=Object.assign({name:td,automaticDataCollectionEnabled:!1},e),r=n.name;if(typeof r!="string"||!r)throw mn.create("bad-app-name",{appName:String(r)});if(t||(t=D0()),!t)throw mn.create("no-options");const i=ti.get(r);if(i){if(Wo(t,i.options)&&Wo(n,i.config))return i;throw mn.create("duplicate-app",{appName:r})}const o=new S_(r);for(const c of sd.values())o.addComponent(c);const l=new Nj(t,n,o);return ti.set(r,l),l}function U0(s=td){const e=ti.get(s);if(!e&&s===td&&D0())return $0();if(!e)throw mn.create("no-app",{appName:s});return e}function _j(){return Array.from(ti.values())}function fn(s,e,t){var n;let r=(n=bj[s])!==null&&n!==void 0?n:s;t&&(r+=`-${t}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const l=[`Unable to register library "${r}" with version "${e}":`];i&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),zs.warn(l.join(" "));return}zr(new sr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jj="firebase-heartbeat-database",Ej=1,si="firebase-heartbeat-store";let bc=null;function B0(){return bc||(bc=U_(jj,Ej,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(si)}catch(t){console.warn(t)}}}}).catch(s=>{throw mn.create("idb-open",{originalErrorMessage:s.message})})),bc}async function Ij(s){try{const t=(await B0()).transaction(si),n=await t.objectStore(si).get(z0(s));return await t.done,n}catch(e){if(e instanceof Js)zs.warn(e.message);else{const t=mn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});zs.warn(t.message)}}}async function Wm(s,e){try{const n=(await B0()).transaction(si,"readwrite");await n.objectStore(si).put(e,z0(s)),await n.done}catch(t){if(t instanceof Js)zs.warn(t.message);else{const n=mn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});zs.warn(n.message)}}}function z0(s){return`${s.name}!${s.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj=1024,Sj=30*24*60*60*1e3;class Aj{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Pj(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Km();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=Sj}),this._storage.overwrite(this._heartbeatsCache))}catch(n){zs.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Km(),{heartbeatsToSend:n,unsentEntries:r}=kj(this._heartbeatsCache.heartbeats),i=qo(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return zs.warn(t),""}}}function Km(){return new Date().toISOString().substring(0,10)}function kj(s,e=Tj){const t=[];let n=s.slice();for(const r of s){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),Hm(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Hm(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class Pj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return L0()?x_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Ij(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Wm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return Wm(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Hm(s){return qo(JSON.stringify({version:2,heartbeats:s})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cj(s){zr(new sr("platform-logger",e=>new G_(e),"PRIVATE")),zr(new sr("heartbeat",e=>new Aj(e),"PRIVATE")),fn(ed,Gm,s),fn(ed,Gm,"esm2017"),fn("fire-js","")}Cj("");var Rj="firebase",Dj="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fn(Rj,Dj,"app");function iu(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t}function G0(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Vj=G0,q0=new Ci("auth","Firebase",G0());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko=new nu("@firebase/auth");function Mj(s,...e){Ko.logLevel<=Ye.WARN&&Ko.warn(`Auth (${ia}): ${s}`,...e)}function To(s,...e){Ko.logLevel<=Ye.ERROR&&Ko.error(`Auth (${ia}): ${s}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gs(s,...e){throw ou(s,...e)}function cs(s,...e){return ou(s,...e)}function W0(s,e,t){const n=Object.assign(Object.assign({},Vj()),{[e]:t});return new Ci("auth","Firebase",n).create(e,{appName:s.name})}function gn(s){return W0(s,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ou(s,...e){if(typeof s!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=s.name),s._errorFactory.create(t,...n)}return q0.create(s,...e)}function Ce(s,e,...t){if(!s)throw ou(e,...t)}function Ls(s){const e="INTERNAL ASSERTION FAILED: "+s;throw To(e),new Error(e)}function qs(s,e){s||Ls(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nd(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.href)||""}function K0(){return Jm()==="http:"||Jm()==="https:"}function Jm(){var s;return typeof self<"u"&&((s=self.location)===null||s===void 0?void 0:s.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lj(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(K0()||f_()||"connection"in navigator)?navigator.onLine:!0}function Oj(){if(typeof navigator>"u")return null;const s=navigator;return s.languages&&s.languages[0]||s.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,t){this.shortDelay=e,this.longDelay=t,qs(t>e,"Short delay should be less than long delay!"),this.isMobile=u_()||g_()}get(){return Lj()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(s,e){qs(s.emulator,"Emulator should always be set here");const{url:t}=s.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ls("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ls("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ls("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j=new Ri(3e4,6e4);function Qs(s,e){return s.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:s.tenantId}):e}async function Cs(s,e,t,n,r={}){return J0(s,r,async()=>{let i={},o={};n&&(e==="GET"?o=n:i={body:JSON.stringify(n)});const l=aa(Object.assign({key:s.config.apiKey},o)).slice(1),c=await s._getAdditionalHeaders();c["Content-Type"]="application/json",s.languageCode&&(c["X-Firebase-Locale"]=s.languageCode);const u=Object.assign({method:e,headers:c},i);return m_()||(u.referrerPolicy="no-referrer"),H0.fetch()(Q0(s,s.config.apiHost,t,l),u)})}async function J0(s,e,t){s._canInitEmulator=!1;const n=Object.assign(Object.assign({},Fj),e);try{const r=new Uj(s),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Pa(s,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Pa(s,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Pa(s,"email-already-in-use",o);if(c==="USER_DISABLED")throw Pa(s,"user-disabled",o);const h=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw W0(s,h,u);Gs(s,h)}}catch(r){if(r instanceof Js)throw r;Gs(s,"network-request-failed",{message:String(r)})}}async function Il(s,e,t,n,r={}){const i=await Cs(s,e,t,n,r);return"mfaPendingCredential"in i&&Gs(s,"multi-factor-auth-required",{_serverResponse:i}),i}function Q0(s,e,t,n){const r=`${e}${t}?${n}`;return s.config.emulator?lu(s.config,r):`${s.config.apiScheme}://${r}`}class Uj{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(cs(this.auth,"network-request-failed")),$j.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Pa(s,e,t){const n={appName:s.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=cs(s,e,n);return r.customData._tokenResponse=t,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qm(s){return s!==void 0&&s.getResponse!==void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bj(s){return(await Cs(s,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zj(s,e){return Cs(s,"POST","/v1/accounts:delete",e)}async function Y0(s,e){return Cs(s,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(s){if(s)try{const e=new Date(Number(s));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Gj(s,e=!1){const t=us(s),n=await t.getIdToken(e),r=cu(n);Ce(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:n,authTime:Oa(vc(r.auth_time)),issuedAtTime:Oa(vc(r.iat)),expirationTime:Oa(vc(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function vc(s){return Number(s)*1e3}function cu(s){const[e,t,n]=s.split(".");if(e===void 0||t===void 0||n===void 0)return To("JWT malformed, contained fewer than 3 sections"),null;try{const r=C0(t);return r?JSON.parse(r):(To("Failed to decode base64 JWT payload"),null)}catch(r){return To("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function Ym(s){const e=cu(s);return Ce(e,"internal-error"),Ce(typeof e.exp<"u","internal-error"),Ce(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ni(s,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof Js&&qj(n)&&s.auth.currentUser===s&&await s.auth.signOut(),n}}function qj({code:s}){return s==="auth/user-disabled"||s==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Oa(this.lastLoginAt),this.creationTime=Oa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ho(s){var e;const t=s.auth,n=await s.getIdToken(),r=await ni(s,Y0(t,{idToken:n}));Ce(r==null?void 0:r.users.length,t,"internal-error");const i=r.users[0];s._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?X0(i.providerUserInfo):[],l=Hj(s.providerData,o),c=s.isAnonymous,u=!(s.email&&i.passwordHash)&&!(l!=null&&l.length),h=c?u:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new rd(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(s,m)}async function Kj(s){const e=us(s);await Ho(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Hj(s,e){return[...s.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function X0(s){return s.map(e=>{var{providerId:t}=e,n=iu(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jj(s,e){const t=await J0(s,{},async()=>{const n=aa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=s.config,o=Q0(s,r,"/v1/token",`key=${i}`),l=await s._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",H0.fetch()(o,{method:"POST",headers:l,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Qj(s,e){return Cs(s,"POST","/v2/accounts:revokeToken",Qs(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ce(e.idToken,"internal-error"),Ce(typeof e.idToken<"u","internal-error"),Ce(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ym(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ce(e.length!==0,"internal-error");const t=Ym(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ce(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await Jj(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,o=new Vr;return n&&(Ce(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),r&&(Ce(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(Ce(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Vr,this.toJSON())}_performRefresh(){return Ls("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(s,e){Ce(typeof s=="string"||typeof s>"u","internal-error",{appName:e})}class Os{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=iu(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rd(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ni(this,this.stsTokenManager.getToken(this.auth,e));return Ce(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Gj(this,e)}reload(){return Kj(this)}_assign(e){this!==e&&(Ce(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Os(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ce(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Ho(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ms(this.auth.app))return Promise.reject(gn(this.auth));const e=await this.getIdToken();return await ni(this,zj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,o,l,c,u,h;const m=(n=t.displayName)!==null&&n!==void 0?n:void 0,p=(r=t.email)!==null&&r!==void 0?r:void 0,N=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,v=(o=t.photoURL)!==null&&o!==void 0?o:void 0,I=(l=t.tenantId)!==null&&l!==void 0?l:void 0,g=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,S=(u=t.createdAt)!==null&&u!==void 0?u:void 0,C=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:T,emailVerified:V,isAnonymous:P,providerData:k,stsTokenManager:b}=t;Ce(T&&b,e,"internal-error");const x=Vr.fromJSON(this.name,b);Ce(typeof T=="string",e,"internal-error"),en(m,e.name),en(p,e.name),Ce(typeof V=="boolean",e,"internal-error"),Ce(typeof P=="boolean",e,"internal-error"),en(N,e.name),en(v,e.name),en(I,e.name),en(g,e.name),en(S,e.name),en(C,e.name);const w=new Os({uid:T,auth:e,email:p,emailVerified:V,displayName:m,isAnonymous:P,photoURL:v,phoneNumber:N,tenantId:I,stsTokenManager:x,createdAt:S,lastLoginAt:C});return k&&Array.isArray(k)&&(w.providerData=k.map(E=>Object.assign({},E))),g&&(w._redirectEventId=g),w}static async _fromIdTokenResponse(e,t,n=!1){const r=new Vr;r.updateFromServerResponse(t);const i=new Os({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Ho(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Ce(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?X0(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),l=new Vr;l.updateFromIdToken(n);const c=new Os({uid:r.localId,auth:e,stsTokenManager:l,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new rd(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm=new Map;function Fs(s){qs(s instanceof Function,"Expected a class definition");let e=Xm.get(s);return e?(qs(e instanceof s,"Instance stored in cache mismatched with class"),e):(e=new s,Xm.set(s,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Z0.type="NONE";const Zm=Z0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(s,e,t){return`firebase:${s}:${e}:${t}`}class Mr{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=So(this.userKey,r.apiKey,i),this.fullPersistenceKey=So("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Os._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Mr(Fs(Zm),e,n);const r=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=r[0]||Fs(Zm);const o=So(n,e.config.apiKey,e.name);let l=null;for(const u of t)try{const h=await u._get(o);if(h){const m=Os._fromJSON(e,h);u!==i&&(l=m),i=u;break}}catch{}const c=r.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Mr(i,e,n):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Mr(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(s){const e=s.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nx(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ex(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ax(e))return"Blackberry";if(ix(e))return"Webos";if(tx(e))return"Safari";if((e.includes("chrome/")||sx(e))&&!e.includes("edge/"))return"Chrome";if(rx(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=s.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function ex(s=Lt()){return/firefox\//i.test(s)}function tx(s=Lt()){const e=s.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function sx(s=Lt()){return/crios\//i.test(s)}function nx(s=Lt()){return/iemobile/i.test(s)}function rx(s=Lt()){return/android/i.test(s)}function ax(s=Lt()){return/blackberry/i.test(s)}function ix(s=Lt()){return/webos/i.test(s)}function du(s=Lt()){return/iphone|ipad|ipod/i.test(s)||/macintosh/i.test(s)&&/mobile/i.test(s)}function Yj(s=Lt()){var e;return du(s)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Xj(){return p_()&&document.documentMode===10}function ox(s=Lt()){return du(s)||rx(s)||ix(s)||ax(s)||/windows phone/i.test(s)||nx(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lx(s,e=[]){let t;switch(s){case"Browser":t=ef(Lt());break;case"Worker":t=`${ef(Lt())}-${s}`;break;default:t=s}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ia}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e2(s,e={}){return Cs(s,"GET","/v2/passwordPolicy",Qs(s,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=6;class s2{constructor(e){var t,n,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:t2,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(n=c.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsUppercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tf(this),this.idTokenSubscription=new tf(this),this.beforeStateQueue=new Zj(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=q0,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Fs(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Mr.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Y0(this,{idToken:e}),n=await Os._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ms(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ce(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ho(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Oj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ms(this.app))return Promise.reject(gn(this));const t=e?us(e):null;return t&&Ce(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ce(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ms(this.app)?Promise.reject(gn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ms(this.app)?Promise.reject(gn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Fs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await e2(this),t=new s2(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ci("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await Qj(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Fs(e)||this._popupRedirectResolver;Ce(t,this,"argument-error"),this.redirectPersistenceManager=await Mr.create(this,[Fs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ce(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,n,r);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ce(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lx(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Mj(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function oa(s){return us(s)}class tf{constructor(e){this.auth=e,this.observer=null,this.addObserver=N_(t=>this.observer=t)}get next(){return Ce(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function r2(s){Tl=s}function cx(s){return Tl.loadJS(s)}function a2(){return Tl.recaptchaV2Script}function i2(){return Tl.gapiScript}function dx(s){return`__${s}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(s,e){const t=au(s,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(Wo(i,e??{}))return r;Gs(r,"already-initialized")}return t.initialize({options:e})}function l2(s,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Fs);e!=null&&e.errorMap&&s._updateErrorMap(e.errorMap),s._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function c2(s,e,t){const n=oa(s);Ce(n._canInitEmulator,n,"emulator-config-failed"),Ce(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,i=ux(e),{host:o,port:l}=d2(e),c=l===null?"":`:${l}`;n.config.emulator={url:`${i}//${o}${c}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),u2()}function ux(s){const e=s.indexOf(":");return e<0?"":s.substr(0,e+1)}function d2(s){const e=ux(s),t=/(\/\/)?([^?#/]+)/.exec(s.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const i=r[1];return{host:i,port:sf(n.substr(i.length+1))}}else{const[i,o]=n.split(":");return{host:i,port:sf(o)}}}function sf(s){if(!s)return null;const e=Number(s);return isNaN(e)?null:e}function u2(){function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",s):s())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ls("not implemented")}_getIdTokenResponse(e){return Ls("not implemented")}_linkToIdToken(e,t){return Ls("not implemented")}_getReauthenticationResolver(e){return Ls("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lr(s,e){return Il(s,"POST","/v1/accounts:signInWithIdp",Qs(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2="http://localhost";class nr extends uu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new nr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Gs("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=iu(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new nr(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Lr(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Lr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Lr(e,t)}buildRequest(){const e={requestUri:h2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=aa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m2(s,e){return Cs(s,"POST","/v1/accounts:sendVerificationCode",Qs(s,e))}async function f2(s,e){return Il(s,"POST","/v1/accounts:signInWithPhoneNumber",Qs(s,e))}async function g2(s,e){const t=await Il(s,"POST","/v1/accounts:signInWithPhoneNumber",Qs(s,e));if(t.temporaryProof)throw Pa(s,"account-exists-with-different-credential",t);return t}const p2={USER_NOT_FOUND:"user-not-found"};async function x2(s,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Il(s,"POST","/v1/accounts:signInWithPhoneNumber",Qs(s,t),p2)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa extends uu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fa({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fa({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return f2(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return g2(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return x2(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return!n&&!t&&!r&&!i?null:new Fa({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hx{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di extends hx{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn extends Di{constructor(){super("facebook.com")}static credential(e){return nr._fromParams({providerId:rn.PROVIDER_ID,signInMethod:rn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rn.credentialFromTaggedObject(e)}static credentialFromError(e){return rn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rn.credential(e.oauthAccessToken)}catch{return null}}}rn.FACEBOOK_SIGN_IN_METHOD="facebook.com";rn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an extends Di{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nr._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return an.credential(t,n)}catch{return null}}}an.GOOGLE_SIGN_IN_METHOD="google.com";an.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on extends Di{constructor(){super("github.com")}static credential(e){return nr._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return on.credential(e.oauthAccessToken)}catch{return null}}}on.GITHUB_SIGN_IN_METHOD="github.com";on.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln extends Di{constructor(){super("twitter.com")}static credential(e,t){return nr._fromParams({providerId:ln.PROVIDER_ID,signInMethod:ln.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ln.credentialFromTaggedObject(e)}static credentialFromError(e){return ln.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ln.credential(t,n)}catch{return null}}}ln.TWITTER_SIGN_IN_METHOD="twitter.com";ln.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Os._fromIdTokenResponse(e,n,r),o=nf(n);return new Gr({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=nf(n);return new Gr({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function nf(s){return s.providerId?s.providerId:"phoneNumber"in s?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo extends Js{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Jo.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Jo(e,t,n,r)}}function mx(s,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(s):t._getIdTokenResponse(s)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Jo._fromErrorAndOperation(s,i,e,n):i})}async function y2(s,e,t=!1){const n=await ni(s,e._linkToIdToken(s.auth,await s.getIdToken()),t);return Gr._forOperation(s,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b2(s,e,t=!1){const{auth:n}=s;if(Ms(n.app))return Promise.reject(gn(n));const r="reauthenticate";try{const i=await ni(s,mx(n,r,e,s),t);Ce(i.idToken,n,"internal-error");const o=cu(i.idToken);Ce(o,n,"internal-error");const{sub:l}=o;return Ce(s.uid===l,n,"user-mismatch"),Gr._forOperation(s,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Gs(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fx(s,e,t=!1){if(Ms(s.app))return Promise.reject(gn(s));const n="signIn",r=await mx(s,n,e),i=await Gr._fromIdTokenResponse(s,n,r);return t||await s._updateCurrentUser(i.user),i}async function v2(s,e){return fx(oa(s),e)}function w2(s,e,t,n){return us(s).onIdTokenChanged(e,t,n)}function N2(s,e,t){return us(s).beforeAuthStateChanged(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2(s,e){return Cs(s,"POST","/v2/accounts/mfaEnrollment:start",Qs(s,e))}const Qo="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Qo,"1"),this.storage.removeItem(Qo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2=1e3,E2=10;class px extends gx{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ox(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(n);!t&&this.localCache[n]===o||this.notifyListeners(n,o)},i=this.storage.getItem(n);Xj()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,E2):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},j2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}px.type="LOCAL";const I2=px;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx extends gx{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xx.type="SESSION";const yx=xx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T2(s){return Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const n=new Sl(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const l=Array.from(o).map(async u=>u(t.origin,i)),c=await T2(l);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sl.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(s="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return s+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const u=hu("",20);r.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},n);o={messageChannel:r,onMessage(m){const p=m;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(p.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rt(){return window}function A2(s){Rt().location.href=s}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(){return typeof Rt().WorkerGlobalScope<"u"&&typeof Rt().importScripts=="function"}async function k2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function P2(){var s;return((s=navigator==null?void 0:navigator.serviceWorker)===null||s===void 0?void 0:s.controller)||null}function C2(){return mu()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx="firebaseLocalStorageDb",R2=1,Yo="firebaseLocalStorage",vx="fbase_key";class Vi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Al(s,e){return s.transaction([Yo],e?"readwrite":"readonly").objectStore(Yo)}function D2(){const s=indexedDB.deleteDatabase(bx);return new Vi(s).toPromise()}function ad(){const s=indexedDB.open(bx,R2);return new Promise((e,t)=>{s.addEventListener("error",()=>{t(s.error)}),s.addEventListener("upgradeneeded",()=>{const n=s.result;try{n.createObjectStore(Yo,{keyPath:vx})}catch(r){t(r)}}),s.addEventListener("success",async()=>{const n=s.result;n.objectStoreNames.contains(Yo)?e(n):(n.close(),await D2(),e(await ad()))})})}async function rf(s,e,t){const n=Al(s,!0).put({[vx]:e,value:t});return new Vi(n).toPromise()}async function V2(s,e){const t=Al(s,!1).get(e),n=await new Vi(t).toPromise();return n===void 0?null:n.value}function af(s,e){const t=Al(s,!0).delete(e);return new Vi(t).toPromise()}const M2=800,L2=3;class wx{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ad(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>L2)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sl._getInstance(C2()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await k2(),!this.activeServiceWorker)return;this.sender=new S2(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||P2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ad();return await rf(e,Qo,"1"),await af(e,Qo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>rf(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>V2(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>af(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Al(r,!1).getAll();return new Vi(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),M2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}wx.type="LOCAL";const O2=wx;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(s,e){return Cs(s,"POST","/v2/accounts/mfaSignIn:start",Qs(s,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=500,U2=6e4,co=1e12;class B2{constructor(e){this.auth=e,this.counter=co,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new z2(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||co;(t=this._widgets.get(n))===null||t===void 0||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||co;return((t=this._widgets.get(n))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const n=e||co;return(t=this._widgets.get(n))===null||t===void 0||t.execute(),""}}class z2{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r=typeof e=="string"?document.getElementById(e):e;Ce(r,"argument-error",{appName:t}),this.container=r,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=G2(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},U2)},$2))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function G2(s){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<s;n++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc=dx("rcb"),q2=new Ri(3e4,6e4);class W2{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Rt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ce(K2(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Qm(Rt().grecaptcha)?Promise.resolve(Rt().grecaptcha):new Promise((n,r)=>{const i=Rt().setTimeout(()=>{r(cs(e,"network-request-failed"))},q2.get());Rt()[wc]=()=>{Rt().clearTimeout(i),delete Rt()[wc];const l=Rt().grecaptcha;if(!l||!Qm(l)){r(cs(e,"internal-error"));return}const c=l.render;l.render=(u,h)=>{const m=c(u,h);return this.counter++,m},this.hostLanguage=t,n(l)};const o=`${a2()}?${aa({onload:wc,render:"explicit",hl:t})}`;cx(o).catch(()=>{clearTimeout(i),r(cs(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Rt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function K2(s){return s.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(s)}class H2{async load(e){return new B2(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx="recaptcha",J2={theme:"light",type:"image"};class Q2{constructor(e,t,n=Object.assign({},J2)){this.parameters=n,this.type=Nx,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=oa(e),this.isInvisible=this.parameters.size==="invisible",Ce(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const r=typeof t=="string"?document.getElementById(t):t;Ce(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new H2:new W2,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(r=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),r(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ce(!this.parameters.sitekey,this.auth,"argument-error"),Ce(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ce(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(n=>n(t)),typeof e=="function")e(t);else if(typeof e=="string"){const n=Rt()[e];typeof n=="function"&&n(t)}}}assertNotDestroyed(){Ce(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ce(K0()&&!mu(),this.auth,"internal-error"),await Y2(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Bj(this.auth);Ce(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ce(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function Y2(){let s=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}s=()=>e(),window.addEventListener("load",s)}).catch(e=>{throw s&&window.removeEventListener("load",s),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Fa._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Z2(s,e,t){if(Ms(s.app))return Promise.reject(gn(s));const n=oa(s),r=await eE(n,e,us(t));return new X2(r,i=>v2(n,i))}async function eE(s,e,t){var n;const r=await t.verify();try{Ce(typeof r=="string",s,"argument-error"),Ce(t.type===Nx,s,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ce(o.type==="enroll",s,"internal-error"),(await _2(s,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:r}})).phoneSessionInfo.sessionInfo;{Ce(o.type==="signin",s,"internal-error");const l=((n=i.multiFactorHint)===null||n===void 0?void 0:n.uid)||i.multiFactorUid;return Ce(l,s,"missing-multi-factor-info"),(await F2(s,{mfaPendingCredential:o.credential,mfaEnrollmentId:l,phoneSignInInfo:{recaptchaToken:r}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await m2(s,{phoneNumber:i.phoneNumber,recaptchaToken:r});return o}}finally{t._reset()}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tE(s,e){return e?Fs(e):(Ce(s._popupRedirectResolver,s,"argument-error"),s._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu extends uu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Lr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Lr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Lr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function sE(s){return fx(s.auth,new fu(s),s.bypassAuthState)}function nE(s){const{auth:e,user:t}=s;return Ce(t,e,"internal-error"),b2(t,new fu(s),s.bypassAuthState)}async function rE(s){const{auth:e,user:t}=s;return Ce(t,e,"internal-error"),y2(t,new fu(s),s.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sE;case"linkViaPopup":case"linkViaRedirect":return rE;case"reauthViaPopup":case"reauthViaRedirect":return nE;default:Gs(this.auth,"internal-error")}}resolve(e){qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE=new Ri(2e3,1e4);class Ar extends _x{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ar.currentPopupAction&&Ar.currentPopupAction.cancel(),Ar.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ce(e,this.auth,"internal-error"),e}async onExecution(){qs(this.filter.length===1,"Popup operations only handle one event");const e=hu();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(cs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(cs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ar.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,aE.get())};e()}}Ar.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="pendingRedirect",Ao=new Map;class oE extends _x{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ao.get(this.auth._key());if(!e){try{const n=await lE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ao.set(this.auth._key(),e)}return this.bypassAuthState||Ao.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lE(s,e){const t=uE(e),n=dE(s);if(!await n._isAvailable())return!1;const r=await n._get(t)==="true";return await n._remove(t),r}function cE(s,e){Ao.set(s._key(),e)}function dE(s){return Fs(s._redirectPersistence)}function uE(s){return So(iE,s.config.apiKey,s.name)}async function hE(s,e,t=!1){if(Ms(s.app))return Promise.reject(gn(s));const n=oa(s),r=tE(n,e),o=await new oE(n,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE=10*60*1e3;class fE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!gE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!jx(e)){const r=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(cs(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=mE&&this.cachedEventUids.clear(),this.cachedEventUids.has(of(e))}saveEventToCache(e){this.cachedEventUids.add(of(e)),this.lastProcessedEventTime=Date.now()}}function of(s){return[s.type,s.eventId,s.sessionId,s.tenantId].filter(e=>e).join("-")}function jx({type:s,error:e}){return s==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function gE(s){switch(s.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jx(s);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pE(s,e={}){return Cs(s,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yE=/^https?/;async function bE(s){if(s.config.emulator)return;const{authorizedDomains:e}=await pE(s);for(const t of e)try{if(vE(t))return}catch{}Gs(s,"unauthorized-domain")}function vE(s){const e=nd(),{protocol:t,hostname:n}=new URL(e);if(s.startsWith("chrome-extension://")){const o=new URL(s);return o.hostname===""&&n===""?t==="chrome-extension:"&&s.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!yE.test(t))return!1;if(xE.test(s))return n===s;const r=s.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE=new Ri(3e4,6e4);function lf(){const s=Rt().___jsl;if(s!=null&&s.H){for(const e of Object.keys(s.H))if(s.H[e].r=s.H[e].r||[],s.H[e].L=s.H[e].L||[],s.H[e].r=[...s.H[e].L],s.CP)for(let t=0;t<s.CP.length;t++)s.CP[t]=null}}function NE(s){return new Promise((e,t)=>{var n,r,i;function o(){lf(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{lf(),t(cs(s,"network-request-failed"))},timeout:wE.get()})}if(!((r=(n=Rt().gapi)===null||n===void 0?void 0:n.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=Rt().gapi)===null||i===void 0)&&i.load)o();else{const l=dx("iframefcb");return Rt()[l]=()=>{gapi.load?o():t(cs(s,"network-request-failed"))},cx(`${i2()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw ko=null,e})}let ko=null;function _E(s){return ko=ko||NE(s),ko}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE=new Ri(5e3,15e3),EE="__/auth/iframe",IE="emulator/auth/iframe",TE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},SE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function AE(s){const e=s.config;Ce(e.authDomain,s,"auth-domain-config-required");const t=e.emulator?lu(e,IE):`https://${s.config.authDomain}/${EE}`,n={apiKey:e.apiKey,appName:s.name,v:ia},r=SE.get(s.config.apiHost);r&&(n.eid=r);const i=s._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${aa(n).slice(1)}`}async function kE(s){const e=await _E(s),t=Rt().gapi;return Ce(t,s,"internal-error"),e.open({where:document.body,url:AE(s),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TE,dontclear:!0},n=>new Promise(async(r,i)=>{await n.restyle({setHideOnLeave:!1});const o=cs(s,"network-request-failed"),l=Rt().setTimeout(()=>{i(o)},jE.get());function c(){Rt().clearTimeout(l),r(n)}n.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},CE=500,RE=600,DE="_blank",VE="http://localhost";class cf{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ME(s,e,t,n=CE,r=RE){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const c=Object.assign(Object.assign({},PE),{width:n.toString(),height:r.toString(),top:i,left:o}),u=Lt().toLowerCase();t&&(l=sx(u)?DE:t),ex(u)&&(e=e||VE,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[N,v])=>`${p}${N}=${v},`,"");if(Yj(u)&&l!=="_self")return LE(e||"",l),new cf(null);const m=window.open(e||"",l,h);Ce(m,s,"popup-blocked");try{m.focus()}catch{}return new cf(m)}function LE(s,e){const t=document.createElement("a");t.href=s,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="__/auth/handler",FE="emulator/auth/handler",$E=encodeURIComponent("fac");async function df(s,e,t,n,r,i){Ce(s.config.authDomain,s,"auth-domain-config-required"),Ce(s.config.apiKey,s,"invalid-api-key");const o={apiKey:s.config.apiKey,appName:s.name,authType:t,redirectUrl:n,v:ia,eventId:r};if(e instanceof hx){e.setDefaultLanguage(s.languageCode),o.providerId=e.providerId||"",w_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))o[h]=m}if(e instanceof Di){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(o.scopes=h.join(","))}s.tenantId&&(o.tid=s.tenantId);const l=o;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await s._getAppCheckToken(),u=c?`#${$E}=${encodeURIComponent(c)}`:"";return`${UE(s)}?${aa(l).slice(1)}${u}`}function UE({config:s}){return s.emulator?lu(s,FE):`https://${s.authDomain}/${OE}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc="webStorageSupport";class BE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yx,this._completeRedirectFn=hE,this._overrideRedirectResult=cE}async _openPopup(e,t,n,r){var i;qs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await df(e,t,n,nd(),r);return ME(e,o,hu())}async _openRedirect(e,t,n,r){await this._originValidation(e);const i=await df(e,t,n,nd(),r);return A2(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(qs(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await kE(e),n=new fE(e);return t.register("authEvent",r=>(Ce(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Nc,{type:Nc},r=>{var i;const o=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[Nc];o!==void 0&&t(!!o),Gs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=bE(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ox()||tx()||du()}}const zE=BE;var uf="@firebase/auth",hf="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ce(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qE(s){switch(s){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function WE(s){zr(new sr("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=n.options;Ce(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:o,authDomain:l,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lx(s)},u=new n2(n,r,i,c);return l2(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),zr(new sr("auth-internal",e=>{const t=oa(e.getProvider("auth").getImmediate());return(n=>new GE(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fn(uf,hf,qE(s)),fn(uf,hf,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KE=5*60,HE=V0("authIdTokenMaxAge")||KE;let mf=null;const JE=s=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>HE)return;const r=t==null?void 0:t.token;mf!==r&&(mf=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function QE(s=U0()){const e=au(s,"auth");if(e.isInitialized())return e.getImmediate();const t=o2(s,{popupRedirectResolver:zE,persistence:[O2,I2,yx]}),n=V0("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const o=JE(i.toString());N2(t,o,()=>o(t.currentUser)),w2(t,l=>o(l))}}const r=R0("auth");return r&&c2(t,`http://${r}`),t}function YE(){var s,e;return(e=(s=document.getElementsByTagName("head"))===null||s===void 0?void 0:s[0])!==null&&e!==void 0?e:document}r2({loadJS(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.onload=e,n.onerror=r=>{const i=cs("internal-error");i.customData=r,t(i)},n.type="text/javascript",n.charset="UTF-8",YE().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});WE("Browser");var ff=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Qn,Ex;(function(){var s;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(b,x){function w(){}w.prototype=x.prototype,b.D=x.prototype,b.prototype=new w,b.prototype.constructor=b,b.C=function(E,A,D){for(var j=Array(arguments.length-2),K=2;K<arguments.length;K++)j[K-2]=arguments[K];return x.prototype[A].apply(E,j)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,x,w){w||(w=0);var E=Array(16);if(typeof x=="string")for(var A=0;16>A;++A)E[A]=x.charCodeAt(w++)|x.charCodeAt(w++)<<8|x.charCodeAt(w++)<<16|x.charCodeAt(w++)<<24;else for(A=0;16>A;++A)E[A]=x[w++]|x[w++]<<8|x[w++]<<16|x[w++]<<24;x=b.g[0],w=b.g[1],A=b.g[2];var D=b.g[3],j=x+(D^w&(A^D))+E[0]+3614090360&4294967295;x=w+(j<<7&4294967295|j>>>25),j=D+(A^x&(w^A))+E[1]+3905402710&4294967295,D=x+(j<<12&4294967295|j>>>20),j=A+(w^D&(x^w))+E[2]+606105819&4294967295,A=D+(j<<17&4294967295|j>>>15),j=w+(x^A&(D^x))+E[3]+3250441966&4294967295,w=A+(j<<22&4294967295|j>>>10),j=x+(D^w&(A^D))+E[4]+4118548399&4294967295,x=w+(j<<7&4294967295|j>>>25),j=D+(A^x&(w^A))+E[5]+1200080426&4294967295,D=x+(j<<12&4294967295|j>>>20),j=A+(w^D&(x^w))+E[6]+2821735955&4294967295,A=D+(j<<17&4294967295|j>>>15),j=w+(x^A&(D^x))+E[7]+4249261313&4294967295,w=A+(j<<22&4294967295|j>>>10),j=x+(D^w&(A^D))+E[8]+1770035416&4294967295,x=w+(j<<7&4294967295|j>>>25),j=D+(A^x&(w^A))+E[9]+2336552879&4294967295,D=x+(j<<12&4294967295|j>>>20),j=A+(w^D&(x^w))+E[10]+4294925233&4294967295,A=D+(j<<17&4294967295|j>>>15),j=w+(x^A&(D^x))+E[11]+2304563134&4294967295,w=A+(j<<22&4294967295|j>>>10),j=x+(D^w&(A^D))+E[12]+1804603682&4294967295,x=w+(j<<7&4294967295|j>>>25),j=D+(A^x&(w^A))+E[13]+4254626195&4294967295,D=x+(j<<12&4294967295|j>>>20),j=A+(w^D&(x^w))+E[14]+2792965006&4294967295,A=D+(j<<17&4294967295|j>>>15),j=w+(x^A&(D^x))+E[15]+1236535329&4294967295,w=A+(j<<22&4294967295|j>>>10),j=x+(A^D&(w^A))+E[1]+4129170786&4294967295,x=w+(j<<5&4294967295|j>>>27),j=D+(w^A&(x^w))+E[6]+3225465664&4294967295,D=x+(j<<9&4294967295|j>>>23),j=A+(x^w&(D^x))+E[11]+643717713&4294967295,A=D+(j<<14&4294967295|j>>>18),j=w+(D^x&(A^D))+E[0]+3921069994&4294967295,w=A+(j<<20&4294967295|j>>>12),j=x+(A^D&(w^A))+E[5]+3593408605&4294967295,x=w+(j<<5&4294967295|j>>>27),j=D+(w^A&(x^w))+E[10]+38016083&4294967295,D=x+(j<<9&4294967295|j>>>23),j=A+(x^w&(D^x))+E[15]+3634488961&4294967295,A=D+(j<<14&4294967295|j>>>18),j=w+(D^x&(A^D))+E[4]+3889429448&4294967295,w=A+(j<<20&4294967295|j>>>12),j=x+(A^D&(w^A))+E[9]+568446438&4294967295,x=w+(j<<5&4294967295|j>>>27),j=D+(w^A&(x^w))+E[14]+3275163606&4294967295,D=x+(j<<9&4294967295|j>>>23),j=A+(x^w&(D^x))+E[3]+4107603335&4294967295,A=D+(j<<14&4294967295|j>>>18),j=w+(D^x&(A^D))+E[8]+1163531501&4294967295,w=A+(j<<20&4294967295|j>>>12),j=x+(A^D&(w^A))+E[13]+2850285829&4294967295,x=w+(j<<5&4294967295|j>>>27),j=D+(w^A&(x^w))+E[2]+4243563512&4294967295,D=x+(j<<9&4294967295|j>>>23),j=A+(x^w&(D^x))+E[7]+1735328473&4294967295,A=D+(j<<14&4294967295|j>>>18),j=w+(D^x&(A^D))+E[12]+2368359562&4294967295,w=A+(j<<20&4294967295|j>>>12),j=x+(w^A^D)+E[5]+4294588738&4294967295,x=w+(j<<4&4294967295|j>>>28),j=D+(x^w^A)+E[8]+2272392833&4294967295,D=x+(j<<11&4294967295|j>>>21),j=A+(D^x^w)+E[11]+1839030562&4294967295,A=D+(j<<16&4294967295|j>>>16),j=w+(A^D^x)+E[14]+4259657740&4294967295,w=A+(j<<23&4294967295|j>>>9),j=x+(w^A^D)+E[1]+2763975236&4294967295,x=w+(j<<4&4294967295|j>>>28),j=D+(x^w^A)+E[4]+1272893353&4294967295,D=x+(j<<11&4294967295|j>>>21),j=A+(D^x^w)+E[7]+4139469664&4294967295,A=D+(j<<16&4294967295|j>>>16),j=w+(A^D^x)+E[10]+3200236656&4294967295,w=A+(j<<23&4294967295|j>>>9),j=x+(w^A^D)+E[13]+681279174&4294967295,x=w+(j<<4&4294967295|j>>>28),j=D+(x^w^A)+E[0]+3936430074&4294967295,D=x+(j<<11&4294967295|j>>>21),j=A+(D^x^w)+E[3]+3572445317&4294967295,A=D+(j<<16&4294967295|j>>>16),j=w+(A^D^x)+E[6]+76029189&4294967295,w=A+(j<<23&4294967295|j>>>9),j=x+(w^A^D)+E[9]+3654602809&4294967295,x=w+(j<<4&4294967295|j>>>28),j=D+(x^w^A)+E[12]+3873151461&4294967295,D=x+(j<<11&4294967295|j>>>21),j=A+(D^x^w)+E[15]+530742520&4294967295,A=D+(j<<16&4294967295|j>>>16),j=w+(A^D^x)+E[2]+3299628645&4294967295,w=A+(j<<23&4294967295|j>>>9),j=x+(A^(w|~D))+E[0]+4096336452&4294967295,x=w+(j<<6&4294967295|j>>>26),j=D+(w^(x|~A))+E[7]+1126891415&4294967295,D=x+(j<<10&4294967295|j>>>22),j=A+(x^(D|~w))+E[14]+2878612391&4294967295,A=D+(j<<15&4294967295|j>>>17),j=w+(D^(A|~x))+E[5]+4237533241&4294967295,w=A+(j<<21&4294967295|j>>>11),j=x+(A^(w|~D))+E[12]+1700485571&4294967295,x=w+(j<<6&4294967295|j>>>26),j=D+(w^(x|~A))+E[3]+2399980690&4294967295,D=x+(j<<10&4294967295|j>>>22),j=A+(x^(D|~w))+E[10]+4293915773&4294967295,A=D+(j<<15&4294967295|j>>>17),j=w+(D^(A|~x))+E[1]+2240044497&4294967295,w=A+(j<<21&4294967295|j>>>11),j=x+(A^(w|~D))+E[8]+1873313359&4294967295,x=w+(j<<6&4294967295|j>>>26),j=D+(w^(x|~A))+E[15]+4264355552&4294967295,D=x+(j<<10&4294967295|j>>>22),j=A+(x^(D|~w))+E[6]+2734768916&4294967295,A=D+(j<<15&4294967295|j>>>17),j=w+(D^(A|~x))+E[13]+1309151649&4294967295,w=A+(j<<21&4294967295|j>>>11),j=x+(A^(w|~D))+E[4]+4149444226&4294967295,x=w+(j<<6&4294967295|j>>>26),j=D+(w^(x|~A))+E[11]+3174756917&4294967295,D=x+(j<<10&4294967295|j>>>22),j=A+(x^(D|~w))+E[2]+718787259&4294967295,A=D+(j<<15&4294967295|j>>>17),j=w+(D^(A|~x))+E[9]+3951481745&4294967295,b.g[0]=b.g[0]+x&4294967295,b.g[1]=b.g[1]+(A+(j<<21&4294967295|j>>>11))&4294967295,b.g[2]=b.g[2]+A&4294967295,b.g[3]=b.g[3]+D&4294967295}n.prototype.u=function(b,x){x===void 0&&(x=b.length);for(var w=x-this.blockSize,E=this.B,A=this.h,D=0;D<x;){if(A==0)for(;D<=w;)r(this,b,D),D+=this.blockSize;if(typeof b=="string"){for(;D<x;)if(E[A++]=b.charCodeAt(D++),A==this.blockSize){r(this,E),A=0;break}}else for(;D<x;)if(E[A++]=b[D++],A==this.blockSize){r(this,E),A=0;break}}this.h=A,this.o+=x},n.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var x=1;x<b.length-8;++x)b[x]=0;var w=8*this.o;for(x=b.length-8;x<b.length;++x)b[x]=w&255,w/=256;for(this.u(b),b=Array(16),x=w=0;4>x;++x)for(var E=0;32>E;E+=8)b[w++]=this.g[x]>>>E&255;return b};function i(b,x){var w=l;return Object.prototype.hasOwnProperty.call(w,b)?w[b]:w[b]=x(b)}function o(b,x){this.h=x;for(var w=[],E=!0,A=b.length-1;0<=A;A--){var D=b[A]|0;E&&D==x||(w[A]=D,E=!1)}this.g=w}var l={};function c(b){return-128<=b&&128>b?i(b,function(x){return new o([x|0],0>x?-1:0)}):new o([b|0],0>b?-1:0)}function u(b){if(isNaN(b)||!isFinite(b))return m;if(0>b)return g(u(-b));for(var x=[],w=1,E=0;b>=w;E++)x[E]=b/w|0,w*=4294967296;return new o(x,0)}function h(b,x){if(b.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(b.charAt(0)=="-")return g(h(b.substring(1),x));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(x,8)),E=m,A=0;A<b.length;A+=8){var D=Math.min(8,b.length-A),j=parseInt(b.substring(A,A+D),x);8>D?(D=u(Math.pow(x,D)),E=E.j(D).add(u(j))):(E=E.j(w),E=E.add(u(j)))}return E}var m=c(0),p=c(1),N=c(16777216);s=o.prototype,s.m=function(){if(I(this))return-g(this).m();for(var b=0,x=1,w=0;w<this.g.length;w++){var E=this.i(w);b+=(0<=E?E:4294967296+E)*x,x*=4294967296}return b},s.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(v(this))return"0";if(I(this))return"-"+g(this).toString(b);for(var x=u(Math.pow(b,6)),w=this,E="";;){var A=V(w,x).g;w=S(w,A.j(x));var D=((0<w.g.length?w.g[0]:w.h)>>>0).toString(b);if(w=A,v(w))return D+E;for(;6>D.length;)D="0"+D;E=D+E}},s.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function v(b){if(b.h!=0)return!1;for(var x=0;x<b.g.length;x++)if(b.g[x]!=0)return!1;return!0}function I(b){return b.h==-1}s.l=function(b){return b=S(this,b),I(b)?-1:v(b)?0:1};function g(b){for(var x=b.g.length,w=[],E=0;E<x;E++)w[E]=~b.g[E];return new o(w,~b.h).add(p)}s.abs=function(){return I(this)?g(this):this},s.add=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0,A=0;A<=x;A++){var D=E+(this.i(A)&65535)+(b.i(A)&65535),j=(D>>>16)+(this.i(A)>>>16)+(b.i(A)>>>16);E=j>>>16,D&=65535,j&=65535,w[A]=j<<16|D}return new o(w,w[w.length-1]&-2147483648?-1:0)};function S(b,x){return b.add(g(x))}s.j=function(b){if(v(this)||v(b))return m;if(I(this))return I(b)?g(this).j(g(b)):g(g(this).j(b));if(I(b))return g(this.j(g(b)));if(0>this.l(N)&&0>b.l(N))return u(this.m()*b.m());for(var x=this.g.length+b.g.length,w=[],E=0;E<2*x;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var A=0;A<b.g.length;A++){var D=this.i(E)>>>16,j=this.i(E)&65535,K=b.i(A)>>>16,X=b.i(A)&65535;w[2*E+2*A]+=j*X,C(w,2*E+2*A),w[2*E+2*A+1]+=D*X,C(w,2*E+2*A+1),w[2*E+2*A+1]+=j*K,C(w,2*E+2*A+1),w[2*E+2*A+2]+=D*K,C(w,2*E+2*A+2)}for(E=0;E<x;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=x;E<2*x;E++)w[E]=0;return new o(w,0)};function C(b,x){for(;(b[x]&65535)!=b[x];)b[x+1]+=b[x]>>>16,b[x]&=65535,x++}function T(b,x){this.g=b,this.h=x}function V(b,x){if(v(x))throw Error("division by zero");if(v(b))return new T(m,m);if(I(b))return x=V(g(b),x),new T(g(x.g),g(x.h));if(I(x))return x=V(b,g(x)),new T(g(x.g),x.h);if(30<b.g.length){if(I(b)||I(x))throw Error("slowDivide_ only works with positive integers.");for(var w=p,E=x;0>=E.l(b);)w=P(w),E=P(E);var A=k(w,1),D=k(E,1);for(E=k(E,2),w=k(w,2);!v(E);){var j=D.add(E);0>=j.l(b)&&(A=A.add(w),D=j),E=k(E,1),w=k(w,1)}return x=S(b,A.j(x)),new T(A,x)}for(A=m;0<=b.l(x);){for(w=Math.max(1,Math.floor(b.m()/x.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),D=u(w),j=D.j(x);I(j)||0<j.l(b);)w-=E,D=u(w),j=D.j(x);v(D)&&(D=p),A=A.add(D),b=S(b,j)}return new T(A,b)}s.A=function(b){return V(this,b).h},s.and=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)&b.i(E);return new o(w,this.h&b.h)},s.or=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)|b.i(E);return new o(w,this.h|b.h)},s.xor=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)^b.i(E);return new o(w,this.h^b.h)};function P(b){for(var x=b.g.length+1,w=[],E=0;E<x;E++)w[E]=b.i(E)<<1|b.i(E-1)>>>31;return new o(w,b.h)}function k(b,x){var w=x>>5;x%=32;for(var E=b.g.length-w,A=[],D=0;D<E;D++)A[D]=0<x?b.i(D+w)>>>x|b.i(D+w+1)<<32-x:b.i(D+w);return new o(A,b.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Ex=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Qn=o}).apply(typeof ff<"u"?ff:typeof self<"u"?self:typeof window<"u"?window:{});var uo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ix,Ca,Tx,Po,id,Sx,Ax,kx;(function(){var s,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,f,y){return d==Array.prototype||d==Object.prototype||(d[f]=y.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof uo=="object"&&uo];for(var f=0;f<d.length;++f){var y=d[f];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var n=t(this);function r(d,f){if(f)e:{var y=n;d=d.split(".");for(var R=0;R<d.length-1;R++){var H=d[R];if(!(H in y))break e;y=y[H]}d=d[d.length-1],R=y[d],f=f(R),f!=R&&f!=null&&e(y,d,{configurable:!0,writable:!0,value:f})}}function i(d,f){d instanceof String&&(d+="");var y=0,R=!1,H={next:function(){if(!R&&y<d.length){var ae=y++;return{value:f(ae,d[ae]),done:!1}}return R=!0,{done:!0,value:void 0}}};return H[Symbol.iterator]=function(){return H},H}r("Array.prototype.values",function(d){return d||function(){return i(this,function(f,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(d){var f=typeof d;return f=f!="object"?f:d?Array.isArray(d)?"array":f:"null",f=="array"||f=="object"&&typeof d.length=="number"}function u(d){var f=typeof d;return f=="object"&&d!=null||f=="function"}function h(d,f,y){return d.call.apply(d.bind,arguments)}function m(d,f,y){if(!d)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var H=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(H,R),d.apply(f,H)}}return function(){return d.apply(f,arguments)}}function p(d,f,y){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,p.apply(null,arguments)}function N(d,f){var y=Array.prototype.slice.call(arguments,1);return function(){var R=y.slice();return R.push.apply(R,arguments),d.apply(this,R)}}function v(d,f){function y(){}y.prototype=f.prototype,d.aa=f.prototype,d.prototype=new y,d.prototype.constructor=d,d.Qb=function(R,H,ae){for(var ve=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)ve[dt-2]=arguments[dt];return f.prototype[H].apply(R,ve)}}function I(d){const f=d.length;if(0<f){const y=Array(f);for(let R=0;R<f;R++)y[R]=d[R];return y}return[]}function g(d,f){for(let y=1;y<arguments.length;y++){const R=arguments[y];if(c(R)){const H=d.length||0,ae=R.length||0;d.length=H+ae;for(let ve=0;ve<ae;ve++)d[H+ve]=R[ve]}else d.push(R)}}class S{constructor(f,y){this.i=f,this.j=y,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function C(d){return/^[\s\xa0]*$/.test(d)}function T(){var d=l.navigator;return d&&(d=d.userAgent)?d:""}function V(d){return V[" "](d),d}V[" "]=function(){};var P=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function k(d,f,y){for(const R in d)f.call(y,d[R],R,d)}function b(d,f){for(const y in d)f.call(void 0,d[y],y,d)}function x(d){const f={};for(const y in d)f[y]=d[y];return f}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(d,f){let y,R;for(let H=1;H<arguments.length;H++){R=arguments[H];for(y in R)d[y]=R[y];for(let ae=0;ae<w.length;ae++)y=w[ae],Object.prototype.hasOwnProperty.call(R,y)&&(d[y]=R[y])}}function A(d){var f=1;d=d.split(":");const y=[];for(;0<f&&d.length;)y.push(d.shift()),f--;return d.length&&y.push(d.join(":")),y}function D(d){l.setTimeout(()=>{throw d},0)}function j(){var d=L;let f=null;return d.g&&(f=d.g,d.g=d.g.next,d.g||(d.h=null),f.next=null),f}class K{constructor(){this.h=this.g=null}add(f,y){const R=X.get();R.set(f,y),this.h?this.h.next=R:this.g=R,this.h=R}}var X=new S(()=>new W,d=>d.reset());class W{constructor(){this.next=this.g=this.h=null}set(f,y){this.h=f,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let se,M=!1,L=new K,Y=()=>{const d=l.Promise.resolve(void 0);se=()=>{d.then(z)}};var z=()=>{for(var d;d=j();){try{d.h.call(d.g)}catch(y){D(y)}var f=X;f.j(d),100>f.h&&(f.h++,d.next=f.g,f.g=d)}M=!1};function le(){this.s=this.s,this.C=this.C}le.prototype.s=!1,le.prototype.ma=function(){this.s||(this.s=!0,this.N())},le.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function he(d,f){this.type=d,this.g=this.target=f,this.defaultPrevented=!1}he.prototype.h=function(){this.defaultPrevented=!0};var Ne=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var d=!1,f=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const y=()=>{};l.addEventListener("test",y,f),l.removeEventListener("test",y,f)}catch{}return d}();function _e(d,f){if(he.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var y=this.type=d.type,R=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=f,f=d.relatedTarget){if(P){e:{try{V(f.nodeName);var H=!0;break e}catch{}H=!1}H||(f=null)}}else y=="mouseover"?f=d.fromElement:y=="mouseout"&&(f=d.toElement);this.relatedTarget=f,R?(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:Ve[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&_e.aa.h.call(this)}}v(_e,he);var Ve={2:"touch",3:"pen",4:"mouse"};_e.prototype.h=function(){_e.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var Ke="closure_listenable_"+(1e6*Math.random()|0),it=0;function at(d,f,y,R,H){this.listener=d,this.proxy=null,this.src=f,this.type=y,this.capture=!!R,this.ha=H,this.key=++it,this.da=this.fa=!1}function oe(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Ae(d){this.src=d,this.g={},this.h=0}Ae.prototype.add=function(d,f,y,R,H){var ae=d.toString();d=this.g[ae],d||(d=this.g[ae]=[],this.h++);var ve=ie(d,f,R,H);return-1<ve?(f=d[ve],y||(f.fa=!1)):(f=new at(f,this.src,ae,!!R,H),f.fa=y,d.push(f)),f};function ee(d,f){var y=f.type;if(y in d.g){var R=d.g[y],H=Array.prototype.indexOf.call(R,f,void 0),ae;(ae=0<=H)&&Array.prototype.splice.call(R,H,1),ae&&(oe(f),d.g[y].length==0&&(delete d.g[y],d.h--))}}function ie(d,f,y,R){for(var H=0;H<d.length;++H){var ae=d[H];if(!ae.da&&ae.listener==f&&ae.capture==!!y&&ae.ha==R)return H}return-1}var G="closure_lm_"+(1e6*Math.random()|0),Ie={};function ye(d,f,y,R,H){if(Array.isArray(f)){for(var ae=0;ae<f.length;ae++)ye(d,f[ae],y,R,H);return null}return y=He(y),d&&d[Ke]?d.K(f,y,u(R)?!!R.capture:!1,H):we(d,f,y,!1,R,H)}function we(d,f,y,R,H,ae){if(!f)throw Error("Invalid event type");var ve=u(H)?!!H.capture:!!H,dt=Se(d);if(dt||(d[G]=dt=new Ae(d)),y=dt.add(f,y,R,ve,ae),y.proxy)return y;if(R=B(),y.proxy=R,R.src=d,R.listener=y,d.addEventListener)Ne||(H=ve),H===void 0&&(H=!1),d.addEventListener(f.toString(),R,H);else if(d.attachEvent)d.attachEvent(be(f.toString()),R);else if(d.addListener&&d.removeListener)d.addListener(R);else throw Error("addEventListener and attachEvent are unavailable.");return y}function B(){function d(y){return f.call(d.src,d.listener,y)}const f=Re;return d}function Z(d,f,y,R,H){if(Array.isArray(f))for(var ae=0;ae<f.length;ae++)Z(d,f[ae],y,R,H);else R=u(R)?!!R.capture:!!R,y=He(y),d&&d[Ke]?(d=d.i,f=String(f).toString(),f in d.g&&(ae=d.g[f],y=ie(ae,y,R,H),-1<y&&(oe(ae[y]),Array.prototype.splice.call(ae,y,1),ae.length==0&&(delete d.g[f],d.h--)))):d&&(d=Se(d))&&(f=d.g[f.toString()],d=-1,f&&(d=ie(f,y,R,H)),(y=-1<d?f[d]:null)&&me(y))}function me(d){if(typeof d!="number"&&d&&!d.da){var f=d.src;if(f&&f[Ke])ee(f.i,d);else{var y=d.type,R=d.proxy;f.removeEventListener?f.removeEventListener(y,R,d.capture):f.detachEvent?f.detachEvent(be(y),R):f.addListener&&f.removeListener&&f.removeListener(R),(y=Se(f))?(ee(y,d),y.h==0&&(y.src=null,f[G]=null)):oe(d)}}}function be(d){return d in Ie?Ie[d]:Ie[d]="on"+d}function Re(d,f){if(d.da)d=!0;else{f=new _e(f,this);var y=d.listener,R=d.ha||d.src;d.fa&&me(d),d=y.call(R,f)}return d}function Se(d){return d=d[G],d instanceof Ae?d:null}var Fe="__closure_events_fn_"+(1e9*Math.random()>>>0);function He(d){return typeof d=="function"?d:(d[Fe]||(d[Fe]=function(f){return d.handleEvent(f)}),d[Fe])}function $(){le.call(this),this.i=new Ae(this),this.M=this,this.F=null}v($,le),$.prototype[Ke]=!0,$.prototype.removeEventListener=function(d,f,y,R){Z(this,d,f,y,R)};function ne(d,f){var y,R=d.F;if(R)for(y=[];R;R=R.F)y.push(R);if(d=d.M,R=f.type||f,typeof f=="string")f=new he(f,d);else if(f instanceof he)f.target=f.target||d;else{var H=f;f=new he(R,d),E(f,H)}if(H=!0,y)for(var ae=y.length-1;0<=ae;ae--){var ve=f.g=y[ae];H=xe(ve,R,!0,f)&&H}if(ve=f.g=d,H=xe(ve,R,!0,f)&&H,H=xe(ve,R,!1,f)&&H,y)for(ae=0;ae<y.length;ae++)ve=f.g=y[ae],H=xe(ve,R,!1,f)&&H}$.prototype.N=function(){if($.aa.N.call(this),this.i){var d=this.i,f;for(f in d.g){for(var y=d.g[f],R=0;R<y.length;R++)oe(y[R]);delete d.g[f],d.h--}}this.F=null},$.prototype.K=function(d,f,y,R){return this.i.add(String(d),f,!1,y,R)},$.prototype.L=function(d,f,y,R){return this.i.add(String(d),f,!0,y,R)};function xe(d,f,y,R){if(f=d.i.g[String(f)],!f)return!0;f=f.concat();for(var H=!0,ae=0;ae<f.length;++ae){var ve=f[ae];if(ve&&!ve.da&&ve.capture==y){var dt=ve.listener,Ut=ve.ha||ve.src;ve.fa&&ee(d.i,ve),H=dt.call(Ut,R)!==!1&&H}}return H&&!R.defaultPrevented}function F(d,f,y){if(typeof d=="function")y&&(d=p(d,y));else if(d&&typeof d.handleEvent=="function")d=p(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:l.setTimeout(d,f||0)}function O(d){d.g=F(()=>{d.g=null,d.i&&(d.i=!1,O(d))},d.l);const f=d.h;d.h=null,d.m.apply(null,f)}class U extends le{constructor(f,y){super(),this.m=f,this.l=y,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:O(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function q(d){le.call(this),this.h=d,this.g={}}v(q,le);var re=[];function de(d){k(d.g,function(f,y){this.g.hasOwnProperty(y)&&me(f)},d),d.g={}}q.prototype.N=function(){q.aa.N.call(this),de(this)},q.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Q=l.JSON.stringify,ge=l.JSON.parse,Te=class{stringify(d){return l.JSON.stringify(d,void 0)}parse(d){return l.JSON.parse(d,void 0)}};function fe(){}fe.prototype.h=null;function ke(d){return d.h||(d.h=d.i())}function Pe(){}var Me={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Oe(){he.call(this,"d")}v(Oe,he);function Je(){he.call(this,"c")}v(Je,he);var et={},tt=null;function $e(){return tt=tt||new $}et.La="serverreachability";function bt(d){he.call(this,et.La,d)}v(bt,he);function St(d){const f=$e();ne(f,new bt(f))}et.STAT_EVENT="statevent";function ts(d,f){he.call(this,et.STAT_EVENT,d),this.stat=f}v(ts,he);function nt(d){const f=$e();ne(f,new ts(f,d))}et.Ma="timingevent";function Ki(d,f){he.call(this,et.Ma,d),this.size=f}v(Ki,he);function Pn(d,f){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){d()},f)}function ga(){this.g=!0}ga.prototype.xa=function(){this.g=!1};function sw(d,f,y,R,H,ae){d.info(function(){if(d.g)if(ae)for(var ve="",dt=ae.split("&"),Ut=0;Ut<dt.length;Ut++){var rt=dt[Ut].split("=");if(1<rt.length){var qt=rt[0];rt=rt[1];var Wt=qt.split("_");ve=2<=Wt.length&&Wt[1]=="type"?ve+(qt+"="+rt+"&"):ve+(qt+"=redacted&")}}else ve=null;else ve=ae;return"XMLHTTP REQ ("+R+") [attempt "+H+"]: "+f+`
`+y+`
`+ve})}function nw(d,f,y,R,H,ae,ve){d.info(function(){return"XMLHTTP RESP ("+R+") [ attempt "+H+"]: "+f+`
`+y+`
`+ae+" "+ve})}function pr(d,f,y,R){d.info(function(){return"XMLHTTP TEXT ("+f+"): "+aw(d,y)+(R?" "+R:"")})}function rw(d,f){d.info(function(){return"TIMEOUT: "+f})}ga.prototype.info=function(){};function aw(d,f){if(!d.g)return f;if(!f)return null;try{var y=JSON.parse(f);if(y){for(d=0;d<y.length;d++)if(Array.isArray(y[d])){var R=y[d];if(!(2>R.length)){var H=R[1];if(Array.isArray(H)&&!(1>H.length)){var ae=H[0];if(ae!="noop"&&ae!="stop"&&ae!="close")for(var ve=1;ve<H.length;ve++)H[ve]=""}}}}return Q(y)}catch{return f}}var Hi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ah={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Zl;function Ji(){}v(Ji,fe),Ji.prototype.g=function(){return new XMLHttpRequest},Ji.prototype.i=function(){return{}},Zl=new Ji;function Ys(d,f,y,R){this.j=d,this.i=f,this.l=y,this.R=R||1,this.U=new q(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new kh}function kh(){this.i=null,this.g="",this.h=!1}var Ph={},ec={};function tc(d,f,y){d.L=1,d.v=Zi(Rs(f)),d.m=y,d.P=!0,Ch(d,null)}function Ch(d,f){d.F=Date.now(),Qi(d),d.A=Rs(d.v);var y=d.A,R=d.R;Array.isArray(R)||(R=[String(R)]),Wh(y.i,"t",R),d.C=0,y=d.j.J,d.h=new kh,d.g=dm(d.j,y?f:null,!d.m),0<d.O&&(d.M=new U(p(d.Y,d,d.g),d.O)),f=d.U,y=d.g,R=d.ca;var H="readystatechange";Array.isArray(H)||(H&&(re[0]=H.toString()),H=re);for(var ae=0;ae<H.length;ae++){var ve=ye(y,H[ae],R||f.handleEvent,!1,f.h||f);if(!ve)break;f.g[ve.key]=ve}f=d.H?x(d.H):{},d.m?(d.u||(d.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,f)):(d.u="GET",d.g.ea(d.A,d.u,null,f)),St(),sw(d.i,d.u,d.A,d.l,d.R,d.m)}Ys.prototype.ca=function(d){d=d.target;const f=this.M;f&&Ds(d)==3?f.j():this.Y(d)},Ys.prototype.Y=function(d){try{if(d==this.g)e:{const Wt=Ds(this.g);var f=this.g.Ba();const br=this.g.Z();if(!(3>Wt)&&(Wt!=3||this.g&&(this.h.h||this.g.oa()||Zh(this.g)))){this.J||Wt!=4||f==7||(f==8||0>=br?St(3):St(2)),sc(this);var y=this.g.Z();this.X=y;t:if(Rh(this)){var R=Zh(this.g);d="";var H=R.length,ae=Ds(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Cn(this),pa(this);var ve="";break t}this.h.i=new l.TextDecoder}for(f=0;f<H;f++)this.h.h=!0,d+=this.h.i.decode(R[f],{stream:!(ae&&f==H-1)});R.length=0,this.h.g+=d,this.C=0,ve=this.h.g}else ve=this.g.oa();if(this.o=y==200,nw(this.i,this.u,this.A,this.l,this.R,Wt,y),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,Ut=this.g;if((dt=Ut.g?Ut.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(dt)){var rt=dt;break t}}rt=null}if(y=rt)pr(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,nc(this,y);else{this.o=!1,this.s=3,nt(12),Cn(this),pa(this);break e}}if(this.P){y=!0;let ws;for(;!this.J&&this.C<ve.length;)if(ws=iw(this,ve),ws==ec){Wt==4&&(this.s=4,nt(14),y=!1),pr(this.i,this.l,null,"[Incomplete Response]");break}else if(ws==Ph){this.s=4,nt(15),pr(this.i,this.l,ve,"[Invalid Chunk]"),y=!1;break}else pr(this.i,this.l,ws,null),nc(this,ws);if(Rh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Wt!=4||ve.length!=0||this.h.h||(this.s=1,nt(16),y=!1),this.o=this.o&&y,!y)pr(this.i,this.l,ve,"[Invalid Chunked Response]"),Cn(this),pa(this);else if(0<ve.length&&!this.W){this.W=!0;var qt=this.j;qt.g==this&&qt.ba&&!qt.M&&(qt.j.info("Great, no buffering proxy detected. Bytes received: "+ve.length),cc(qt),qt.M=!0,nt(11))}}else pr(this.i,this.l,ve,null),nc(this,ve);Wt==4&&Cn(this),this.o&&!this.J&&(Wt==4?im(this.j,this):(this.o=!1,Qi(this)))}else _w(this.g),y==400&&0<ve.indexOf("Unknown SID")?(this.s=3,nt(12)):(this.s=0,nt(13)),Cn(this),pa(this)}}}catch{}finally{}};function Rh(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function iw(d,f){var y=d.C,R=f.indexOf(`
`,y);return R==-1?ec:(y=Number(f.substring(y,R)),isNaN(y)?Ph:(R+=1,R+y>f.length?ec:(f=f.slice(R,R+y),d.C=R+y,f)))}Ys.prototype.cancel=function(){this.J=!0,Cn(this)};function Qi(d){d.S=Date.now()+d.I,Dh(d,d.I)}function Dh(d,f){if(d.B!=null)throw Error("WatchDog timer not null");d.B=Pn(p(d.ba,d),f)}function sc(d){d.B&&(l.clearTimeout(d.B),d.B=null)}Ys.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(rw(this.i,this.A),this.L!=2&&(St(),nt(17)),Cn(this),this.s=2,pa(this)):Dh(this,this.S-d)};function pa(d){d.j.G==0||d.J||im(d.j,d)}function Cn(d){sc(d);var f=d.M;f&&typeof f.ma=="function"&&f.ma(),d.M=null,de(d.U),d.g&&(f=d.g,d.g=null,f.abort(),f.ma())}function nc(d,f){try{var y=d.j;if(y.G!=0&&(y.g==d||rc(y.h,d))){if(!d.K&&rc(y.h,d)&&y.G==3){try{var R=y.Da.g.parse(f)}catch{R=null}if(Array.isArray(R)&&R.length==3){var H=R;if(H[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<d.F)ao(y),no(y);else break e;lc(y),nt(18)}}else y.za=H[1],0<y.za-y.T&&37500>H[2]&&y.F&&y.v==0&&!y.C&&(y.C=Pn(p(y.Za,y),6e3));if(1>=Lh(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Dn(y,11)}else if((d.K||y.g==d)&&ao(y),!C(f))for(H=y.Da.g.parse(f),f=0;f<H.length;f++){let rt=H[f];if(y.T=rt[0],rt=rt[1],y.G==2)if(rt[0]=="c"){y.K=rt[1],y.ia=rt[2];const qt=rt[3];qt!=null&&(y.la=qt,y.j.info("VER="+y.la));const Wt=rt[4];Wt!=null&&(y.Aa=Wt,y.j.info("SVER="+y.Aa));const br=rt[5];br!=null&&typeof br=="number"&&0<br&&(R=1.5*br,y.L=R,y.j.info("backChannelRequestTimeoutMs_="+R)),R=y;const ws=d.g;if(ws){const oo=ws.g?ws.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(oo){var ae=R.h;ae.g||oo.indexOf("spdy")==-1&&oo.indexOf("quic")==-1&&oo.indexOf("h2")==-1||(ae.j=ae.l,ae.g=new Set,ae.h&&(ac(ae,ae.h),ae.h=null))}if(R.D){const dc=ws.g?ws.g.getResponseHeader("X-HTTP-Session-Id"):null;dc&&(R.ya=dc,ht(R.I,R.D,dc))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-d.F,y.j.info("Handshake RTT: "+y.R+"ms")),R=y;var ve=d;if(R.qa=cm(R,R.J?R.ia:null,R.W),ve.K){Oh(R.h,ve);var dt=ve,Ut=R.L;Ut&&(dt.I=Ut),dt.B&&(sc(dt),Qi(dt)),R.g=ve}else rm(R);0<y.i.length&&ro(y)}else rt[0]!="stop"&&rt[0]!="close"||Dn(y,7);else y.G==3&&(rt[0]=="stop"||rt[0]=="close"?rt[0]=="stop"?Dn(y,7):oc(y):rt[0]!="noop"&&y.l&&y.l.ta(rt),y.v=0)}}St(4)}catch{}}var ow=class{constructor(d,f){this.g=d,this.map=f}};function Vh(d){this.l=d||10,l.PerformanceNavigationTiming?(d=l.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mh(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Lh(d){return d.h?1:d.g?d.g.size:0}function rc(d,f){return d.h?d.h==f:d.g?d.g.has(f):!1}function ac(d,f){d.g?d.g.add(f):d.h=f}function Oh(d,f){d.h&&d.h==f?d.h=null:d.g&&d.g.has(f)&&d.g.delete(f)}Vh.prototype.cancel=function(){if(this.i=Fh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function Fh(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let f=d.i;for(const y of d.g.values())f=f.concat(y.D);return f}return I(d.i)}function lw(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var f=[],y=d.length,R=0;R<y;R++)f.push(d[R]);return f}f=[],y=0;for(R in d)f[y++]=d[R];return f}function cw(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var f=[];d=d.length;for(var y=0;y<d;y++)f.push(y);return f}f=[],y=0;for(const R in d)f[y++]=R;return f}}}function $h(d,f){if(d.forEach&&typeof d.forEach=="function")d.forEach(f,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,f,void 0);else for(var y=cw(d),R=lw(d),H=R.length,ae=0;ae<H;ae++)f.call(void 0,R[ae],y&&y[ae],d)}var Uh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dw(d,f){if(d){d=d.split("&");for(var y=0;y<d.length;y++){var R=d[y].indexOf("="),H=null;if(0<=R){var ae=d[y].substring(0,R);H=d[y].substring(R+1)}else ae=d[y];f(ae,H?decodeURIComponent(H.replace(/\+/g," ")):"")}}}function Rn(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof Rn){this.h=d.h,Yi(this,d.j),this.o=d.o,this.g=d.g,Xi(this,d.s),this.l=d.l;var f=d.i,y=new ba;y.i=f.i,f.g&&(y.g=new Map(f.g),y.h=f.h),Bh(this,y),this.m=d.m}else d&&(f=String(d).match(Uh))?(this.h=!1,Yi(this,f[1]||"",!0),this.o=xa(f[2]||""),this.g=xa(f[3]||"",!0),Xi(this,f[4]),this.l=xa(f[5]||"",!0),Bh(this,f[6]||"",!0),this.m=xa(f[7]||"")):(this.h=!1,this.i=new ba(null,this.h))}Rn.prototype.toString=function(){var d=[],f=this.j;f&&d.push(ya(f,zh,!0),":");var y=this.g;return(y||f=="file")&&(d.push("//"),(f=this.o)&&d.push(ya(f,zh,!0),"@"),d.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&d.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&d.push("/"),d.push(ya(y,y.charAt(0)=="/"?mw:hw,!0))),(y=this.i.toString())&&d.push("?",y),(y=this.m)&&d.push("#",ya(y,gw)),d.join("")};function Rs(d){return new Rn(d)}function Yi(d,f,y){d.j=y?xa(f,!0):f,d.j&&(d.j=d.j.replace(/:$/,""))}function Xi(d,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);d.s=f}else d.s=null}function Bh(d,f,y){f instanceof ba?(d.i=f,pw(d.i,d.h)):(y||(f=ya(f,fw)),d.i=new ba(f,d.h))}function ht(d,f,y){d.i.set(f,y)}function Zi(d){return ht(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function xa(d,f){return d?f?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function ya(d,f,y){return typeof d=="string"?(d=encodeURI(d).replace(f,uw),y&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function uw(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var zh=/[#\/\?@]/g,hw=/[#\?:]/g,mw=/[#\?]/g,fw=/[#\?@]/g,gw=/#/g;function ba(d,f){this.h=this.g=null,this.i=d||null,this.j=!!f}function Xs(d){d.g||(d.g=new Map,d.h=0,d.i&&dw(d.i,function(f,y){d.add(decodeURIComponent(f.replace(/\+/g," ")),y)}))}s=ba.prototype,s.add=function(d,f){Xs(this),this.i=null,d=xr(this,d);var y=this.g.get(d);return y||this.g.set(d,y=[]),y.push(f),this.h+=1,this};function Gh(d,f){Xs(d),f=xr(d,f),d.g.has(f)&&(d.i=null,d.h-=d.g.get(f).length,d.g.delete(f))}function qh(d,f){return Xs(d),f=xr(d,f),d.g.has(f)}s.forEach=function(d,f){Xs(this),this.g.forEach(function(y,R){y.forEach(function(H){d.call(f,H,R,this)},this)},this)},s.na=function(){Xs(this);const d=Array.from(this.g.values()),f=Array.from(this.g.keys()),y=[];for(let R=0;R<f.length;R++){const H=d[R];for(let ae=0;ae<H.length;ae++)y.push(f[R])}return y},s.V=function(d){Xs(this);let f=[];if(typeof d=="string")qh(this,d)&&(f=f.concat(this.g.get(xr(this,d))));else{d=Array.from(this.g.values());for(let y=0;y<d.length;y++)f=f.concat(d[y])}return f},s.set=function(d,f){return Xs(this),this.i=null,d=xr(this,d),qh(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[f]),this.h+=1,this},s.get=function(d,f){return d?(d=this.V(d),0<d.length?String(d[0]):f):f};function Wh(d,f,y){Gh(d,f),0<y.length&&(d.i=null,d.g.set(xr(d,f),I(y)),d.h+=y.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],f=Array.from(this.g.keys());for(var y=0;y<f.length;y++){var R=f[y];const ae=encodeURIComponent(String(R)),ve=this.V(R);for(R=0;R<ve.length;R++){var H=ae;ve[R]!==""&&(H+="="+encodeURIComponent(String(ve[R]))),d.push(H)}}return this.i=d.join("&")};function xr(d,f){return f=String(f),d.j&&(f=f.toLowerCase()),f}function pw(d,f){f&&!d.j&&(Xs(d),d.i=null,d.g.forEach(function(y,R){var H=R.toLowerCase();R!=H&&(Gh(this,R),Wh(this,H,y))},d)),d.j=f}function xw(d,f){const y=new ga;if(l.Image){const R=new Image;R.onload=N(Zs,y,"TestLoadImage: loaded",!0,f,R),R.onerror=N(Zs,y,"TestLoadImage: error",!1,f,R),R.onabort=N(Zs,y,"TestLoadImage: abort",!1,f,R),R.ontimeout=N(Zs,y,"TestLoadImage: timeout",!1,f,R),l.setTimeout(function(){R.ontimeout&&R.ontimeout()},1e4),R.src=d}else f(!1)}function yw(d,f){const y=new ga,R=new AbortController,H=setTimeout(()=>{R.abort(),Zs(y,"TestPingServer: timeout",!1,f)},1e4);fetch(d,{signal:R.signal}).then(ae=>{clearTimeout(H),ae.ok?Zs(y,"TestPingServer: ok",!0,f):Zs(y,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(H),Zs(y,"TestPingServer: error",!1,f)})}function Zs(d,f,y,R,H){try{H&&(H.onload=null,H.onerror=null,H.onabort=null,H.ontimeout=null),R(y)}catch{}}function bw(){this.g=new Te}function vw(d,f,y){const R=y||"";try{$h(d,function(H,ae){let ve=H;u(H)&&(ve=Q(H)),f.push(R+ae+"="+encodeURIComponent(ve))})}catch(H){throw f.push(R+"type="+encodeURIComponent("_badmap")),H}}function eo(d){this.l=d.Ub||null,this.j=d.eb||!1}v(eo,fe),eo.prototype.g=function(){return new to(this.l,this.j)},eo.prototype.i=function(d){return function(){return d}}({});function to(d,f){$.call(this),this.D=d,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(to,$),s=to.prototype,s.open=function(d,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=f,this.readyState=1,wa(this)},s.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(f.body=d),(this.D||l).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,va(this)),this.readyState=0},s.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,wa(this)),this.g&&(this.readyState=3,wa(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Kh(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function Kh(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}s.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var f=d.value?d.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!d.done}))&&(this.response=this.responseText+=f)}d.done?va(this):wa(this),this.readyState==3&&Kh(this)}},s.Ra=function(d){this.g&&(this.response=this.responseText=d,va(this))},s.Qa=function(d){this.g&&(this.response=d,va(this))},s.ga=function(){this.g&&va(this)};function va(d){d.readyState=4,d.l=null,d.j=null,d.v=null,wa(d)}s.setRequestHeader=function(d,f){this.u.append(d,f)},s.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],f=this.h.entries();for(var y=f.next();!y.done;)y=y.value,d.push(y[0]+": "+y[1]),y=f.next();return d.join(`\r
`)};function wa(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(to.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function Hh(d){let f="";return k(d,function(y,R){f+=R,f+=":",f+=y,f+=`\r
`}),f}function ic(d,f,y){e:{for(R in y){var R=!1;break e}R=!0}R||(y=Hh(y),typeof d=="string"?y!=null&&encodeURIComponent(String(y)):ht(d,f,y))}function Nt(d){$.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(Nt,$);var ww=/^https?$/i,Nw=["POST","PUT"];s=Nt.prototype,s.Ha=function(d){this.J=d},s.ea=function(d,f,y,R){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);f=f?f.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Zl.g(),this.v=this.o?ke(this.o):ke(Zl),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(f,String(d),!0),this.B=!1}catch(ae){Jh(this,ae);return}if(d=y||"",y=new Map(this.headers),R)if(Object.getPrototypeOf(R)===Object.prototype)for(var H in R)y.set(H,R[H]);else if(typeof R.keys=="function"&&typeof R.get=="function")for(const ae of R.keys())y.set(ae,R.get(ae));else throw Error("Unknown input type for opt_headers: "+String(R));R=Array.from(y.keys()).find(ae=>ae.toLowerCase()=="content-type"),H=l.FormData&&d instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Nw,f,void 0))||R||H||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ae,ve]of y)this.g.setRequestHeader(ae,ve);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xh(this),this.u=!0,this.g.send(d),this.u=!1}catch(ae){Jh(this,ae)}};function Jh(d,f){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=f,d.m=5,Qh(d),so(d)}function Qh(d){d.A||(d.A=!0,ne(d,"complete"),ne(d,"error"))}s.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,ne(this,"complete"),ne(this,"abort"),so(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),so(this,!0)),Nt.aa.N.call(this)},s.Ea=function(){this.s||(this.B||this.u||this.j?Yh(this):this.bb())},s.bb=function(){Yh(this)};function Yh(d){if(d.h&&typeof o<"u"&&(!d.v[1]||Ds(d)!=4||d.Z()!=2)){if(d.u&&Ds(d)==4)F(d.Ea,0,d);else if(ne(d,"readystatechange"),Ds(d)==4){d.h=!1;try{const ve=d.Z();e:switch(ve){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var y;if(!(y=f)){var R;if(R=ve===0){var H=String(d.D).match(Uh)[1]||null;!H&&l.self&&l.self.location&&(H=l.self.location.protocol.slice(0,-1)),R=!ww.test(H?H.toLowerCase():"")}y=R}if(y)ne(d,"complete"),ne(d,"success");else{d.m=6;try{var ae=2<Ds(d)?d.g.statusText:""}catch{ae=""}d.l=ae+" ["+d.Z()+"]",Qh(d)}}finally{so(d)}}}}function so(d,f){if(d.g){Xh(d);const y=d.g,R=d.v[0]?()=>{}:null;d.g=null,d.v=null,f||ne(d,"ready");try{y.onreadystatechange=R}catch{}}}function Xh(d){d.I&&(l.clearTimeout(d.I),d.I=null)}s.isActive=function(){return!!this.g};function Ds(d){return d.g?d.g.readyState:0}s.Z=function(){try{return 2<Ds(this)?this.g.status:-1}catch{return-1}},s.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.Oa=function(d){if(this.g){var f=this.g.responseText;return d&&f.indexOf(d)==0&&(f=f.substring(d.length)),ge(f)}};function Zh(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function _w(d){const f={};d=(d.g&&2<=Ds(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let R=0;R<d.length;R++){if(C(d[R]))continue;var y=A(d[R]);const H=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const ae=f[H]||[];f[H]=ae,ae.push(y)}b(f,function(R){return R.join(", ")})}s.Ba=function(){return this.m},s.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Na(d,f,y){return y&&y.internalChannelParams&&y.internalChannelParams[d]||f}function em(d){this.Aa=0,this.i=[],this.j=new ga,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Na("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Na("baseRetryDelayMs",5e3,d),this.cb=Na("retryDelaySeedMs",1e4,d),this.Wa=Na("forwardChannelMaxRetries",2,d),this.wa=Na("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Vh(d&&d.concurrentRequestLimit),this.Da=new bw,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}s=em.prototype,s.la=8,s.G=1,s.connect=function(d,f,y,R){nt(0),this.W=d,this.H=f||{},y&&R!==void 0&&(this.H.OSID=y,this.H.OAID=R),this.F=this.X,this.I=cm(this,null,this.W),ro(this)};function oc(d){if(tm(d),d.G==3){var f=d.U++,y=Rs(d.I);if(ht(y,"SID",d.K),ht(y,"RID",f),ht(y,"TYPE","terminate"),_a(d,y),f=new Ys(d,d.j,f),f.L=2,f.v=Zi(Rs(y)),y=!1,l.navigator&&l.navigator.sendBeacon)try{y=l.navigator.sendBeacon(f.v.toString(),"")}catch{}!y&&l.Image&&(new Image().src=f.v,y=!0),y||(f.g=dm(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Qi(f)}lm(d)}function no(d){d.g&&(cc(d),d.g.cancel(),d.g=null)}function tm(d){no(d),d.u&&(l.clearTimeout(d.u),d.u=null),ao(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&l.clearTimeout(d.s),d.s=null)}function ro(d){if(!Mh(d.h)&&!d.s){d.s=!0;var f=d.Ga;se||Y(),M||(se(),M=!0),L.add(f,d),d.B=0}}function jw(d,f){return Lh(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=f.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=Pn(p(d.Ga,d,f),om(d,d.B)),d.B++,!0)}s.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const H=new Ys(this,this.j,d);let ae=this.o;if(this.S&&(ae?(ae=x(ae),E(ae,this.S)):ae=this.S),this.m!==null||this.O||(H.H=ae,ae=null),this.P)e:{for(var f=0,y=0;y<this.i.length;y++){t:{var R=this.i[y];if("__data__"in R.map&&(R=R.map.__data__,typeof R=="string")){R=R.length;break t}R=void 0}if(R===void 0)break;if(f+=R,4096<f){f=y;break e}if(f===4096||y===this.i.length-1){f=y+1;break e}}f=1e3}else f=1e3;f=nm(this,H,f),y=Rs(this.I),ht(y,"RID",d),ht(y,"CVER",22),this.D&&ht(y,"X-HTTP-Session-Id",this.D),_a(this,y),ae&&(this.O?f="headers="+encodeURIComponent(String(Hh(ae)))+"&"+f:this.m&&ic(y,this.m,ae)),ac(this.h,H),this.Ua&&ht(y,"TYPE","init"),this.P?(ht(y,"$req",f),ht(y,"SID","null"),H.T=!0,tc(H,y,null)):tc(H,y,f),this.G=2}}else this.G==3&&(d?sm(this,d):this.i.length==0||Mh(this.h)||sm(this))};function sm(d,f){var y;f?y=f.l:y=d.U++;const R=Rs(d.I);ht(R,"SID",d.K),ht(R,"RID",y),ht(R,"AID",d.T),_a(d,R),d.m&&d.o&&ic(R,d.m,d.o),y=new Ys(d,d.j,y,d.B+1),d.m===null&&(y.H=d.o),f&&(d.i=f.D.concat(d.i)),f=nm(d,y,1e3),y.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),ac(d.h,y),tc(y,R,f)}function _a(d,f){d.H&&k(d.H,function(y,R){ht(f,R,y)}),d.l&&$h({},function(y,R){ht(f,R,y)})}function nm(d,f,y){y=Math.min(d.i.length,y);var R=d.l?p(d.l.Na,d.l,d):null;e:{var H=d.i;let ae=-1;for(;;){const ve=["count="+y];ae==-1?0<y?(ae=H[0].g,ve.push("ofs="+ae)):ae=0:ve.push("ofs="+ae);let dt=!0;for(let Ut=0;Ut<y;Ut++){let rt=H[Ut].g;const qt=H[Ut].map;if(rt-=ae,0>rt)ae=Math.max(0,H[Ut].g-100),dt=!1;else try{vw(qt,ve,"req"+rt+"_")}catch{R&&R(qt)}}if(dt){R=ve.join("&");break e}}}return d=d.i.splice(0,y),f.D=d,R}function rm(d){if(!d.g&&!d.u){d.Y=1;var f=d.Fa;se||Y(),M||(se(),M=!0),L.add(f,d),d.v=0}}function lc(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=Pn(p(d.Fa,d),om(d,d.v)),d.v++,!0)}s.Fa=function(){if(this.u=null,am(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=Pn(p(this.ab,this),d)}},s.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nt(10),no(this),am(this))};function cc(d){d.A!=null&&(l.clearTimeout(d.A),d.A=null)}function am(d){d.g=new Ys(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var f=Rs(d.qa);ht(f,"RID","rpc"),ht(f,"SID",d.K),ht(f,"AID",d.T),ht(f,"CI",d.F?"0":"1"),!d.F&&d.ja&&ht(f,"TO",d.ja),ht(f,"TYPE","xmlhttp"),_a(d,f),d.m&&d.o&&ic(f,d.m,d.o),d.L&&(d.g.I=d.L);var y=d.g;d=d.ia,y.L=1,y.v=Zi(Rs(f)),y.m=null,y.P=!0,Ch(y,d)}s.Za=function(){this.C!=null&&(this.C=null,no(this),lc(this),nt(19))};function ao(d){d.C!=null&&(l.clearTimeout(d.C),d.C=null)}function im(d,f){var y=null;if(d.g==f){ao(d),cc(d),d.g=null;var R=2}else if(rc(d.h,f))y=f.D,Oh(d.h,f),R=1;else return;if(d.G!=0){if(f.o)if(R==1){y=f.m?f.m.length:0,f=Date.now()-f.F;var H=d.B;R=$e(),ne(R,new Ki(R,y)),ro(d)}else rm(d);else if(H=f.s,H==3||H==0&&0<f.X||!(R==1&&jw(d,f)||R==2&&lc(d)))switch(y&&0<y.length&&(f=d.h,f.i=f.i.concat(y)),H){case 1:Dn(d,5);break;case 4:Dn(d,10);break;case 3:Dn(d,6);break;default:Dn(d,2)}}}function om(d,f){let y=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(y*=2),y*f}function Dn(d,f){if(d.j.info("Error code "+f),f==2){var y=p(d.fb,d),R=d.Xa;const H=!R;R=new Rn(R||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Yi(R,"https"),Zi(R),H?xw(R.toString(),y):yw(R.toString(),y)}else nt(2);d.G=0,d.l&&d.l.sa(f),lm(d),tm(d)}s.fb=function(d){d?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))};function lm(d){if(d.G=0,d.ka=[],d.l){const f=Fh(d.h);(f.length!=0||d.i.length!=0)&&(g(d.ka,f),g(d.ka,d.i),d.h.i.length=0,I(d.i),d.i.length=0),d.l.ra()}}function cm(d,f,y){var R=y instanceof Rn?Rs(y):new Rn(y);if(R.g!="")f&&(R.g=f+"."+R.g),Xi(R,R.s);else{var H=l.location;R=H.protocol,f=f?f+"."+H.hostname:H.hostname,H=+H.port;var ae=new Rn(null);R&&Yi(ae,R),f&&(ae.g=f),H&&Xi(ae,H),y&&(ae.l=y),R=ae}return y=d.D,f=d.ya,y&&f&&ht(R,y,f),ht(R,"VER",d.la),_a(d,R),R}function dm(d,f,y){if(f&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=d.Ca&&!d.pa?new Nt(new eo({eb:y})):new Nt(d.pa),f.Ha(d.J),f}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function um(){}s=um.prototype,s.ua=function(){},s.ta=function(){},s.sa=function(){},s.ra=function(){},s.isActive=function(){return!0},s.Na=function(){};function io(){}io.prototype.g=function(d,f){return new os(d,f)};function os(d,f){$.call(this),this.g=new em(f),this.l=d,this.h=f&&f.messageUrlParams||null,d=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(d?d["X-WebChannel-Content-Type"]=f.messageContentType:d={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(d?d["X-WebChannel-Client-Profile"]=f.va:d={"X-WebChannel-Client-Profile":f.va}),this.g.S=d,(d=f&&f.Sb)&&!C(d)&&(this.g.m=d),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!C(f)&&(this.g.D=f,d=this.h,d!==null&&f in d&&(d=this.h,f in d&&delete d[f])),this.j=new yr(this)}v(os,$),os.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},os.prototype.close=function(){oc(this.g)},os.prototype.o=function(d){var f=this.g;if(typeof d=="string"){var y={};y.__data__=d,d=y}else this.u&&(y={},y.__data__=Q(d),d=y);f.i.push(new ow(f.Ya++,d)),f.G==3&&ro(f)},os.prototype.N=function(){this.g.l=null,delete this.j,oc(this.g),delete this.g,os.aa.N.call(this)};function hm(d){Oe.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var f=d.__sm__;if(f){e:{for(const y in f){d=y;break e}d=void 0}(this.i=d)&&(d=this.i,f=f!==null&&d in f?f[d]:void 0),this.data=f}else this.data=d}v(hm,Oe);function mm(){Je.call(this),this.status=1}v(mm,Je);function yr(d){this.g=d}v(yr,um),yr.prototype.ua=function(){ne(this.g,"a")},yr.prototype.ta=function(d){ne(this.g,new hm(d))},yr.prototype.sa=function(d){ne(this.g,new mm)},yr.prototype.ra=function(){ne(this.g,"b")},io.prototype.createWebChannel=io.prototype.g,os.prototype.send=os.prototype.o,os.prototype.open=os.prototype.m,os.prototype.close=os.prototype.close,kx=function(){return new io},Ax=function(){return $e()},Sx=et,id={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Hi.NO_ERROR=0,Hi.TIMEOUT=8,Hi.HTTP_ERROR=6,Po=Hi,Ah.COMPLETE="complete",Tx=Ah,Pe.EventType=Me,Me.OPEN="a",Me.CLOSE="b",Me.ERROR="c",Me.MESSAGE="d",$.prototype.listen=$.prototype.K,Ca=Pe,Nt.prototype.listenOnce=Nt.prototype.L,Nt.prototype.getLastError=Nt.prototype.Ka,Nt.prototype.getLastErrorCode=Nt.prototype.Ba,Nt.prototype.getStatus=Nt.prototype.Z,Nt.prototype.getResponseJson=Nt.prototype.Oa,Nt.prototype.getResponseText=Nt.prototype.oa,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Ha,Ix=Nt}).apply(typeof uo<"u"?uo:typeof self<"u"?self:typeof window<"u"?window:{});const gf="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}zt.UNAUTHENTICATED=new zt(null),zt.GOOGLE_CREDENTIALS=new zt("google-credentials-uid"),zt.FIRST_PARTY=new zt("first-party-uid"),zt.MOCK_USER=new zt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let la="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr=new nu("@firebase/firestore");function jr(){return rr.logLevel}function pe(s,...e){if(rr.logLevel<=Ye.DEBUG){const t=e.map(gu);rr.debug(`Firestore (${la}): ${s}`,...t)}}function Qt(s,...e){if(rr.logLevel<=Ye.ERROR){const t=e.map(gu);rr.error(`Firestore (${la}): ${s}`,...t)}}function ar(s,...e){if(rr.logLevel<=Ye.WARN){const t=e.map(gu);rr.warn(`Firestore (${la}): ${s}`,...t)}}function gu(s){if(typeof s=="string")return s;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(s)}catch{return s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(s="Unexpected state"){const e=`FIRESTORE (${la}) INTERNAL ASSERTION FAILED: `+s;throw Qt(e),new Error(e)}function Le(s,e){s||De()}function Ge(s,e){return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class je extends Js{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class XE{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(zt.UNAUTHENTICATED))}shutdown(){}}class ZE{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class eI{constructor(e){this.t=e,this.currentUser=zt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Le(this.o===void 0);let n=this.i;const r=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve();let i=new Yn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Yn,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await r(this.currentUser)})},l=c=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Yn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Le(typeof n.accessToken=="string"),new Px(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Le(e===null||typeof e=="string"),new zt(e)}}class tI{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=zt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class sI{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new tI(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(zt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nI{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rI{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Le(this.o===void 0);const n=i=>{i.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const r=i=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?r(i):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Le(typeof t.token=="string"),this.R=t.token,new nI(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=aI(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function qe(s,e){return s<e?-1:s>e?1:0}function qr(s,e,t){return s.length===e.length&&s.every((n,r)=>t(n,e[r]))}function Rx(s){return s+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new je(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new je(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new je(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new je(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return It.fromMillis(Date.now())}static fromDate(e){return It.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new It(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?qe(this.nanoseconds,e.nanoseconds):qe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Be(e)}static min(){return new Be(new It(0,0))}static max(){return new Be(new It(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e,t,n){t===void 0?t=0:t>e.length&&De(),n===void 0?n=e.length-t:n>e.length-t&&De(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return ri.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ri?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const i=e.get(r),o=t.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ot extends ri{construct(e,t,n){return new ot(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new je(ue.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(r=>r.length>0))}return new ot(t)}static emptyPath(){return new ot([])}}const iI=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Et extends ri{construct(e,t,n){return new Et(e,t,n)}static isValidIdentifier(e){return iI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Et(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(n.length===0)throw new je(ue.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new je(ue.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[r+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new je(ue.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,r+=2}else l==="`"?(o=!o,r++):l!=="."||o?(n+=l,r++):(i(),r++)}if(i(),o)throw new je(ue.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Et(t)}static emptyPath(){return new Et([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e){this.path=e}static fromPath(e){return new Ee(ot.fromString(e))}static fromName(e){return new Ee(ot.fromString(e).popFirst(5))}static empty(){return new Ee(ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ot.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ee(new ot(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function od(s){return s.fields.find(e=>e.kind===2)}function On(s){return s.fields.filter(e=>e.kind!==2)}Xo.UNKNOWN_ID=-1;class Co{constructor(e,t){this.fieldPath=e,this.kind=t}}class ai{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ai(0,hs.min())}}function oI(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,r=Be.fromTimestamp(n===1e9?new It(t+1,0):new It(t,n));return new hs(r,Ee.empty(),e)}function Dx(s){return new hs(s.readTime,s.key,-1)}class hs{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new hs(Be.min(),Ee.empty(),-1)}static max(){return new hs(Be.max(),Ee.empty(),-1)}}function pu(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=Ee.comparator(s.documentKey,e.documentKey),t!==0?t:qe(s.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Mx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mr(s){if(s.code!==ue.FAILED_PRECONDITION||s.message!==Vx)throw s;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&De(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new J((n,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof J?t:J.resolve(t)}catch(t){return J.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):J.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):J.reject(t)}static resolve(e){return new J((t,n)=>{t(e)})}static reject(e){return new J((t,n)=>{n(e)})}static waitFor(e){return new J((t,n)=>{let r=0,i=0,o=!1;e.forEach(l=>{++r,l.next(()=>{++i,o&&i===r&&t()},c=>n(c))}),o=!0,i===r&&t()})}static or(e){let t=J.resolve(!1);for(const n of e)t=t.next(r=>r?J.resolve(r):n());return t}static forEach(e,t){const n=[];return e.forEach((r,i)=>{n.push(t.call(this,r,i))}),this.waitFor(n)}static mapArray(e,t){return new J((n,r)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const u=c;t(e[u]).next(h=>{o[u]=h,++l,l===i&&n(o)},h=>r(h))}})}static doWhile(e,t){return new J((n,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Yn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new $a(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const r=xu(n.target.error);this.V.reject(new $a(e,r))}}static open(e,t,n,r){try{return new kl(t,e.transaction(r,n))}catch(i){throw new $a(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(pe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new cI(t)}}class pn{constructor(e,t,n){this.name=e,this.version=t,this.p=n,pn.S(Lt())===12.2&&Qt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return pe("SimpleDb","Removing database:",e),$n(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!L0())return!1;if(pn.v())return!0;const e=Lt(),t=pn.S(e),n=0<t&&t<10,r=Lx(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(e){return this.db||(pe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=i=>{const o=i.target.result;t(o)},r.onblocked=()=>{n(new $a(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=i=>{const o=i.target.error;o.name==="VersionError"?n(new je(ue.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new je(ue.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new $a(e,o))},r.onupgradeneeded=i=>{pe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,r.transaction,i.oldVersion,this.version).next(()=>{pe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const l=kl.open(this.db,e,i?"readonly":"readwrite",n),c=r(l).next(u=>(l.g(),u)).catch(u=>(l.abort(u),J.reject(u))).toPromise();return c.catch(()=>{}),await l.m,c}catch(l){const c=l,u=c.name!=="FirebaseError"&&o<3;if(pe("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Lx(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class lI{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return $n(this.B.delete())}}class $a extends je{constructor(e,t){super(ue.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Sn(s){return s.name==="IndexedDbTransactionError"}class cI{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(pe("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(pe("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),$n(n)}add(e){return pe("SimpleDb","ADD",this.store.name,e,e),$n(this.store.add(e))}get(e){return $n(this.store.get(e)).next(t=>(t===void 0&&(t=null),pe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return pe("SimpleDb","DELETE",this.store.name,e),$n(this.store.delete(e))}count(){return pe("SimpleDb","COUNT",this.store.name),$n(this.store.count())}U(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if(typeof r.getAll=="function"){const i=r.getAll(n.range);return new J((o,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(n),o=[];return this.W(i,(l,c)=>{o.push(c)}).next(()=>o)}}G(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new J((r,i)=>{n.onerror=o=>{i(o.target.error)},n.onsuccess=o=>{r(o.target.result)}})}j(e,t){pe("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const r=this.cursor(n);return this.W(r,(i,o,l)=>l.delete())}J(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.W(r,t)}Y(e){const t=this.cursor({});return new J((n,r)=>{t.onerror=i=>{const o=xu(i.target.error);r(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():n()}):n()}})}W(e,t){const n=[];return new J((r,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const l=o.target.result;if(!l)return void r();const c=new lI(l),u=t(l.primaryKey,l.value,c);if(u instanceof J){const h=u.catch(m=>(c.done(),J.reject(m)));n.push(h)}c.isDone?r():c.K===null?l.continue():l.continue(c.K)}}).next(()=>J.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function $n(s){return new J((e,t)=>{s.onsuccess=n=>{const r=n.target.result;e(r)},s.onerror=n=>{const r=xu(n.target.error);t(r)}})}let pf=!1;function xu(s){const e=pn.S(Lt());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(s.message.indexOf(t)>=0){const n=new je("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pf||(pf=!0,setTimeout(()=>{throw n},0)),n}}return s}class dI{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){pe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{pe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Sn(t)?pe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await mr(t)}await this.X(6e4)})}}class uI{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const n=new Set;let r=t,i=!0;return J.doWhile(()=>i===!0&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return pe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,r).next(l=>{r-=l,n.add(o)});i=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(r,i)).next(l=>(pe("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((r,i)=>{const o=Dx(i);pu(o,n)>0&&(n=o)}),new hs(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ps.oe=-1;function Pl(s){return s==null}function ii(s){return s===0&&1/s==-1/0}function hI(s){return typeof s=="number"&&Number.isInteger(s)&&!ii(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xt(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=xf(e)),e=mI(s.get(t),e);return xf(e)}function mI(s,e){let t=e;const n=s.length;for(let r=0;r<n;r++){const i=s.charAt(r);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function xf(s){return s+""}function Ts(s){const e=s.length;if(Le(e>=2),e===2)return Le(s.charAt(0)===""&&s.charAt(1)===""),ot.emptyPath();const t=e-2,n=[];let r="";for(let i=0;i<e;){const o=s.indexOf("",i);switch((o<0||o>t)&&De(),s.charAt(o+1)){case"":const l=s.substring(i,o);let c;r.length===0?c=l:(r+=l,c=r,r=""),n.push(c);break;case"":r+=s.substring(i,o),r+="\0";break;case"":r+=s.substring(i,o+1);break;default:De()}i=o+2}return new ot(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ro(s,e){return[s,Xt(e)]}function Ox(s,e,t){return[s,Xt(e),t]}const fI={},gI=["prefixPath","collectionGroup","readTime","documentId"],pI=["prefixPath","collectionGroup","documentId"],xI=["collectionGroup","readTime","prefixPath","documentId"],yI=["canonicalId","targetId"],bI=["targetId","path"],vI=["path","targetId"],wI=["collectionId","parent"],NI=["indexId","uid"],_I=["uid","sequenceNumber"],jI=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],EI=["indexId","uid","orderedDocumentKey"],II=["userId","collectionPath","documentId"],TI=["userId","collectionPath","largestBatchId"],SI=["userId","collectionGroup","largestBatchId"],Fx=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],AI=[...Fx,"documentOverlays"],$x=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ux=$x,yu=[...Ux,"indexConfiguration","indexState","indexEntries"],kI=yu,PI=[...yu,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld extends Mx{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ot(s,e){const t=Ge(s);return pn.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function Mi(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function Bx(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||Gt.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ho(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ho(this.root,e,this.comparator,!1)}getReverseIterator(){return new ho(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ho(this.root,e,this.comparator,!0)}}class ho{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gt{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=n??Gt.RED,this.left=r??Gt.EMPTY,this.right=i??Gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Gt(e??this.key,t??this.value,n??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Gt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw De();const e=this.left.check();if(e!==this.right.check())throw De();return e+(this.isRed()?0:1)}}Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw De()}get value(){throw De()}get color(){throw De()}get left(){throw De()}get right(){throw De()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Gt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new vf(this.data.getIterator())}getIteratorFrom(e){return new vf(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ct)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=n.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ct(this.comparator);return t.data=e,t}}class vf{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function vr(s){return s.hasNext()?s.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.fields=e,e.sort(Et.comparator)}static empty(){return new $s([])}unionWith(e){let t=new ct(Et.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new $s(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qr(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new zx("Invalid base64 string: "+i):i}}(e);return new Mt(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new Mt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return qe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Mt.EMPTY_BYTE_STRING=new Mt("");const CI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ws(s){if(Le(!!s),typeof s=="string"){let e=0;const t=CI.exec(s);if(Le(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:gt(s.seconds),nanos:gt(s.nanos)}}function gt(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function bn(s){return typeof s=="string"?Mt.fromBase64String(s):Mt.fromUint8Array(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bu(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function vu(s){const e=s.mapValue.fields.__previous_value__;return bu(e)?vu(e):e}function oi(s){const e=Ws(s.mapValue.fields.__local_write_time__.timestampValue);return new It(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RI{constructor(e,t,n,r,i,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=u}}class ir{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ir("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ir&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const un={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Do={nullValue:"NULL_VALUE"};function or(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?bu(s)?4:Gx(s)?9007199254740991:Cl(s)?10:11:De()}function Ps(s,e){if(s===e)return!0;const t=or(s);if(t!==or(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return oi(s).isEqual(oi(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=Ws(r.timestampValue),l=Ws(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(s,e);case 5:return s.stringValue===e.stringValue;case 6:return function(r,i){return bn(r.bytesValue).isEqual(bn(i.bytesValue))}(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return function(r,i){return gt(r.geoPointValue.latitude)===gt(i.geoPointValue.latitude)&&gt(r.geoPointValue.longitude)===gt(i.geoPointValue.longitude)}(s,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return gt(r.integerValue)===gt(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=gt(r.doubleValue),l=gt(i.doubleValue);return o===l?ii(o)===ii(l):isNaN(o)&&isNaN(l)}return!1}(s,e);case 9:return qr(s.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},l=i.mapValue.fields||{};if(bf(o)!==bf(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Ps(o[c],l[c])))return!1;return!0}(s,e);default:return De()}}function li(s,e){return(s.values||[]).find(t=>Ps(t,e))!==void 0}function vn(s,e){if(s===e)return 0;const t=or(s),n=or(e);if(t!==n)return qe(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return qe(s.booleanValue,e.booleanValue);case 2:return function(i,o){const l=gt(i.integerValue||i.doubleValue),c=gt(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(s,e);case 3:return wf(s.timestampValue,e.timestampValue);case 4:return wf(oi(s),oi(e));case 5:return qe(s.stringValue,e.stringValue);case 6:return function(i,o){const l=bn(i),c=bn(o);return l.compareTo(c)}(s.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let u=0;u<l.length&&u<c.length;u++){const h=qe(l[u],c[u]);if(h!==0)return h}return qe(l.length,c.length)}(s.referenceValue,e.referenceValue);case 8:return function(i,o){const l=qe(gt(i.latitude),gt(o.latitude));return l!==0?l:qe(gt(i.longitude),gt(o.longitude))}(s.geoPointValue,e.geoPointValue);case 9:return Nf(s.arrayValue,e.arrayValue);case 10:return function(i,o){var l,c,u,h;const m=i.fields||{},p=o.fields||{},N=(l=m.value)===null||l===void 0?void 0:l.arrayValue,v=(c=p.value)===null||c===void 0?void 0:c.arrayValue,I=qe(((u=N==null?void 0:N.values)===null||u===void 0?void 0:u.length)||0,((h=v==null?void 0:v.values)===null||h===void 0?void 0:h.length)||0);return I!==0?I:Nf(N,v)}(s.mapValue,e.mapValue);case 11:return function(i,o){if(i===un.mapValue&&o===un.mapValue)return 0;if(i===un.mapValue)return 1;if(o===un.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),u=o.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let m=0;m<c.length&&m<h.length;++m){const p=qe(c[m],h[m]);if(p!==0)return p;const N=vn(l[c[m]],u[h[m]]);if(N!==0)return N}return qe(c.length,h.length)}(s.mapValue,e.mapValue);default:throw De()}}function wf(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return qe(s,e);const t=Ws(s),n=Ws(e),r=qe(t.seconds,n.seconds);return r!==0?r:qe(t.nanos,n.nanos)}function Nf(s,e){const t=s.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){const i=vn(t[r],n[r]);if(i)return i}return qe(t.length,n.length)}function Wr(s){return cd(s)}function cd(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?function(t){const n=Ws(t);return`time(${n.seconds},${n.nanos})`}(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?function(t){return bn(t).toBase64()}(s.bytesValue):"referenceValue"in s?function(t){return Ee.fromName(t).toString()}(s.referenceValue):"geoPointValue"in s?function(t){return`geo(${t.latitude},${t.longitude})`}(s.geoPointValue):"arrayValue"in s?function(t){let n="[",r=!0;for(const i of t.values||[])r?r=!1:n+=",",n+=cd(i);return n+"]"}(s.arrayValue):"mapValue"in s?function(t){const n=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of n)i?i=!1:r+=",",r+=`${o}:${cd(t.fields[o])}`;return r+"}"}(s.mapValue):De()}function ci(s,e){return{referenceValue:`projects/${s.projectId}/databases/${s.database}/documents/${e.path.canonicalString()}`}}function dd(s){return!!s&&"integerValue"in s}function di(s){return!!s&&"arrayValue"in s}function _f(s){return!!s&&"nullValue"in s}function jf(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function _c(s){return!!s&&"mapValue"in s}function Cl(s){var e,t;return((t=(((e=s==null?void 0:s.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ua(s){if(s.geoPointValue)return{geoPointValue:Object.assign({},s.geoPointValue)};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:Object.assign({},s.timestampValue)};if(s.mapValue){const e={mapValue:{fields:{}}};return Mi(s.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ua(n)),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ua(s.arrayValue.values[t]);return e}return Object.assign({},s)}function Gx(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const qx={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function DI(s){return"nullValue"in s?Do:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ci(ir.empty(),Ee.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?Cl(s)?qx:{mapValue:{}}:De()}function VI(s){return"nullValue"in s?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ci(ir.empty(),Ee.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?qx:"mapValue"in s?Cl(s)?{mapValue:{}}:un:De()}function Ef(s,e){const t=vn(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?-1:!s.inclusive&&e.inclusive?1:0}function If(s,e){const t=vn(s.value,e.value);return t!==0?t:s.inclusive&&!e.inclusive?1:!s.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.value=e}static empty(){return new gs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!_c(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ua(t)}setAll(e){let t=Et.emptyPath(),n={},r=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){const c=this.getFieldsMap(t);this.applyChanges(c,n,r),n={},r=[],t=l.popLast()}o?n[l.lastSegment()]=Ua(o):r.push(l.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());_c(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];_c(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Mi(t,(r,i)=>e[r]=i);for(const r of n)delete e[r]}clone(){return new gs(Ua(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t,n,r,i,o,l){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new jt(e,0,Be.min(),Be.min(),Be.min(),gs.empty(),0)}static newFoundDocument(e,t,n,r){return new jt(e,1,t,Be.min(),n,r,0)}static newNoDocument(e,t){return new jt(e,2,t,Be.min(),Be.min(),gs.empty(),0)}static newUnknownDocument(e,t){return new jt(e,3,t,Be.min(),Be.min(),gs.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof jt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new jt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t){this.position=e,this.inclusive=t}}function Tf(s,e,t){let n=0;for(let r=0;r<s.position.length;r++){const i=e[r],o=s.position[r];if(i.field.isKeyField()?n=Ee.comparator(Ee.fromName(o.referenceValue),t.key):n=vn(o,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function Sf(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!Ps(s.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t="asc"){this.field=e,this.dir=t}}function MI(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{}class Xe extends Wx{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new LI(e,t,n):t==="array-contains"?new $I(e,n):t==="in"?new Xx(e,n):t==="not-in"?new UI(e,n):t==="array-contains-any"?new BI(e,n):new Xe(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new OI(e,n):new FI(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(vn(t,this.value)):t!==null&&or(this.value)===or(t)&&this.matchesComparison(vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return De()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class lt extends Wx{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new lt(e,t)}matches(e){return Hr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Hr(s){return s.op==="and"}function ud(s){return s.op==="or"}function wu(s){return Kx(s)&&Hr(s)}function Kx(s){for(const e of s.filters)if(e instanceof lt)return!1;return!0}function hd(s){if(s instanceof Xe)return s.field.canonicalString()+s.op.toString()+Wr(s.value);if(wu(s))return s.filters.map(e=>hd(e)).join(",");{const e=s.filters.map(t=>hd(t)).join(",");return`${s.op}(${e})`}}function Hx(s,e){return s instanceof Xe?function(n,r){return r instanceof Xe&&n.op===r.op&&n.field.isEqual(r.field)&&Ps(n.value,r.value)}(s,e):s instanceof lt?function(n,r){return r instanceof lt&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce((i,o,l)=>i&&Hx(o,r.filters[l]),!0):!1}(s,e):void De()}function Jx(s,e){const t=s.filters.concat(e);return lt.create(t,s.op)}function Qx(s){return s instanceof Xe?function(t){return`${t.field.canonicalString()} ${t.op} ${Wr(t.value)}`}(s):s instanceof lt?function(t){return t.op.toString()+" {"+t.getFilters().map(Qx).join(" ,")+"}"}(s):"Filter"}class LI extends Xe{constructor(e,t,n){super(e,t,n),this.key=Ee.fromName(n.referenceValue)}matches(e){const t=Ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class OI extends Xe{constructor(e,t){super(e,"in",t),this.keys=Yx("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class FI extends Xe{constructor(e,t){super(e,"not-in",t),this.keys=Yx("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Yx(s,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>Ee.fromName(n.referenceValue))}class $I extends Xe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return di(t)&&li(t.arrayValue,this.value)}}class Xx extends Xe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&li(this.value.arrayValue,t)}}class UI extends Xe{constructor(e,t){super(e,"not-in",t)}matches(e){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!li(this.value.arrayValue,t)}}class BI extends Xe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!di(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>li(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(e,t=null,n=[],r=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=l,this.ue=null}}function md(s,e=null,t=[],n=[],r=null,i=null,o=null){return new zI(s,e,t,n,r,i,o)}function lr(s){const e=Ge(s);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>hd(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Pl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Wr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Wr(n)).join(",")),e.ue=t}return e.ue}function Li(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!MI(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!Hx(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!Sf(s.startAt,e.startAt)&&Sf(s.endAt,e.endAt)}function Zo(s){return Ee.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function el(s,e){return s.filters.filter(t=>t instanceof Xe&&t.field.isEqual(e))}function Af(s,e,t){let n=Do,r=!0;for(const i of el(s,e)){let o=Do,l=!0;switch(i.op){case"<":case"<=":o=DI(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,l=!1;break;case"!=":case"not-in":o=Do}Ef({value:n,inclusive:r},{value:o,inclusive:l})<0&&(n=o,r=l)}if(t!==null){for(let i=0;i<s.orderBy.length;++i)if(s.orderBy[i].field.isEqual(e)){const o=t.position[i];Ef({value:n,inclusive:r},{value:o,inclusive:t.inclusive})<0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}function kf(s,e,t){let n=un,r=!0;for(const i of el(s,e)){let o=un,l=!0;switch(i.op){case">=":case">":o=VI(i.value),l=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,l=!1;break;case"!=":case"not-in":o=un}If({value:n,inclusive:r},{value:o,inclusive:l})>0&&(n=o,r=l)}if(t!==null){for(let i=0;i<s.orderBy.length;++i)if(s.orderBy[i].field.isEqual(e)){const o=t.position[i];If({value:n,inclusive:r},{value:o,inclusive:t.inclusive})>0&&(n=o,r=t.inclusive);break}}return{value:n,inclusive:r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e,t=null,n=[],r=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function GI(s,e,t,n,r,i,o,l){return new ca(s,e,t,n,r,i,o,l)}function Rl(s){return new ca(s)}function Pf(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Zx(s){return s.collectionGroup!==null}function Ba(s){const e=Ge(s);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ct(Et.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(l=l.add(u.field))})}),l})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ui(i,n))}),t.has(Et.keyField().canonicalString())||e.ce.push(new ui(Et.keyField(),n))}return e.ce}function bs(s){const e=Ge(s);return e.le||(e.le=qI(e,Ba(s))),e.le}function qI(s,e){if(s.limitType==="F")return md(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new ui(r.field,i)});const t=s.endAt?new Kr(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new Kr(s.startAt.position,s.startAt.inclusive):null;return md(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function fd(s,e){const t=s.filters.concat([e]);return new ca(s.path,s.collectionGroup,s.explicitOrderBy.slice(),t,s.limit,s.limitType,s.startAt,s.endAt)}function gd(s,e,t){return new ca(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function Dl(s,e){return Li(bs(s),bs(e))&&s.limitType===e.limitType}function ey(s){return`${lr(bs(s))}|lt:${s.limitType}`}function Er(s){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(r=>Qx(r)).join(", ")}]`),Pl(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>Wr(r)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>Wr(r)).join(",")),`Target(${n})`}(bs(s))}; limitType=${s.limitType})`}function Oi(s,e){return e.isFoundDocument()&&function(n,r){const i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Ee.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(s,e)&&function(n,r){for(const i of Ba(n))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(s,e)&&function(n,r){for(const i of n.filters)if(!i.matches(r))return!1;return!0}(s,e)&&function(n,r){return!(n.startAt&&!function(o,l,c){const u=Tf(o,l,c);return o.inclusive?u<=0:u<0}(n.startAt,Ba(n),r)||n.endAt&&!function(o,l,c){const u=Tf(o,l,c);return o.inclusive?u>=0:u>0}(n.endAt,Ba(n),r))}(s,e)}function WI(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function ty(s){return(e,t)=>{let n=!1;for(const r of Ba(s)){const i=KI(r,e,t);if(i!==0)return i;n=n||r.field.isKeyField()}return 0}}function KI(s,e,t){const n=s.field.isKeyField()?Ee.comparator(e.key,t.key):function(i,o,l){const c=o.data.field(i),u=l.data.field(i);return c!==null&&u!==null?vn(c,u):De()}(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return De()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,i]of n)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Mi(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return Bx(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HI=new wt(Ee.comparator);function xs(){return HI}const sy=new wt(Ee.comparator);function Ra(...s){let e=sy;for(const t of s)e=e.insert(t.key,t);return e}function JI(s){let e=sy;return s.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ss(){return za()}function ny(){return za()}function za(){return new An(s=>s.toString(),(s,e)=>s.isEqual(e))}const QI=new wt(Ee.comparator),YI=new ct(Ee.comparator);function Qe(...s){let e=YI;for(const t of s)e=e.add(t);return e}const XI=new ct(qe);function ZI(){return XI}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(e)?"-0":e}}function ry(s){return{integerValue:""+s}}function eT(s,e){return hI(e)?ry(e):Nu(s,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(){this._=void 0}}function tT(s,e,t){return s instanceof hi?function(r,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&bu(i)&&(i=vu(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):s instanceof Jr?ay(s,e):s instanceof Qr?iy(s,e):function(r,i){const o=nT(r,i),l=Cf(o)+Cf(r.Pe);return dd(o)&&dd(r.Pe)?ry(l):Nu(r.serializer,l)}(s,e)}function sT(s,e,t){return s instanceof Jr?ay(s,e):s instanceof Qr?iy(s,e):t}function nT(s,e){return s instanceof mi?function(n){return dd(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class hi extends Vl{}class Jr extends Vl{constructor(e){super(),this.elements=e}}function ay(s,e){const t=oy(e);for(const n of s.elements)t.some(r=>Ps(r,n))||t.push(n);return{arrayValue:{values:t}}}class Qr extends Vl{constructor(e){super(),this.elements=e}}function iy(s,e){let t=oy(e);for(const n of s.elements)t=t.filter(r=>!Ps(r,n));return{arrayValue:{values:t}}}class mi extends Vl{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Cf(s){return gt(s.integerValue||s.doubleValue)}function oy(s){return di(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(e,t){this.field=e,this.transform=t}}function aT(s,e){return s.field.isEqual(e.field)&&function(n,r){return n instanceof Jr&&r instanceof Jr||n instanceof Qr&&r instanceof Qr?qr(n.elements,r.elements,Ps):n instanceof mi&&r instanceof mi?Ps(n.Pe,r.Pe):n instanceof hi&&r instanceof hi}(s.transform,e.transform)}class iT{constructor(e,t){this.version=e,this.transformResults=t}}class _s{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _s}static exists(e){return new _s(void 0,e)}static updateTime(e){return new _s(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Vo(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Ml{}function ly(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new _u(s.key,_s.none()):new Fi(s.key,s.data,_s.none());{const t=s.data,n=gs.empty();let r=new ct(Et.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?n.delete(i):n.set(i,o),r=r.add(i)}return new da(s.key,n,new $s(r.toArray()),_s.none())}}function oT(s,e,t){s instanceof Fi?function(r,i,o){const l=r.value.clone(),c=Df(r.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(s,e,t):s instanceof da?function(r,i,o){if(!Vo(r.precondition,i))return void i.convertToUnknownDocument(o.version);const l=Df(r.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(cy(r)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(s,e,t):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ga(s,e,t,n){return s instanceof Fi?function(i,o,l,c){if(!Vo(i.precondition,o))return l;const u=i.value.clone(),h=Vf(i.fieldTransforms,c,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(s,e,t,n):s instanceof da?function(i,o,l,c){if(!Vo(i.precondition,o))return l;const u=Vf(i.fieldTransforms,c,o),h=o.data;return h.setAll(cy(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(m=>m.field))}(s,e,t,n):function(i,o,l){return Vo(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(s,e,t)}function Rf(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&qr(n,r,(i,o)=>aT(i,o))}(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class Fi extends Ml{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class da extends Ml{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cy(s){const e=new Map;return s.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}}),e}function Df(s,e,t){const n=new Map;Le(s.length===t.length);for(let r=0;r<t.length;r++){const i=s[r],o=i.transform,l=e.data.field(i.field);n.set(i.field,sT(o,l,t[r]))}return n}function Vf(s,e,t){const n=new Map;for(const r of s){const i=r.transform,o=t.data.field(r.field);n.set(r.field,tT(i,o,e))}return n}class _u extends Ml{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dy extends Ml{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&oT(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ga(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ny();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=t.has(r.key)?null:l;const c=ly(o,l);c!==null&&n.set(r.key,c),o.isValidDocument()||o.convertToNoDocument(Be.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Qe())}isEqual(e){return this.batchId===e.batchId&&qr(this.mutations,e.mutations,(t,n)=>Rf(t,n))&&qr(this.baseMutations,e.baseMutations,(t,n)=>Rf(t,n))}}class Eu{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Le(e.mutations.length===n.length);let r=function(){return QI}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Eu(e,t,n,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pt,st;function cT(s){switch(s){default:return De();case ue.CANCELLED:case ue.UNKNOWN:case ue.DEADLINE_EXCEEDED:case ue.RESOURCE_EXHAUSTED:case ue.INTERNAL:case ue.UNAVAILABLE:case ue.UNAUTHENTICATED:return!1;case ue.INVALID_ARGUMENT:case ue.NOT_FOUND:case ue.ALREADY_EXISTS:case ue.PERMISSION_DENIED:case ue.FAILED_PRECONDITION:case ue.ABORTED:case ue.OUT_OF_RANGE:case ue.UNIMPLEMENTED:case ue.DATA_LOSS:return!0}}function uy(s){if(s===void 0)return Qt("GRPC error has no .code"),ue.UNKNOWN;switch(s){case Pt.OK:return ue.OK;case Pt.CANCELLED:return ue.CANCELLED;case Pt.UNKNOWN:return ue.UNKNOWN;case Pt.DEADLINE_EXCEEDED:return ue.DEADLINE_EXCEEDED;case Pt.RESOURCE_EXHAUSTED:return ue.RESOURCE_EXHAUSTED;case Pt.INTERNAL:return ue.INTERNAL;case Pt.UNAVAILABLE:return ue.UNAVAILABLE;case Pt.UNAUTHENTICATED:return ue.UNAUTHENTICATED;case Pt.INVALID_ARGUMENT:return ue.INVALID_ARGUMENT;case Pt.NOT_FOUND:return ue.NOT_FOUND;case Pt.ALREADY_EXISTS:return ue.ALREADY_EXISTS;case Pt.PERMISSION_DENIED:return ue.PERMISSION_DENIED;case Pt.FAILED_PRECONDITION:return ue.FAILED_PRECONDITION;case Pt.ABORTED:return ue.ABORTED;case Pt.OUT_OF_RANGE:return ue.OUT_OF_RANGE;case Pt.UNIMPLEMENTED:return ue.UNIMPLEMENTED;case Pt.DATA_LOSS:return ue.DATA_LOSS;default:return De()}}(st=Pt||(Pt={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dT(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT=new Qn([4294967295,4294967295],0);function Mf(s){const e=dT().encode(s),t=new Ex;return t.update(e),new Uint8Array(t.digest())}function Lf(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Qn([t,n],0),new Qn([r,i],0)]}class Tu{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Da(`Invalid padding: ${t}`);if(n<0)throw new Da(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Da(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Da(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Qn.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(Qn.fromNumber(n)));return r.compare(uT)===1&&(r=new Qn([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Mf(e),[n,r]=Lf(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,r,i);if(!this.de(o))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Tu(i,r,t);return n.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const t=Mf(e),[n,r]=Lf(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(n,r,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Da extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,$i.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ll(Be.min(),r,new wt(qe),xs(),Qe())}}class $i{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new $i(n,t,Qe(),Qe(),Qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class hy{constructor(e,t){this.targetId=e,this.me=t}}class my{constructor(e,t,n=Mt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Of{constructor(){this.fe=0,this.ge=$f(),this.pe=Mt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Qe(),t=Qe(),n=Qe();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:De()}}),new $i(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=$f()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Le(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class hT{constructor(e){this.Le=e,this.Be=new Map,this.ke=xs(),this.qe=Ff(),this.Qe=new wt(qe)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:De()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,r)=>{this.ze(r)&&t(r)})}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(Zo(i))if(n===0){const o=new Ee(i.path);this.Ue(t,o,jt.newNoDocument(o,Be.min()))}else Le(n===1);else{const o=this.Ye(t);if(o!==n){const l=this.Ze(e),c=l?this.Xe(l,e,o):1;if(c!==0){this.je(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let o,l;try{o=bn(n).toUint8Array()}catch(c){if(c instanceof zx)return ar("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new Tu(o,r,i)}catch(c){return ar(c instanceof Da?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.Ie===0?null:l}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach(i=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,i,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const l=this.Je(o);if(l){if(i.current&&Zo(l.target)){const c=new Ee(l.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,jt.newNoDocument(c,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let n=Qe();this.qe.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const r=new Ll(e,t,this.Qe,this.ke,n);return this.ke=xs(),this.qe=Ff(),this.Qe=new wt(qe),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Of,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ct(qe),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||pe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Of),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Ff(){return new wt(Ee.comparator)}function $f(){return new wt(Ee.comparator)}const mT={asc:"ASCENDING",desc:"DESCENDING"},fT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gT={and:"AND",or:"OR"};class pT{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pd(s,e){return s.useProto3Json||Pl(e)?e:{value:e}}function Yr(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fy(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function xT(s,e){return Yr(s,e.toTimestamp())}function Zt(s){return Le(!!s),Be.fromTimestamp(function(t){const n=Ws(t);return new It(n.seconds,n.nanos)}(s))}function Su(s,e){return xd(s,e).canonicalString()}function xd(s,e){const t=function(r){return new ot(["projects",r.projectId,"databases",r.database])}(s).child("documents");return e===void 0?t:t.child(e)}function gy(s){const e=ot.fromString(s);return Le(jy(e)),e}function tl(s,e){return Su(s.databaseId,e.path)}function Xn(s,e){const t=gy(e);if(t.get(1)!==s.databaseId.projectId)throw new je(ue.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new je(ue.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new Ee(yy(t))}function py(s,e){return Su(s.databaseId,e)}function xy(s){const e=gy(s);return e.length===4?ot.emptyPath():yy(e)}function yd(s){return new ot(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function yy(s){return Le(s.length>4&&s.get(4)==="documents"),s.popFirst(5)}function Uf(s,e,t){return{name:tl(s,e),fields:t.value.mapValue.fields}}function yT(s,e,t){const n=Xn(s,e.name),r=Zt(e.updateTime),i=e.createTime?Zt(e.createTime):Be.min(),o=new gs({mapValue:{fields:e.fields}}),l=jt.newFoundDocument(n,r,i,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function bT(s,e){let t;if("targetChange"in e){e.targetChange;const n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:De()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(Le(h===void 0||typeof h=="string"),Mt.fromBase64String(h||"")):(Le(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Mt.fromUint8Array(h||new Uint8Array))}(s,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(u){const h=u.code===void 0?ue.UNKNOWN:uy(u.code);return new je(h,u.message||"")}(o);t=new my(n,r,i,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=Xn(s,n.document.name),i=Zt(n.document.updateTime),o=n.document.createTime?Zt(n.document.createTime):Be.min(),l=new gs({mapValue:{fields:n.document.fields}}),c=jt.newFoundDocument(r,i,o,l),u=n.targetIds||[],h=n.removedTargetIds||[];t=new Mo(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=Xn(s,n.document),i=n.readTime?Zt(n.readTime):Be.min(),o=jt.newNoDocument(r,i),l=n.removedTargetIds||[];t=new Mo([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=Xn(s,n.document),i=n.removedTargetIds||[];t=new Mo([],i,r,null)}else{if(!("filter"in e))return De();{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:i}=n,o=new lT(r,i),l=n.targetId;t=new hy(l,o)}}return t}function sl(s,e){let t;if(e instanceof Fi)t={update:Uf(s,e.key,e.value)};else if(e instanceof _u)t={delete:tl(s,e.key)};else if(e instanceof da)t={update:Uf(s,e.key,e.data),updateMask:ET(e.fieldMask)};else{if(!(e instanceof dy))return De();t={verify:tl(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,o){const l=o.transform;if(l instanceof hi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Jr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Qr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof mi)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw De()}(0,n))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:xT(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:De()}(s,e.precondition)),t}function bd(s,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?_s.updateTime(Zt(i.updateTime)):i.exists!==void 0?_s.exists(i.exists):_s.none()}(e.currentDocument):_s.none(),n=e.updateTransforms?e.updateTransforms.map(r=>function(o,l){let c=null;if("setToServerValue"in l)Le(l.setToServerValue==="REQUEST_TIME"),c=new hi;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new Jr(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new Qr(h)}else"increment"in l?c=new mi(o,l.increment):De();const u=Et.fromServerFormat(l.fieldPath);return new rT(u,c)}(s,r)):[];if(e.update){e.update.name;const r=Xn(s,e.update.name),i=new gs({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const u=c.fieldPaths||[];return new $s(u.map(h=>Et.fromServerFormat(h)))}(e.updateMask);return new da(r,i,o,t,n)}return new Fi(r,i,t,n)}if(e.delete){const r=Xn(s,e.delete);return new _u(r,t)}if(e.verify){const r=Xn(s,e.verify);return new dy(r,t)}return De()}function vT(s,e){return s&&s.length>0?(Le(e!==void 0),s.map(t=>function(r,i){let o=r.updateTime?Zt(r.updateTime):Zt(i);return o.isEqual(Be.min())&&(o=Zt(i)),new iT(o,r.transformResults||[])}(t,e))):[]}function by(s,e){return{documents:[py(s,e.path)]}}function vy(s,e){const t={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=py(s,r);const i=function(u){if(u.length!==0)return _y(lt.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:Ir(p.field),direction:NT(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const l=pd(s,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:r}}function wy(s){let e=xy(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){Le(n===1);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(m){const p=Ny(m);return p instanceof lt&&wu(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(p=>function(v){return new ui(Tr(v.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(m){let p;return p=typeof m=="object"?m.value:m,Pl(p)?null:p}(t.limit));let c=null;t.startAt&&(c=function(m){const p=!!m.before,N=m.values||[];return new Kr(N,p)}(t.startAt));let u=null;return t.endAt&&(u=function(m){const p=!m.before,N=m.values||[];return new Kr(N,p)}(t.endAt)),GI(e,r,o,i,l,"F",c,u)}function wT(s,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return De()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Ny(s){return s.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Tr(t.unaryFilter.field);return Xe.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=Tr(t.unaryFilter.field);return Xe.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Tr(t.unaryFilter.field);return Xe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Tr(t.unaryFilter.field);return Xe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return De()}}(s):s.fieldFilter!==void 0?function(t){return Xe.create(Tr(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return De()}}(t.fieldFilter.op),t.fieldFilter.value)}(s):s.compositeFilter!==void 0?function(t){return lt.create(t.compositeFilter.filters.map(n=>Ny(n)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return De()}}(t.compositeFilter.op))}(s):De()}function NT(s){return mT[s]}function _T(s){return fT[s]}function jT(s){return gT[s]}function Ir(s){return{fieldPath:s.canonicalString()}}function Tr(s){return Et.fromServerFormat(s.fieldPath)}function _y(s){return s instanceof Xe?function(t){if(t.op==="=="){if(jf(t.value))return{unaryFilter:{field:Ir(t.field),op:"IS_NAN"}};if(_f(t.value))return{unaryFilter:{field:Ir(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(jf(t.value))return{unaryFilter:{field:Ir(t.field),op:"IS_NOT_NAN"}};if(_f(t.value))return{unaryFilter:{field:Ir(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ir(t.field),op:_T(t.op),value:t.value}}}(s):s instanceof lt?function(t){const n=t.getFilters().map(r=>_y(r));return n.length===1?n[0]:{compositeFilter:{op:jT(t.op),filters:n}}}(s):De()}function ET(s){const e=[];return s.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function jy(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e,t,n,r,i=Be.min(),o=Be.min(),l=Mt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new Us(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Us(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey{constructor(e){this.ct=e}}function IT(s,e){let t;if(e.document)t=yT(s.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=Ee.fromSegments(e.noDocument.path),r=dr(e.noDocument.readTime);t=jt.newNoDocument(n,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return De();{const n=Ee.fromSegments(e.unknownDocument.path),r=dr(e.unknownDocument.version);t=jt.newUnknownDocument(n,r)}}return e.readTime&&t.setReadTime(function(r){const i=new It(r[0],r[1]);return Be.fromTimestamp(i)}(e.readTime)),t}function Bf(s,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:nl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(i,o){return{name:tl(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Yr(i,o.version.toTimestamp()),createTime:Yr(i,o.createTime.toTimestamp())}}(s.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:cr(e.version)};else{if(!e.isUnknownDocument())return De();n.unknownDocument={path:t.path.toArray(),version:cr(e.version)}}return n}function nl(s){const e=s.toTimestamp();return[e.seconds,e.nanoseconds]}function cr(s){const e=s.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function dr(s){const e=new It(s.seconds,s.nanoseconds);return Be.fromTimestamp(e)}function Un(s,e){const t=(e.baseMutations||[]).map(i=>bd(s.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const n=e.mutations.map(i=>bd(s.ct,i)),r=It.fromMillis(e.localWriteTimeMs);return new ju(e.batchId,r,t,n)}function Va(s){const e=dr(s.readTime),t=s.lastLimboFreeSnapshotVersion!==void 0?dr(s.lastLimboFreeSnapshotVersion):Be.min();let n;return n=function(i){return i.documents!==void 0}(s.query)?function(i){return Le(i.documents.length===1),bs(Rl(xy(i.documents[0])))}(s.query):function(i){return bs(wy(i))}(s.query),new Us(n,s.targetId,"TargetPurposeListen",s.lastListenSequenceNumber,e,t,Mt.fromBase64String(s.resumeToken))}function Iy(s,e){const t=cr(e.snapshotVersion),n=cr(e.lastLimboFreeSnapshotVersion);let r;r=Zo(e.target)?by(s.ct,e.target):vy(s.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:lr(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:r}}function Ty(s){const e=wy({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?gd(e,e.limit,"L"):e}function jc(s,e){return new Iu(e.largestBatchId,bd(s.ct,e.overlayMutation))}function zf(s,e){const t=e.path.lastSegment();return[s,Xt(e.path.popLast()),t]}function Gf(s,e,t,n){return{indexId:s,uid:e,sequenceNumber:t,readTime:cr(n.readTime),documentKey:Xt(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{getBundleMetadata(e,t){return qf(e).get(t).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:dr(i.createTime),version:i.version}}(n)})}saveBundleMetadata(e,t){return qf(e).put(function(r){return{bundleId:r.id,createTime:cr(Zt(r.createTime)),version:r.version}}(t))}getNamedQuery(e,t){return Wf(e).get(t).next(n=>{if(n)return function(i){return{name:i.name,query:Ty(i.bundledQuery),readTime:dr(i.readTime)}}(n)})}saveNamedQuery(e,t){return Wf(e).put(function(r){return{name:r.name,readTime:cr(Zt(r.readTime)),bundledQuery:r.bundledQuery}}(t))}}function qf(s){return Ot(s,"bundles")}function Wf(s){return Ot(s,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new Ol(e,n)}getOverlay(e,t){return Ea(e).get(zf(this.userId,t)).next(n=>n?jc(this.serializer,n):null)}getOverlays(e,t){const n=Ss();return J.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&n.set(r,i)})).next(()=>n)}saveOverlays(e,t,n){const r=[];return n.forEach((i,o)=>{const l=new Iu(t,o);r.push(this.ht(e,l))}),J.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(o=>r.add(Xt(o.getCollectionPath())));const i=[];return r.forEach(o=>{const l=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);i.push(Ea(e).j("collectionPathOverlayIndex",l))}),J.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Ss(),i=Xt(t),o=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ea(e).U("collectionPathOverlayIndex",o).next(l=>{for(const c of l){const u=jc(this.serializer,c);r.set(u.getKey(),u)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=Ss();let o;const l=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ea(e).J({index:"collectionGroupOverlayIndex",range:l},(c,u,h)=>{const m=jc(this.serializer,u);i.size()<r||m.largestBatchId===o?(i.set(m.getKey(),m),o=m.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return Ea(e).put(function(r,i,o){const[l,c,u]=zf(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:sl(r.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Ea(s){return Ot(s,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{Pt(e){return Ot(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t==null?void 0:t.value;return n?Mt.fromUint8Array(n):Mt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(gt(e.integerValue));else if("doubleValue"in e){const n=gt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ii(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=Ws(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(bn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Gx(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Cl(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):De()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const o="value",l=((r=(n=i[o].arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.length)||0;this.dt(t,15),t.At(gt(l)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),Ee.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Bn.vt=new Bn;function AT(s){if(s===0)return 8;let e=0;return!(s>>4)&&(e+=4,s<<=4),!(s>>6)&&(e+=2,s<<=2),!(s>>7)&&(e+=1),e}function Kf(s){const e=64-function(n){let r=0;for(let i=0;i<8;++i){const o=AT(255&n[i]);if(r+=o,o!==8)break}return r}(s);return Math.ceil(e/8)}class kT{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const r=t.codePointAt(0);this.Ft(240|r>>>18),this.Ft(128|63&r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const r=t.codePointAt(0);this.Ot(240|r>>>18),this.Ot(128|63&r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r)}}this.Nt()}kt(e){const t=this.qt(e),n=Kf(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Kt(e){const t=this.qt(e),n=Kf(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class PT{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class CT{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Ia{constructor(){this.jt=new kT,this.Ht=new PT(this.jt),this.Jt=new CT(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new zn(this.indexId,this.documentKey,this.arrayValue,n)}}function tn(s,e){let t=s.indexId-e.indexId;return t!==0?t:(t=Hf(s.arrayValue,e.arrayValue),t!==0?t:(t=Hf(s.directionalValue,e.directionalValue),t!==0?t:Ee.comparator(s.documentKey,e.documentKey)))}function Hf(s,e){for(let t=0;t<s.length&&t<e.length;++t){const n=s[t]-e[t];if(n!==0)return n}return s.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this.Xt=new ct((t,n)=>Et.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(Le(e.collectionGroup===this.collectionId),this.nn)return!1;const t=od(e);if(t!==void 0&&!this.sn(t))return!1;const n=On(e);let r=new Set,i=0,o=0;for(;i<n.length&&this.sn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Xt.size>0){const l=this.Xt.getIterator().getNext();if(!r.has(l.field.canonicalString())){const c=n[i];if(!this.on(l,c)||!this._n(this.en[o++],c))return!1}++i}for(;i<n.length;++i){const l=n[i];if(o>=this.en.length||!this._n(this.en[o++],l))return!1}return!0}an(){if(this.nn)return null;let e=new ct(Et.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Co(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Co(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Co(n.field,n.dir==="asc"?0:1)));return new Xo(Xo.UNKNOWN_ID,this.collectionId,t,ai.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sy(s){var e,t;if(Le(s instanceof Xe||s instanceof lt),s instanceof Xe){if(s instanceof Xx){const r=((t=(e=s.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Xe.create(s.field,"==",i)))||[];return lt.create(r,"or")}return s}const n=s.filters.map(r=>Sy(r));return lt.create(n,s.op)}function RT(s){if(s.getFilters().length===0)return[];const e=Nd(Sy(s));return Le(Ay(e)),vd(e)||wd(e)?[e]:e.getFilters()}function vd(s){return s instanceof Xe}function wd(s){return s instanceof lt&&wu(s)}function Ay(s){return vd(s)||wd(s)||function(t){if(t instanceof lt&&ud(t)){for(const n of t.getFilters())if(!vd(n)&&!wd(n))return!1;return!0}return!1}(s)}function Nd(s){if(Le(s instanceof Xe||s instanceof lt),s instanceof Xe)return s;if(s.filters.length===1)return Nd(s.filters[0]);const e=s.filters.map(n=>Nd(n));let t=lt.create(e,s.op);return t=rl(t),Ay(t)?t:(Le(t instanceof lt),Le(Hr(t)),Le(t.filters.length>1),t.filters.reduce((n,r)=>Au(n,r)))}function Au(s,e){let t;return Le(s instanceof Xe||s instanceof lt),Le(e instanceof Xe||e instanceof lt),t=s instanceof Xe?e instanceof Xe?function(r,i){return lt.create([r,i],"and")}(s,e):Qf(s,e):e instanceof Xe?Qf(e,s):function(r,i){if(Le(r.filters.length>0&&i.filters.length>0),Hr(r)&&Hr(i))return Jx(r,i.getFilters());const o=ud(r)?r:i,l=ud(r)?i:r,c=o.filters.map(u=>Au(u,l));return lt.create(c,"or")}(s,e),rl(t)}function Qf(s,e){if(Hr(e))return Jx(e,s.getFilters());{const t=e.filters.map(n=>Au(s,n));return lt.create(t,"or")}}function rl(s){if(Le(s instanceof Xe||s instanceof lt),s instanceof Xe)return s;const e=s.getFilters();if(e.length===1)return rl(e[0]);if(Kx(s))return s;const t=e.map(r=>rl(r)),n=[];return t.forEach(r=>{r instanceof Xe?n.push(r):r instanceof lt&&(r.op===s.op?n.push(...r.filters):n.push(r))}),n.length===1?n[0]:lt.create(n,s.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(){this.un=new ku}addToCollectionParentIndex(e,t){return this.un.add(t),J.resolve()}getCollectionParents(e,t){return J.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return J.resolve()}deleteFieldIndex(e,t){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,t){return J.resolve()}getDocumentsMatchingTarget(e,t){return J.resolve(null)}getIndexType(e,t){return J.resolve(0)}getFieldIndexes(e,t){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,t){return J.resolve(hs.min())}getMinOffsetFromCollectionGroup(e,t){return J.resolve(hs.min())}updateCollectionGroup(e,t,n){return J.resolve()}updateIndexEntries(e,t){return J.resolve()}}class ku{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ct(ot.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ct(ot.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mo=new Uint8Array(0);class VT{constructor(e,t){this.databaseId=t,this.cn=new ku,this.ln=new An(n=>lr(n),(n,r)=>Li(n,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:n,parent:Xt(r)};return Yf(e).put(i)}return J.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Rx(t),""],!1,!0);return Yf(e).U(r).next(i=>{for(const o of i){if(o.collectionId!==t)break;n.push(Ts(o.parent))}return n})}addFieldIndex(e,t){const n=Ta(e),r=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const o=Nr(e);return i.next(l=>{o.put(Gf(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=Ta(e),r=Nr(e),i=wr(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Ta(e),n=wr(e),r=Nr(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return J.forEach(this.hn(t),n=>this.getIndexType(e,n).next(r=>{if(r===0||r===1){const i=new Jf(n).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const n=wr(e);let r=!0;const i=new Map;return J.forEach(this.hn(t),o=>this.Pn(e,o).next(l=>{r&&(r=!!l),i.set(o,l)})).next(()=>{if(r){let o=Qe();const l=[];return J.forEach(i,(c,u)=>{pe("IndexedDbIndexManager",`Using index ${function(T){return`id=${T.indexId}|cg=${T.collectionGroup}|f=${T.fields.map(V=>`${V.fieldPath}:${V.kind}`).join(",")}`}(c)} to execute ${lr(t)}`);const h=function(T,V){const P=od(V);if(P===void 0)return null;for(const k of el(T,P.fieldPath))switch(k.op){case"array-contains-any":return k.value.arrayValue.values||[];case"array-contains":return[k.value]}return null}(u,c),m=function(T,V){const P=new Map;for(const k of On(V))for(const b of el(T,k.fieldPath))switch(b.op){case"==":case"in":P.set(k.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return P.set(k.fieldPath.canonicalString(),b.value),Array.from(P.values())}return null}(u,c),p=function(T,V){const P=[];let k=!0;for(const b of On(V)){const x=b.kind===0?Af(T,b.fieldPath,T.startAt):kf(T,b.fieldPath,T.startAt);P.push(x.value),k&&(k=x.inclusive)}return new Kr(P,k)}(u,c),N=function(T,V){const P=[];let k=!0;for(const b of On(V)){const x=b.kind===0?kf(T,b.fieldPath,T.endAt):Af(T,b.fieldPath,T.endAt);P.push(x.value),k&&(k=x.inclusive)}return new Kr(P,k)}(u,c),v=this.In(c,u,p),I=this.In(c,u,N),g=this.Tn(c,u,m),S=this.En(c.indexId,h,v,p.inclusive,I,N.inclusive,g);return J.forEach(S,C=>n.G(C,t.limit).next(T=>{T.forEach(V=>{const P=Ee.fromSegments(V.documentKey);o.has(P)||(o=o.add(P),l.push(P))})}))}).next(()=>l)}return J.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=RT(lt.create(e.filters,"and")).map(n=>md(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,r,i,o,l){const c=(t!=null?t.length:1)*Math.max(n.length,i.length),u=c/(t!=null?t.length:1),h=[];for(let m=0;m<c;++m){const p=t?this.dn(t[m/u]):mo,N=this.An(e,p,n[m%u],r),v=this.Rn(e,p,i[m%u],o),I=l.map(g=>this.An(e,p,g,!0));h.push(...this.createRange(N,v,I))}return h}An(e,t,n,r){const i=new zn(e,Ee.empty(),t,n);return r?i:i.Zt()}Rn(e,t,n,r){const i=new zn(e,Ee.empty(),t,n);return r?i.Zt():i}Pn(e,t){const n=new Jf(t),r=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(i=>{let o=null;for(const l of i)n.rn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let n=2;const r=this.hn(t);return J.forEach(r,i=>this.Pn(e,i).next(o=>{o?n!==0&&o.fields.length<function(c){let u=new ct(Et.comparator),h=!1;for(const m of c.filters)for(const p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const m of c.orderBy)m.field.isKeyField()||(u=u.add(m.field));return u.size+(h?1:0)}(i)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&r.length>1&&n===2?1:n)}Vn(e,t){const n=new Ia;for(const r of On(e)){const i=t.data.field(r.fieldPath);if(i==null)return null;const o=n.Yt(r.kind);Bn.vt.It(i,o)}return n.zt()}dn(e){const t=new Ia;return Bn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new Ia;return Bn.vt.It(ci(this.databaseId,t),n.Yt(function(i){const o=On(i);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let r=[];r.push(new Ia);let i=0;for(const o of On(e)){const l=n[i++];for(const c of r)if(this.fn(t,o.fieldPath)&&di(l))r=this.gn(r,o,l);else{const u=c.Yt(o.kind);Bn.vt.It(l,u)}}return this.pn(r)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const r=[...e],i=[];for(const o of n.arrayValue.values||[])for(const l of r){const c=new Ia;c.seed(l.zt()),Bn.vt.It(o,c.Yt(t.kind)),i.push(c)}return i}fn(e,t){return!!e.filters.find(n=>n instanceof Xe&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){const n=Ta(e),r=Nr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(i=>{const o=[];return J.forEach(i,l=>r.get([l.indexId,this.uid]).next(c=>{o.push(function(h,m){const p=m?new ai(m.sequenceNumber,new hs(dr(m.readTime),new Ee(Ts(m.documentKey)),m.largestBatchId)):ai.empty(),N=h.fields.map(([v,I])=>new Co(Et.fromServerFormat(v),I));return new Xo(h.indexId,h.collectionGroup,N,p)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,r)=>{const i=n.indexState.sequenceNumber-r.indexState.sequenceNumber;return i!==0?i:qe(n.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=Ta(e),i=Nr(e);return this.yn(e).next(o=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>J.forEach(l,c=>i.put(Gf(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){const n=new Map;return J.forEach(t,(r,i)=>{const o=n.get(r.collectionGroup);return(o?J.resolve(o):this.getFieldIndexes(e,r.collectionGroup)).next(l=>(n.set(r.collectionGroup,l),J.forEach(l,c=>this.wn(e,r,c).next(u=>{const h=this.Sn(i,c);return u.isEqual(h)?J.resolve():this.bn(e,i,c,u,h)}))))})}Dn(e,t,n,r){return wr(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return wr(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const r=wr(e);let i=new ct(tn);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,l)=>{i=i.add(new zn(n.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>i)}Sn(e,t){let n=new ct(tn);const r=this.Vn(t,e);if(r==null)return n;const i=od(t);if(i!=null){const o=e.data.field(i.fieldPath);if(di(o))for(const l of o.arrayValue.values||[])n=n.add(new zn(t.indexId,e.key,this.dn(l),r))}else n=n.add(new zn(t.indexId,e.key,mo,r));return n}bn(e,t,n,r,i){pe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(c,u,h,m,p){const N=c.getIterator(),v=u.getIterator();let I=vr(N),g=vr(v);for(;I||g;){let S=!1,C=!1;if(I&&g){const T=h(I,g);T<0?C=!0:T>0&&(S=!0)}else I!=null?C=!0:S=!0;S?(m(g),g=vr(v)):C?(p(I),I=vr(N)):(I=vr(N),g=vr(v))}}(r,i,tn,l=>{o.push(this.Dn(e,t,n,l))},l=>{o.push(this.vn(e,t,n,l))}),J.waitFor(o)}yn(e){let t=1;return Nr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,r,i)=>{i.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,l)=>tn(o,l)).filter((o,l,c)=>!l||tn(o,c[l-1])!==0);const r=[];r.push(e);for(const o of n){const l=tn(o,e),c=tn(o,t);if(l===0)r[0]=e.Zt();else if(l>0&&c<0)r.push(o),r.push(o.Zt());else if(c>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Cn(r[o],r[o+1]))return[];const l=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,mo,[]],c=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,mo,[]];i.push(IDBKeyRange.bound(l,c))}return i}Cn(e,t){return tn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Xf)}getMinOffset(e,t){return J.mapArray(this.hn(t),n=>this.Pn(e,n).next(r=>r||De())).next(Xf)}}function Yf(s){return Ot(s,"collectionParents")}function wr(s){return Ot(s,"indexEntries")}function Ta(s){return Ot(s,"indexConfiguration")}function Nr(s){return Ot(s,"indexState")}function Xf(s){Le(s.length!==0);let e=s[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<s.length;n++){const r=s[n].indexState.offset;pu(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new hs(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ss{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ss(e,ss.DEFAULT_COLLECTION_PERCENTILE,ss.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(s,e,t){const n=s.store("mutations"),r=s.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let l=0;const c=n.J({range:o},(h,m,p)=>(l++,p.delete()));i.push(c.next(()=>{Le(l===1)}));const u=[];for(const h of t.mutations){const m=Ox(e,h.key.path,t.batchId);i.push(r.delete(m)),u.push(h.key)}return J.waitFor(i).next(()=>u)}function al(s){if(!s)return 0;let e;if(s.document)e=s.document;else if(s.unknownDocument)e=s.unknownDocument;else{if(!s.noDocument)throw De();e=s.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ss.DEFAULT_COLLECTION_PERCENTILE=10,ss.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ss.DEFAULT=new ss(41943040,ss.DEFAULT_COLLECTION_PERCENTILE,ss.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ss.DISABLED=new ss(-1,0,0);class Fl{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Fn={}}static lt(e,t,n,r){Le(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Fl(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return sn(e).J({index:"userMutationsIndex",range:n},(r,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,r){const i=Sr(e),o=sn(e);return o.add({}).next(l=>{Le(typeof l=="number");const c=new ju(l,t,n,r),u=function(N,v,I){const g=I.baseMutations.map(C=>sl(N.ct,C)),S=I.mutations.map(C=>sl(N.ct,C));return{userId:v,batchId:I.batchId,localWriteTimeMs:I.localWriteTime.toMillis(),baseMutations:g,mutations:S}}(this.serializer,this.userId,c),h=[];let m=new ct((p,N)=>qe(p.canonicalString(),N.canonicalString()));for(const p of r){const N=Ox(this.userId,p.key.path,l);m=m.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(N,fI))}return m.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[l]=c.keys()}),J.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return sn(e).get(t).next(n=>n?(Le(n.userId===this.userId),Un(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?J.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const r=n.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return sn(e).J({index:"userMutationsIndex",range:r},(o,l,c)=>{l.userId===this.userId&&(Le(l.batchId>=n),i=Un(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return sn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(r,i,o)=>{n=i.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return sn(e).U("userMutationsIndex",t).next(n=>n.map(r=>Un(this.serializer,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ro(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Sr(e).J({range:r},(o,l,c)=>{const[u,h,m]=o,p=Ts(h);if(u===this.userId&&t.path.isEqual(p))return sn(e).get(m).next(N=>{if(!N)throw De();Le(N.userId===this.userId),i.push(Un(this.serializer,N))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ct(qe);const r=[];return t.forEach(i=>{const o=Ro(this.userId,i.path),l=IDBKeyRange.lowerBound(o),c=Sr(e).J({range:l},(u,h,m)=>{const[p,N,v]=u,I=Ts(N);p===this.userId&&i.path.isEqual(I)?n=n.add(v):m.done()});r.push(c)}),J.waitFor(r).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=Ro(this.userId,n),o=IDBKeyRange.lowerBound(i);let l=new ct(qe);return Sr(e).J({range:o},(c,u,h)=>{const[m,p,N]=c,v=Ts(p);m===this.userId&&n.isPrefixOf(v)?v.length===r&&(l=l.add(N)):h.done()}).next(()=>this.xn(e,l))}xn(e,t){const n=[],r=[];return t.forEach(i=>{r.push(sn(e).get(i).next(o=>{if(o===null)throw De();Le(o.userId===this.userId),n.push(Un(this.serializer,o))}))}),J.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return ky(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),J.forEach(n,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return J.resolve();const n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),r=[];return Sr(e).J({range:n},(i,o,l)=>{if(i[0]===this.userId){const c=Ts(i[1]);r.push(c)}else l.done()}).next(()=>{Le(r.length===0)})})}containsKey(e,t){return Py(e,this.userId,t)}Nn(e){return Cy(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Py(s,e,t){const n=Ro(e,t.path),r=n[1],i=IDBKeyRange.lowerBound(n);let o=!1;return Sr(s).J({range:i,H:!0},(l,c,u)=>{const[h,m,p]=l;h===e&&m===r&&(o=!0),u.done()}).next(()=>o)}function sn(s){return Ot(s,"mutations")}function Sr(s){return Ot(s,"documentMutations")}function Cy(s){return Ot(s,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ur(0)}static kn(){return new ur(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MT{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new ur(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Be.fromTimestamp(new It(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>_r(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(Le(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let r=0;const i=[];return _r(e).J((o,l)=>{const c=Va(l);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(r++,i.push(this.removeTargetData(e,c)))}).next(()=>J.waitFor(i)).next(()=>r)}forEachTarget(e,t){return _r(e).J((n,r)=>{const i=Va(r);t(i)})}qn(e){return eg(e).get("targetGlobalKey").next(t=>(Le(t!==null),t))}Qn(e,t){return eg(e).put("targetGlobalKey",t)}Kn(e,t){return _r(e).put(Iy(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=lr(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return _r(e).J({range:r,index:"queryTargetsIndex"},(o,l,c)=>{const u=Va(l);Li(t,u.target)&&(i=u,c.done())}).next(()=>i)}addMatchingKeys(e,t,n){const r=[],i=cn(e);return t.forEach(o=>{const l=Xt(o.path);r.push(i.put({targetId:n,path:l})),r.push(this.referenceDelegate.addReference(e,n,o))}),J.waitFor(r)}removeMatchingKeys(e,t,n){const r=cn(e);return J.forEach(t,i=>{const o=Xt(i.path);return J.waitFor([r.delete([n,o]),this.referenceDelegate.removeReference(e,n,i)])})}removeMatchingKeysForTargetId(e,t){const n=cn(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=cn(e);let i=Qe();return r.J({range:n,H:!0},(o,l,c)=>{const u=Ts(o[1]),h=new Ee(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const n=Xt(t.path),r=IDBKeyRange.bound([n],[Rx(n)],!1,!0);let i=0;return cn(e).J({index:"documentTargetsIndex",H:!0,range:r},([o,l],c,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}ot(e,t){return _r(e).get(t).next(n=>n?Va(n):null)}}function _r(s){return Ot(s,"targets")}function eg(s){return Ot(s,"targetGlobal")}function cn(s){return Ot(s,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg([s,e],[t,n]){const r=qe(s,t);return r===0?qe(e,n):r}class LT{constructor(e){this.Un=e,this.buffer=new ct(tg),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();tg(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class OT{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){pe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Sn(t)?pe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await mr(t)}await this.Hn(3e5)})}}class FT{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return J.resolve(ps.oe);const n=new LT(t);return this.Jn.forEachTarget(e,r=>n.zn(r.sequenceNumber)).next(()=>this.Jn.Zn(e,r=>n.zn(r))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),J.resolve(Zf)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zf):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,r,i,o,l,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),r=this.params.maximumSequenceNumbersToCollect):r=m,o=Date.now(),this.nthSequenceNumber(e,r))).next(m=>(n=m,l=Date.now(),this.removeTargets(e,n,t))).next(m=>(i=m,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(u=Date.now(),jr()<=Ye.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${r} in `+(l-o)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${m} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),J.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:m})))}}function $T(s,e){return new FT(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e,t){this.db=e,this.garbageCollector=$T(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(r=>n+r))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,r)=>t(r))}addReference(e,t,n){return fo(e,n)}removeReference(e,t,n){return fo(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return fo(e,t)}nr(e,t){return function(r,i){let o=!1;return Cy(r).Y(l=>Py(r,l,i).next(c=>(c&&(o=!0),J.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.tr(e,(o,l)=>{if(l<=t){const c=this.nr(e,o).next(u=>{if(!u)return i++,n.getEntry(e,o).next(()=>(n.removeEntry(o,Be.min()),cn(e).delete(function(m){return[0,Xt(m.path)]}(o))))});r.push(c)}}).next(()=>J.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return fo(e,t)}tr(e,t){const n=cn(e);let r,i=ps.oe;return n.J({index:"documentTargetsIndex"},([o,l],{path:c,sequenceNumber:u})=>{o===0?(i!==ps.oe&&t(new Ee(Ts(r)),i),i=u,r=c):i=ps.oe}).next(()=>{i!==ps.oe&&t(new Ee(Ts(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function fo(s,e){return cn(s).put(function(n,r){return{targetId:0,path:Xt(n.path),sequenceNumber:r}}(e,s.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ry{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,jt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?J.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BT{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Vn(e).put(n)}removeEntry(e,t,n){return Vn(e).delete(function(i,o){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],nl(o),l[l.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=jt.newInvalidDocument(t);return Vn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sa(t))},(r,i)=>{n=this.ir(t,i)}).next(()=>n)}sr(e,t){let n={size:0,document:jt.newInvalidDocument(t)};return Vn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sa(t))},(r,i)=>{n={document:this.ir(t,i),size:al(i)}}).next(()=>n)}getEntries(e,t){let n=xs();return this._r(e,t,(r,i)=>{const o=this.ir(r,i);n=n.insert(r,o)}).next(()=>n)}ar(e,t){let n=xs(),r=new wt(Ee.comparator);return this._r(e,t,(i,o)=>{const l=this.ir(i,o);n=n.insert(i,l),r=r.insert(i,al(o))}).next(()=>({documents:n,ur:r}))}_r(e,t,n){if(t.isEmpty())return J.resolve();let r=new ct(rg);t.forEach(c=>r=r.add(c));const i=IDBKeyRange.bound(Sa(r.first()),Sa(r.last())),o=r.getIterator();let l=o.getNext();return Vn(e).J({index:"documentKeyIndex",range:i},(c,u,h)=>{const m=Ee.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;l&&rg(l,m)<0;)n(l,null),l=o.getNext();l&&l.isEqual(m)&&(n(l,u),l=o.hasNext()?o.getNext():null),l?h.$(Sa(l)):h.done()}).next(()=>{for(;l;)n(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){const o=t.path,l=[o.popLast().toArray(),o.lastSegment(),nl(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Vn(e).U(IDBKeyRange.bound(l,c,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=xs();for(const m of u){const p=this.ir(Ee.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(Oi(t,p)||r.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,n,r){let i=xs();const o=ng(t,n),l=ng(t,hs.max());return Vn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,l,!0)},(c,u,h)=>{const m=this.ir(Ee.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(m.key,m),i.size===r&&h.done()}).next(()=>i)}newChangeBuffer(e){return new zT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return sg(e).get("remoteDocumentGlobalKey").next(t=>(Le(!!t),t))}rr(e,t){return sg(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=IT(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(Be.min())))return n}return jt.newInvalidDocument(e)}}function Dy(s){return new BT(s)}class zT extends Ry{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new An(n=>n.toString(),(n,r)=>n.isEqual(r))}applyChanges(e){const t=[];let n=0,r=new ct((i,o)=>qe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const l=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,l.readTime)),o.isValidDocument()){const c=Bf(this.cr.serializer,o);r=r.add(i.path.popLast());const u=al(c);n+=u-l.size,t.push(this.cr.addEntry(e,i,c))}else if(n-=l.size,this.trackRemovals){const c=Bf(this.cr.serializer,o.convertToNoDocument(Be.min()));t.push(this.cr.addEntry(e,i,c))}}),r.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,n)),J.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:r})=>(r.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:n.get(i).readTime})}),n))}}function sg(s){return Ot(s,"remoteDocumentGlobal")}function Vn(s){return Ot(s,"remoteDocumentsV14")}function Sa(s){const e=s.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ng(s,e){const t=e.documentKey.path.toArray();return[s,nl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function rg(s,e){const t=s.path.toArray(),n=e.path.toArray();let r=0;for(let i=0;i<t.length-2&&i<n.length-2;++i)if(r=qe(t[i],n[i]),r)return r;return r=qe(t.length,n.length),r||(r=qe(t[t.length-2],n[n.length-2]),r||qe(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(n!==null&&Ga(n.mutation,r,$s.empty(),It.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Qe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Qe()){const r=Ss();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(i=>{let o=Ra();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Ss();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Qe()))}populateOverlays(e,t,n){const r=[];return n.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,n,r){let i=xs();const o=za(),l=function(){return za()}();return t.forEach((c,u)=>{const h=n.get(u.key);r.has(u.key)&&(h===void 0||h.mutation instanceof da)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Ga(h.mutation,u,h.mutation.getFieldMask(),It.now())):o.set(u.key,$s.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>{var m;return l.set(u,new GT(h,(m=o.get(u))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const n=za();let r=new wt((o,l)=>o-l),i=Qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const l of o)l.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let h=n.get(c)||$s.empty();h=l.applyToLocalView(u,h),n.set(c,h);const m=(r.get(l.batchId)||Qe()).add(c);r=r.insert(l.batchId,m)})}).next(()=>{const o=[],l=r.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),u=c.key,h=c.value,m=ny();h.forEach(p=>{if(!i.has(p)){const N=ly(t.get(p),n.get(p));N!==null&&m.set(p,N),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,m))}return J.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,r){return function(o){return Ee.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Zx(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):J.resolve(Ss());let l=-1,c=i;return o.next(u=>J.forEach(u,(h,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),i.get(h)?J.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,Qe())).next(h=>({batchId:l,changes:JI(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ee(t)).next(n=>{let r=Ra();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let o=Ra();return this.indexManager.getCollectionParents(e,i).next(l=>J.forEach(l,c=>{const u=function(m,p){return new ca(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,n,r).next(h=>{h.forEach((m,p)=>{o=o.insert(m,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(o=>{i.forEach((c,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,jt.newInvalidDocument(h)))});let l=Ra();return o.forEach((c,u)=>{const h=i.get(c);h!==void 0&&Ga(h.mutation,u,$s.empty(),It.now()),Oi(t,u)&&(l=l.insert(c,u))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qT{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return J.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:Zt(r.createTime)}}(t)),J.resolve()}getNamedQuery(e,t){return J.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(r){return{name:r.name,query:Ty(r.bundledQuery),readTime:Zt(r.readTime)}}(t)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(){this.overlays=new wt(Ee.comparator),this.Ir=new Map}getOverlay(e,t){return J.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ss();return J.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&n.set(r,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((r,i)=>{this.ht(e,t,i)}),J.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),J.resolve()}getOverlaysForCollection(e,t,n){const r=Ss(),i=t.length+1,o=new Ee(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>n&&r.set(c.getKey(),c)}return J.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new wt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let h=i.get(u.largestBatchId);h===null&&(h=Ss(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const l=Ss(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,h)=>l.set(u,h)),!(l.size()>=r)););return J.resolve(l)}ht(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const o=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Iu(t,n));let i=this.Ir.get(t);i===void 0&&(i=Qe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(){this.sessionToken=Mt.EMPTY_BYTE_STRING}getSessionToken(e){return J.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,J.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(){this.Tr=new ct(Ft.Er),this.dr=new ct(Ft.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Ft(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Ft(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new Ee(new ot([])),n=new Ft(t,e),r=new Ft(t,e+1),i=[];return this.dr.forEachInRange([n,r],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ee(new ot([])),n=new Ft(t,e),r=new Ft(t,e+1);let i=Qe();return this.dr.forEachInRange([n,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Ft(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Ft{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ee.comparator(e.key,t.key)||qe(e.wr,t.wr)}static Ar(e,t){return qe(e.wr,t.wr)||Ee.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ct(Ft.Er)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ju(i,t,n,r);this.mutationQueue.push(o);for(const l of r)this.br=this.br.add(new Ft(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return J.resolve(o)}lookupMutationBatch(e,t){return J.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return J.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ft(t,0),r=new Ft(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],o=>{const l=this.Dr(o.wr);i.push(l)}),J.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ct(qe);return t.forEach(r=>{const i=new Ft(r,0),o=new Ft(r,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],l=>{n=n.add(l.wr)})}),J.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Ee.isDocumentKey(i)||(i=i.child(""));const o=new Ft(new Ee(i),0);let l=new ct(qe);return this.br.forEachWhile(c=>{const u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===r&&(l=l.add(c.wr)),!0)},o),J.resolve(this.Cr(l))}Cr(e){const t=[];return e.forEach(n=>{const r=this.Dr(n);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){Le(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return J.forEach(t.mutations,r=>{const i=new Ft(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Ft(t,0),r=this.br.firstAfterOrEqual(n);return J.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT{constructor(e){this.Mr=e,this.docs=function(){return new wt(Ee.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return J.resolve(n?n.document.mutableCopy():jt.newInvalidDocument(t))}getEntries(e,t){let n=xs();return t.forEach(r=>{const i=this.docs.get(r);n=n.insert(r,i?i.document.mutableCopy():jt.newInvalidDocument(r))}),J.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=xs();const o=t.path,l=new Ee(o.child("")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||pu(Dx(h),n)<=0||(r.has(h.key)||Oi(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return J.resolve(i)}getAllFromCollectionGroup(e,t,n,r){De()}Or(e,t){return J.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new QT(this)}getSize(e){return J.resolve(this.size)}}class QT extends Ry{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),J.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YT{constructor(e){this.persistence=e,this.Nr=new An(t=>lr(t),Li),this.lastRemoteSnapshotVersion=Be.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Pu,this.targetCount=0,this.kr=ur.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,r)=>t(r)),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),J.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ur(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,J.resolve()}updateTargetData(e,t){return this.Kn(t),J.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)}),J.waitFor(i).next(()=>r)}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return J.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),J.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),J.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),J.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return J.resolve(n)}containsKey(e,t){return J.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ps(0),this.Kr=!1,this.Kr=!0,this.$r=new KT,this.referenceDelegate=e(this),this.Ur=new YT(this),this.indexManager=new DT,this.remoteDocumentCache=function(r){return new JT(r)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Ey(t),this.Gr=new qT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new WT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new HT(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){pe("MemoryPersistence","Starting transaction:",e);const r=new XT(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(i=>this.referenceDelegate.jr(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Hr(e,t){return J.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class XT extends Mx{constructor(e){super(),this.currentSequenceNumber=e}}class $l{constructor(e){this.persistence=e,this.Jr=new Pu,this.Yr=null}static Zr(e){return new $l(e)}get Xr(){if(this.Yr)return this.Yr;throw De()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),J.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),J.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),J.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(r=>this.Xr.add(r.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.Xr,n=>{const r=Ee.fromPath(n);return this.ei(e,r).next(i=>{i||t.removeEntry(r,Be.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return J.or([()=>J.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(e){this.serializer=e}O(e,t,n,r){const i=new kl("createOrUpgrade",t);n<1&&r>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0}),c.createObjectStore("documentMutations")}(e),ag(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=J.resolve();return n<3&&r>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),ag(e)),o=o.next(()=>function(c){const u=c.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Be.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",h)}(i))),n<4&&r>=4&&(n!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(h=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yf,{unique:!0});const m=u.store("mutations"),p=h.map(N=>m.put(N));return J.waitFor(p)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&r>=5&&(o=o.next(()=>this.ni(i))),n<6&&r>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),n<7&&r>=7&&(o=o.next(()=>this.ii(i))),n<8&&r>=8&&(o=o.next(()=>this.si(e,i))),n<9&&r>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&r>=10&&(o=o.next(()=>this.oi(i))),n<11&&r>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(o=o.next(()=>{(function(c){const u=c.createObjectStore("documentOverlays",{keyPath:II});u.createIndex("collectionPathOverlayIndex",TI,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",SI,{unique:!1})})(e)})),n<13&&r>=13&&(o=o.next(()=>function(c){const u=c.createObjectStore("remoteDocumentsV14",{keyPath:gI});u.createIndex("documentKeyIndex",pI),u.createIndex("collectionGroupIndex",xI)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(o=o.next(()=>this.ai(e,i))),n<15&&r>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:NI}).createIndex("sequenceNumberIndex",_I,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:jI}).createIndex("documentKeyIndex",EI,{unique:!1})}(e))),n<16&&r>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&r>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,r)=>{t+=al(r)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(r=>J.forEach(r,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(l=>J.forEach(l,c=>{Le(c.userId===i.userId);const u=Un(this.serializer,c);return ky(e,i.userId,u).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const i=[];return n.J((o,l)=>{const c=new ot(o),u=function(m){return[0,Xt(m)]}(c);i.push(t.get(u).next(h=>h?J.resolve():(m=>t.put({targetId:0,path:Xt(m),sequenceNumber:r.highestListenSequenceNumber}))(c)))}).next(()=>J.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:wI});const n=t.store("collectionParents"),r=new ku,i=o=>{if(r.add(o)){const l=o.lastSegment(),c=o.popLast();return n.put({collectionId:l,parent:Xt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,l)=>{const c=new ot(o);return i(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,l,c],u)=>{const h=Ts(l);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,r)=>{const i=Va(r),o=Iy(this.serializer,i);return t.put(o)})}_i(e,t){const n=t.store("remoteDocuments"),r=[];return n.J((i,o)=>{const l=t.store("remoteDocumentsV14"),c=function(m){return m.document?new Ee(ot.fromString(m.document.name).popFirst(5)):m.noDocument?Ee.fromSegments(m.noDocument.path):m.unknownDocument?Ee.fromSegments(m.unknownDocument.path):De()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};r.push(l.put(u))}).next(()=>J.waitFor(r))}ai(e,t){const n=t.store("mutations"),r=Dy(this.serializer),i=new My($l.Zr,this.serializer.ct);return n.U().next(o=>{const l=new Map;return o.forEach(c=>{var u;let h=(u=l.get(c.userId))!==null&&u!==void 0?u:Qe();Un(this.serializer,c).keys().forEach(m=>h=h.add(m)),l.set(c.userId,h)}),J.forEach(l,(c,u)=>{const h=new zt(u),m=Ol.lt(this.serializer,h),p=i.getIndexManager(h),N=Fl.lt(h,this.serializer,p,i.referenceDelegate);return new Vy(r,N,m,p).recalculateAndSaveOverlaysForDocumentKeys(new ld(t,ps.oe),c).next()})})}}function ag(s){s.createObjectStore("targetDocuments",{keyPath:bI}).createIndex("documentTargetsIndex",vI,{unique:!0}),s.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",yI,{unique:!0}),s.createObjectStore("targetGlobal")}const Ec="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Cu{constructor(e,t,n,r,i,o,l,c,u,h,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=i,this.window=o,this.document=l,this.ci=u,this.li=h,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!Cu.D())throw new je(ue.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new UT(this,r),this.Ai=t+"main",this.serializer=new Ey(c),this.Ri=new pn(this.Ai,this.hi,new ZT(this.serializer)),this.$r=new ST,this.Ur=new MT(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Dy(this.serializer),this.Gr=new TT,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&Qt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new je(ue.FAILED_PRECONDITION,Ec);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ps(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>go(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Sn(e))return pe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return pe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Aa(e).get("owner").next(t=>J.resolve(this.vi(t)))}Ci(e){return go(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const n=Ot(t,"clientMetadata");return n.U().next(r=>{const i=this.xi(r,18e5),o=r.filter(l=>i.indexOf(l)===-1);return J.forEach(o,l=>n.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?J.resolve(!0):Aa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new je(ue.FAILED_PRECONDITION,Ec);return!1}}return!(!this.networkEnabled||!this.inForeground)||go(e).U().next(n=>this.xi(n,5e3).find(r=>{if(this.clientId!==r.clientId){const i=!this.networkEnabled&&r.networkEnabled,o=!this.inForeground&&r.inForeground,l=this.networkEnabled===r.networkEnabled;if(i||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&pe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new ld(e,ps.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>go(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Fl.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new VT(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ol.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){pe("IndexedDbPersistence","Starting transaction:",e);const r=t==="readonly"?"readonly":"readwrite",i=function(c){return c===17?PI:c===16?kI:c===15?yu:c===14?Ux:c===13?$x:c===12?AI:c===11?Fx:void De()}(this.hi);let o;return this.Ri.runTransaction(e,r,i,l=>(o=new ld(l,this.Qr?this.Qr.next():ps.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Qt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new je(ue.FAILED_PRECONDITION,Vx);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Ki(e){return Aa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new je(ue.FAILED_PRECONDITION,Ec)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Aa(e).put("owner",t)}static D(){return pn.D()}bi(e){const t=Aa(e);return t.get("owner").next(n=>this.vi(n)?(pe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):J.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Qt(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;M0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return pe("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Qt("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Qt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Aa(s){return Ot(s,"owner")}function go(s){return Ot(s,"clientMetadata")}function eS(s,e){let t=s.projectId;return s.isDefaultDatabase||(t+="."+s.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=Qe(),r=Qe();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Ru(e,t.fromCache,n,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return M0()?8:Lx(Lt())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,r,n).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new tS;return this.Xi(e,t,o).next(l=>{if(i.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>i.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(jr()<=Ye.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",Er(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),J.resolve()):(jr()<=Ye.DEBUG&&pe("QueryEngine","Query:",Er(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(jr()<=Ye.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",Er(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bs(t))):J.resolve())}Yi(e,t){if(Pf(t))return J.resolve(null);let n=bs(t);return this.indexManager.getIndexType(e,n).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=gd(t,null,"F"),n=bs(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const o=Qe(...i);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,n).next(c=>{const u=this.ts(t,l);return this.ns(t,u,o,c.readTime)?this.Yi(e,gd(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,n,r){return Pf(t)||r.isEqual(Be.min())?J.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const o=this.ts(t,i);return this.ns(t,o,n,r)?J.resolve(null):(jr()<=Ye.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Er(t)),this.rs(e,o,t,oI(r,-1)).next(l=>l))})}ts(e,t){let n=new ct(ty(e));return t.forEach((r,i)=>{Oi(e,i)&&(n=n.add(i))}),n}ns(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return jr()<=Ye.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",Er(t)),this.Ji.getDocumentsMatchingQuery(e,t,hs.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new wt(qe),this._s=new An(i=>lr(i),Li),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vy(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Oy(s,e,t,n){return new sS(s,e,t,n)}async function Fy(s,e){const t=Ge(s);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const o=[],l=[];let c=Qe();for(const u of r){o.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of i){l.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(n,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:l}))})})}function nS(s,e){const t=Ge(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const r=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,c,u,h){const m=u.batch,p=m.keys();let N=J.resolve();return p.forEach(v=>{N=N.next(()=>h.getEntry(c,v)).next(I=>{const g=u.docVersions.get(v);Le(g!==null),I.version.compareTo(g)<0&&(m.applyToRemoteDocument(I,u),I.isValidDocument()&&(I.setReadTime(u.commitVersion),h.addEntry(I)))})}),N.next(()=>l.mutationQueue.removeMutationBatch(c,m))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let c=Qe();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(c=c.add(l.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,r))})}function $y(s){const e=Ge(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function rS(s,e){const t=Ge(s),n=e.snapshotVersion;let r=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});r=t.os;const l=[];e.targetChanges.forEach((h,m)=>{const p=r.get(m);if(!p)return;l.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,m)));let N=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(m)!==null?N=N.withResumeToken(Mt.EMPTY_BYTE_STRING,Be.min()).withLastLimboFreeSnapshotVersion(Be.min()):h.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(h.resumeToken,n)),r=r.insert(m,N),function(I,g,S){return I.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-I.snapshotVersion.toMicroseconds()>=3e8?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(p,N,h)&&l.push(t.Ur.updateTargetData(i,N))});let c=xs(),u=Qe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),l.push(aS(i,o,e.documentUpdates).next(h=>{c=h.Ps,u=h.Is})),!n.isEqual(Be.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(m=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));l.push(h)}return J.waitFor(l).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(t.os=r,i))}function aS(s,e,t){let n=Qe(),r=Qe();return t.forEach(i=>n=n.add(i)),e.getEntries(s,n).next(i=>{let o=xs();return t.forEach((l,c)=>{const u=i.get(l);c.isFoundDocument()!==u.isFoundDocument()&&(r=r.add(l)),c.isNoDocument()&&c.version.isEqual(Be.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):pe("LocalStore","Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:r}})}function iS(s,e){const t=Ge(s);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function oS(s,e){const t=Ge(s);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return t.Ur.getTargetData(n,e).next(i=>i?(r=i,J.resolve(r)):t.Ur.allocateTargetId(n).next(o=>(r=new Us(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,r).next(()=>r))))}).then(n=>{const r=t.os.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function _d(s,e,t){const n=Ge(s),r=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,o=>n.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Sn(o))throw o;pe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(r.target)}function ig(s,e,t){const n=Ge(s);let r=Be.min(),i=Qe();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,h){const m=Ge(c),p=m._s.get(h);return p!==void 0?J.resolve(m.os.get(p)):m.Ur.getTargetData(u,h)}(n,o,bs(e)).next(l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?r:Be.min(),t?i:Qe())).next(l=>(lS(n,WI(e),l),{documents:l,Ts:i})))}function lS(s,e,t){let n=s.us.get(e)||Be.min();t.forEach((r,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),s.us.set(e,n)}class og{constructor(){this.activeTargetIds=ZI()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uy{constructor(){this.so=new og,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new og,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){pe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){pe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let po=null;function Ic(){return po===null?po=function(){return 268435456+Math.round(2147483648*Math.random())}():po++,"0x"+po.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kt="WebChannelConnection";class hS extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${r}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${r}`:`project_id=${r}&database_id=${i}`}get Fo(){return!1}Mo(t,n,r,i,o){const l=Ic(),c=this.xo(t,n.toUriEncodedString());pe("RestConnection",`Sending RPC '${t}' ${l}:`,c,r);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,o),this.No(t,c,u,r).then(h=>(pe("RestConnection",`Received RPC '${t}' ${l}: `,h),h),h=>{throw ar("RestConnection",`RPC '${t}' ${l} failed with error: `,h,"url: ",c,"request:",r),h})}Lo(t,n,r,i,o,l){return this.Mo(t,n,r,i,o)}Oo(t,n,r){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+la}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,o)=>t[o]=i),r&&r.headers.forEach((i,o)=>t[o]=i)}xo(t,n){const r=dS[t];return`${this.Do}/v1/${n}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=Ic();return new Promise((o,l)=>{const c=new Ix;c.setWithCredentials(!0),c.listenOnce(Tx.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Po.NO_ERROR:const h=c.getResponseJson();pe(Kt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Po.TIMEOUT:pe(Kt,`RPC '${e}' ${i} timed out`),l(new je(ue.DEADLINE_EXCEEDED,"Request time out"));break;case Po.HTTP_ERROR:const m=c.getStatus();if(pe(Kt,`RPC '${e}' ${i} failed with status:`,m,"response text:",c.getResponseText()),m>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const N=p==null?void 0:p.error;if(N&&N.status&&N.message){const v=function(g){const S=g.toLowerCase().replace(/_/g,"-");return Object.values(ue).indexOf(S)>=0?S:ue.UNKNOWN}(N.status);l(new je(v,N.message))}else l(new je(ue.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new je(ue.UNAVAILABLE,"Connection failed."));break;default:De()}}finally{pe(Kt,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(r);pe(Kt,`RPC '${e}' ${i} sending request:`,r),c.send(t,"POST",u,n,15)})}Bo(e,t,n){const r=Ic(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=kx(),l=Ax(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const h=i.join("");pe(Kt,`Creating RPC '${e}' stream ${r}: ${h}`,c);const m=o.createWebChannel(h,c);let p=!1,N=!1;const v=new uS({Io:g=>{N?pe(Kt,`Not sending because RPC '${e}' stream ${r} is closed:`,g):(p||(pe(Kt,`Opening RPC '${e}' stream ${r} transport.`),m.open(),p=!0),pe(Kt,`RPC '${e}' stream ${r} sending:`,g),m.send(g))},To:()=>m.close()}),I=(g,S,C)=>{g.listen(S,T=>{try{C(T)}catch(V){setTimeout(()=>{throw V},0)}})};return I(m,Ca.EventType.OPEN,()=>{N||(pe(Kt,`RPC '${e}' stream ${r} transport opened.`),v.yo())}),I(m,Ca.EventType.CLOSE,()=>{N||(N=!0,pe(Kt,`RPC '${e}' stream ${r} transport closed`),v.So())}),I(m,Ca.EventType.ERROR,g=>{N||(N=!0,ar(Kt,`RPC '${e}' stream ${r} transport errored:`,g),v.So(new je(ue.UNAVAILABLE,"The operation could not be completed")))}),I(m,Ca.EventType.MESSAGE,g=>{var S;if(!N){const C=g.data[0];Le(!!C);const T=C,V=T.error||((S=T[0])===null||S===void 0?void 0:S.error);if(V){pe(Kt,`RPC '${e}' stream ${r} received error:`,V);const P=V.status;let k=function(w){const E=Pt[w];if(E!==void 0)return uy(E)}(P),b=V.message;k===void 0&&(k=ue.INTERNAL,b="Unknown error status: "+P+" with message "+V.message),N=!0,v.So(new je(k,b)),m.close()}else pe(Kt,`RPC '${e}' stream ${r} received:`,C),v.bo(C)}}),I(l,Sx.STAT_EVENT,g=>{g.stat===id.PROXY?pe(Kt,`RPC '${e}' stream ${r} detected buffering proxy`):g.stat===id.NOPROXY&&pe(Kt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mS(){return typeof window<"u"?window:null}function Lo(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(s){return new pT(s,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&pe("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{constructor(e,t,n,r,i,o,l,c){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new By(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===ue.RESOURCE_EXHAUSTED?(Qt(t.toString()),Qt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===ue.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,r])=>{this.Yo===t&&this.P_(n,r)},n=>{e(()=>{const r=new je(ue.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(r)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(r=>{n(()=>this.I_(r))}),this.stream.onMessage(r=>{n(()=>++this.e_==1?this.E_(r):this.onNext(r))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return pe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(pe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class fS extends zy{constructor(e,t,n,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=bT(this.serializer,e),n=function(i){if(!("targetChange"in i))return Be.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Be.min():o.readTime?Zt(o.readTime):Be.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=yd(this.serializer),t.addTarget=function(i,o){let l;const c=o.target;if(l=Zo(c)?{documents:by(i,c)}:{query:vy(i,c)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=fy(i,o.resumeToken);const u=pd(i,o.expectedCount);u!==null&&(l.expectedCount=u)}else if(o.snapshotVersion.compareTo(Be.min())>0){l.readTime=Yr(i,o.snapshotVersion.toTimestamp());const u=pd(i,o.expectedCount);u!==null&&(l.expectedCount=u)}return l}(this.serializer,e);const n=wT(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=yd(this.serializer),t.removeTarget=e,this.a_(t)}}class gS extends zy{constructor(e,t,n,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Le(!!e.streamToken),this.lastStreamToken=e.streamToken,Le(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Le(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=vT(e.writeResults,e.commitTime),n=Zt(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=yd(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>sl(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new je(ue.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,xd(t,n),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new je(ue.UNKNOWN,i.toString())})}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,xd(t,n),r,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new je(ue.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class xS{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Qt(t),this.D_=!1):pe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{n.enqueueAndForget(async()=>{fr(this)&&(pe("RemoteStore","Restarting streams for network reachability change."),await async function(c){const u=Ge(c);u.L_.add(4),await Ui(u),u.q_.set("Unknown"),u.L_.delete(4),await Bl(u)}(this))})}),this.q_=new xS(n,r)}}async function Bl(s){if(fr(s))for(const e of s.B_)await e(!0)}async function Ui(s){for(const e of s.B_)await e(!1)}function Gy(s,e){const t=Ge(s);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Lu(t)?Mu(t):ua(t).r_()&&Vu(t,e))}function Du(s,e){const t=Ge(s),n=ua(t);t.N_.delete(e),n.r_()&&qy(t,e),t.N_.size===0&&(n.r_()?n.o_():fr(t)&&t.q_.set("Unknown"))}function Vu(s,e){if(s.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Be.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ua(s).A_(e)}function qy(s,e){s.Q_.xe(e),ua(s).R_(e)}function Mu(s){s.Q_=new hT({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>s.N_.get(e)||null,tt:()=>s.datastore.serializer.databaseId}),ua(s).start(),s.q_.v_()}function Lu(s){return fr(s)&&!ua(s).n_()&&s.N_.size>0}function fr(s){return Ge(s).L_.size===0}function Wy(s){s.Q_=void 0}async function bS(s){s.q_.set("Online")}async function vS(s){s.N_.forEach((e,t)=>{Vu(s,e)})}async function wS(s,e){Wy(s),Lu(s)?(s.q_.M_(e),Mu(s)):s.q_.set("Unknown")}async function NS(s,e,t){if(s.q_.set("Online"),e instanceof my&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const l of i.targetIds)r.N_.has(l)&&(await r.remoteSyncer.rejectListen(l,o),r.N_.delete(l),r.Q_.removeTarget(l))}(s,e)}catch(n){pe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await il(s,n)}else if(e instanceof Mo?s.Q_.Ke(e):e instanceof hy?s.Q_.He(e):s.Q_.We(e),!t.isEqual(Be.min()))try{const n=await $y(s.localStore);t.compareTo(n)>=0&&await function(i,o){const l=i.Q_.rt(o);return l.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.N_.get(u);h&&i.N_.set(u,h.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,u)=>{const h=i.N_.get(c);if(!h)return;i.N_.set(c,h.withResumeToken(Mt.EMPTY_BYTE_STRING,h.snapshotVersion)),qy(i,c);const m=new Us(h.target,c,u,h.sequenceNumber);Vu(i,m)}),i.remoteSyncer.applyRemoteEvent(l)}(s,t)}catch(n){pe("RemoteStore","Failed to raise snapshot:",n),await il(s,n)}}async function il(s,e,t){if(!Sn(e))throw e;s.L_.add(1),await Ui(s),s.q_.set("Offline"),t||(t=()=>$y(s.localStore)),s.asyncQueue.enqueueRetryable(async()=>{pe("RemoteStore","Retrying IndexedDB access"),await t(),s.L_.delete(1),await Bl(s)})}function Ky(s,e){return e().catch(t=>il(s,t,e))}async function zl(s){const e=Ge(s),t=wn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_S(e);)try{const r=await iS(e.localStore,n);if(r===null){e.O_.length===0&&t.o_();break}n=r.batchId,jS(e,r)}catch(r){await il(e,r)}Hy(e)&&Jy(e)}function _S(s){return fr(s)&&s.O_.length<10}function jS(s,e){s.O_.push(e);const t=wn(s);t.r_()&&t.V_&&t.m_(e.mutations)}function Hy(s){return fr(s)&&!wn(s).n_()&&s.O_.length>0}function Jy(s){wn(s).start()}async function ES(s){wn(s).p_()}async function IS(s){const e=wn(s);for(const t of s.O_)e.m_(t.mutations)}async function TS(s,e,t){const n=s.O_.shift(),r=Eu.from(n,e,t);await Ky(s,()=>s.remoteSyncer.applySuccessfulWrite(r)),await zl(s)}async function SS(s,e){e&&wn(s).V_&&await async function(n,r){if(function(o){return cT(o)&&o!==ue.ABORTED}(r.code)){const i=n.O_.shift();wn(n).s_(),await Ky(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,r)),await zl(n)}}(s,e),Hy(s)&&Jy(s)}async function cg(s,e){const t=Ge(s);t.asyncQueue.verifyOperationInProgress(),pe("RemoteStore","RemoteStore received new credentials");const n=fr(t);t.L_.add(3),await Ui(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Bl(t)}async function AS(s,e){const t=Ge(s);e?(t.L_.delete(2),await Bl(t)):e||(t.L_.add(2),await Ui(t),t.q_.set("Unknown"))}function ua(s){return s.K_||(s.K_=function(t,n,r){const i=Ge(t);return i.w_(),new fS(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(s.datastore,s.asyncQueue,{Eo:bS.bind(null,s),Ro:vS.bind(null,s),mo:wS.bind(null,s),d_:NS.bind(null,s)}),s.B_.push(async e=>{e?(s.K_.s_(),Lu(s)?Mu(s):s.q_.set("Unknown")):(await s.K_.stop(),Wy(s))})),s.K_}function wn(s){return s.U_||(s.U_=function(t,n,r){const i=Ge(t);return i.w_(),new gS(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(s.datastore,s.asyncQueue,{Eo:()=>Promise.resolve(),Ro:ES.bind(null,s),mo:SS.bind(null,s),f_:IS.bind(null,s),g_:TS.bind(null,s)}),s.B_.push(async e=>{e?(s.U_.s_(),await zl(s)):(await s.U_.stop(),s.O_.length>0&&(pe("RemoteStore",`Stopping write stream with ${s.O_.length} pending writes`),s.O_=[]))})),s.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Yn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const o=Date.now()+n,l=new Ou(e,t,o,r,i);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new je(ue.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qy(s,e){if(Qt("AsyncQueue",`${e}: ${s}`),Sn(s))return new je(ue.UNAVAILABLE,`${e}: ${s}`);throw s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ee.comparator(t.key,n.key):(t,n)=>Ee.comparator(t.key,n.key),this.keyedMap=Ra(),this.sortedSet=new wt(this.comparator)}static emptySet(e){return new Or(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Or)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Or;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(){this.W_=new wt(Ee.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):De():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class Xr{constructor(e,t,n,r,i,o,l,c,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,i){const o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new Xr(e,t,Or.emptySet(t),o,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Dl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class PS{constructor(){this.queries=ug(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const r=Ge(t),i=r.queries;r.queries=ug(),i.forEach((o,l)=>{for(const c of l.j_)c.onError(n)})})(this,new je(ue.ABORTED,"Firestore shutting down"))}}function ug(){return new An(s=>ey(s),Dl)}async function CS(s,e){const t=Ge(s);let n=3;const r=e.query;let i=t.queries.get(r);i?!i.H_()&&e.J_()&&(n=2):(i=new kS,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(r,!0);break;case 1:i.z_=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const l=Qy(o,`Initialization of query '${Er(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Fu(t)}async function RS(s,e){const t=Ge(s),n=e.query;let r=3;const i=t.queries.get(n);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?r=e.J_()?0:1:!i.H_()&&e.J_()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function DS(s,e){const t=Ge(s);let n=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const l of o.j_)l.X_(r)&&(n=!0);o.z_=r}}n&&Fu(t)}function VS(s,e,t){const n=Ge(s),r=n.queries.get(e);if(r)for(const i of r.j_)i.onError(t);n.queries.delete(e)}function Fu(s){s.Y_.forEach(e=>{e.next()})}var jd,hg;(hg=jd||(jd={})).ea="default",hg.Cache="cache";class MS{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new Xr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Xr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==jd.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e){this.key=e}}class Xy{constructor(e){this.key=e}}class LS{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Qe(),this.mutatedKeys=Qe(),this.Aa=ty(e),this.Ra=new Or(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new dg,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,l=!1;const c=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,u=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,m)=>{const p=r.get(h),N=Oi(this.query,m)?m:null,v=!!p&&this.mutatedKeys.has(p.key),I=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let g=!1;p&&N?p.data.isEqual(N.data)?v!==I&&(n.track({type:3,doc:N}),g=!0):this.ga(p,N)||(n.track({type:2,doc:N}),g=!0,(c&&this.Aa(N,c)>0||u&&this.Aa(N,u)<0)&&(l=!0)):!p&&N?(n.track({type:0,doc:N}),g=!0):p&&!N&&(n.track({type:1,doc:p}),g=!0,(c||u)&&(l=!0)),g&&(N?(o=o.add(N),i=I?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),n.track({type:1,doc:h})}return{Ra:o,fa:n,ns:l,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,m)=>function(N,v){const I=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return De()}};return I(N)-I(v)}(h.type,m.type)||this.Aa(h.doc,m.doc)),this.pa(n),r=r!=null&&r;const l=t&&!r?this.ya():[],c=this.da.size===0&&this.current&&!r?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new Xr(this.query,e.Ra,i,o,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new dg,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Qe(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Xy(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Yy(n))}),t}ba(e){this.Ta=e.Ts,this.da=Qe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Xr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class OS{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class FS{constructor(e){this.key=e,this.va=!1}}class $S{constructor(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new An(l=>ey(l),Dl),this.Ma=new Map,this.xa=new Set,this.Oa=new wt(Ee.comparator),this.Na=new Map,this.La=new Pu,this.Ba={},this.ka=new Map,this.qa=ur.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function US(s,e,t=!0){const n=rb(s);let r;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Da()):r=await Zy(n,e,t,!0),r}async function BS(s,e){const t=rb(s);await Zy(t,e,!0,!1)}async function Zy(s,e,t,n){const r=await oS(s.localStore,bs(e)),i=r.targetId,o=s.sharedClientState.addLocalQueryTarget(i,t);let l;return n&&(l=await zS(s,e,i,o==="current",r.resumeToken)),s.isPrimaryClient&&t&&Gy(s.remoteStore,r),l}async function zS(s,e,t,n,r){s.Ka=(m,p,N)=>async function(I,g,S,C){let T=g.view.ma(S);T.ns&&(T=await ig(I.localStore,g.query,!1).then(({documents:b})=>g.view.ma(b,T)));const V=C&&C.targetChanges.get(g.targetId),P=C&&C.targetMismatches.get(g.targetId)!=null,k=g.view.applyChanges(T,I.isPrimaryClient,V,P);return fg(I,g.targetId,k.wa),k.snapshot}(s,m,p,N);const i=await ig(s.localStore,e,!0),o=new LS(e,i.Ts),l=o.ma(i.documents),c=$i.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",r),u=o.applyChanges(l,s.isPrimaryClient,c);fg(s,t,u.wa);const h=new OS(e,t,o);return s.Fa.set(e,h),s.Ma.has(t)?s.Ma.get(t).push(e):s.Ma.set(t,[e]),u.snapshot}async function GS(s,e,t){const n=Ge(s),r=n.Fa.get(e),i=n.Ma.get(r.targetId);if(i.length>1)return n.Ma.set(r.targetId,i.filter(o=>!Dl(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await _d(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),t&&Du(n.remoteStore,r.targetId),Ed(n,r.targetId)}).catch(mr)):(Ed(n,r.targetId),await _d(n.localStore,r.targetId,!0))}async function qS(s,e){const t=Ge(s),n=t.Fa.get(e),r=t.Ma.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Du(t.remoteStore,n.targetId))}async function eb(s,e){const t=Ge(s);try{const n=await rS(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.Na.get(i);o&&(Le(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.va=!0:r.modifiedDocuments.size>0?Le(o.va):r.removedDocuments.size>0&&(Le(o.va),o.va=!1))}),await Gl(t,n,e)}catch(n){await mr(n)}}function mg(s,e,t){const n=Ge(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Fa.forEach((i,o)=>{const l=o.view.Z_(e);l.snapshot&&r.push(l.snapshot)}),function(o,l){const c=Ge(o);c.onlineState=l;let u=!1;c.queries.forEach((h,m)=>{for(const p of m.j_)p.Z_(l)&&(u=!0)}),u&&Fu(c)}(n.eventManager,e),r.length&&n.Ca.d_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function WS(s,e,t){const n=Ge(s);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Na.get(e),i=r&&r.key;if(i){let o=new wt(Ee.comparator);o=o.insert(i,jt.newNoDocument(i,Be.min()));const l=Qe().add(i),c=new Ll(Be.min(),new Map,new wt(qe),o,l);await eb(n,c),n.Oa=n.Oa.remove(i),n.Na.delete(e),$u(n)}else await _d(n.localStore,e,!1).then(()=>Ed(n,e,t)).catch(mr)}async function KS(s,e){const t=Ge(s),n=e.batch.batchId;try{const r=await nS(t.localStore,e);sb(t,n,null),tb(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Gl(t,r)}catch(r){await mr(r)}}async function HS(s,e,t){const n=Ge(s);try{const r=await function(o,l){const c=Ge(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return c.mutationQueue.lookupMutationBatch(u,l).next(m=>(Le(m!==null),h=m.keys(),c.mutationQueue.removeMutationBatch(u,m))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>c.localDocuments.getDocuments(u,h))})}(n.localStore,e);sb(n,e,t),tb(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Gl(n,r)}catch(r){await mr(r)}}function tb(s,e){(s.ka.get(e)||[]).forEach(t=>{t.resolve()}),s.ka.delete(e)}function sb(s,e,t){const n=Ge(s);let r=n.Ba[n.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),n.Ba[n.currentUser.toKey()]=r}}function Ed(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Ma.get(e))s.Fa.delete(n),t&&s.Ca.$a(n,t);s.Ma.delete(e),s.isPrimaryClient&&s.La.gr(e).forEach(n=>{s.La.containsKey(n)||nb(s,n)})}function nb(s,e){s.xa.delete(e.path.canonicalString());const t=s.Oa.get(e);t!==null&&(Du(s.remoteStore,t),s.Oa=s.Oa.remove(e),s.Na.delete(t),$u(s))}function fg(s,e,t){for(const n of t)n instanceof Yy?(s.La.addReference(n.key,e),JS(s,n)):n instanceof Xy?(pe("SyncEngine","Document no longer in limbo: "+n.key),s.La.removeReference(n.key,e),s.La.containsKey(n.key)||nb(s,n.key)):De()}function JS(s,e){const t=e.key,n=t.path.canonicalString();s.Oa.get(t)||s.xa.has(n)||(pe("SyncEngine","New document in limbo: "+t),s.xa.add(n),$u(s))}function $u(s){for(;s.xa.size>0&&s.Oa.size<s.maxConcurrentLimboResolutions;){const e=s.xa.values().next().value;s.xa.delete(e);const t=new Ee(ot.fromString(e)),n=s.qa.next();s.Na.set(n,new FS(t)),s.Oa=s.Oa.insert(t,n),Gy(s.remoteStore,new Us(bs(Rl(t.path)),n,"TargetPurposeLimboResolution",ps.oe))}}async function Gl(s,e,t){const n=Ge(s),r=[],i=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((l,c)=>{o.push(n.Ka(c,e,t).then(u=>{var h;if((u||t)&&n.isPrimaryClient){const m=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;n.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(u){r.push(u);const m=Ru.Wi(c.targetId,u);i.push(m)}}))}),await Promise.all(o),n.Ca.d_(r),await async function(c,u){const h=Ge(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>J.forEach(u,p=>J.forEach(p.$i,N=>h.persistence.referenceDelegate.addReference(m,p.targetId,N)).next(()=>J.forEach(p.Ui,N=>h.persistence.referenceDelegate.removeReference(m,p.targetId,N)))))}catch(m){if(!Sn(m))throw m;pe("LocalStore","Failed to update sequence numbers: "+m)}for(const m of u){const p=m.targetId;if(!m.fromCache){const N=h.os.get(p),v=N.snapshotVersion,I=N.withLastLimboFreeSnapshotVersion(v);h.os=h.os.insert(p,I)}}}(n.localStore,i))}async function QS(s,e){const t=Ge(s);if(!t.currentUser.isEqual(e)){pe("SyncEngine","User change. New user:",e.toKey());const n=await Fy(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(l=>{l.forEach(c=>{c.reject(new je(ue.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Gl(t,n.hs)}}function YS(s,e){const t=Ge(s),n=t.Na.get(e);if(n&&n.va)return Qe().add(n.key);{let r=Qe();const i=t.Ma.get(e);if(!i)return r;for(const o of i){const l=t.Fa.get(o);r=r.unionWith(l.view.Va)}return r}}function rb(s){const e=Ge(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=eb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=YS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=WS.bind(null,e),e.Ca.d_=DS.bind(null,e.eventManager),e.Ca.$a=VS.bind(null,e.eventManager),e}function XS(s){const e=Ge(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=KS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=HS.bind(null,e),e}class fi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ul(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Oy(this.persistence,new Ly,e.initialUser,this.serializer)}Ga(e){return new My($l.Zr,this.serializer)}Wa(e){return new Uy}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fi.provider={build:()=>new fi};class ZS extends fi{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await XS(this.Ja.syncEngine),await zl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Oy(this.persistence,new Ly,e.initialUser,this.serializer)}ja(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new OT(n,e.asyncQueue,t)}Ha(e,t){const n=new uI(t,this.persistence);return new dI(e.asyncQueue,n)}Ga(e){const t=eS(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?ss.withCacheSize(this.cacheSizeBytes):ss.DEFAULT;return new Cu(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,mS(),Lo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Uy}}class ol{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>mg(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=QS.bind(null,this.syncEngine),await AS(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new PS}()}createDatastore(e){const t=Ul(e.databaseInfo.databaseId),n=function(i){return new hS(i)}(e.databaseInfo);return function(i,o,l,c){return new pS(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,r,i,o,l){return new yS(n,r,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>mg(this.syncEngine,t,0),function(){return lg.D()?new lg:new cS}())}createSyncEngine(e,t){return function(r,i,o,l,c,u,h){const m=new $S(r,i,o,l,c,u);return h&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=Ge(r);pe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ui(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ol.provider={build:()=>new ol};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eA{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Qt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=zt.UNAUTHENTICATED,this.clientId=Cx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async o=>{pe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(pe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Yn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Qy(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Tc(s,e){s.asyncQueue.verifyOperationInProgress(),pe("FirestoreClient","Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener(async r=>{n.isEqual(r)||(await Fy(e.localStore,r),n=r)}),e.persistence.setDatabaseDeletedListener(()=>s.terminate()),s._offlineComponents=e}async function gg(s,e){s.asyncQueue.verifyOperationInProgress();const t=await sA(s);pe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener(n=>cg(e.remoteStore,n)),s.setAppCheckTokenChangeListener((n,r)=>cg(e.remoteStore,r)),s._onlineComponents=e}async function sA(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){pe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Tc(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===ue.FAILED_PRECONDITION||r.code===ue.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;ar("Error using user provided cache. Falling back to memory cache: "+t),await Tc(s,new fi)}}else pe("FirestoreClient","Using default OfflineComponentProvider"),await Tc(s,new fi);return s._offlineComponents}async function nA(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(pe("FirestoreClient","Using user provided OnlineComponentProvider"),await gg(s,s._uninitializedComponentsProvider._online)):(pe("FirestoreClient","Using default OnlineComponentProvider"),await gg(s,new ol))),s._onlineComponents}async function pg(s){const e=await nA(s),t=e.eventManager;return t.onListen=US.bind(null,e.syncEngine),t.onUnlisten=GS.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=BS.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=qS.bind(null,e.syncEngine),t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ab(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xg=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(s,e,t){if(!t)throw new je(ue.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function rA(s,e,t,n){if(e===!0&&n===!0)throw new je(ue.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function yg(s){if(!Ee.isDocumentKey(s))throw new je(ue.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function bg(s){if(Ee.isDocumentKey(s))throw new je(ue.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function ql(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":De()}function qa(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new je(ue.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ql(s);throw new je(ue.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new je(ue.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new je(ue.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}rA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ab((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new je(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new je(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new je(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,r){return n.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wl{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vg({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new je(ue.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new je(ue.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vg(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new XE;switch(n.type){case"firstParty":return new sI(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new je(ue.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=xg.get(t);n&&(pe("ComponentProvider","Removing Datastore"),xg.delete(t),n.terminate())}(this),Promise.resolve()}}function aA(s,e,t,n={}){var r;const i=(s=qa(s,Wl))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&ar("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),s._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),n.mockUserToken){let l,c;if(typeof n.mockUserToken=="string")l=n.mockUserToken,c=zt.MOCK_USER;else{l=d_(n.mockUserToken,(r=s._app)===null||r===void 0?void 0:r.options.projectId);const u=n.mockUserToken.sub||n.mockUserToken.user_id;if(!u)throw new je(ue.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new zt(u)}s._authCredentials=new ZE(new Px(l,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gr(this.firestore,e,this._query)}}class ds{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ds(this.firestore,e,this._key)}}class xn extends gr{constructor(e,t,n){super(e,t,Rl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ds(this.firestore,null,new Ee(e))}withConverter(e){return new xn(this.firestore,e,this._path)}}function Wa(s,e,...t){if(s=us(s),ib("collection","path",e),s instanceof Wl){const n=ot.fromString(e,...t);return bg(n),new xn(s,null,n)}{if(!(s instanceof ds||s instanceof xn))throw new je(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(ot.fromString(e,...t));return bg(n),new xn(s.firestore,null,n)}}function ll(s,e,...t){if(s=us(s),arguments.length===1&&(e=Cx.newId()),ib("doc","path",e),s instanceof Wl){const n=ot.fromString(e,...t);return yg(n),new ds(s,null,new Ee(n))}{if(!(s instanceof ds||s instanceof xn))throw new je(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(ot.fromString(e,...t));return yg(n),new ds(s.firestore,s instanceof xn?s.converter:null,new Ee(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new By(this,"async_queue_retry"),this.Vu=()=>{const n=Lo();n&&pe("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Lo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Lo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Yn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Sn(e))throw e;pe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const r=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(n);throw Qt("INTERNAL UNHANDLED ERROR: ",r),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=Ou.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(r),r}fu(){this.Eu&&De()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Ng(s){return function(t,n){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of n)if(i in r&&typeof r[i]=="function")return!0;return!1}(s,["next","error","complete"])}class cl extends Wl{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new wg,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new wg(e),this._firestoreClient=void 0,await e}}}function iA(s,e){const t=typeof s=="object"?s:U0(),n=typeof s=="string"?s:"(default)",r=au(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const i=l_("firestore");i&&aA(r,...i)}return r}function oA(s){if(s._terminated)throw new je(ue.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||ob(s),s._firestoreClient}function ob(s){var e,t,n;const r=s._freezeSettings(),i=function(l,c,u,h){return new RI(l,c,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,ab(h.experimentalLongPollingOptions),h.useFetchStreams)}(s._databaseId,((e=s._app)===null||e===void 0?void 0:e.options.appId)||"",s._persistenceKey,r);s._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=r.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(s._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),s._firestoreClient=new tA(s._authCredentials,s._appCheckCredentials,s._queue,i,s._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(s._componentsProvider))}function lA(s,e){ar("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=s._freezeSettings();return cA(s,ol.provider,{build:n=>new ZS(n,t.cacheSizeBytes,void 0)}),Promise.resolve()}function cA(s,e,t){if((s=qa(s,cl))._firestoreClient||s._terminated)throw new je(ue.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(s._componentsProvider||s._getSettings().localCache)throw new je(ue.FAILED_PRECONDITION,"SDK cache is already specified.");s._componentsProvider={_online:e,_offline:t},ob(s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Zr(Mt.fromBase64String(e))}catch(t){throw new je(ue.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Zr(Mt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new je(ue.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new je(ue.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new je(ue.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return qe(this._lat,e._lat)||qe(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bu{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,r){if(n.length!==r.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==r[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dA=/^__.*__$/;function db(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw De()}}class zu{constructor(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new zu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Id(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(db(this.Cu)&&dA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class uA{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ul(e)}Qu(e,t,n,r=!1){return new zu({Cu:e,methodName:t,qu:n,path:Et.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hA(s){const e=s._freezeSettings(),t=Ul(s._databaseId);return new uA(s._databaseId,!!e.ignoreUndefinedProperties,t)}function mA(s,e,t,n=!1){return Gu(t,s.Qu(n?4:3,e))}function Gu(s,e){if(ub(s=us(s)))return gA("Unsupported field value:",e,s),fA(s,e);if(s instanceof cb)return function(n,r){if(!db(r.Cu))throw r.Bu(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,r){const i=[];let o=0;for(const l of n){let c=Gu(l,r.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(s,e)}return function(n,r){if((n=us(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return eT(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=It.fromDate(n);return{timestampValue:Yr(r.serializer,i)}}if(n instanceof It){const i=new It(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Yr(r.serializer,i)}}if(n instanceof Uu)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Zr)return{bytesValue:fy(r.serializer,n._byteString)};if(n instanceof ds){const i=r.databaseId,o=n.firestore._databaseId;if(!o.isEqual(i))throw r.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Su(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof Bu)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw l.Bu("VectorValues must only contain numeric values.");return Nu(l.serializer,c)})}}}}}}(n,r);throw r.Bu(`Unsupported field value: ${ql(n)}`)}(s,e)}function fA(s,e){const t={};return Bx(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mi(s,(n,r)=>{const i=Gu(r,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function ub(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof It||s instanceof Uu||s instanceof Zr||s instanceof ds||s instanceof cb||s instanceof Bu)}function gA(s,e,t){if(!ub(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const n=ql(t);throw n==="an object"?e.Bu(s+" a custom object"):e.Bu(s+" "+n)}}const pA=new RegExp("[~\\*/\\[\\]]");function xA(s,e,t){if(e.search(pA)>=0)throw Id(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new lb(...e.split("."))._internalPath}catch{throw Id(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function Id(s,e,t,n,r){const i=n&&!n.isEmpty(),o=r!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${n}`),o&&(c+=` in document ${r}`),c+=")"),new je(ue.INVALID_ARGUMENT,l+s+c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ds(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new yA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Kl("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class yA extends hb{data(){return super.data()}}function Kl(s,e){return typeof e=="string"?xA(s,e):e instanceof lb?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bA(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new je(ue.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class qu{}class mb extends qu{}function Ka(s,e,...t){let n=[];e instanceof qu&&n.push(e),n=n.concat(t),function(i){const o=i.filter(c=>c instanceof Wu).length,l=i.filter(c=>c instanceof Hl).length;if(o>1||o>0&&l>0)throw new je(ue.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)s=r._apply(s);return s}class Hl extends mb{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Hl(e,t,n)}_apply(e){const t=this._parse(e);return fb(e._query,t),new gr(e.firestore,e.converter,fd(e._query,t))}_parse(e){const t=hA(e.firestore);return function(i,o,l,c,u,h,m){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new je(ue.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){jg(m,h);const N=[];for(const v of m)N.push(_g(c,i,v));p={arrayValue:{values:N}}}else p=_g(c,i,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||jg(m,h),p=mA(l,o,m,h==="in"||h==="not-in");return Xe.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function vA(s,e,t){const n=e,r=Kl("where",s);return Hl._create(r,n,t)}class Wu extends qu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wu(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:lt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,i){let o=r;const l=i.getFlattenedFilters();for(const c of l)fb(o,c),o=fd(o,c)}(e._query,t),new gr(e.firestore,e.converter,fd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ku extends mb{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ku(e,t)}_apply(e){const t=function(r,i,o){if(r.startAt!==null)throw new je(ue.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new je(ue.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ui(i,o)}(e._query,this._field,this._direction);return new gr(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new ca(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function dl(s,e="asc"){const t=e,n=Kl("orderBy",s);return Ku._create(n,t)}function _g(s,e,t){if(typeof(t=us(t))=="string"){if(t==="")throw new je(ue.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zx(e)&&t.indexOf("/")!==-1)throw new je(ue.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ot.fromString(t));if(!Ee.isDocumentKey(n))throw new je(ue.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ci(s,new Ee(n))}if(t instanceof ds)return ci(s,t._key);throw new je(ue.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ql(t)}.`)}function jg(s,e){if(!Array.isArray(s)||s.length===0)throw new je(ue.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function fb(s,e){const t=function(r,i){for(const o of r)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(s.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new je(ue.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new je(ue.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class wA{convertValue(e,t="none"){switch(or(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw De()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Mi(e,(r,i)=>{n[r]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,r;const i=(r=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||r===void 0?void 0:r.map(o=>gt(o.doubleValue));return new Bu(i)}convertGeoPoint(e){return new Uu(gt(e.latitude),gt(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=vu(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(oi(e));default:return null}}convertTimestamp(e){const t=Ws(e);return new It(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ot.fromString(e);Le(jy(n));const r=new ir(n.get(1),n.get(3)),i=new Ee(n.popFirst(5));return r.isEqual(t)||Qt(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class gb extends hb{constructor(e,t,n,r,i,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Oo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Kl("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Oo extends gb{data(e={}){return super.data(e)}}class NA{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ma(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Oo(this._firestore,this._userDataWriter,n.key,n,new Ma(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new je(ue.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(l=>{const c=new Oo(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Ma(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Oo(r._firestore,r._userDataWriter,l.doc.key,l.doc,new Ma(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,h=-1;return l.type!==0&&(u=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),h=o.indexOf(l.doc.key)),{type:_A(l.type),doc:c,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function _A(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return De()}}class pb extends wA{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ds(this.firestore,null,t)}}function Vs(s,...e){var t,n,r;s=us(s);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Ng(e[o])||(i=e[o],o++);const l={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Ng(e[o])){const m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(n=m.error)===null||n===void 0?void 0:n.bind(m),e[o+2]=(r=m.complete)===null||r===void 0?void 0:r.bind(m)}let c,u,h;if(s instanceof ds)u=qa(s.firestore,cl),h=Rl(s._key.path),c={next:m=>{e[o]&&e[o](jA(u,s,m))},error:e[o+1],complete:e[o+2]};else{const m=qa(s,gr);u=qa(m.firestore,cl),h=m._query;const p=new pb(u);c={next:N=>{e[o]&&e[o](new NA(u,p,m,N))},error:e[o+1],complete:e[o+2]},bA(s._query)}return function(p,N,v,I){const g=new eA(I),S=new MS(N,g,v);return p.asyncQueue.enqueueAndForget(async()=>CS(await pg(p),S)),()=>{g.Za(),p.asyncQueue.enqueueAndForget(async()=>RS(await pg(p),S))}}(oA(u),h,l,c)}function jA(s,e,t){const n=t.docs.get(e._key),r=new pb(s);return new gb(s,r,e._key,n,new Ma(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(r){la=r})(ia),zr(new sr("firestore",(n,{instanceIdentifier:r,options:i})=>{const o=n.getProvider("app").getImmediate(),l=new cl(new eI(n.getProvider("auth-internal")),new rI(n.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new je(ue.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ir(u.options.projectId,h)}(o,r),o);return i=Object.assign({useFetchStreams:t},i),l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),fn(gf,"4.7.3",e),fn(gf,"4.7.3","esm2017")})();const Sc={apiKey:"AIzaSyDCiXnLj23Iqf9tfNMT1vrIenN5agia_h8",authDomain:"fitfix-database.firebaseapp.com",projectId:"fitfix-database",storageBucket:"fitfix-database.appspot.com",messagingSenderId:"986603435194",appId:"1:986603435194:web:7ef360f7bc6a663f5abe83"};let xo=null,ls=null,Dt=null;try{if(Sc.apiKey&&Sc.apiKey.trim()!==""){const s=_j();s.length>0?xo=s[0]:xo=$0(Sc),ls=QE(xo),Dt=iA(xo),typeof window<"u"&&setTimeout(()=>{lA(Dt).then(()=>{console.log(" Firestore persistence enabled")}).catch(e=>{e.code==="failed-precondition"?console.warn(" Firestore persistence: Multiple tabs open. Only one tab can have persistence enabled."):e.code==="unimplemented"?console.warn(" Firestore persistence not supported in this browser"):console.warn(" Firestore persistence disabled (non-critical):",e.message||e.code||"Unknown error")})},500),console.log(" Firebase initialized successfully")}else console.warn(" Firebase config not found. Phone authentication will not work. Please set VITE_FIREBASE_* environment variables."),ls=null,Dt=null}catch(s){console.error(" Firebase initialization error:",s),ls=null,Dt=null}const EA=(s="recaptcha-container")=>{if(!ls)throw new Error("Firebase Auth is not initialized. Please configure Firebase environment variables.");return new Q2(ls,s,{size:"invisible",callback:()=>{},"expired-callback":()=>{console.error("reCAPTCHA expired")}})},IA=({children:s})=>{const e=ft(),t=Tn(),[n,r]=_.useState(!0);return _.useEffect(()=>{let i=null;return(()=>{try{const l=localStorage.getItem("token"),c=localStorage.getItem("user");if(l&&c)try{const u=JSON.parse(c);if(u&&u.role){const h=u.role;if(t.pathname==="/login"||t.pathname==="/"){if(h==="admin")e("/admin",{replace:!0});else if(h==="employee"){const m=u.uid||"";e(`/employee/${m}`,{replace:!0})}else h==="user"&&e("/dashboard",{replace:!0});r(!1);return}r(!1);return}else localStorage.removeItem("token"),localStorage.removeItem("user")}catch(u){console.error("Error parsing user data:",u),localStorage.removeItem("token"),localStorage.removeItem("user")}ls?i=ls.onAuthStateChanged(u=>{if(u){const h=localStorage.getItem("user");if(h)try{const m=JSON.parse(h);if(m&&m.role){const p=m.role;if(t.pathname==="/login"||t.pathname==="/"){if(p==="admin")e("/admin",{replace:!0});else if(p==="employee"){const N=m.uid||u.uid;e(`/employee/${N}`,{replace:!0})}else p==="user"&&e("/dashboard",{replace:!0});r(!1);return}r(!1);return}}catch(m){console.error("Error parsing user data:",m)}}t.pathname!=="/login"&&t.pathname!=="/contact-admin"&&t.pathname!=="/forgot-password"&&!t.pathname.startsWith("/employee/payment-success")&&e("/login",{replace:!0}),r(!1)}):(t.pathname!=="/login"&&t.pathname!=="/contact-admin"&&t.pathname!=="/forgot-password"&&!t.pathname.startsWith("/employee/payment-success")&&e("/login",{replace:!0}),r(!1))}catch(l){console.error("Auth check error:",l),t.pathname!=="/login"&&e("/login",{replace:!0}),r(!1)}})(),()=>{i&&i()}},[e,t.pathname]),n?null:a.jsx(a.Fragment,{children:s})};var xb={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Eg=Kn.createContext&&Kn.createContext(xb),yn=function(){return yn=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r])}return s},yn.apply(this,arguments)},TA=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t};function yb(s){return s&&s.map(function(e,t){return Kn.createElement(e.tag,yn({key:t},e.attr),yb(e.child))})}function Ue(s){return function(e){return Kn.createElement(SA,yn({attr:yn({},s.attr)},e),yb(s.child))}}function SA(s){var e=function(t){var n=s.attr,r=s.size,i=s.title,o=TA(s,["attr","size","title"]),l=r||t.size||"1em",c;return t.className&&(c=t.className),s.className&&(c=(c?c+" ":"")+s.className),Kn.createElement("svg",yn({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,o,{className:c,style:yn(yn({color:s.color||t.color},t.style),s.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&Kn.createElement("title",null,i),s.children)};return Eg!==void 0?Kn.createElement(Eg.Consumer,null,function(t){return e(t)}):e(xb)}function Td(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"22 12 18 12 15 21 9 3 6 12 2 12"}}]})(s)}function AA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"polyline",attr:{points:"19 12 12 19 5 12"}}]})(s)}function kA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"}},{tag:"polyline",attr:{points:"12 19 5 12 12 5"}}]})(s)}function PA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 16 16 12 12 8"}},{tag:"line",attr:{x1:"8",y1:"12",x2:"16",y2:"12"}}]})(s)}function CA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"19",x2:"12",y2:"5"}},{tag:"polyline",attr:{points:"5 12 12 5 19 12"}}]})(s)}function RA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(s)}function Hu(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(s)}function bb(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(s)}function js(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"}}]})(s)}function Jl(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"}}]})(s)}function gi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"}}]})(s)}function Sd(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"18 15 12 9 6 15"}}]})(s)}function Ad(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}},{tag:"rect",attr:{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"}}]})(s)}function Ac(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(s)}function hr(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8h1a4 4 0 0 1 0 8h-1"}},{tag:"path",attr:{d:"M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"}},{tag:"line",attr:{x1:"6",y1:"1",x2:"6",y2:"4"}},{tag:"line",attr:{x1:"10",y1:"1",x2:"10",y2:"4"}},{tag:"line",attr:{x1:"14",y1:"1",x2:"14",y2:"4"}}]})(s)}function Ig(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}},{tag:"path",attr:{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"}}]})(s)}function vb(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"23"}},{tag:"path",attr:{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"}}]})(s)}function is(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}}]})(s)}function Ju(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(s)}function wb(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}}]})(s)}function Nb(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}},{tag:"polyline",attr:{points:"9 22 9 12 15 12 15 22"}}]})(s)}function pi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(s)}function Tg(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"}}]})(s)}function xi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}},{tag:"path",attr:{d:"M7 11V7a5 5 0 0 1 10 0v4"}}]})(s)}function Qu(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}},{tag:"polyline",attr:{points:"22,6 12,13 2,6"}}]})(s)}function kc(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"3",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"21",y2:"18"}}]})(s)}function Bs(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"}}]})(s)}function DA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}}]})(s)}function kt(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(s)}function yi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"}},{tag:"polyline",attr:{points:"1 20 1 14 7 14"}},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"}}]})(s)}function VA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}},{tag:"polyline",attr:{points:"17 21 17 13 7 13 7 21"}},{tag:"polyline",attr:{points:"7 3 7 8 15 8"}}]})(s)}function Nn(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"}},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}}]})(s)}function bi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"}},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"}}]})(s)}function _b(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(s)}function MA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}}]})(s)}function ul(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"path",attr:{d:"M8 14s1.5 2 4 2 4-2 4-2"}},{tag:"line",attr:{x1:"9",y1:"9",x2:"9.01",y2:"9"}},{tag:"line",attr:{x1:"15",y1:"9",x2:"15.01",y2:"9"}}]})(s)}function LA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"6"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"2"}}]})(s)}function OA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"1",y:"5",width:"22",height:"14",rx:"7",ry:"7"}},{tag:"circle",attr:{cx:"8",cy:"12",r:"3"}}]})(s)}function FA(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"1",y:"5",width:"22",height:"14",rx:"7",ry:"7"}},{tag:"circle",attr:{cx:"16",cy:"12",r:"3"}}]})(s)}function xt(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(s)}function $A(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 6 13.5 15.5 8.5 10.5 1 18"}},{tag:"polyline",attr:{points:"17 6 23 6 23 12"}}]})(s)}function Sg(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(s)}function hl(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(s)}function Bi(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"}}]})(s)}function es(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(s)}function Fr(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"15",y1:"9",x2:"9",y2:"15"}},{tag:"line",attr:{x1:"9",y1:"9",x2:"15",y2:"15"}}]})(s)}function mt(s){return Ue({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(s)}const UA=[{key:"dashboard",label:"Dashboard",icon:a.jsx(Nb,{}),path:"/admin-dashboard"},{key:"employees",label:"Employee",icon:a.jsx(es,{}),path:"/admin/employees"},{key:"employeeRequests",label:"Employee Requests",icon:a.jsx(Ad,{}),path:"/admin/employee-requests"},{key:"subscriptions",label:"Subscriptions",icon:a.jsx(Hu,{}),path:"/admin/subscriptions"},{key:"payments",label:"Payments",icon:a.jsx(vb,{}),path:"/payments/admin"},{key:"chat",label:"Chat",icon:a.jsx(Bs,{}),path:"/admin/chat"},{key:"settings",label:"Settings",icon:a.jsx(_b,{}),path:"/settings"}],_n=()=>{const s=ft(),e=Tn(),{isDarkMode:t,toggleTheme:n}=Tt(),[r,i]=_.useState(()=>JSON.parse(localStorage.getItem("user")||"{}"));_.useEffect(()=>{const h=()=>{const m=JSON.parse(localStorage.getItem("user")||"{}");i(m)};return window.addEventListener("storage",h),window.addEventListener("profileUpdated",h),()=>{window.removeEventListener("storage",h),window.removeEventListener("profileUpdated",h)}},[]);const o=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s("/login")},l=h=>{h&&h!=="#"&&s(h)},u=(()=>{const h=e.pathname;return h==="/admin-dashboard"?"dashboard":h==="/admin/employees"?"employees":h==="/admin/employee-requests"?"employeeRequests":h==="/admin/subscriptions"?"subscriptions":h==="/payments/admin"?"payments":h==="/admin/chat"?"chat":h==="/settings"?"settings":"dashboard"})();return a.jsxs("aside",{className:`w-64 rounded-r-[32px] p-6 flex flex-col gap-10 transition-colors ${t?"bg-[#0f111f]":"bg-white border-r border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[r.photoURL?a.jsx("img",{src:r.photoURL,alt:"avatar",className:`w-14 h-14 rounded-2xl object-cover border ${t?"border-white/10":"border-gray-200"}`,onError:h=>{h.target.style.display="none",h.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br from-[#1f36ff] to-[#15b5ff] flex items-center justify-center text-white font-bold text-lg border ${t?"border-white/10":"border-gray-200"} ${r.photoURL?"hidden":""}`,children:(r.displayName||r.email||"A")[0].toUpperCase()}),a.jsxs("div",{children:[a.jsx("p",{className:`font-semibold text-lg ${t?"text-white":"text-gray-900"}`,children:r.displayName||"Admin"}),a.jsx("span",{className:`text-xs ${t?"text-white/60":"text-gray-500"}`,children:"Administrator"})]})]}),a.jsx("nav",{className:"flex flex-col gap-4",children:UA.map(({key:h,label:m,icon:p,path:N})=>a.jsxs("button",{onClick:()=>l(N),className:`flex items-center gap-3 text-sm font-semibold px-4 py-3 rounded-2xl transition ${u===h?"bg-[#1f36ff] text-white shadow-lg shadow-blue-900/40":t?"text-white/70 hover:bg-white/5":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("span",{className:"text-lg",children:p}),m]},h))}),a.jsx("div",{className:"mt-auto",children:a.jsxs("button",{onClick:n,className:`w-full flex items-center justify-between text-xs p-3 rounded-2xl transition ${t?"bg-white/5 hover:bg-white/10":"bg-gray-100 hover:bg-gray-200"}`,children:[a.jsx("span",{className:t?"text-white/60":"text-gray-600",children:"Light"}),a.jsx("div",{className:`flex items-center gap-2 rounded-full px-3 py-1 text-xs transition-all ${t?"bg-[#1f36ff] text-white":"bg-gray-300 text-gray-700"}`,children:a.jsx("span",{children:"Dark"})})]})}),a.jsx("button",{onClick:o,className:"mt-4 px-4 py-2 bg-red-600/80 hover:bg-red-600 text-white rounded-2xl transition-colors font-medium text-sm",children:"Logout"})]})},jb=(s="admin",e=null)=>{const[t,n]=_.useState(()=>{const h=s==="admin"?"adminDashboardCache":`employeeDashboardCache_${e||""}`,m=localStorage.getItem(h);if(m)try{return{...JSON.parse(m),loading:!1,fromCache:!0}}catch(p){console.warn("Failed to parse cached dashboard data:",p)}return s==="admin"?{stats:{totalEmployees:0,totalPayments:0,totalPaymentAmount:0,loading:!1},weeklyStats:{Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0},employeeActivity:{active:0,inactive:0},pendingNotifications:0,pendingRequests:[],employees:[],users:[],userPayments:[],employeePayments:[],loading:!1,fromCache:!1}:{assignedUsers:[],stats:{totalUsers:0,activeUsers:0,totalProgressEntries:0,loading:!1},weeklyStats:{Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0},userActivity:{active:0,inactive:0},loading:!1,fromCache:!1}}),r=_.useRef([]),i=_.useRef(!0),o=h=>{const m=s==="admin"?"adminDashboardCache":`employeeDashboardCache_${e||""}`;try{localStorage.setItem(m,JSON.stringify({...h,fromCache:void 0,loading:void 0,cachedAt:Date.now()}))}catch(p){console.warn("Failed to save to cache:",p)}},l=(h,m)=>{if(m==="admin"){const{employees:p=[],userPayments:N=[],employeePayments:v=[],users:I=[],employeeRequests:g=[]}=h,S=p.length,C=p.filter(W=>W.isActive===!0).length,T=p.filter(W=>W.isActive===!1).length,V=N.length+v.length,P=N.filter(W=>W.status==="completed").reduce((W,se)=>W+(se.amount||0),0),k=v.filter(W=>W.paid===!0).reduce((W,se)=>W+(se.amount||0),0),b=P+k,x=g.filter(W=>W.status==="pending"),w=v.filter(W=>!W.accountCreated).length,E=x.length,A=w+E,D=new Date,j=new Date(D);j.setDate(D.getDate()-D.getDay());const K={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0},X=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return I.forEach(W=>{if(W.createdAt){const se=W.createdAt.seconds?new Date(W.createdAt.seconds*1e3):new Date(W.createdAt);if(se>=j&&se<=D){const M=se.getDay(),L=X[M];K[L]++}}}),{stats:{totalEmployees:S,totalPayments:V,totalPaymentAmount:b,loading:!1},weeklyStats:K,employeeActivity:{active:C,inactive:T},pendingNotifications:A,pendingRequests:x.slice(0,5),employees:p,users:I,userPayments:N,employeePayments:v,employeeRequests:g}}else{const{assignedUsers:p=[]}=h,N=p.filter(V=>V.isActive!==!1).length,v=p.filter(V=>V.isActive===!1).length,I=new Date,g=new Date(I);g.setDate(I.getDate()-I.getDay());const S={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0},C=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];p.forEach(V=>{if((!V.signupMethod||V.signupMethod==="mobile")&&V.createdAt){const k=V.createdAt.seconds?new Date(V.createdAt.seconds*1e3):new Date(V.createdAt);if(k>=g&&k<=I){const b=k.getDay(),x=C[b];S[x]++}}});const T=p.reduce((V,P)=>V+(P.progressEntriesCount||0),0);return{assignedUsers:p,stats:{totalUsers:p.length,activeUsers:N,totalProgressEntries:T,loading:!1},weeklyStats:S,userActivity:{active:N,inactive:v}}}},c=async()=>{try{const h=localStorage.getItem("token");if(!h)return;const m={headers:{Authorization:`Bearer ${h}`}};if(s==="admin"){const[p,N,v,I,g]=await Promise.all([ce.get("http://localhost:3000/api/admin/employees",m),ce.get("http://localhost:3000/api/payments/all",m),ce.get("http://localhost:3000/api/employee-payments/all",m),ce.get("http://localhost:3000/api/employee-requests",m),ce.get("http://localhost:3000/api/admin/users",m)]),S={employees:p.data.data||[],userPayments:N.data.data||[],employeePayments:v.data.data||[],employeeRequests:I.data.data||[],users:g.data.data||[]},C=l(S,"admin");i.current&&(n({...C,loading:!1,fromCache:!1}),o(C))}else{const p=await ce.get("http://localhost:3000/api/employee/users",m);if(p.data.success){const N=p.data.data||[],I={assignedUsers:await Promise.all(N.map(async S=>{var C;try{const T=await ce.get(`http://localhost:3000/api/employee/users/${S.uid}/progress`,m);return{...S,progressEntriesCount:T.data.success&&((C=T.data.data)==null?void 0:C.length)||0}}catch{return{...S,progressEntriesCount:0}}}))},g=l(I,"employee");i.current&&(n({...g,loading:!1,fromCache:!1}),o(g))}}}catch(h){console.error("API fallback error:",h)}},u=()=>{if(!Dt){c();return}c()};return _.useEffect(()=>(i.current=!0,u(),()=>{i.current=!1,r.current.forEach(h=>{try{typeof h=="function"&&Dt&&h()}catch(m){console.warn("Error cleaning up Firestore listener (non-critical):",m.message)}}),r.current=[]}),[s,e]),{...t,refresh:()=>{const h=s==="admin"?"adminDashboardCache":`employeeDashboardCache_${e||""}`;localStorage.removeItem(h),u()}}},BA=`
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
`,Ag=()=>{JSON.parse(localStorage.getItem("user")||"{}");const s=ft(),{isDarkMode:e}=Tt(),[t,n]=_.useState(!1),[r,i]=_.useState(null),{stats:o,weeklyStats:l,employeeActivity:c,pendingNotifications:u,pendingRequests:h}=jb("admin");return _.useEffect(()=>{if(!localStorage.getItem("token")){s("/login");return}const p=()=>{console.log("Employee approved event received")};return window.addEventListener("employeeApproved",p),()=>{window.removeEventListener("employeeApproved",p)}},[s]),a.jsxs(a.Fragment,{children:[a.jsx("style",{children:BA}),a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsxs("main",{className:"flex-1 px-10 py-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),r&&a.jsxs("div",{className:"mt-2 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm",children:[" ",r]})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:()=>n(!t),className:"relative w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 active:scale-95 transition-all duration-200 flex items-center justify-center hover:shadow-lg hover:shadow-white/10",children:[a.jsx(RA,{className:"text-lg transition-transform duration-200 hover:rotate-12"}),u>0&&a.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs font-bold animate-pulse",children:u})]}),a.jsx("button",{className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 active:scale-95 transition-all duration-200 flex items-center justify-center hover:shadow-lg hover:shadow-white/10",children:a.jsx(Bs,{className:"text-lg transition-transform duration-200 hover:scale-110"})})]})]}),t&&a.jsxs("div",{className:"fixed top-20 right-10 w-96 bg-[#111324] border border-white/10 rounded-2xl shadow-2xl z-50 max-h-[500px] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[a.jsx("h3",{className:"font-bold text-white",children:"Employee Requests"}),a.jsx("button",{onClick:()=>n(!1),className:"text-white/60 hover:text-white",children:""})]}),a.jsx("div",{className:"overflow-y-auto flex-1 p-4 space-y-3",children:u===0?a.jsx("p",{className:"text-white/60 text-sm text-center py-8",children:"No pending requests"}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-emerald-400 text-sm font-semibold mb-3",children:[u," pending request",u>1?"s":""]}),h.length>0&&a.jsxs("div",{className:"space-y-2",children:[h.map(m=>a.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-3 hover:bg-white/10 hover:border-white/20 hover:shadow-lg hover:shadow-white/5 hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 cursor-pointer",onClick:()=>{n(!1),s("/admin/employee-requests")},children:[a.jsx("p",{className:"text-white font-semibold text-sm",children:m.fullName}),a.jsx("p",{className:"text-white/60 text-xs mt-1",children:m.email}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("span",{className:"text-xs text-emerald-400",children:m.selectedPlanLabel||m.selectedPlan}),a.jsx("span",{className:"text-xs text-white/40",children:m.createdAt?(()=>{try{return(m.createdAt.seconds?new Date(m.createdAt.seconds*1e3):new Date(m.createdAt)).toLocaleDateString()}catch{return"Just now"}})():"Just now"})]})]},m.id)),h.length<u&&a.jsxs("p",{className:"text-white/40 text-xs text-center py-2",children:["+",u-h.length," more request",u-h.length>1?"s":""]})]})]}),a.jsx("button",{onClick:()=>{n(!1),s("/admin/employee-requests")},className:"w-full bg-[#1f36ff] hover:bg-[#1b2ed1] text-white px-4 py-3 rounded-xl transition-all duration-300 font-medium mt-4 hover:shadow-lg hover:shadow-[#1f36ff]/40 hover:-translate-y-0.5 active:scale-[0.98]",children:"View All Requests"})]})})]}),a.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[a.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[a.jsxs("section",{className:"bg-gradient-to-r from-[#f8eedf] to-[#fbe3d3] rounded-[32px] p-6 flex flex-col lg:flex-row gap-6 text-[#111324] opacity-0 animate-[fadeIn_0.6s_ease-out_0.1s_forwards] hover:shadow-2xl hover:shadow-[#f8eedf]/20 transition-all duration-300 hover:-translate-y-1",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-semibold mb-2 tracking-wide",children:"Welcome back!"}),a.jsx("h2",{className:"text-3xl font-black leading-tight tracking-tight",children:"Ready to add employee?"}),a.jsx("p",{className:"text-sm text-black/60 mt-3 leading-relaxed",children:"Your guidance powers every member's journey"})]}),a.jsx("div",{className:"w-full lg:w-56 h-56 rounded-[28px] overflow-hidden border border-black/5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:a.jsx("img",{src:"/hero-image.png",alt:"athlete",className:"w-full h-full object-cover transition-transform duration-300 hover:scale-110"})})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white/10 rounded-[28px] p-6 backdrop-blur opacity-0 animate-[fadeIn_0.6s_ease-out_0.2s_forwards] hover:bg-white/15 hover:shadow-2xl hover:shadow-[#1f9fff]/20 hover:-translate-y-2 active:scale-[0.98] transition-all duration-300 cursor-pointer border border-white/5 hover:border-white/20",children:[a.jsx("p",{className:"text-sm text-white/70 mb-4 font-medium tracking-wide",children:"Total Employees"}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-5xl font-black leading-none transition-all duration-300 hover:scale-110 inline-block",children:o.totalEmployees}),a.jsx("p",{className:"text-sm text-white/60 mt-2 font-medium",children:"Active coaches"})]}),a.jsx(es,{className:"text-5xl text-[#1f9fff] transition-transform duration-300 hover:scale-110 hover:rotate-12"})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:a.jsx("p",{className:"text-xs text-white/50 font-medium",children:"Updates in real-time"})})]}),a.jsxs("div",{className:"bg-[#1f36ff] rounded-[28px] p-6 text-white opacity-0 animate-[fadeIn_0.6s_ease-out_0.3s_forwards] hover:shadow-2xl hover:shadow-[#1f36ff]/40 hover:-translate-y-2 active:scale-[0.98] transition-all duration-300 cursor-pointer border border-[#1f36ff]/50 hover:border-white/30",children:[a.jsx("p",{className:"text-sm text-white/80 mb-4 font-medium tracking-wide",children:"Total Payments"}),a.jsxs("div",{className:"flex items-end gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-5xl font-black leading-none transition-all duration-300 hover:scale-110 inline-block",children:o.totalPayments}),a.jsxs("span",{className:"text-sm text-white/70 mt-1 block font-medium",children:["$",o.totalPaymentAmount.toFixed(2)," received"]})]}),a.jsx(vb,{className:"text-5xl transition-transform duration-300 hover:scale-110 hover:rotate-12"})]}),a.jsx("div",{className:"mt-6 h-24 rounded-2xl bg-white/15 flex items-end gap-1 p-2",children:Array.from({length:20}).map((m,p)=>a.jsx("span",{className:"flex-1 rounded-full bg-white/70 transition-all duration-300 hover:bg-white/90",style:{height:`${30+p*2}px`}},p))})]})]}),a.jsxs("section",{className:"bg-gradient-to-r from-[#1f36ff] to-[#15b5ff] rounded-[32px] p-6 flex items-center justify-between opacity-0 animate-[fadeIn_0.6s_ease-out_0.4s_forwards] hover:shadow-2xl hover:shadow-[#1f36ff]/30 hover:-translate-y-1 transition-all duration-300",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 font-semibold mb-1",children:"Congrats!"}),a.jsx("h3",{className:"text-2xl font-semibold leading-tight",children:"Your activity is much better than yesterday."})]}),a.jsx("button",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 active:scale-90 transition-all duration-200 hover:rotate-90 hover:shadow-lg",children:""})]})]}),a.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:a.jsxs("section",{className:"bg-[#111324] rounded-[32px] p-6 space-y-6 border border-white/5 opacity-0 animate-[fadeIn_0.6s_ease-out_0.5s_forwards] hover:border-white/10 hover:shadow-2xl hover:shadow-black/20 transition-all duration-300",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 mb-4 font-semibold",children:"User Signups This Week"}),a.jsx("div",{className:"bg-white/5 rounded-2xl p-4 h-48 flex gap-2 items-end",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((m,p)=>{const N=l[m]||0,v=Math.max(...Object.values(l),1),I=N/v*100,g=N>0?20:10,S=Math.max(g,I);return a.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2 group opacity-0 animate-[fadeInUp_0.5s_ease-out_forwards]",style:{animationDelay:`${p*50}ms`},children:[a.jsxs("div",{className:"relative w-full flex items-end justify-center",style:{height:"140px"},children:[a.jsx("div",{className:"w-full rounded-full bg-gradient-to-t from-[#1f36ff] to-[#15b5ff] transition-all duration-300 group-hover:from-[#2547ff] group-hover:to-[#20c5ff] group-hover:shadow-lg group-hover:shadow-[#1f36ff]/40 group-hover:scale-105",style:{height:`${S}%`}}),N>0&&a.jsx("span",{className:"absolute -top-6 text-xs font-bold text-white/90 transition-all duration-300 group-hover:text-white group-hover:scale-110",children:N})]}),a.jsx("span",{className:"text-xs text-white/60 font-medium transition-colors duration-300 group-hover:text-white/80",children:m})]},m)})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 mb-4 font-semibold",children:"Employee Status"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-2xl p-5 flex items-center justify-between hover:bg-emerald-500/20 hover:border-emerald-500/50 hover:shadow-lg hover:shadow-emerald-500/20 hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 cursor-pointer",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110 hover:rotate-12",children:a.jsx(es,{className:"text-emerald-400 text-xl"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-lg font-bold text-white transition-all duration-300 hover:scale-105 inline-block",children:c.active}),a.jsx("p",{className:"text-xs text-white/60 mt-0.5 font-medium",children:"Active Employees"})]})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110",children:a.jsx("span",{className:"text-emerald-400 text-xs font-bold",children:""})})]}),a.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-2xl p-5 flex items-center justify-between hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/20 hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 cursor-pointer",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110 hover:rotate-12",children:a.jsx(es,{className:"text-red-400 text-xl"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-lg font-bold text-white transition-all duration-300 hover:scale-105 inline-block",children:c.inactive}),a.jsx("p",{className:"text-xs text-white/60 mt-0.5 font-medium",children:"Inactive Employees"})]})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110",children:a.jsx("span",{className:"text-red-400 text-xs font-bold",children:""})})]})]})]})]})})]})]})]})]})};function zA(s){return Ue({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"}}]})(s)}function GA(s){return Ue({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"}}]})(s)}function qA(s){return Ue({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 10V3L4 14h7v7l9-11h-7z"}}]})(s)}function WA(s){return Ue({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"}}]})(s)}const KA=[{value:"cash",title:"Pay in Cash",description:"Settle your plan at the club reception.",icon:zA,accent:"from-emerald-500/80 to-teal-500/70"},{value:"omt",title:"OMT Transfer",description:"Send via OMT and upload the receipt.",icon:qA,accent:"from-amber-500/80 to-orange-500/70"},{value:"whatsapp",title:"WhatsApp Confirmation",description:"Share your proof directly with the coach.",icon:GA,accent:"from-purple-500/80 to-pink-500/70"}],HA=()=>{const s=ft(),{showNotification:e}=yt(),[t,n]=_.useState(""),[r,i]=_.useState("cash"),[o,l]=_.useState(!1),[c,u]=_.useState(!1),h=_.useMemo(()=>{try{const N=localStorage.getItem("user");return N?JSON.parse(N):null}catch(N){return console.error("Failed to parse user",N),null}},[]),m=h==null?void 0:h.assignedEmployeeId,p=async N=>{var I,g;if(N.preventDefault(),!m){e({type:"error",message:"No coach assigned to your account yet."});return}const v=Number(t);if(!v||v<=0){e({type:"error",message:"Please enter a valid amount."});return}try{l(!0);const S=localStorage.getItem("token");await ce.post("http://localhost:3000/api/payments/create",{amount:v,method:r,employeeId:m},{headers:{Authorization:`Bearer ${S}`}}),u(!0),e({type:"success",message:"Payment submitted! Awaiting coach approval."}),setTimeout(()=>{s("/payments/success",{state:{amount:v,method:r}})},1200)}catch(S){console.error("Payment submission error:",S);const C=((g=(I=S.response)==null?void 0:I.data)==null?void 0:g.message)||"Unable to submit payment. Please try again.";e({type:"error",message:C})}finally{l(!1)}};return a.jsxs("div",{className:"relative min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[a.jsx("div",{className:"absolute -top-16 -right-10 w-64 h-64 bg-emerald-500/20 blur-[120px] rounded-full animate-pulse"}),a.jsx("div",{className:"absolute bottom-10 -left-10 w-72 h-72 bg-indigo-500/20 blur-[120px] rounded-full animate-pulse delay-300"})]}),a.jsxs("div",{className:"relative max-w-5xl mx-auto px-4 py-16",children:[a.jsxs("header",{className:"text-center mb-12",children:[a.jsx("p",{className:"uppercase tracking-[0.5em] text-xs text-emerald-400 mb-3",children:"Payments"}),a.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight",children:"Fuel Your Fitness Journey"}),a.jsx("p",{className:"text-slate-300 max-w-2xl mx-auto mt-4",children:"Submit your offline payment and let your coach verify it. Every transaction is logged, auditable, and secure."})]}),m?a.jsxs("div",{className:"grid lg:grid-cols-5 gap-10",children:[a.jsxs("form",{onSubmit:p,className:"lg:col-span-3 bg-slate-900/80 border border-slate-800 rounded-3xl p-8 backdrop-blur relative overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 opacity-10 pointer-events-none mix-blend-screen",children:[a.jsx("div",{className:"w-48 h-48 border border-emerald-500/40 rounded-full absolute -right-10 -top-10 animate-spin-slow"}),a.jsx("div",{className:"w-32 h-32 border border-indigo-500/40 rounded-full absolute right-6 top-12 animate-spin-slower"})]}),a.jsxs("div",{className:"relative z-10 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm uppercase tracking-[0.3em] text-slate-400",children:"Amount"}),a.jsxs("div",{className:"mt-2 bg-black/40 border border-slate-800 rounded-2xl flex items-center px-5",children:[a.jsx("span",{className:"text-slate-400 text-lg",children:"$"}),a.jsx("input",{type:"number",min:"1",step:"0.01",value:t,onChange:N=>n(N.target.value),className:"w-full bg-transparent px-3 py-4 text-3xl font-semibold focus:outline-none",placeholder:"0.00"})]}),a.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Enter the exact amount you transferred."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm uppercase tracking-[0.3em] text-slate-400",children:"Method"}),a.jsx("div",{className:"grid sm:grid-cols-3 gap-4 mt-3",children:KA.map(({value:N,title:v,description:I,icon:g,accent:S})=>a.jsxs("button",{type:"button",onClick:()=>i(N),className:`group relative rounded-2xl border p-4 text-left transition-all duration-300 ${r===N?"border-transparent bg-gradient-to-br "+S+" shadow-lg shadow-emerald-500/30":"border-slate-800 bg-black/30 hover:border-emerald-400/40"}`,children:[a.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center mb-3 ${r===N?"bg-black/20":"bg-slate-900/60"}`,children:a.jsx(g,{className:"text-2xl"})}),a.jsx("p",{className:"font-semibold",children:v}),a.jsx("p",{className:"text-sm text-slate-300",children:I}),r===N&&a.jsx("span",{className:"absolute top-4 right-4 text-xs uppercase tracking-[0.3em]",children:"Selected"})]},N))})]}),a.jsxs("button",{type:"submit",disabled:o,className:"w-full mt-6 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 text-black font-semibold rounded-2xl py-4 flex items-center justify-center gap-3 shadow-xl shadow-emerald-500/40 hover:scale-[1.01] transition-all disabled:opacity-60",children:[a.jsx(bi,{className:"text-xl"}),o?"Submitting...":"Submit Payment"]})]})]}),a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/70 border border-slate-800 rounded-3xl p-8 backdrop-blur",children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-emerald-400 mb-3",children:"Coach"}),a.jsx("h3",{className:"text-2xl font-semibold",children:(h==null?void 0:h.assignedEmployeeName)||"Your Coach"}),a.jsx("p",{className:"text-slate-300 mt-2",children:"Payments go directly to your assigned coach for a quick verification workflow."}),a.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4 text-sm text-slate-400",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-slate-500",children:"Status"}),a.jsx("p",{className:"text-white font-semibold",children:"Awaiting submission"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-slate-500",children:"Next step"}),a.jsx("p",{className:"text-white font-semibold",children:"Coach approval"})]})]})]}),a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl border border-slate-800 p-8",children:[a.jsx("h4",{className:"text-xl font-semibold mb-3",children:"How it works"}),a.jsxs("ul",{className:"space-y-4 text-slate-300",children:[a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx("span",{className:"w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-300 flex items-center justify-center font-semibold",children:"1"}),"Submit your payment details above."]}),a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx("span",{className:"w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-300 flex items-center justify-center font-semibold",children:"2"}),"Your coach approves it after checking the proof."]}),a.jsxs("li",{className:"flex items-start gap-3",children:[a.jsx("span",{className:"w-8 h-8 rounded-full bg-emerald-500/20 text-emerald-300 flex items-center justify-center font-semibold",children:"3"}),"Admin finalizes the record and your plan unlocks."]})]})]})]})]}):a.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-10 text-center backdrop-blur",children:[a.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Coach Assignment Needed"}),a.jsx("p",{className:"text-slate-400",children:"Please contact support so we can assign a coach to your account before submitting payments."})]})]}),c&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-20",children:a.jsxs("div",{className:"bg-slate-900 border border-emerald-400 rounded-3xl p-10 text-center animate-pop",children:[a.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-6",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-400 to-cyan-400 rounded-full opacity-40 blur-2xl animate-pulse"}),a.jsx("div",{className:"relative w-24 h-24 rounded-full border-4 border-emerald-400 flex items-center justify-center",children:a.jsx(bi,{className:"text-3xl text-emerald-300 animate-bounce"})})]}),a.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Payment Sent!"}),a.jsx("p",{className:"text-slate-300",children:"Redirecting you to the success page..."})]})})]})},JA={pending:"bg-amber-500/20 text-amber-200 border border-amber-400/30",completed:"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",rejected:"bg-rose-500/20 text-rose-200 border border-rose-400/30"},QA=s=>{const e=Number(s);return Number.isNaN(e)?s:e.toFixed(2)},YA=()=>{const{showNotification:s}=yt(),[e,t]=_.useState([]),[n,r]=_.useState(!0),[i,o]=_.useState("pending"),[l,c]=_.useState(null),u=_.useMemo(()=>{try{const v=localStorage.getItem("user");return v?JSON.parse(v):null}catch(v){return console.error("Failed to parse user",v),null}},[]),h=u==null?void 0:u.uid,m=async()=>{if(!h){r(!1);return}try{const v=localStorage.getItem("token"),{data:I}=await ce.get(`http://localhost:3000/api/payments/employee/${h}`,{headers:{Authorization:`Bearer ${v}`}});t(I.data||[])}catch(v){console.error("Failed to fetch payments",v),s({type:"error",message:"Could not load payment list."})}finally{r(!1)}};_.useEffect(()=>{m()},[h]);const p=async(v,I)=>{var g,S;try{c(v);const C=localStorage.getItem("token");await ce.post("http://localhost:3000/api/payments/employee-approve",{paymentId:v,decision:I},{headers:{Authorization:`Bearer ${C}`}}),s({type:I==="approve"?"success":"error",message:I==="approve"?"Payment approved":"Payment rejected"}),await m()}catch(C){console.error("Decision error",C);const T=((S=(g=C.response)==null?void 0:g.data)==null?void 0:S.message)||"Action failed. Try again.";s({type:"error",message:T})}finally{c(null)}},N=e.filter(v=>i==="pending"?v.status==="pending"&&!v.approvedByEmployee:i==="completed"?v.status==="completed":i==="rejected"?v.status==="rejected":!0);return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white px-4 py-12",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-10",children:[a.jsxs("header",{className:"text-center",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.5em] text-emerald-400 mb-3",children:"Coach Console"}),a.jsx("h1",{className:"text-4xl font-black",children:"Approve Client Payments"}),a.jsx("p",{className:"text-slate-300 mt-3",children:"Review offline payments, keep everything transparent, and notify admins instantly."})]}),a.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6 backdrop-blur",children:[a.jsxs("div",{className:"flex flex-wrap gap-3 items-center justify-between mb-8",children:[a.jsx("div",{className:"flex gap-2",children:["pending","completed","rejected","all"].map(v=>a.jsx("button",{onClick:()=>o(v),className:`px-4 py-2 rounded-full text-sm font-semibold capitalize transition ${i===v?"bg-emerald-500 text-black":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:v},v))}),a.jsxs("button",{onClick:m,className:"flex items-center gap-2 text-sm text-slate-300 hover:text-white",children:[a.jsx(yi,{className:"animate-spin-slower"}),"Refresh"]})]}),n?a.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-300",children:[a.jsx(yi,{className:"text-3xl animate-spin mb-4"}),"Loading payment requests..."]}):N.length===0?a.jsxs("div",{className:"py-16 text-center",children:[a.jsx("div",{className:"mx-auto w-24 h-24 border border-dashed border-slate-700 rounded-full flex items-center justify-center animate-pulse mb-5",children:a.jsx("span",{className:"text-slate-500 text-sm",children:"No data"})}),a.jsx("p",{className:"text-slate-400",children:"No payments in this state. Enjoy the calm!"})]}):a.jsx("div",{className:"space-y-5",children:N.map(v=>a.jsxs("div",{className:"bg-slate-900/70 border border-slate-800 rounded-2xl p-6 flex flex-col md:flex-row md:items-center gap-6 hover:border-emerald-500/30 transition",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-slate-500",children:v.method}),a.jsxs("p",{className:"text-3xl font-semibold mt-2",children:["$",QA(v.amount)]}),a.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Submitted ",v.createdAt?new Date(v.createdAt).toLocaleString():"Recently"]})]}),a.jsxs("div",{className:"flex flex-col gap-3 min-w-[260px]",children:[a.jsx("span",{className:`inline-flex items-center justify-center px-4 py-1 rounded-full text-xs uppercase tracking-[0.3em] ${JA[v.status]}`,children:v.status}),v.status==="pending"&&a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{onClick:()=>p(v.id,"reject"),disabled:l===v.id,className:"flex-1 border border-rose-400/50 text-rose-200 rounded-xl py-2 hover:bg-rose-500/10 transition disabled:opacity-60",children:[a.jsx(Fr,{className:"inline mr-1"}),"Reject"]}),a.jsxs("button",{onClick:()=>p(v.id,"approve"),disabled:l===v.id,className:"flex-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-black rounded-xl py-2 font-semibold shadow-lg disabled:opacity-60",children:[a.jsx(js,{className:"inline mr-1"}),"Approve"]})]}),v.status!=="pending"&&a.jsxs("p",{className:"text-slate-400 text-sm",children:["Reviewed by: ",v.approvedByEmployeeId?`Coach ${v.approvedByEmployeeId.slice(-4)}`:"N/A"]})]})]},v.id))})]})]})})},XA={pending:"bg-amber-500/15 text-amber-200 border border-amber-400/40",completed:"bg-emerald-500/15 text-emerald-200 border border-emerald-400/40",rejected:"bg-rose-500/15 text-rose-200 border border-rose-400/40"},ZA=s=>{const e=Number(s);return Number.isNaN(e)?s:e.toFixed(2)},ek=()=>{const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState(!0),[o,l]=_.useState(null),c=async()=>{try{i(!0);const m=localStorage.getItem("token"),[p,N]=await Promise.all([ce.get("http://localhost:3000/api/payments/all",{headers:{Authorization:`Bearer ${m}`}}),ce.get("http://localhost:3000/api/employee-payments/all",{headers:{Authorization:`Bearer ${m}`}})]),v=(p.data.data||[]).map(g=>({...g,type:"user",status:g.status||"pending"})),I=(N.data.data||[]).map(g=>({...g,id:g.id,userId:g.name||g.email,employeeId:"Employee Signup",method:g.selectedPlan||"Signup",status:"completed",type:"employee",createdAt:g.createdAt||g.timestamp}));n([...v,...I])}catch(m){console.error("Failed to load payments",m),s({type:"error",message:"Unable to fetch payments."})}finally{i(!1)}};_.useEffect(()=>{c();const m=()=>{console.log("Employee approved event received, refreshing payments..."),c()};return window.addEventListener("employeeApproved",m),()=>{window.removeEventListener("employeeApproved",m)}},[]);const u=async(m,p="approve")=>{var N,v;try{l(m);const I=localStorage.getItem("token");await ce.post("http://localhost:3000/api/payments/admin-approve",{paymentId:m,decision:p},{headers:{Authorization:`Bearer ${I}`}}),s({type:p==="approve"?"success":"error",message:p==="approve"?"Payment approved":"Payment rejected"}),await c()}catch(I){console.error("Admin approval error",I);const g=((v=(N=I.response)==null?void 0:N.data)==null?void 0:v.message)||"Action failed.";s({type:"error",message:g})}finally{l(null)}},h=t;return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 px-4 py-12",children:a.jsxs("div",{className:"max-w-7xl mx-auto space-y-10",children:[a.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.5em] text-emerald-400 mb-2",children:"Admin Control"}),a.jsx("h1",{className:"text-4xl font-black",children:"Payment Verification Desk"}),a.jsx("p",{className:"text-slate-300 mt-2",children:"One place to validate every offline transaction with real-time status badges."})]}),a.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-2xl px-6 py-4 flex items-center gap-3",children:[a.jsx(WA,{className:"text-3xl text-emerald-400"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-400",children:"Verified this week"}),a.jsx("p",{className:"text-2xl font-semibold",children:t.filter(m=>m.status==="completed").length})]})]})]}),a.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6 backdrop-blur space-y-6",children:[a.jsx("div",{className:"flex flex-wrap gap-3 items-center justify-end",children:a.jsxs("button",{onClick:c,className:"flex items-center gap-2 text-sm text-slate-300 hover:text-white",children:[a.jsx(yi,{className:"animate-spin-slower"}),"Refresh"]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-left text-sm min-w-[720px]",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-slate-400 uppercase text-xs tracking-[0.3em]",children:[a.jsx("th",{className:"py-3",children:"Payment"}),a.jsx("th",{className:"py-3",children:"Client"}),a.jsx("th",{className:"py-3",children:"Coach"}),a.jsx("th",{className:"py-3",children:"Method"}),a.jsx("th",{className:"py-3",children:"Submitted"}),a.jsx("th",{className:"py-3",children:"Status"}),a.jsx("th",{className:"py-3 text-right",children:"Action"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-800",children:r?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"py-10 text-center text-slate-400",children:"Loading payments..."})}):h.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"py-12 text-center",children:a.jsxs("div",{className:"inline-flex items-center gap-2 text-slate-500",children:[a.jsx("span",{className:"w-8 h-8 rounded-full border border-dashed border-slate-700"}),"No payments found in this filter."]})})}):h.map(m=>a.jsxs("tr",{className:"hover:bg-slate-900/60 transition",children:[a.jsxs("td",{className:"py-4",children:[a.jsxs("p",{className:"font-semibold text-white",children:["$",ZA(m.amount)]}),a.jsx("p",{className:"text-slate-500 text-xs",children:m.id})]}),a.jsx("td",{className:"py-4",children:a.jsx("p",{className:"text-white font-medium",children:m.userId})}),a.jsx("td",{className:"py-4",children:a.jsx("p",{className:"text-slate-300",children:m.employeeId})}),a.jsx("td",{className:"py-4 capitalize",children:m.method}),a.jsx("td",{className:"py-4 text-slate-400",children:m.createdAt?new Date(m.createdAt).toLocaleString():""}),a.jsx("td",{className:"py-4",children:a.jsx("span",{className:`px-4 py-1 rounded-full text-xs uppercase tracking-[0.3em] ${XA[m.status]}`,children:m.status})}),a.jsx("td",{className:"py-4",children:m.status==="pending"?a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>u(m.id,"reject"),disabled:o===m.id,className:"px-4 py-2 rounded-xl border border-rose-400/50 text-rose-200 hover:bg-rose-500/10 transition disabled:opacity-60",children:"Reject"}),a.jsxs("button",{onClick:()=>u(m.id,"approve"),disabled:o===m.id,className:"px-4 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-black font-semibold flex items-center gap-2 shadow-lg disabled:opacity-60",children:[a.jsx(js,{}),"Approve"]})]}):a.jsx("p",{className:"text-right text-slate-500 text-sm",children:"No action"})})]},m.id))})]})})]})]})})]})},tk=()=>{var i,o;const s=ft(),e=Tn(),t=(i=e.state)==null?void 0:i.amount,n=(o=e.state)==null?void 0:o.method,r=typeof t=="number"?t.toFixed(2):t?Number(t).toFixed(2):"";return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white flex items-center justify-center px-4 py-12",children:a.jsxs("div",{className:"relative max-w-3xl w-full bg-slate-900/80 border border-slate-800 rounded-[36px] p-10 text-center backdrop-blur",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-cyan-500/10 opacity-60 blur-3xl rounded-[36px] pointer-events-none"}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("div",{className:"w-24 h-24 mx-auto rounded-full border-4 border-emerald-400 flex items-center justify-center mb-6 animate-pop",children:a.jsx(js,{className:"text-3xl text-emerald-300"})}),a.jsx("p",{className:"uppercase text-xs tracking-[0.5em] text-emerald-400 mb-4",children:"Payment Logged"}),a.jsx("h1",{className:"text-4xl font-black mb-4",children:"You're All Set!"}),a.jsx("p",{className:"text-slate-300 max-w-2xl mx-auto",children:"Your payment is now awaiting verification. We'll notify you once your coach and admin finish the checks."}),a.jsxs("div",{className:"mt-10 grid sm:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-black/30 border border-slate-800 rounded-3xl p-6",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Amount"}),a.jsxs("p",{className:"text-3xl font-semibold mt-2",children:["$",r]})]}),a.jsxs("div",{className:"bg-black/30 border border-slate-800 rounded-3xl p-6",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Method"}),a.jsx("p",{className:"text-2xl font-semibold mt-2 capitalize",children:n||"Pending"})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-4 justify-center mt-12",children:[a.jsx("button",{onClick:()=>s("/dashboard"),className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-emerald-500 to-teal-500 text-black font-semibold shadow-lg",children:"Go to Dashboard"}),a.jsx("button",{onClick:()=>s("/payments/user"),className:"px-6 py-3 rounded-2xl border border-slate-700 hover:border-emerald-400 transition",children:"Submit another payment"})]})]})]})})},Eb=_.createContext({});function sk(s){const e=_.useRef(null);return e.current===null&&(e.current=s()),e.current}const Yu=typeof window<"u",nk=Yu?_.useLayoutEffect:_.useEffect,Xu=_.createContext(null);function Zu(s,e){s.indexOf(e)===-1&&s.push(e)}function eh(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}const Ks=(s,e,t)=>t>e?e:t<s?s:t;let th=()=>{};const Hs={},Ib=s=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(s);function Tb(s){return typeof s=="object"&&s!==null}const Sb=s=>/^0[^.\s]+$/u.test(s);function sh(s){let e;return()=>(e===void 0&&(e=s()),e)}const vs=s=>s,rk=(s,e)=>t=>e(s(t)),zi=(...s)=>s.reduce(rk),vi=(s,e,t)=>{const n=e-s;return n===0?1:(t-s)/n};class nh{constructor(){this.subscriptions=[]}add(e){return Zu(this.subscriptions,e),()=>eh(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const As=s=>s*1e3,ys=s=>s/1e3;function Ab(s,e){return e?s*(1e3/e):0}const kb=(s,e,t)=>(((1-3*t+3*e)*s+(3*t-6*e))*s+3*e)*s,ak=1e-7,ik=12;function ok(s,e,t,n,r){let i,o,l=0;do o=e+(t-e)/2,i=kb(o,n,r)-s,i>0?t=o:e=o;while(Math.abs(i)>ak&&++l<ik);return o}function Gi(s,e,t,n){if(s===e&&t===n)return vs;const r=i=>ok(i,0,1,s,t);return i=>i===0||i===1?i:kb(r(i),e,n)}const Pb=s=>e=>e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2,Cb=s=>e=>1-s(1-e),Rb=Gi(.33,1.53,.69,.99),rh=Cb(Rb),Db=Pb(rh),Vb=s=>(s*=2)<1?.5*rh(s):.5*(2-Math.pow(2,-10*(s-1))),ah=s=>1-Math.sin(Math.acos(s)),Mb=Cb(ah),Lb=Pb(ah),lk=Gi(.42,0,1,1),ck=Gi(0,0,.58,1),Ob=Gi(.42,0,.58,1),dk=s=>Array.isArray(s)&&typeof s[0]!="number",Fb=s=>Array.isArray(s)&&typeof s[0]=="number",uk={linear:vs,easeIn:lk,easeInOut:Ob,easeOut:ck,circIn:ah,circInOut:Lb,circOut:Mb,backIn:rh,backInOut:Db,backOut:Rb,anticipate:Vb},hk=s=>typeof s=="string",kg=s=>{if(Fb(s)){th(s.length===4);const[e,t,n,r]=s;return Gi(e,t,n,r)}else if(hk(s))return uk[s];return s},yo=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function mk(s,e){let t=new Set,n=new Set,r=!1,i=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(h){o.has(h)&&(u.schedule(h),s()),h(l)}const u={schedule:(h,m=!1,p=!1)=>{const v=p&&r?t:n;return m&&o.add(h),v.has(h)||v.add(h),h},cancel:h=>{n.delete(h),o.delete(h)},process:h=>{if(l=h,r){i=!0;return}r=!0,[t,n]=[n,t],t.forEach(c),t.clear(),r=!1,i&&(i=!1,u.process(h))}};return u}const fk=40;function $b(s,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=()=>t=!0,o=yo.reduce((T,V)=>(T[V]=mk(i),T),{}),{setup:l,read:c,resolveKeyframes:u,preUpdate:h,update:m,preRender:p,render:N,postRender:v}=o,I=()=>{const T=Hs.useManualTiming?r.timestamp:performance.now();t=!1,Hs.useManualTiming||(r.delta=n?1e3/60:Math.max(Math.min(T-r.timestamp,fk),1)),r.timestamp=T,r.isProcessing=!0,l.process(r),c.process(r),u.process(r),h.process(r),m.process(r),p.process(r),N.process(r),v.process(r),r.isProcessing=!1,t&&e&&(n=!1,s(I))},g=()=>{t=!0,n=!0,r.isProcessing||s(I)};return{schedule:yo.reduce((T,V)=>{const P=o[V];return T[V]=(k,b=!1,x=!1)=>(t||g(),P.schedule(k,b,x)),T},{}),cancel:T=>{for(let V=0;V<yo.length;V++)o[yo[V]].cancel(T)},state:r,steps:o}}const{schedule:pt,cancel:jn,state:Bt,steps:Pc}=$b(typeof requestAnimationFrame<"u"?requestAnimationFrame:vs,!0);let Fo;function gk(){Fo=void 0}const ns={now:()=>(Fo===void 0&&ns.set(Bt.isProcessing||Hs.useManualTiming?Bt.timestamp:performance.now()),Fo),set:s=>{Fo=s,queueMicrotask(gk)}},Ub=s=>e=>typeof e=="string"&&e.startsWith(s),ih=Ub("--"),pk=Ub("var(--"),oh=s=>pk(s)?xk.test(s.split("/*")[0].trim()):!1,xk=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ha={test:s=>typeof s=="number",parse:parseFloat,transform:s=>s},wi={...ha,transform:s=>Ks(0,1,s)},bo={...ha,default:1},Ha=s=>Math.round(s*1e5)/1e5,lh=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function yk(s){return s==null}const bk=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ch=(s,e)=>t=>!!(typeof t=="string"&&bk.test(t)&&t.startsWith(s)||e&&!yk(t)&&Object.prototype.hasOwnProperty.call(t,e)),Bb=(s,e,t)=>n=>{if(typeof n!="string")return n;const[r,i,o,l]=n.match(lh);return{[s]:parseFloat(r),[e]:parseFloat(i),[t]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},vk=s=>Ks(0,255,s),Cc={...ha,transform:s=>Math.round(vk(s))},qn={test:ch("rgb","red"),parse:Bb("red","green","blue"),transform:({red:s,green:e,blue:t,alpha:n=1})=>"rgba("+Cc.transform(s)+", "+Cc.transform(e)+", "+Cc.transform(t)+", "+Ha(wi.transform(n))+")"};function wk(s){let e="",t="",n="",r="";return s.length>5?(e=s.substring(1,3),t=s.substring(3,5),n=s.substring(5,7),r=s.substring(7,9)):(e=s.substring(1,2),t=s.substring(2,3),n=s.substring(3,4),r=s.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const kd={test:ch("#"),parse:wk,transform:qn.transform},qi=s=>({test:e=>typeof e=="string"&&e.endsWith(s)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${s}`}),nn=qi("deg"),ks=qi("%"),ze=qi("px"),Nk=qi("vh"),_k=qi("vw"),Pg={...ks,parse:s=>ks.parse(s)/100,transform:s=>ks.transform(s*100)},kr={test:ch("hsl","hue"),parse:Bb("hue","saturation","lightness"),transform:({hue:s,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(s)+", "+ks.transform(Ha(e))+", "+ks.transform(Ha(t))+", "+Ha(wi.transform(n))+")"},Ct={test:s=>qn.test(s)||kd.test(s)||kr.test(s),parse:s=>qn.test(s)?qn.parse(s):kr.test(s)?kr.parse(s):kd.parse(s),transform:s=>typeof s=="string"?s:s.hasOwnProperty("red")?qn.transform(s):kr.transform(s),getAnimatableNone:s=>{const e=Ct.parse(s);return e.alpha=0,Ct.transform(e)}},jk=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Ek(s){var e,t;return isNaN(s)&&typeof s=="string"&&(((e=s.match(lh))==null?void 0:e.length)||0)+(((t=s.match(jk))==null?void 0:t.length)||0)>0}const zb="number",Gb="color",Ik="var",Tk="var(",Cg="${}",Sk=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ni(s){const e=s.toString(),t=[],n={color:[],number:[],var:[]},r=[];let i=0;const l=e.replace(Sk,c=>(Ct.test(c)?(n.color.push(i),r.push(Gb),t.push(Ct.parse(c))):c.startsWith(Tk)?(n.var.push(i),r.push(Ik),t.push(c)):(n.number.push(i),r.push(zb),t.push(parseFloat(c))),++i,Cg)).split(Cg);return{values:t,split:l,indexes:n,types:r}}function qb(s){return Ni(s).values}function Wb(s){const{split:e,types:t}=Ni(s),n=e.length;return r=>{let i="";for(let o=0;o<n;o++)if(i+=e[o],r[o]!==void 0){const l=t[o];l===zb?i+=Ha(r[o]):l===Gb?i+=Ct.transform(r[o]):i+=r[o]}return i}}const Ak=s=>typeof s=="number"?0:Ct.test(s)?Ct.getAnimatableNone(s):s;function kk(s){const e=qb(s);return Wb(s)(e.map(Ak))}const En={test:Ek,parse:qb,createTransformer:Wb,getAnimatableNone:kk};function Rc(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+(e-s)*6*t:t<1/2?e:t<2/3?s+(e-s)*(2/3-t)*6:s}function Pk({hue:s,saturation:e,lightness:t,alpha:n}){s/=360,e/=100,t/=100;let r=0,i=0,o=0;if(!e)r=i=o=t;else{const l=t<.5?t*(1+e):t+e-t*e,c=2*t-l;r=Rc(c,l,s+1/3),i=Rc(c,l,s),o=Rc(c,l,s-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:n}}function ml(s,e){return t=>t>0?e:s}const vt=(s,e,t)=>s+(e-s)*t,Dc=(s,e,t)=>{const n=s*s,r=t*(e*e-n)+n;return r<0?0:Math.sqrt(r)},Ck=[kd,qn,kr],Rk=s=>Ck.find(e=>e.test(s));function Rg(s){const e=Rk(s);if(!e)return!1;let t=e.parse(s);return e===kr&&(t=Pk(t)),t}const Dg=(s,e)=>{const t=Rg(s),n=Rg(e);if(!t||!n)return ml(s,e);const r={...t};return i=>(r.red=Dc(t.red,n.red,i),r.green=Dc(t.green,n.green,i),r.blue=Dc(t.blue,n.blue,i),r.alpha=vt(t.alpha,n.alpha,i),qn.transform(r))},Pd=new Set(["none","hidden"]);function Dk(s,e){return Pd.has(s)?t=>t<=0?s:e:t=>t>=1?e:s}function Vk(s,e){return t=>vt(s,e,t)}function dh(s){return typeof s=="number"?Vk:typeof s=="string"?oh(s)?ml:Ct.test(s)?Dg:Ok:Array.isArray(s)?Kb:typeof s=="object"?Ct.test(s)?Dg:Mk:ml}function Kb(s,e){const t=[...s],n=t.length,r=s.map((i,o)=>dh(i)(i,e[o]));return i=>{for(let o=0;o<n;o++)t[o]=r[o](i);return t}}function Mk(s,e){const t={...s,...e},n={};for(const r in t)s[r]!==void 0&&e[r]!==void 0&&(n[r]=dh(s[r])(s[r],e[r]));return r=>{for(const i in n)t[i]=n[i](r);return t}}function Lk(s,e){const t=[],n={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const i=e.types[r],o=s.indexes[i][n[i]],l=s.values[o]??0;t[r]=l,n[i]++}return t}const Ok=(s,e)=>{const t=En.createTransformer(e),n=Ni(s),r=Ni(e);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?Pd.has(s)&&!r.values.length||Pd.has(e)&&!n.values.length?Dk(s,e):zi(Kb(Lk(n,r),r.values),t):ml(s,e)};function Hb(s,e,t){return typeof s=="number"&&typeof e=="number"&&typeof t=="number"?vt(s,e,t):dh(s)(s,e)}const Fk=s=>{const e=({timestamp:t})=>s(t);return{start:(t=!0)=>pt.update(e,t),stop:()=>jn(e),now:()=>Bt.isProcessing?Bt.timestamp:ns.now()}},Jb=(s,e,t=10)=>{let n="";const r=Math.max(Math.round(e/t),2);for(let i=0;i<r;i++)n+=Math.round(s(i/(r-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},fl=2e4;function uh(s){let e=0;const t=50;let n=s.next(e);for(;!n.done&&e<fl;)e+=t,n=s.next(e);return e>=fl?1/0:e}function $k(s,e=100,t){const n=t({...s,keyframes:[0,e]}),r=Math.min(uh(n),fl);return{type:"keyframes",ease:i=>n.next(r*i).value/e,duration:ys(r)}}const Uk=5;function Qb(s,e,t){const n=Math.max(e-Uk,0);return Ab(t-s(n),e-n)}const _t={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Vc=.001;function Bk({duration:s=_t.duration,bounce:e=_t.bounce,velocity:t=_t.velocity,mass:n=_t.mass}){let r,i,o=1-e;o=Ks(_t.minDamping,_t.maxDamping,o),s=Ks(_t.minDuration,_t.maxDuration,ys(s)),o<1?(r=u=>{const h=u*o,m=h*s,p=h-t,N=Cd(u,o),v=Math.exp(-m);return Vc-p/N*v},i=u=>{const m=u*o*s,p=m*t+t,N=Math.pow(o,2)*Math.pow(u,2)*s,v=Math.exp(-m),I=Cd(Math.pow(u,2),o);return(-r(u)+Vc>0?-1:1)*((p-N)*v)/I}):(r=u=>{const h=Math.exp(-u*s),m=(u-t)*s+1;return-Vc+h*m},i=u=>{const h=Math.exp(-u*s),m=(t-u)*(s*s);return h*m});const l=5/s,c=Gk(r,i,l);if(s=As(s),isNaN(c))return{stiffness:_t.stiffness,damping:_t.damping,duration:s};{const u=Math.pow(c,2)*n;return{stiffness:u,damping:o*2*Math.sqrt(n*u),duration:s}}}const zk=12;function Gk(s,e,t){let n=t;for(let r=1;r<zk;r++)n=n-s(n)/e(n);return n}function Cd(s,e){return s*Math.sqrt(1-e*e)}const qk=["duration","bounce"],Wk=["stiffness","damping","mass"];function Vg(s,e){return e.some(t=>s[t]!==void 0)}function Kk(s){let e={velocity:_t.velocity,stiffness:_t.stiffness,damping:_t.damping,mass:_t.mass,isResolvedFromDuration:!1,...s};if(!Vg(s,Wk)&&Vg(s,qk))if(s.visualDuration){const t=s.visualDuration,n=2*Math.PI/(t*1.2),r=n*n,i=2*Ks(.05,1,1-(s.bounce||0))*Math.sqrt(r);e={...e,mass:_t.mass,stiffness:r,damping:i}}else{const t=Bk(s);e={...e,...t,mass:_t.mass},e.isResolvedFromDuration=!0}return e}function gl(s=_t.visualDuration,e=_t.bounce){const t=typeof s!="object"?{visualDuration:s,keyframes:[0,1],bounce:e}:s;let{restSpeed:n,restDelta:r}=t;const i=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],l={done:!1,value:i},{stiffness:c,damping:u,mass:h,duration:m,velocity:p,isResolvedFromDuration:N}=Kk({...t,velocity:-ys(t.velocity||0)}),v=p||0,I=u/(2*Math.sqrt(c*h)),g=o-i,S=ys(Math.sqrt(c/h)),C=Math.abs(g)<5;n||(n=C?_t.restSpeed.granular:_t.restSpeed.default),r||(r=C?_t.restDelta.granular:_t.restDelta.default);let T;if(I<1){const P=Cd(S,I);T=k=>{const b=Math.exp(-I*S*k);return o-b*((v+I*S*g)/P*Math.sin(P*k)+g*Math.cos(P*k))}}else if(I===1)T=P=>o-Math.exp(-S*P)*(g+(v+S*g)*P);else{const P=S*Math.sqrt(I*I-1);T=k=>{const b=Math.exp(-I*S*k),x=Math.min(P*k,300);return o-b*((v+I*S*g)*Math.sinh(x)+P*g*Math.cosh(x))/P}}const V={calculatedDuration:N&&m||null,next:P=>{const k=T(P);if(N)l.done=P>=m;else{let b=P===0?v:0;I<1&&(b=P===0?As(v):Qb(T,P,k));const x=Math.abs(b)<=n,w=Math.abs(o-k)<=r;l.done=x&&w}return l.value=l.done?o:k,l},toString:()=>{const P=Math.min(uh(V),fl),k=Jb(b=>V.next(P*b).value,P,30);return P+"ms "+k},toTransition:()=>{}};return V}gl.applyToOptions=s=>{const e=$k(s,100,gl);return s.ease=e.ease,s.duration=As(e.duration),s.type="keyframes",s};function Rd({keyframes:s,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:l,max:c,restDelta:u=.5,restSpeed:h}){const m=s[0],p={done:!1,value:m},N=x=>l!==void 0&&x<l||c!==void 0&&x>c,v=x=>l===void 0?c:c===void 0||Math.abs(l-x)<Math.abs(c-x)?l:c;let I=t*e;const g=m+I,S=o===void 0?g:o(g);S!==g&&(I=S-m);const C=x=>-I*Math.exp(-x/n),T=x=>S+C(x),V=x=>{const w=C(x),E=T(x);p.done=Math.abs(w)<=u,p.value=p.done?S:E};let P,k;const b=x=>{N(p.value)&&(P=x,k=gl({keyframes:[p.value,v(p.value)],velocity:Qb(T,x,p.value),damping:r,stiffness:i,restDelta:u,restSpeed:h}))};return b(0),{calculatedDuration:null,next:x=>{let w=!1;return!k&&P===void 0&&(w=!0,V(x),b(x)),P!==void 0&&x>=P?k.next(x-P):(!w&&V(x),p)}}}function Hk(s,e,t){const n=[],r=t||Hs.mix||Hb,i=s.length-1;for(let o=0;o<i;o++){let l=r(s[o],s[o+1]);if(e){const c=Array.isArray(e)?e[o]||vs:e;l=zi(c,l)}n.push(l)}return n}function Jk(s,e,{clamp:t=!0,ease:n,mixer:r}={}){const i=s.length;if(th(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=s[0]===s[1];s[0]>s[i-1]&&(s=[...s].reverse(),e=[...e].reverse());const l=Hk(e,n,r),c=l.length,u=h=>{if(o&&h<s[0])return e[0];let m=0;if(c>1)for(;m<s.length-2&&!(h<s[m+1]);m++);const p=vi(s[m],s[m+1],h);return l[m](p)};return t?h=>u(Ks(s[0],s[i-1],h)):u}function Qk(s,e){const t=s[s.length-1];for(let n=1;n<=e;n++){const r=vi(0,e,n);s.push(vt(t,1,r))}}function Yk(s){const e=[0];return Qk(e,s.length-1),e}function Xk(s,e){return s.map(t=>t*e)}function Zk(s,e){return s.map(()=>e||Ob).splice(0,s.length-1)}function Ja({duration:s=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=dk(n)?n.map(kg):kg(n),i={done:!1,value:e[0]},o=Xk(t&&t.length===e.length?t:Yk(e),s),l=Jk(o,e,{ease:Array.isArray(r)?r:Zk(e,r)});return{calculatedDuration:s,next:c=>(i.value=l(c),i.done=c>=s,i)}}const eP=s=>s!==null;function hh(s,{repeat:e,repeatType:t="loop"},n,r=1){const i=s.filter(eP),l=r<0||e&&t!=="loop"&&e%2===1?0:i.length-1;return!l||n===void 0?i[l]:n}const tP={decay:Rd,inertia:Rd,tween:Ja,keyframes:Ja,spring:gl};function Yb(s){typeof s.type=="string"&&(s.type=tP[s.type])}class mh{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const sP=s=>s/100;class fh extends mh{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,r;const{motionValue:t}=this.options;t&&t.updatedAt!==ns.now()&&this.tick(ns.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(r=(n=this.options).onStop)==null||r.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Yb(e);const{type:t=Ja,repeat:n=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=e;let{keyframes:l}=e;const c=t||Ja;c!==Ja&&typeof l[0]!="number"&&(this.mixKeyframes=zi(sP,Hb(l[0],l[1])),l=[0,100]);const u=c({...e,keyframes:l});i==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-o})),u.calculatedDuration===null&&(u.calculatedDuration=uh(u));const{calculatedDuration:h}=u;this.calculatedDuration=h,this.resolvedDuration=h+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=u}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:n,totalDuration:r,mixKeyframes:i,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:u=0,keyframes:h,repeat:m,repeatType:p,repeatDelay:N,type:v,onUpdate:I,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const S=this.currentTime-u*(this.playbackSpeed>=0?1:-1),C=this.playbackSpeed>=0?S<0:S>r;this.currentTime=Math.max(S,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let T=this.currentTime,V=n;if(m){const x=Math.min(this.currentTime,r)/l;let w=Math.floor(x),E=x%1;!E&&x>=1&&(E=1),E===1&&w--,w=Math.min(w,m+1),!!(w%2)&&(p==="reverse"?(E=1-E,N&&(E-=N/l)):p==="mirror"&&(V=o)),T=Ks(0,1,E)*l}const P=C?{done:!1,value:h[0]}:V.next(T);i&&(P.value=i(P.value));let{done:k}=P;!C&&c!==null&&(k=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const b=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&k);return b&&v!==Rd&&(P.value=hh(h,this.options,g,this.speed)),I&&I(P.value),b&&this.finish(),P}then(e,t){return this.finished.then(e,t)}get duration(){return ys(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ys(e)}get time(){return ys(this.currentTime)}set time(e){var t;e=As(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(t=this.driver)==null||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(ns.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=ys(this.currentTime))}play(){var r,i;if(this.isStopped)return;const{driver:e=Fk,startTime:t}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),(i=(r=this.options).onPlay)==null||i.call(r);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ns.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",(t=(e=this.options).onComplete)==null||t.call(e)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(t=(e=this.options).onCancel)==null||t.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(t=this.driver)==null||t.stop(),e.observe(this)}}function nP(s){for(let e=1;e<s.length;e++)s[e]??(s[e]=s[e-1])}const Wn=s=>s*180/Math.PI,Dd=s=>{const e=Wn(Math.atan2(s[1],s[0]));return Vd(e)},rP={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:s=>(Math.abs(s[0])+Math.abs(s[3]))/2,rotate:Dd,rotateZ:Dd,skewX:s=>Wn(Math.atan(s[1])),skewY:s=>Wn(Math.atan(s[2])),skew:s=>(Math.abs(s[1])+Math.abs(s[2]))/2},Vd=s=>(s=s%360,s<0&&(s+=360),s),Mg=Dd,Lg=s=>Math.sqrt(s[0]*s[0]+s[1]*s[1]),Og=s=>Math.sqrt(s[4]*s[4]+s[5]*s[5]),aP={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Lg,scaleY:Og,scale:s=>(Lg(s)+Og(s))/2,rotateX:s=>Vd(Wn(Math.atan2(s[6],s[5]))),rotateY:s=>Vd(Wn(Math.atan2(-s[2],s[0]))),rotateZ:Mg,rotate:Mg,skewX:s=>Wn(Math.atan(s[4])),skewY:s=>Wn(Math.atan(s[1])),skew:s=>(Math.abs(s[1])+Math.abs(s[4]))/2};function Md(s){return s.includes("scale")?1:0}function Ld(s,e){if(!s||s==="none")return Md(e);const t=s.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,r;if(t)n=aP,r=t;else{const l=s.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=rP,r=l}if(!r)return Md(e);const i=n[e],o=r[1].split(",").map(oP);return typeof i=="function"?i(o):o[i]}const iP=(s,e)=>{const{transform:t="none"}=getComputedStyle(s);return Ld(t,e)};function oP(s){return parseFloat(s.trim())}const ma=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],fa=new Set(ma),Fg=s=>s===ha||s===ze,lP=new Set(["x","y","z"]),cP=ma.filter(s=>!lP.has(s));function dP(s){const e=[];return cP.forEach(t=>{const n=s.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e}const Zn={width:({x:s},{paddingLeft:e="0",paddingRight:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),height:({y:s},{paddingTop:e="0",paddingBottom:t="0"})=>s.max-s.min-parseFloat(e)-parseFloat(t),top:(s,{top:e})=>parseFloat(e),left:(s,{left:e})=>parseFloat(e),bottom:({y:s},{top:e})=>parseFloat(e)+(s.max-s.min),right:({x:s},{left:e})=>parseFloat(e)+(s.max-s.min),x:(s,{transform:e})=>Ld(e,"x"),y:(s,{transform:e})=>Ld(e,"y")};Zn.translateX=Zn.x;Zn.translateY=Zn.y;const er=new Set;let Od=!1,Fd=!1,$d=!1;function Xb(){if(Fd){const s=Array.from(er).filter(n=>n.needsMeasurement),e=new Set(s.map(n=>n.element)),t=new Map;e.forEach(n=>{const r=dP(n);r.length&&(t.set(n,r),n.render())}),s.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const r=t.get(n);r&&r.forEach(([i,o])=>{var l;(l=n.getValue(i))==null||l.set(o)})}),s.forEach(n=>n.measureEndState()),s.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Fd=!1,Od=!1,er.forEach(s=>s.complete($d)),er.clear()}function Zb(){er.forEach(s=>{s.readKeyframes(),s.needsMeasurement&&(Fd=!0)})}function uP(){$d=!0,Zb(),Xb(),$d=!1}class gh{constructor(e,t,n,r,i,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(er.add(this),Od||(Od=!0,pt.read(Zb),pt.resolveKeyframes(Xb))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(e[0]===null){const i=r==null?void 0:r.get(),o=e[e.length-1];if(i!==void 0)e[0]=i;else if(n&&t){const l=n.readValue(t,o);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=o),r&&i===void 0&&r.set(e[0])}nP(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),er.delete(this)}cancel(){this.state==="scheduled"&&(er.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const hP=s=>s.startsWith("--");function mP(s,e,t){hP(e)?s.style.setProperty(e,t):s.style[e]=t}const fP=sh(()=>window.ScrollTimeline!==void 0),gP={};function pP(s,e){const t=sh(s);return()=>gP[e]??t()}const ev=pP(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),La=([s,e,t,n])=>`cubic-bezier(${s}, ${e}, ${t}, ${n})`,$g={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:La([0,.65,.55,1]),circOut:La([.55,0,1,.45]),backIn:La([.31,.01,.66,-.59]),backOut:La([.33,1.53,.69,.99])};function tv(s,e){if(s)return typeof s=="function"?ev()?Jb(s,e):"ease-out":Fb(s)?La(s):Array.isArray(s)?s.map(t=>tv(t,e)||$g.easeOut):$g[s]}function xP(s,e,t,{delay:n=0,duration:r=300,repeat:i=0,repeatType:o="loop",ease:l="easeOut",times:c}={},u=void 0){const h={[e]:t};c&&(h.offset=c);const m=tv(l,r);Array.isArray(m)&&(h.easing=m);const p={delay:n,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"};return u&&(p.pseudoElement=u),s.animate(h,p)}function sv(s){return typeof s=="function"&&"applyToOptions"in s}function yP({type:s,...e}){return sv(s)&&ev()?s.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class bP extends mh{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:i,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!i,this.allowFlatten=o,this.options=e,th(typeof e.type!="string");const u=yP(e);this.animation=xP(t,n,r,u,i),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const h=hh(r,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(h):mP(t,n,h),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;(t=(e=this.animation).finish)==null||t.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(t=(e=this.animation).commitStyles)==null||t.call(e)}get duration(){var t,n;const e=((n=(t=this.animation.effect)==null?void 0:t.getComputedTiming)==null?void 0:n.call(t).duration)||0;return ys(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+ys(e)}get time(){return ys(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=As(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&fP()?(this.animation.timeline=e,vs):t(this)}}const nv={anticipate:Vb,backInOut:Db,circInOut:Lb};function vP(s){return s in nv}function wP(s){typeof s.ease=="string"&&vP(s.ease)&&(s.ease=nv[s.ease])}const Ug=10;class NP extends bP{constructor(e){wP(e),Yb(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:r,element:i,...o}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const l=new fh({...o,autoplay:!1}),c=As(this.finishedTime??this.time);t.setWithVelocity(l.sample(c-Ug).value,l.sample(c).value,Ug),l.stop()}}const Bg=(s,e)=>e==="zIndex"?!1:!!(typeof s=="number"||Array.isArray(s)||typeof s=="string"&&(En.test(s)||s==="0")&&!s.startsWith("url("));function _P(s){const e=s[0];if(s.length===1)return!0;for(let t=0;t<s.length;t++)if(s[t]!==e)return!0}function jP(s,e,t,n){const r=s[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const i=s[s.length-1],o=Bg(r,e),l=Bg(i,e);return!o||!l?!1:_P(s)||(t==="spring"||sv(t))&&n}function Ud(s){s.duration=0,s.type="keyframes"}const EP=new Set(["opacity","clipPath","filter","transform"]),IP=sh(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function TP(s){var h;const{motionValue:e,name:t,repeatDelay:n,repeatType:r,damping:i,type:o}=s;if(!(((h=e==null?void 0:e.owner)==null?void 0:h.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:u}=e.owner.getProps();return IP()&&t&&EP.has(t)&&(t!=="transform"||!u)&&!c&&!n&&r!=="mirror"&&i!==0&&o!=="inertia"}const SP=40;class AP extends mh{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",keyframes:l,name:c,motionValue:u,element:h,...m}){var v;super(),this.stop=()=>{var I,g;this._animation&&(this._animation.stop(),(I=this.stopTimeline)==null||I.call(this)),(g=this.keyframeResolver)==null||g.cancel()},this.createdAt=ns.now();const p={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:i,repeatType:o,name:c,motionValue:u,element:h,...m},N=(h==null?void 0:h.KeyframeResolver)||gh;this.keyframeResolver=new N(l,(I,g,S)=>this.onKeyframesResolved(I,g,p,!S),c,u,h),(v=this.keyframeResolver)==null||v.scheduleResolve()}onKeyframesResolved(e,t,n,r){this.keyframeResolver=void 0;const{name:i,type:o,velocity:l,delay:c,isHandoff:u,onUpdate:h}=n;this.resolvedAt=ns.now(),jP(e,i,o,l)||((Hs.instantAnimations||!c)&&(h==null||h(hh(e,n,t))),e[0]=e[e.length-1],Ud(n),n.repeat=0);const p={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>SP?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},N=!u&&TP(p)?new NP({...p,element:p.motionValue.owner.current}):new fh(p);N.finished.then(()=>this.notifyFinished()).catch(vs),this.pendingTimeline&&(this.stopTimeline=N.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=N}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),uP()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const kP=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function PP(s){const e=kP.exec(s);if(!e)return[,];const[,t,n,r]=e;return[`--${t??n}`,r]}function rv(s,e,t=1){const[n,r]=PP(s);if(!n)return;const i=window.getComputedStyle(e).getPropertyValue(n);if(i){const o=i.trim();return Ib(o)?parseFloat(o):o}return oh(r)?rv(r,e,t+1):r}function ph(s,e){return(s==null?void 0:s[e])??(s==null?void 0:s.default)??s}const av=new Set(["width","height","top","left","right","bottom",...ma]),CP={test:s=>s==="auto",parse:s=>s},iv=s=>e=>e.test(s),ov=[ha,ze,ks,nn,_k,Nk,CP],zg=s=>ov.find(iv(s));function RP(s){return typeof s=="number"?s===0:s!==null?s==="none"||s==="0"||Sb(s):!0}const DP=new Set(["brightness","contrast","saturate","opacity"]);function VP(s){const[e,t]=s.slice(0,-1).split("(");if(e==="drop-shadow")return s;const[n]=t.match(lh)||[];if(!n)return s;const r=t.replace(n,"");let i=DP.has(e)?1:0;return n!==t&&(i*=100),e+"("+i+r+")"}const MP=/\b([a-z-]*)\(.*?\)/gu,Bd={...En,getAnimatableNone:s=>{const e=s.match(MP);return e?e.map(VP).join(" "):s}},Gg={...ha,transform:Math.round},LP={rotate:nn,rotateX:nn,rotateY:nn,rotateZ:nn,scale:bo,scaleX:bo,scaleY:bo,scaleZ:bo,skew:nn,skewX:nn,skewY:nn,distance:ze,translateX:ze,translateY:ze,translateZ:ze,x:ze,y:ze,z:ze,perspective:ze,transformPerspective:ze,opacity:wi,originX:Pg,originY:Pg,originZ:ze},xh={borderWidth:ze,borderTopWidth:ze,borderRightWidth:ze,borderBottomWidth:ze,borderLeftWidth:ze,borderRadius:ze,radius:ze,borderTopLeftRadius:ze,borderTopRightRadius:ze,borderBottomRightRadius:ze,borderBottomLeftRadius:ze,width:ze,maxWidth:ze,height:ze,maxHeight:ze,top:ze,right:ze,bottom:ze,left:ze,padding:ze,paddingTop:ze,paddingRight:ze,paddingBottom:ze,paddingLeft:ze,margin:ze,marginTop:ze,marginRight:ze,marginBottom:ze,marginLeft:ze,backgroundPositionX:ze,backgroundPositionY:ze,...LP,zIndex:Gg,fillOpacity:wi,strokeOpacity:wi,numOctaves:Gg},OP={...xh,color:Ct,backgroundColor:Ct,outlineColor:Ct,fill:Ct,stroke:Ct,borderColor:Ct,borderTopColor:Ct,borderRightColor:Ct,borderBottomColor:Ct,borderLeftColor:Ct,filter:Bd,WebkitFilter:Bd},lv=s=>OP[s];function cv(s,e){let t=lv(s);return t!==Bd&&(t=En),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const FP=new Set(["auto","none","0"]);function $P(s,e,t){let n=0,r;for(;n<s.length&&!r;){const i=s[n];typeof i=="string"&&!FP.has(i)&&Ni(i).values.length&&(r=s[n]),n++}if(r&&t)for(const i of e)s[i]=cv(t,r)}class UP extends gh{constructor(e,t,n,r,i){super(e,t,n,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let u=e[c];if(typeof u=="string"&&(u=u.trim(),oh(u))){const h=rv(u,t.current);h!==void 0&&(e[c]=h),c===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!av.has(n)||e.length!==2)return;const[r,i]=e,o=zg(r),l=zg(i);if(o!==l)if(Fg(o)&&Fg(l))for(let c=0;c<e.length;c++){const u=e[c];typeof u=="string"&&(e[c]=parseFloat(u))}else Zn[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)(e[r]===null||RP(e[r]))&&n.push(r);n.length&&$P(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Zn[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(n,r).jump(r,!1)}measureEndState(){var l;const{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const i=n.length-1,o=n[i];n[i]=Zn[t](e.measureViewportBox(),window.getComputedStyle(e.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,u])=>{e.getValue(c).set(u)}),this.resolveNoneKeyframes()}}function BP(s,e,t){if(s instanceof EventTarget)return[s];if(typeof s=="string"){let n=document;const r=(t==null?void 0:t[s])??n.querySelectorAll(s);return r?Array.from(r):[]}return Array.from(s)}const dv=(s,e)=>e&&typeof s=="number"?e.transform(s):s;function zP(s){return Tb(s)&&"offsetHeight"in s}const qg=30,GP=s=>!isNaN(parseFloat(s));class qP{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var i;const r=ns.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((i=this.events.change)==null||i.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=ns.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=GP(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new nh);const n=this.events[e].add(t);return e==="change"?()=>{n(),pt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=ns.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>qg)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,qg);return Ab(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;(e=this.dependents)==null||e.clear(),(t=this.events.destroy)==null||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ea(s,e){return new qP(s,e)}const{schedule:yh}=$b(queueMicrotask,!1),Ns={x:!1,y:!1};function uv(){return Ns.x||Ns.y}function WP(s){return s==="x"||s==="y"?Ns[s]?null:(Ns[s]=!0,()=>{Ns[s]=!1}):Ns.x||Ns.y?null:(Ns.x=Ns.y=!0,()=>{Ns.x=Ns.y=!1})}function hv(s,e){const t=BP(s),n=new AbortController,r={passive:!0,...e,signal:n.signal};return[t,r,()=>n.abort()]}function Wg(s){return!(s.pointerType==="touch"||uv())}function KP(s,e,t={}){const[n,r,i]=hv(s,t),o=l=>{if(!Wg(l))return;const{target:c}=l,u=e(c,l);if(typeof u!="function"||!c)return;const h=m=>{Wg(m)&&(u(m),c.removeEventListener("pointerleave",h))};c.addEventListener("pointerleave",h,r)};return n.forEach(l=>{l.addEventListener("pointerenter",o,r)}),i}const mv=(s,e)=>e?s===e?!0:mv(s,e.parentElement):!1,bh=s=>s.pointerType==="mouse"?typeof s.button!="number"||s.button<=0:s.isPrimary!==!1,HP=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function JP(s){return HP.has(s.tagName)||s.tabIndex!==-1}const $o=new WeakSet;function Kg(s){return e=>{e.key==="Enter"&&s(e)}}function Mc(s,e){s.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const QP=(s,e)=>{const t=s.currentTarget;if(!t)return;const n=Kg(()=>{if($o.has(t))return;Mc(t,"down");const r=Kg(()=>{Mc(t,"up")}),i=()=>Mc(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",i,e)});t.addEventListener("keydown",n,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",n),e)};function Hg(s){return bh(s)&&!uv()}function YP(s,e,t={}){const[n,r,i]=hv(s,t),o=l=>{const c=l.currentTarget;if(!Hg(l))return;$o.add(c);const u=e(c,l),h=(N,v)=>{window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",p),$o.has(c)&&$o.delete(c),Hg(N)&&typeof u=="function"&&u(N,{success:v})},m=N=>{h(N,c===window||c===document||t.useGlobalTarget||mv(c,N.target))},p=N=>{h(N,!1)};window.addEventListener("pointerup",m,r),window.addEventListener("pointercancel",p,r)};return n.forEach(l=>{(t.useGlobalTarget?window:l).addEventListener("pointerdown",o,r),zP(l)&&(l.addEventListener("focus",u=>QP(u,r)),!JP(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),i}function fv(s){return Tb(s)&&"ownerSVGElement"in s}function XP(s){return fv(s)&&s.tagName==="svg"}const Jt=s=>!!(s&&s.getVelocity),ZP=[...ov,Ct,En],eC=s=>ZP.find(iv(s)),gv=_.createContext({transformPagePoint:s=>s,isStatic:!1,reducedMotion:"never"});function tC(s=!0){const e=_.useContext(Xu);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,i=_.useId();_.useEffect(()=>{if(s)return r(i)},[s]);const o=_.useCallback(()=>s&&n&&n(i),[i,n,s]);return!t&&n?[!1,o]:[!0]}const pv=_.createContext({strict:!1}),Jg={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ta={};for(const s in Jg)ta[s]={isEnabled:e=>Jg[s].some(t=>!!e[t])};function sC(s){for(const e in s)ta[e]={...ta[e],...s[e]}}const nC=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function pl(s){return s.startsWith("while")||s.startsWith("drag")&&s!=="draggable"||s.startsWith("layout")||s.startsWith("onTap")||s.startsWith("onPan")||s.startsWith("onLayout")||nC.has(s)}let xv=s=>!pl(s);function rC(s){typeof s=="function"&&(xv=e=>e.startsWith("on")?!pl(e):s(e))}try{rC(require("@emotion/is-prop-valid").default)}catch{}function aC(s,e,t){const n={};for(const r in s)r==="values"&&typeof s.values=="object"||(xv(r)||t===!0&&pl(r)||!e&&!pl(r)||s.draggable&&r.startsWith("onDrag"))&&(n[r]=s[r]);return n}const Ql=_.createContext({});function Yl(s){return s!==null&&typeof s=="object"&&typeof s.start=="function"}function _i(s){return typeof s=="string"||Array.isArray(s)}const vh=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],wh=["initial",...vh];function Xl(s){return Yl(s.animate)||wh.some(e=>_i(s[e]))}function yv(s){return!!(Xl(s)||s.variants)}function iC(s,e){if(Xl(s)){const{initial:t,animate:n}=s;return{initial:t===!1||_i(t)?t:void 0,animate:_i(n)?n:void 0}}return s.inherit!==!1?e:{}}function oC(s){const{initial:e,animate:t}=iC(s,_.useContext(Ql));return _.useMemo(()=>({initial:e,animate:t}),[Qg(e),Qg(t)])}function Qg(s){return Array.isArray(s)?s.join(" "):s}const ji={};function lC(s){for(const e in s)ji[e]=s[e],ih(e)&&(ji[e].isCSSVariable=!0)}function bv(s,{layout:e,layoutId:t}){return fa.has(s)||s.startsWith("origin")||(e||t!==void 0)&&(!!ji[s]||s==="opacity")}const cC={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},dC=ma.length;function uC(s,e,t){let n="",r=!0;for(let i=0;i<dC;i++){const o=ma[i],l=s[o];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(o.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||t){const u=dv(l,xh[o]);if(!c){r=!1;const h=cC[o]||o;n+=`${h}(${u}) `}t&&(e[o]=u)}}return n=n.trim(),t?n=t(e,r?"":n):r&&(n="none"),n}function Nh(s,e,t){const{style:n,vars:r,transformOrigin:i}=s;let o=!1,l=!1;for(const c in e){const u=e[c];if(fa.has(c)){o=!0;continue}else if(ih(c)){r[c]=u;continue}else{const h=dv(u,xh[c]);c.startsWith("origin")?(l=!0,i[c]=h):n[c]=h}}if(e.transform||(o||t?n.transform=uC(e,s.transform,t):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:u="50%",originZ:h=0}=i;n.transformOrigin=`${c} ${u} ${h}`}}const _h=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function vv(s,e,t){for(const n in e)!Jt(e[n])&&!bv(n,t)&&(s[n]=e[n])}function hC({transformTemplate:s},e){return _.useMemo(()=>{const t=_h();return Nh(t,e,s),Object.assign({},t.vars,t.style)},[e])}function mC(s,e){const t=s.style||{},n={};return vv(n,t,s),Object.assign(n,hC(s,e)),n}function fC(s,e){const t={},n=mC(s,e);return s.drag&&s.dragListener!==!1&&(t.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=s.drag===!0?"none":`pan-${s.drag==="x"?"y":"x"}`),s.tabIndex===void 0&&(s.onTap||s.onTapStart||s.whileTap)&&(t.tabIndex=0),t.style=n,t}const gC={offset:"stroke-dashoffset",array:"stroke-dasharray"},pC={offset:"strokeDashoffset",array:"strokeDasharray"};function xC(s,e,t=1,n=0,r=!0){s.pathLength=1;const i=r?gC:pC;s[i.offset]=ze.transform(-n);const o=ze.transform(e),l=ze.transform(t);s[i.array]=`${o} ${l}`}function wv(s,{attrX:e,attrY:t,attrScale:n,pathLength:r,pathSpacing:i=1,pathOffset:o=0,...l},c,u,h){if(Nh(s,l,u),c){s.style.viewBox&&(s.attrs.viewBox=s.style.viewBox);return}s.attrs=s.style,s.style={};const{attrs:m,style:p}=s;m.transform&&(p.transform=m.transform,delete m.transform),(p.transform||m.transformOrigin)&&(p.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),p.transform&&(p.transformBox=(h==null?void 0:h.transformBox)??"fill-box",delete m.transformBox),e!==void 0&&(m.x=e),t!==void 0&&(m.y=t),n!==void 0&&(m.scale=n),r!==void 0&&xC(m,r,i,o,!1)}const Nv=()=>({..._h(),attrs:{}}),_v=s=>typeof s=="string"&&s.toLowerCase()==="svg";function yC(s,e,t,n){const r=_.useMemo(()=>{const i=Nv();return wv(i,e,_v(n),s.transformTemplate,s.style),{...i.attrs,style:{...i.style}}},[e]);if(s.style){const i={};vv(i,s.style,s),r.style={...i,...r.style}}return r}const bC=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jh(s){return typeof s!="string"||s.includes("-")?!1:!!(bC.indexOf(s)>-1||/[A-Z]/u.test(s))}function vC(s,e,t,{latestValues:n},r,i=!1){const l=(jh(s)?yC:fC)(e,n,r,s),c=aC(e,typeof s=="string",i),u=s!==_.Fragment?{...c,...l,ref:t}:{},{children:h}=e,m=_.useMemo(()=>Jt(h)?h.get():h,[h]);return _.createElement(s,{...u,children:m})}function Yg(s){const e=[{},{}];return s==null||s.values.forEach((t,n)=>{e[0][n]=t.get(),e[1][n]=t.getVelocity()}),e}function Eh(s,e,t,n){if(typeof e=="function"){const[r,i]=Yg(n);e=e(t!==void 0?t:s.custom,r,i)}if(typeof e=="string"&&(e=s.variants&&s.variants[e]),typeof e=="function"){const[r,i]=Yg(n);e=e(t!==void 0?t:s.custom,r,i)}return e}function Uo(s){return Jt(s)?s.get():s}function wC({scrapeMotionValuesFromProps:s,createRenderState:e},t,n,r){return{latestValues:NC(t,n,r,s),renderState:e()}}function NC(s,e,t,n){const r={},i=n(s,{});for(const p in i)r[p]=Uo(i[p]);let{initial:o,animate:l}=s;const c=Xl(s),u=yv(s);e&&u&&!c&&s.inherit!==!1&&(o===void 0&&(o=e.initial),l===void 0&&(l=e.animate));let h=t?t.initial===!1:!1;h=h||o===!1;const m=h?l:o;if(m&&typeof m!="boolean"&&!Yl(m)){const p=Array.isArray(m)?m:[m];for(let N=0;N<p.length;N++){const v=Eh(s,p[N]);if(v){const{transitionEnd:I,transition:g,...S}=v;for(const C in S){let T=S[C];if(Array.isArray(T)){const V=h?T.length-1:0;T=T[V]}T!==null&&(r[C]=T)}for(const C in I)r[C]=I[C]}}}return r}const jv=s=>(e,t)=>{const n=_.useContext(Ql),r=_.useContext(Xu),i=()=>wC(s,e,n,r);return t?i():sk(i)};function Ih(s,e,t){var i;const{style:n}=s,r={};for(const o in n)(Jt(n[o])||e.style&&Jt(e.style[o])||bv(o,s)||((i=t==null?void 0:t.getValue(o))==null?void 0:i.liveStyle)!==void 0)&&(r[o]=n[o]);return r}const _C=jv({scrapeMotionValuesFromProps:Ih,createRenderState:_h});function Ev(s,e,t){const n=Ih(s,e,t);for(const r in s)if(Jt(s[r])||Jt(e[r])){const i=ma.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[i]=s[r]}return n}const jC=jv({scrapeMotionValuesFromProps:Ev,createRenderState:Nv}),EC=Symbol.for("motionComponentSymbol");function Pr(s){return s&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function IC(s,e,t){return _.useCallback(n=>{n&&s.onMount&&s.onMount(n),e&&(n?e.mount(n):e.unmount()),t&&(typeof t=="function"?t(n):Pr(t)&&(t.current=n))},[e])}const Th=s=>s.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),TC="framerAppearId",Iv="data-"+Th(TC),Tv=_.createContext({});function SC(s,e,t,n,r){var I,g;const{visualElement:i}=_.useContext(Ql),o=_.useContext(pv),l=_.useContext(Xu),c=_.useContext(gv).reducedMotion,u=_.useRef(null);n=n||o.renderer,!u.current&&n&&(u.current=n(s,{visualState:e,parent:i,props:t,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const h=u.current,m=_.useContext(Tv);h&&!h.projection&&r&&(h.type==="html"||h.type==="svg")&&AC(u.current,t,r,m);const p=_.useRef(!1);_.useInsertionEffect(()=>{h&&p.current&&h.update(t,l)});const N=t[Iv],v=_.useRef(!!N&&!((I=window.MotionHandoffIsComplete)!=null&&I.call(window,N))&&((g=window.MotionHasOptimisedAnimation)==null?void 0:g.call(window,N)));return nk(()=>{h&&(p.current=!0,window.MotionIsMounted=!0,h.updateFeatures(),h.scheduleRenderMicrotask(),v.current&&h.animationState&&h.animationState.animateChanges())}),_.useEffect(()=>{h&&(!v.current&&h.animationState&&h.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var S;(S=window.MotionHandoffMarkAsComplete)==null||S.call(window,N)}),v.current=!1),h.enteringChildren=void 0)}),h}function AC(s,e,t,n){const{layoutId:r,layout:i,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:u,layoutCrossfade:h}=e;s.projection=new t(s.latestValues,e["data-framer-portal-id"]?void 0:Sv(s.parent)),s.projection.setOptions({layoutId:r,layout:i,alwaysMeasureLayout:!!o||l&&Pr(l),visualElement:s,animationType:typeof i=="string"?i:"both",initialPromotionConfig:n,crossfade:h,layoutScroll:c,layoutRoot:u})}function Sv(s){if(s)return s.options.allowProjection!==!1?s.projection:Sv(s.parent)}function Lc(s,{forwardMotionProps:e=!1}={},t,n){t&&sC(t);const r=jh(s)?jC:_C;function i(l,c){let u;const h={..._.useContext(gv),...l,layoutId:kC(l)},{isStatic:m}=h,p=oC(l),N=r(l,m);if(!m&&Yu){PC();const v=CC(h);u=v.MeasureLayout,p.visualElement=SC(s,N,h,n,v.ProjectionNode)}return a.jsxs(Ql.Provider,{value:p,children:[u&&p.visualElement?a.jsx(u,{visualElement:p.visualElement,...h}):null,vC(s,l,IC(N,p.visualElement,c),N,m,e)]})}i.displayName=`motion.${typeof s=="string"?s:`create(${s.displayName??s.name??""})`}`;const o=_.forwardRef(i);return o[EC]=s,o}function kC({layoutId:s}){const e=_.useContext(Eb).id;return e&&s!==void 0?e+"-"+s:s}function PC(s,e){_.useContext(pv).strict}function CC(s){const{drag:e,layout:t}=ta;if(!e&&!t)return{};const n={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(s)||t!=null&&t.isEnabled(s)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function RC(s,e){if(typeof Proxy>"u")return Lc;const t=new Map,n=(i,o)=>Lc(i,o,s,e),r=(i,o)=>n(i,o);return new Proxy(r,{get:(i,o)=>o==="create"?n:(t.has(o)||t.set(o,Lc(o,void 0,s,e)),t.get(o))})}function Av({top:s,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:s,max:n}}}function DC({x:s,y:e}){return{top:e.min,right:s.max,bottom:e.max,left:s.min}}function VC(s,e){if(!e)return s;const t=e({x:s.left,y:s.top}),n=e({x:s.right,y:s.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function Oc(s){return s===void 0||s===1}function zd({scale:s,scaleX:e,scaleY:t}){return!Oc(s)||!Oc(e)||!Oc(t)}function Fn(s){return zd(s)||kv(s)||s.z||s.rotate||s.rotateX||s.rotateY||s.skewX||s.skewY}function kv(s){return Xg(s.x)||Xg(s.y)}function Xg(s){return s&&s!=="0%"}function xl(s,e,t){const n=s-t,r=e*n;return t+r}function Zg(s,e,t,n,r){return r!==void 0&&(s=xl(s,r,n)),xl(s,t,n)+e}function Gd(s,e=0,t=1,n,r){s.min=Zg(s.min,e,t,n,r),s.max=Zg(s.max,e,t,n,r)}function Pv(s,{x:e,y:t}){Gd(s.x,e.translate,e.scale,e.originPoint),Gd(s.y,t.translate,t.scale,t.originPoint)}const ep=.999999999999,tp=1.0000000000001;function MC(s,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let i,o;for(let l=0;l<r;l++){i=t[l],o=i.projectionDelta;const{visualElement:c}=i.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Rr(s,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,Pv(s,o)),n&&Fn(i.latestValues)&&Rr(s,i.latestValues))}e.x<tp&&e.x>ep&&(e.x=1),e.y<tp&&e.y>ep&&(e.y=1)}function Cr(s,e){s.min=s.min+e,s.max=s.max+e}function sp(s,e,t,n,r=.5){const i=vt(s.min,s.max,r);Gd(s,e,t,i,n)}function Rr(s,e){sp(s.x,e.x,e.scaleX,e.scale,e.originX),sp(s.y,e.y,e.scaleY,e.scale,e.originY)}function Cv(s,e){return Av(VC(s.getBoundingClientRect(),e))}function LC(s,e,t){const n=Cv(s,t),{scroll:r}=e;return r&&(Cr(n.x,r.offset.x),Cr(n.y,r.offset.y)),n}const np=()=>({translate:0,scale:1,origin:0,originPoint:0}),Dr=()=>({x:np(),y:np()}),rp=()=>({min:0,max:0}),At=()=>({x:rp(),y:rp()}),qd={current:null},Rv={current:!1};function OC(){if(Rv.current=!0,!!Yu)if(window.matchMedia){const s=window.matchMedia("(prefers-reduced-motion)"),e=()=>qd.current=s.matches;s.addEventListener("change",e),e()}else qd.current=!1}const FC=new WeakMap;function $C(s,e,t){for(const n in e){const r=e[n],i=t[n];if(Jt(r))s.addValue(n,r);else if(Jt(i))s.addValue(n,ea(r,{owner:s}));else if(i!==r)if(s.hasValue(n)){const o=s.getValue(n);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=s.getStaticValue(n);s.addValue(n,ea(o!==void 0?o:r,{owner:s}))}}for(const n in t)e[n]===void 0&&s.removeValue(n);return e}const ap=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class UC{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=gh,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=ns.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,pt.render(this.render,!1,!0))};const{latestValues:c,renderState:u}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=t.initial?{...c}:{},this.renderState=u,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=l,this.blockInitialAnimation=!!i,this.isControllingVariants=Xl(t),this.isVariantNode=yv(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:h,...m}=this.scrapeMotionValuesFromProps(t,{},this);for(const p in m){const N=m[p];c[p]!==void 0&&Jt(N)&&N.set(c[p])}}mount(e){var t;this.current=e,FC.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,r)=>this.bindToMotionValue(r,n)),Rv.current||OC(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:qd.current,(t=this.parent)==null||t.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),jn(this.notifyUpdate),jn(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=fa.has(e);n&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&pt.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let i;window.MotionCheckAppearSync&&(i=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),i&&i(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ta){const t=ta[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):At()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<ap.length;n++){const r=ap[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,o=e[i];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=$C(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ea(t===null?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(Ib(n)||Sb(n))?n=parseFloat(n):!eC(n)&&En.test(t)&&(n=cv(e,t)),this.setBaseTarget(e,Jt(n)?n.get():n)),Jt(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var i;const{initial:t}=this.props;let n;if(typeof t=="string"||typeof t=="object"){const o=Eh(this.props,t,(i=this.presenceContext)==null?void 0:i.custom);o&&(n=o[e])}if(t&&n!==void 0)return n;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!Jt(r)?r:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new nh),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){yh.render(this.render)}}class Dv extends UC{constructor(){super(...arguments),this.KeyframeResolver=UP}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Jt(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function Vv(s,{style:e,vars:t},n,r){const i=s.style;let o;for(o in e)i[o]=e[o];r==null||r.applyProjectionStyles(i,n);for(o in t)i.setProperty(o,t[o])}function BC(s){return window.getComputedStyle(s)}class zC extends Dv{constructor(){super(...arguments),this.type="html",this.renderInstance=Vv}readValueFromInstance(e,t){var n;if(fa.has(t))return(n=this.projection)!=null&&n.isProjecting?Md(t):iP(e,t);{const r=BC(e),i=(ih(t)?r.getPropertyValue(t):r[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return Cv(e,t)}build(e,t,n){Nh(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return Ih(e,t,n)}}const Mv=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function GC(s,e,t,n){Vv(s,e,void 0,n);for(const r in e.attrs)s.setAttribute(Mv.has(r)?r:Th(r),e.attrs[r])}class qC extends Dv{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=At}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(fa.has(t)){const n=lv(t);return n&&n.default||0}return t=Mv.has(t)?t:Th(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return Ev(e,t,n)}build(e,t,n){wv(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){GC(e,t,n,r)}mount(e){this.isSVGTag=_v(e.tagName),super.mount(e)}}const WC=(s,e)=>jh(s)?new qC(e):new zC(e,{allowProjection:s!==_.Fragment});function $r(s,e,t){const n=s.getProps();return Eh(n,e,t!==void 0?t:n.custom,s)}const Wd=s=>Array.isArray(s);function KC(s,e,t){s.hasValue(e)?s.getValue(e).set(t):s.addValue(e,ea(t))}function HC(s){return Wd(s)?s[s.length-1]||0:s}function JC(s,e){const t=$r(s,e);let{transitionEnd:n={},transition:r={},...i}=t||{};i={...i,...n};for(const o in i){const l=HC(i[o]);KC(s,o,l)}}function QC(s){return!!(Jt(s)&&s.add)}function Kd(s,e){const t=s.getValue("willChange");if(QC(t))return t.add(e);if(!t&&Hs.WillChange){const n=new Hs.WillChange("auto");s.addValue("willChange",n),n.add(e)}}function Lv(s){return s.props[Iv]}const YC=s=>s!==null;function XC(s,{repeat:e,repeatType:t="loop"},n){const r=s.filter(YC),i=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[i]}const ZC={type:"spring",stiffness:500,damping:25,restSpeed:10},eR=s=>({type:"spring",stiffness:550,damping:s===0?2*Math.sqrt(550):30,restSpeed:10}),tR={type:"keyframes",duration:.8},sR={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},nR=(s,{keyframes:e})=>e.length>2?tR:fa.has(s)?s.startsWith("scale")?eR(e[1]):ZC:sR;function rR({when:s,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:l,from:c,elapsed:u,...h}){return!!Object.keys(h).length}const Sh=(s,e,t,n={},r,i)=>o=>{const l=ph(n,s)||{},c=l.delay||n.delay||0;let{elapsed:u=0}=n;u=u-As(c);const h={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-u,onUpdate:p=>{e.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:s,motionValue:e,element:i?void 0:r};rR(l)||Object.assign(h,nR(s,h)),h.duration&&(h.duration=As(h.duration)),h.repeatDelay&&(h.repeatDelay=As(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let m=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(Ud(h),h.delay===0&&(m=!0)),(Hs.instantAnimations||Hs.skipAnimations)&&(m=!0,Ud(h),h.delay=0),h.allowFlatten=!l.type&&!l.ease,m&&!i&&e.get()!==void 0){const p=XC(h.keyframes,l);if(p!==void 0){pt.update(()=>{h.onUpdate(p),h.onComplete()});return}}return l.isSync?new fh(h):new AP(h)};function aR({protectedKeys:s,needsAnimating:e},t){const n=s.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function Ov(s,e,{delay:t=0,transitionOverride:n,type:r}={}){let{transition:i=s.getDefaultTransition(),transitionEnd:o,...l}=e;n&&(i=n);const c=[],u=r&&s.animationState&&s.animationState.getState()[r];for(const h in l){const m=s.getValue(h,s.latestValues[h]??null),p=l[h];if(p===void 0||u&&aR(u,h))continue;const N={delay:t,...ph(i||{},h)},v=m.get();if(v!==void 0&&!m.isAnimating&&!Array.isArray(p)&&p===v&&!N.velocity)continue;let I=!1;if(window.MotionHandoffAnimation){const S=Lv(s);if(S){const C=window.MotionHandoffAnimation(S,h,pt);C!==null&&(N.startTime=C,I=!0)}}Kd(s,h),m.start(Sh(h,m,p,s.shouldReduceMotion&&av.has(h)?{type:!1}:N,s,I));const g=m.animation;g&&c.push(g)}return o&&Promise.all(c).then(()=>{pt.update(()=>{o&&JC(s,o)})}),c}function Fv(s,e,t,n=0,r=1){const i=Array.from(s).sort((u,h)=>u.sortNodePosition(h)).indexOf(e),o=s.size,l=(o-1)*n;return typeof t=="function"?t(i,o):r===1?i*n:l-i*n}function Hd(s,e,t={}){var c;const n=$r(s,e,t.type==="exit"?(c=s.presenceContext)==null?void 0:c.custom:void 0);let{transition:r=s.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(r=t.transitionOverride);const i=n?()=>Promise.all(Ov(s,n,t)):()=>Promise.resolve(),o=s.variantChildren&&s.variantChildren.size?(u=0)=>{const{delayChildren:h=0,staggerChildren:m,staggerDirection:p}=r;return iR(s,e,u,h,m,p,t)}:()=>Promise.resolve(),{when:l}=r;if(l){const[u,h]=l==="beforeChildren"?[i,o]:[o,i];return u().then(()=>h())}else return Promise.all([i(),o(t.delay)])}function iR(s,e,t=0,n=0,r=0,i=1,o){const l=[];for(const c of s.variantChildren)c.notify("AnimationStart",e),l.push(Hd(c,e,{...o,delay:t+(typeof n=="function"?0:n)+Fv(s.variantChildren,c,n,r,i)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function oR(s,e,t={}){s.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(i=>Hd(s,i,t));n=Promise.all(r)}else if(typeof e=="string")n=Hd(s,e,t);else{const r=typeof e=="function"?$r(s,e,t.custom):e;n=Promise.all(Ov(s,r,t))}return n.then(()=>{s.notify("AnimationComplete",e)})}function $v(s,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==s.length)return!1;for(let n=0;n<t;n++)if(e[n]!==s[n])return!1;return!0}const lR=wh.length;function Uv(s){if(!s)return;if(!s.isControllingVariants){const t=s.parent?Uv(s.parent)||{}:{};return s.props.initial!==void 0&&(t.initial=s.props.initial),t}const e={};for(let t=0;t<lR;t++){const n=wh[t],r=s.props[n];(_i(r)||r===!1)&&(e[n]=r)}return e}const cR=[...vh].reverse(),dR=vh.length;function uR(s){return e=>Promise.all(e.map(({animation:t,options:n})=>oR(s,t,n)))}function hR(s){let e=uR(s),t=ip(),n=!0;const r=c=>(u,h)=>{var p;const m=$r(s,h,c==="exit"?(p=s.presenceContext)==null?void 0:p.custom:void 0);if(m){const{transition:N,transitionEnd:v,...I}=m;u={...u,...I,...v}}return u};function i(c){e=c(s)}function o(c){const{props:u}=s,h=Uv(s.parent)||{},m=[],p=new Set;let N={},v=1/0;for(let g=0;g<dR;g++){const S=cR[g],C=t[S],T=u[S]!==void 0?u[S]:h[S],V=_i(T),P=S===c?C.isActive:null;P===!1&&(v=g);let k=T===h[S]&&T!==u[S]&&V;if(k&&n&&s.manuallyAnimateOnMount&&(k=!1),C.protectedKeys={...N},!C.isActive&&P===null||!T&&!C.prevProp||Yl(T)||typeof T=="boolean")continue;const b=mR(C.prevProp,T);let x=b||S===c&&C.isActive&&!k&&V||g>v&&V,w=!1;const E=Array.isArray(T)?T:[T];let A=E.reduce(r(S),{});P===!1&&(A={});const{prevResolvedValues:D={}}=C,j={...D,...A},K=se=>{x=!0,p.has(se)&&(w=!0,p.delete(se)),C.needsAnimating[se]=!0;const M=s.getValue(se);M&&(M.liveStyle=!1)};for(const se in j){const M=A[se],L=D[se];if(N.hasOwnProperty(se))continue;let Y=!1;Wd(M)&&Wd(L)?Y=!$v(M,L):Y=M!==L,Y?M!=null?K(se):p.add(se):M!==void 0&&p.has(se)?K(se):C.protectedKeys[se]=!0}C.prevProp=T,C.prevResolvedValues=A,C.isActive&&(N={...N,...A}),n&&s.blockInitialAnimation&&(x=!1);const X=k&&b;x&&(!X||w)&&m.push(...E.map(se=>{const M={type:S};if(typeof se=="string"&&n&&!X&&s.manuallyAnimateOnMount&&s.parent){const{parent:L}=s,Y=$r(L,se);if(L.enteringChildren&&Y){const{delayChildren:z}=Y.transition||{};M.delay=Fv(L.enteringChildren,s,z)}}return{animation:se,options:M}}))}if(p.size){const g={};if(typeof u.initial!="boolean"){const S=$r(s,Array.isArray(u.initial)?u.initial[0]:u.initial);S&&S.transition&&(g.transition=S.transition)}p.forEach(S=>{const C=s.getBaseTarget(S),T=s.getValue(S);T&&(T.liveStyle=!0),g[S]=C??null}),m.push({animation:g})}let I=!!m.length;return n&&(u.initial===!1||u.initial===u.animate)&&!s.manuallyAnimateOnMount&&(I=!1),n=!1,I?e(m):Promise.resolve()}function l(c,u){var m;if(t[c].isActive===u)return Promise.resolve();(m=s.variantChildren)==null||m.forEach(p=>{var N;return(N=p.animationState)==null?void 0:N.setActive(c,u)}),t[c].isActive=u;const h=o(c);for(const p in t)t[p].protectedKeys={};return h}return{animateChanges:o,setActive:l,setAnimateFunction:i,getState:()=>t,reset:()=>{t=ip()}}}function mR(s,e){return typeof e=="string"?e!==s:Array.isArray(e)?!$v(e,s):!1}function Mn(s=!1){return{isActive:s,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ip(){return{animate:Mn(!0),whileInView:Mn(),whileHover:Mn(),whileTap:Mn(),whileDrag:Mn(),whileFocus:Mn(),exit:Mn()}}class kn{constructor(e){this.isMounted=!1,this.node=e}update(){}}class fR extends kn{constructor(e){super(e),e.animationState||(e.animationState=hR(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Yl(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let gR=0;class pR extends kn{constructor(){super(...arguments),this.id=gR++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const xR={animation:{Feature:fR},exit:{Feature:pR}};function Ei(s,e,t,n={passive:!0}){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t)}function Wi(s){return{point:{x:s.pageX,y:s.pageY}}}const yR=s=>e=>bh(e)&&s(e,Wi(e));function Qa(s,e,t,n){return Ei(s,e,yR(t),n)}const Bv=1e-4,bR=1-Bv,vR=1+Bv,zv=.01,wR=0-zv,NR=0+zv;function Yt(s){return s.max-s.min}function _R(s,e,t){return Math.abs(s-e)<=t}function op(s,e,t,n=.5){s.origin=n,s.originPoint=vt(e.min,e.max,s.origin),s.scale=Yt(t)/Yt(e),s.translate=vt(t.min,t.max,s.origin)-s.originPoint,(s.scale>=bR&&s.scale<=vR||isNaN(s.scale))&&(s.scale=1),(s.translate>=wR&&s.translate<=NR||isNaN(s.translate))&&(s.translate=0)}function Ya(s,e,t,n){op(s.x,e.x,t.x,n?n.originX:void 0),op(s.y,e.y,t.y,n?n.originY:void 0)}function lp(s,e,t){s.min=t.min+e.min,s.max=s.min+Yt(e)}function jR(s,e,t){lp(s.x,e.x,t.x),lp(s.y,e.y,t.y)}function cp(s,e,t){s.min=e.min-t.min,s.max=s.min+Yt(e)}function Xa(s,e,t){cp(s.x,e.x,t.x),cp(s.y,e.y,t.y)}function fs(s){return[s("x"),s("y")]}const Gv=({current:s})=>s?s.ownerDocument.defaultView:null,dp=(s,e)=>Math.abs(s-e);function ER(s,e){const t=dp(s.x,e.x),n=dp(s.y,e.y);return Math.sqrt(t**2+n**2)}class qv{constructor(e,t,{transformPagePoint:n,contextWindow:r=window,dragSnapToOrigin:i=!1,distanceThreshold:o=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=$c(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,v=ER(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!N&&!v)return;const{point:I}=p,{timestamp:g}=Bt;this.history.push({...I,timestamp:g});const{onStart:S,onMove:C}=this.handlers;N||(S&&S(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,p)},this.handlePointerMove=(p,N)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Fc(N,this.transformPagePoint),pt.update(this.updatePoint,!0)},this.handlePointerUp=(p,N)=>{this.end();const{onEnd:v,onSessionEnd:I,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=$c(p.type==="pointercancel"?this.lastMoveEventInfo:Fc(N,this.transformPagePoint),this.history);this.startEvent&&v&&v(p,S),I&&I(p,S)},!bh(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=o,this.contextWindow=r||window;const l=Wi(e),c=Fc(l,this.transformPagePoint),{point:u}=c,{timestamp:h}=Bt;this.history=[{...u,timestamp:h}];const{onSessionStart:m}=t;m&&m(e,$c(c,this.history)),this.removeListeners=zi(Qa(this.contextWindow,"pointermove",this.handlePointerMove),Qa(this.contextWindow,"pointerup",this.handlePointerUp),Qa(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),jn(this.updatePoint)}}function Fc(s,e){return e?{point:e(s.point)}:s}function up(s,e){return{x:s.x-e.x,y:s.y-e.y}}function $c({point:s},e){return{point:s,delta:up(s,Wv(e)),offset:up(s,IR(e)),velocity:TR(e,.1)}}function IR(s){return s[0]}function Wv(s){return s[s.length-1]}function TR(s,e){if(s.length<2)return{x:0,y:0};let t=s.length-1,n=null;const r=Wv(s);for(;t>=0&&(n=s[t],!(r.timestamp-n.timestamp>As(e)));)t--;if(!n)return{x:0,y:0};const i=ys(r.timestamp-n.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-n.x)/i,y:(r.y-n.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function SR(s,{min:e,max:t},n){return e!==void 0&&s<e?s=n?vt(e,s,n.min):Math.max(s,e):t!==void 0&&s>t&&(s=n?vt(t,s,n.max):Math.min(s,t)),s}function hp(s,e,t){return{min:e!==void 0?s.min+e:void 0,max:t!==void 0?s.max+t-(s.max-s.min):void 0}}function AR(s,{top:e,left:t,bottom:n,right:r}){return{x:hp(s.x,t,r),y:hp(s.y,e,n)}}function mp(s,e){let t=e.min-s.min,n=e.max-s.max;return e.max-e.min<s.max-s.min&&([t,n]=[n,t]),{min:t,max:n}}function kR(s,e){return{x:mp(s.x,e.x),y:mp(s.y,e.y)}}function PR(s,e){let t=.5;const n=Yt(s),r=Yt(e);return r>n?t=vi(e.min,e.max-n,s.min):n>r&&(t=vi(s.min,s.max-r,e.min)),Ks(0,1,t)}function CR(s,e){const t={};return e.min!==void 0&&(t.min=e.min-s.min),e.max!==void 0&&(t.max=e.max-s.min),t}const Jd=.35;function RR(s=Jd){return s===!1?s=0:s===!0&&(s=Jd),{x:fp(s,"left","right"),y:fp(s,"top","bottom")}}function fp(s,e,t){return{min:gp(s,e),max:gp(s,t)}}function gp(s,e){return typeof s=="number"?s:s[e]||0}const DR=new WeakMap;class VR{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=At(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const i=m=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Wi(m).point)},o=(m,p)=>{const{drag:N,dragPropagation:v,onDragStart:I}=this.getProps();if(N&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=WP(N),!this.openDragLock))return;this.latestPointerEvent=m,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),fs(S=>{let C=this.getAxisMotionValue(S).get()||0;if(ks.test(C)){const{projection:T}=this.visualElement;if(T&&T.layout){const V=T.layout.layoutBox[S];V&&(C=Yt(V)*(parseFloat(C)/100))}}this.originPoint[S]=C}),I&&pt.postRender(()=>I(m,p)),Kd(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},l=(m,p)=>{this.latestPointerEvent=m,this.latestPanInfo=p;const{dragPropagation:N,dragDirectionLock:v,onDirectionLock:I,onDrag:g}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:S}=p;if(v&&this.currentDirection===null){this.currentDirection=MR(S),this.currentDirection!==null&&I&&I(this.currentDirection);return}this.updateAxis("x",p.point,S),this.updateAxis("y",p.point,S),this.visualElement.render(),g&&g(m,p)},c=(m,p)=>{this.latestPointerEvent=m,this.latestPanInfo=p,this.stop(m,p),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>fs(m=>{var p;return this.getAnimationState(m)==="paused"&&((p=this.getAxisMotionValue(m).animation)==null?void 0:p.play())}),{dragSnapToOrigin:h}=this.getProps();this.panSession=new qv(e,{onSessionStart:i,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,distanceThreshold:n,contextWindow:Gv(this.visualElement)})}stop(e,t){const n=e||this.latestPointerEvent,r=t||this.latestPanInfo,i=this.isDragging;if(this.cancel(),!i||!r||!n)return;const{velocity:o}=r;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&pt.postRender(()=>l(n,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!vo(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=SR(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var i;const{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(i=this.visualElement.projection)==null?void 0:i.layout,r=this.constraints;e&&Pr(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=AR(n.layoutBox,e):this.constraints=!1,this.elastic=RR(t),r!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&fs(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=CR(n.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Pr(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=LC(n,r.root,this.visualElement.getTransformPagePoint());let o=kR(r.layout.layoutBox,i);if(t){const l=t(DC(o));this.hasMutatedConstraints=!!l,l&&(o=Av(l))}return o}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},u=fs(h=>{if(!vo(h,t,this.currentDirection))return;let m=c&&c[h]||{};o&&(m={min:0,max:0});const p=r?200:1e6,N=r?40:1e7,v={type:"inertia",velocity:n?e[h]:0,bounceStiffness:p,bounceDamping:N,timeConstant:750,restDelta:1,restSpeed:10,...i,...m};return this.startAxisValueAnimation(h,v)});return Promise.all(u).then(l)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return Kd(this.visualElement,e),n.start(Sh(e,n,0,t,this.visualElement,!1))}stopAnimation(){fs(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){fs(e=>{var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){fs(t=>{const{drag:n}=this.getProps();if(!vo(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:o,max:l}=r.layout.layoutBox[t];i.set(e[t]-vt(o,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!Pr(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};fs(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();r[o]=PR({min:c,max:c},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),fs(o=>{if(!vo(o,e,null))return;const l=this.getAxisMotionValue(o),{min:c,max:u}=this.constraints[o];l.set(vt(c,u,r[o]))})}addListeners(){if(!this.visualElement.current)return;DR.set(this.visualElement,this);const e=this.visualElement.current,t=Qa(e,"pointerdown",c=>{const{drag:u,dragListener:h=!0}=this.getProps();u&&h&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();Pr(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",n);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),pt.read(n);const o=Ei(window,"resize",()=>this.scalePositionWithinConstraints()),l=r.addEventListener("didUpdate",({delta:c,hasLayoutChanged:u})=>{this.isDragging&&u&&(fs(h=>{const m=this.getAxisMotionValue(h);m&&(this.originPoint[h]+=c[h].translate,m.set(m.get()+c[h].translate))}),this.visualElement.render())});return()=>{o(),t(),i(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=Jd,dragMomentum:l=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:l}}}function vo(s,e,t){return(e===!0||e===s)&&(t===null||t===s)}function MR(s,e=10){let t=null;return Math.abs(s.y)>e?t="y":Math.abs(s.x)>e&&(t="x"),t}class LR extends kn{constructor(e){super(e),this.removeGroupControls=vs,this.removeListeners=vs,this.controls=new VR(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||vs}unmount(){this.removeGroupControls(),this.removeListeners()}}const pp=s=>(e,t)=>{s&&pt.postRender(()=>s(e,t))};class OR extends kn{constructor(){super(...arguments),this.removePointerDownListener=vs}onPointerDown(e){this.session=new qv(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Gv(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:pp(e),onStart:pp(t),onMove:n,onEnd:(i,o)=>{delete this.session,r&&pt.postRender(()=>r(i,o))}}}mount(){this.removePointerDownListener=Qa(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Bo={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function xp(s,e){return e.max===e.min?0:s/(e.max-e.min)*100}const ka={correct:(s,e)=>{if(!e.target)return s;if(typeof s=="string")if(ze.test(s))s=parseFloat(s);else return s;const t=xp(s,e.target.x),n=xp(s,e.target.y);return`${t}% ${n}%`}},FR={correct:(s,{treeScale:e,projectionDelta:t})=>{const n=s,r=En.parse(s);if(r.length>5)return n;const i=En.createTransformer(s),o=typeof r[0]!="number"?1:0,l=t.x.scale*e.x,c=t.y.scale*e.y;r[0+o]/=l,r[1+o]/=c;const u=vt(l,c,.5);return typeof r[2+o]=="number"&&(r[2+o]/=u),typeof r[3+o]=="number"&&(r[3+o]/=u),i(r)}};let Uc=!1;class $R extends _.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;lC(UR),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),Uc&&i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Bo.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,{projection:o}=n;return o&&(o.isPresent=i,Uc=!0,r||e.layoutDependency!==t||t===void 0||e.isPresent!==i?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||pt.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),yh.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;Uc=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Kv(s){const[e,t]=tC(),n=_.useContext(Eb);return a.jsx($R,{...s,layoutGroup:n,switchLayoutGroup:_.useContext(Tv),isPresent:e,safeToRemove:t})}const UR={borderRadius:{...ka,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ka,borderTopRightRadius:ka,borderBottomLeftRadius:ka,borderBottomRightRadius:ka,boxShadow:FR};function BR(s,e,t){const n=Jt(s)?s:ea(s);return n.start(Sh("",n,e,t)),n.animation}const zR=(s,e)=>s.depth-e.depth;class GR{constructor(){this.children=[],this.isDirty=!1}add(e){Zu(this.children,e),this.isDirty=!0}remove(e){eh(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(zR),this.isDirty=!1,this.children.forEach(e)}}function qR(s,e){const t=ns.now(),n=({timestamp:r})=>{const i=r-t;i>=e&&(jn(n),s(i-e))};return pt.setup(n,!0),()=>jn(n)}const Hv=["TopLeft","TopRight","BottomLeft","BottomRight"],WR=Hv.length,yp=s=>typeof s=="string"?parseFloat(s):s,bp=s=>typeof s=="number"||ze.test(s);function KR(s,e,t,n,r,i){r?(s.opacity=vt(0,t.opacity??1,HR(n)),s.opacityExit=vt(e.opacity??1,0,JR(n))):i&&(s.opacity=vt(e.opacity??1,t.opacity??1,n));for(let o=0;o<WR;o++){const l=`border${Hv[o]}Radius`;let c=vp(e,l),u=vp(t,l);if(c===void 0&&u===void 0)continue;c||(c=0),u||(u=0),c===0||u===0||bp(c)===bp(u)?(s[l]=Math.max(vt(yp(c),yp(u),n),0),(ks.test(u)||ks.test(c))&&(s[l]+="%")):s[l]=u}(e.rotate||t.rotate)&&(s.rotate=vt(e.rotate||0,t.rotate||0,n))}function vp(s,e){return s[e]!==void 0?s[e]:s.borderRadius}const HR=Jv(0,.5,Mb),JR=Jv(.5,.95,vs);function Jv(s,e,t){return n=>n<s?0:n>e?1:t(vi(s,e,n))}function wp(s,e){s.min=e.min,s.max=e.max}function ms(s,e){wp(s.x,e.x),wp(s.y,e.y)}function Np(s,e){s.translate=e.translate,s.scale=e.scale,s.originPoint=e.originPoint,s.origin=e.origin}function _p(s,e,t,n,r){return s-=e,s=xl(s,1/t,n),r!==void 0&&(s=xl(s,1/r,n)),s}function QR(s,e=0,t=1,n=.5,r,i=s,o=s){if(ks.test(e)&&(e=parseFloat(e),e=vt(o.min,o.max,e/100)-o.min),typeof e!="number")return;let l=vt(i.min,i.max,n);s===i&&(l-=e),s.min=_p(s.min,e,t,l,r),s.max=_p(s.max,e,t,l,r)}function jp(s,e,[t,n,r],i,o){QR(s,e[t],e[n],e[r],e.scale,i,o)}const YR=["x","scaleX","originX"],XR=["y","scaleY","originY"];function Ep(s,e,t,n){jp(s.x,e,YR,t?t.x:void 0,n?n.x:void 0),jp(s.y,e,XR,t?t.y:void 0,n?n.y:void 0)}function Ip(s){return s.translate===0&&s.scale===1}function Qv(s){return Ip(s.x)&&Ip(s.y)}function Tp(s,e){return s.min===e.min&&s.max===e.max}function ZR(s,e){return Tp(s.x,e.x)&&Tp(s.y,e.y)}function Sp(s,e){return Math.round(s.min)===Math.round(e.min)&&Math.round(s.max)===Math.round(e.max)}function Yv(s,e){return Sp(s.x,e.x)&&Sp(s.y,e.y)}function Ap(s){return Yt(s.x)/Yt(s.y)}function kp(s,e){return s.translate===e.translate&&s.scale===e.scale&&s.originPoint===e.originPoint}class e4{constructor(){this.members=[]}add(e){Zu(this.members,e),e.scheduleRender()}remove(e){if(eh(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){n=i;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function t4(s,e,t){let n="";const r=s.x.translate/e.x,i=s.y.translate/e.y,o=(t==null?void 0:t.z)||0;if((r||i||o)&&(n=`translate3d(${r}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:u,rotate:h,rotateX:m,rotateY:p,skewX:N,skewY:v}=t;u&&(n=`perspective(${u}px) ${n}`),h&&(n+=`rotate(${h}deg) `),m&&(n+=`rotateX(${m}deg) `),p&&(n+=`rotateY(${p}deg) `),N&&(n+=`skewX(${N}deg) `),v&&(n+=`skewY(${v}deg) `)}const l=s.x.scale*e.x,c=s.y.scale*e.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const Bc=["","X","Y","Z"],s4=1e3;let n4=0;function zc(s,e,t,n){const{latestValues:r}=e;r[s]&&(t[s]=r[s],e.setStaticValue(s,0),n&&(n[s]=0))}function Xv(s){if(s.hasCheckedOptimisedAppear=!0,s.root===s)return;const{visualElement:e}=s.options;if(!e)return;const t=Lv(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:i}=s.options;window.MotionCancelOptimisedAnimation(t,"transform",pt,!(r||i))}const{parent:n}=s;n&&!n.hasCheckedOptimisedAppear&&Xv(n)}function Zv({attachResizeListener:s,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(o={},l=e==null?void 0:e()){this.id=n4++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(i4),this.nodes.forEach(d4),this.nodes.forEach(u4),this.nodes.forEach(o4)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new GR)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new nh),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=fv(o)&&!XP(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),s){let h,m=0;const p=()=>this.root.updateBlockedByResize=!1;pt.read(()=>{m=window.innerWidth}),s(o,()=>{const N=window.innerWidth;N!==m&&(m=N,this.root.updateBlockedByResize=!0,h&&h(),h=qR(p,250),Bo.hasAnimatedSinceResize&&(Bo.hasAnimatedSinceResize=!1,this.nodes.forEach(Rp)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:m,hasRelativeLayoutChanged:p,layout:N})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||p4,{onLayoutAnimationStart:I,onLayoutAnimationComplete:g}=u.getProps(),S=!this.targetLayout||!Yv(this.targetLayout,N),C=!m&&p;if(this.options.layoutRoot||this.resumeFrom||C||m&&(S||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const T={...ph(v,"layout"),onPlay:I,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(T.delay=0,T.type=!1),this.startAnimation(T),this.setAnimationOrigin(h,C)}else m||Rp(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=N})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),jn(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(h4),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Xv(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const m=this.path[h];m.shouldResetTransform=!0,m.updateScroll("snapshot"),m.options.layoutRoot&&m.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Pp);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Cp);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(c4),this.nodes.forEach(r4),this.nodes.forEach(a4)):this.nodes.forEach(Cp),this.clearAllSnapshots();const l=ns.now();Bt.delta=Ks(0,1e3/60,l-Bt.timestamp),Bt.timestamp=l,Bt.isProcessing=!0,Pc.update.process(Bt),Pc.preRender.process(Bt),Pc.render.process(Bt),Bt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,yh.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(l4),this.sharedNodes.forEach(m4)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,pt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){pt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Yt(this.snapshot.measuredBox.x)&&!Yt(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=At(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!Qv(this.projectionDelta),c=this.getTransformTemplate(),u=c?c(this.latestValues,""):void 0,h=u!==this.prevTransformTemplateValue;o&&this.instance&&(l||Fn(this.latestValues)||h)&&(r(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),x4(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:o}=this.options;if(!o)return At();const l=o.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(y4))){const{scroll:h}=this.root;h&&(Cr(l.x,h.offset.x),Cr(l.y,h.offset.y))}return l}removeElementScroll(o){var c;const l=At();if(ms(l,o),(c=this.scroll)!=null&&c.wasRoot)return l;for(let u=0;u<this.path.length;u++){const h=this.path[u],{scroll:m,options:p}=h;h!==this.root&&m&&p.layoutScroll&&(m.wasRoot&&ms(l,o),Cr(l.x,m.offset.x),Cr(l.y,m.offset.y))}return l}applyTransform(o,l=!1){const c=At();ms(c,o);for(let u=0;u<this.path.length;u++){const h=this.path[u];!l&&h.options.layoutScroll&&h.scroll&&h!==h.root&&Rr(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),Fn(h.latestValues)&&Rr(c,h.latestValues)}return Fn(this.latestValues)&&Rr(c,this.latestValues),c}removeTransform(o){const l=At();ms(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];if(!u.instance||!Fn(u.latestValues))continue;zd(u.latestValues)&&u.updateSnapshot();const h=At(),m=u.measurePageBox();ms(h,m),Ep(l,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,h)}return Fn(this.latestValues)&&Ep(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Bt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var p;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:m}=this.options;if(!(!this.layout||!(h||m))){if(this.resolvedRelativeTargetAt=Bt.timestamp,!this.targetDelta&&!this.relativeTarget){const N=this.getClosestProjectingParent();N&&N.layout&&this.animationProgress!==1?(this.relativeParent=N,this.forceRelativeParentToResolveTarget(),this.relativeTarget=At(),this.relativeTargetOrigin=At(),Xa(this.relativeTargetOrigin,this.layout.layoutBox,N.layout.layoutBox),ms(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=At(),this.targetWithTransforms=At()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),jR(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ms(this.target,this.layout.layoutBox),Pv(this.target,this.targetDelta)):ms(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const N=this.getClosestProjectingParent();N&&!!N.resumingFrom==!!this.resumingFrom&&!N.options.layoutScroll&&N.target&&this.animationProgress!==1?(this.relativeParent=N,this.forceRelativeParentToResolveTarget(),this.relativeTarget=At(),this.relativeTargetOrigin=At(),Xa(this.relativeTargetOrigin,this.target,N.target),ms(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||zd(this.parent.latestValues)||kv(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var v;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||(v=this.parent)!=null&&v.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Bt.timestamp&&(c=!1),c)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;ms(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,p=this.treeScale.y;MC(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=At());const{target:N}=o;if(!N){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Np(this.prevProjectionDelta.x,this.projectionDelta.x),Np(this.prevProjectionDelta.y,this.projectionDelta.y)),Ya(this.projectionDelta,this.layoutCorrected,N,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==p||!kp(this.projectionDelta.x,this.prevProjectionDelta.x)||!kp(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",N))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Dr(),this.projectionDelta=Dr(),this.projectionDeltaWithTransform=Dr()}setAnimationOrigin(o,l=!1){const c=this.snapshot,u=c?c.latestValues:{},h={...this.latestValues},m=Dr();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=At(),N=c?c.source:void 0,v=this.layout?this.layout.source:void 0,I=N!==v,g=this.getStack(),S=!g||g.members.length<=1,C=!!(I&&!S&&this.options.crossfade===!0&&!this.path.some(g4));this.animationProgress=0;let T;this.mixTargetDelta=V=>{const P=V/1e3;Dp(m.x,o.x,P),Dp(m.y,o.y,P),this.setTargetDelta(m),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Xa(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),f4(this.relativeTarget,this.relativeTargetOrigin,p,P),T&&ZR(this.relativeTarget,T)&&(this.isProjectionDirty=!1),T||(T=At()),ms(T,this.relativeTarget)),I&&(this.animationValues=h,KR(h,u,this.latestValues,P,C,S)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=P},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var l,c,u;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(u=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||u.stop(),this.pendingAnimation&&(jn(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=pt.update(()=>{Bo.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ea(0)),this.currentAnimation=BR(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:h=>{this.mixTargetDelta(h),o.onUpdate&&o.onUpdate(h)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(s4),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:u,latestValues:h}=o;if(!(!l||!c||!u)){if(this!==o&&this.layout&&u&&ew(this.options.animationType,this.layout.layoutBox,u.layoutBox)){c=this.target||At();const m=Yt(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+m;const p=Yt(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+p}ms(l,c),Rr(l,h),Ya(this.projectionDeltaWithTransform,this.layoutCorrected,l,h)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new e4),this.sharedNodes.get(o).add(l);const u=l.options.initialPromotionConfig;l.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var l;const{layoutId:o}=this.options;return o?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:o}=this.options;return o?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const u=this.getStack();u&&u.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const u={};c.z&&zc("z",o,u,this.animationValues);for(let h=0;h<Bc.length;h++)zc(`rotate${Bc[h]}`,o,u,this.animationValues),zc(`skew${Bc[h]}`,o,u,this.animationValues);o.render();for(const h in u)o.setStaticValue(h,u[h]),this.animationValues&&(this.animationValues[h]=u[h]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Uo(l==null?void 0:l.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Uo(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!Fn(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const h=u.animationValues||u.latestValues;this.applyTransformsToTarget();let m=t4(this.projectionDeltaWithTransform,this.treeScale,h);c&&(m=c(h,m)),o.transform=m;const{x:p,y:N}=this.projectionDelta;o.transformOrigin=`${p.origin*100}% ${N.origin*100}% 0`,u.animationValues?o.opacity=u===this?h.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:o.opacity=u===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const v in ji){if(h[v]===void 0)continue;const{correct:I,applyTo:g,isCSSVariable:S}=ji[v],C=m==="none"?h[v]:I(h[v],u);if(g){const T=g.length;for(let V=0;V<T;V++)o[g[V]]=C}else S?this.options.visualElement.renderState.vars[v]=C:o[v]=C}this.options.layoutId&&(o.pointerEvents=u===this?Uo(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(Pp),this.root.sharedNodes.clear()}}}function r4(s){s.updateLayout()}function a4(s){var t;const e=((t=s.resumeFrom)==null?void 0:t.snapshot)||s.snapshot;if(s.isLead()&&s.layout&&e&&s.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=s.layout,{animationType:i}=s.options,o=e.source!==s.layout.source;i==="size"?fs(m=>{const p=o?e.measuredBox[m]:e.layoutBox[m],N=Yt(p);p.min=n[m].min,p.max=p.min+N}):ew(i,e.layoutBox,n)&&fs(m=>{const p=o?e.measuredBox[m]:e.layoutBox[m],N=Yt(n[m]);p.max=p.min+N,s.relativeTarget&&!s.currentAnimation&&(s.isProjectionDirty=!0,s.relativeTarget[m].max=s.relativeTarget[m].min+N)});const l=Dr();Ya(l,n,e.layoutBox);const c=Dr();o?Ya(c,s.applyTransform(r,!0),e.measuredBox):Ya(c,n,e.layoutBox);const u=!Qv(l);let h=!1;if(!s.resumeFrom){const m=s.getClosestProjectingParent();if(m&&!m.resumeFrom){const{snapshot:p,layout:N}=m;if(p&&N){const v=At();Xa(v,e.layoutBox,p.layoutBox);const I=At();Xa(I,n,N.layoutBox),Yv(v,I)||(h=!0),m.options.layoutRoot&&(s.relativeTarget=I,s.relativeTargetOrigin=v,s.relativeParent=m)}}}s.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:c,layoutDelta:l,hasLayoutChanged:u,hasRelativeLayoutChanged:h})}else if(s.isLead()){const{onExitComplete:n}=s.options;n&&n()}s.options.transition=void 0}function i4(s){s.parent&&(s.isProjecting()||(s.isProjectionDirty=s.parent.isProjectionDirty),s.isSharedProjectionDirty||(s.isSharedProjectionDirty=!!(s.isProjectionDirty||s.parent.isProjectionDirty||s.parent.isSharedProjectionDirty)),s.isTransformDirty||(s.isTransformDirty=s.parent.isTransformDirty))}function o4(s){s.isProjectionDirty=s.isSharedProjectionDirty=s.isTransformDirty=!1}function l4(s){s.clearSnapshot()}function Pp(s){s.clearMeasurements()}function Cp(s){s.isLayoutDirty=!1}function c4(s){const{visualElement:e}=s.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),s.resetTransform()}function Rp(s){s.finishAnimation(),s.targetDelta=s.relativeTarget=s.target=void 0,s.isProjectionDirty=!0}function d4(s){s.resolveTargetDelta()}function u4(s){s.calcProjection()}function h4(s){s.resetSkewAndRotation()}function m4(s){s.removeLeadSnapshot()}function Dp(s,e,t){s.translate=vt(e.translate,0,t),s.scale=vt(e.scale,1,t),s.origin=e.origin,s.originPoint=e.originPoint}function Vp(s,e,t,n){s.min=vt(e.min,t.min,n),s.max=vt(e.max,t.max,n)}function f4(s,e,t,n){Vp(s.x,e.x,t.x,n),Vp(s.y,e.y,t.y,n)}function g4(s){return s.animationValues&&s.animationValues.opacityExit!==void 0}const p4={duration:.45,ease:[.4,0,.1,1]},Mp=s=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(s),Lp=Mp("applewebkit/")&&!Mp("chrome/")?Math.round:vs;function Op(s){s.min=Lp(s.min),s.max=Lp(s.max)}function x4(s){Op(s.x),Op(s.y)}function ew(s,e,t){return s==="position"||s==="preserve-aspect"&&!_R(Ap(e),Ap(t),.2)}function y4(s){var e;return s!==s.root&&((e=s.scroll)==null?void 0:e.wasRoot)}const b4=Zv({attachResizeListener:(s,e)=>Ei(s,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Gc={current:void 0},tw=Zv({measureScroll:s=>({x:s.scrollLeft,y:s.scrollTop}),defaultParent:()=>{if(!Gc.current){const s=new b4({});s.mount(window),s.setOptions({layoutScroll:!0}),Gc.current=s}return Gc.current},resetTransform:(s,e)=>{s.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:s=>window.getComputedStyle(s).position==="fixed"}),v4={pan:{Feature:OR},drag:{Feature:LR,ProjectionNode:tw,MeasureLayout:Kv}};function Fp(s,e,t){const{props:n}=s;s.animationState&&n.whileHover&&s.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,i=n[r];i&&pt.postRender(()=>i(e,Wi(e)))}class w4 extends kn{mount(){const{current:e}=this.node;e&&(this.unmount=KP(e,(t,n)=>(Fp(this.node,n,"Start"),r=>Fp(this.node,r,"End"))))}unmount(){}}class N4 extends kn{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=zi(Ei(this.node.current,"focus",()=>this.onFocus()),Ei(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function $p(s,e,t){const{props:n}=s;if(s.current instanceof HTMLButtonElement&&s.current.disabled)return;s.animationState&&n.whileTap&&s.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),i=n[r];i&&pt.postRender(()=>i(e,Wi(e)))}class _4 extends kn{mount(){const{current:e}=this.node;e&&(this.unmount=YP(e,(t,n)=>($p(this.node,n,"Start"),(r,{success:i})=>$p(this.node,r,i?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Qd=new WeakMap,qc=new WeakMap,j4=s=>{const e=Qd.get(s.target);e&&e(s)},E4=s=>{s.forEach(j4)};function I4({root:s,...e}){const t=s||document;qc.has(t)||qc.set(t,{});const n=qc.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(E4,{root:s,...e})),n[r]}function T4(s,e,t){const n=I4(e);return Qd.set(s,t),n.observe(s),()=>{Qd.delete(s),n.unobserve(s)}}const S4={some:0,all:1};class A4 extends kn{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:S4[r]},l=c=>{const{isIntersecting:u}=c;if(this.isInView===u||(this.isInView=u,i&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:h,onViewportLeave:m}=this.node.getProps(),p=u?h:m;p&&p(c)};return T4(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(k4(e,t))&&this.startObserver()}unmount(){}}function k4({viewport:s={}},{viewport:e={}}={}){return t=>s[t]!==e[t]}const P4={inView:{Feature:A4},tap:{Feature:_4},focus:{Feature:N4},hover:{Feature:w4}},C4={layout:{ProjectionNode:tw,MeasureLayout:Kv}},R4={...xR,...P4,...v4,...C4},Ur=RC(R4,WC);function D4(s){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M366.688 30.027c-1.01-.01-2.022-.01-3.034.004h.002c-41.495.563-83.634 22.155-110.844 69.282-41.912-117.77-236.49-76.29-232 64.5.64 20.068 5.132 38.987 12.454 56.917h76.45l21.22-74.126 26.375 90.134 18.46-64.312 17.238 48.303H328.1l21.222-74.126 26.375 90.13 18.46-64.308 17.238 48.303h72.517c7.097-18.183 10.927-37.136 10.307-56.917-2.61-83.04-63.874-133.082-127.533-133.786zM131.125 211.34l-7.842 27.39h-81.58c54.51 103.006 197.737 172.59 216.172 241.395 16.782-62.62 165.07-139.482 217.855-241.396h-77.023l-2.69-7.542-20.154 70.208-26.353-90.054-7.84 27.387H180.32l-2.69-7.54-20.15 70.206-26.355-90.056z"}}]})(s)}function V4(s){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M165.906 18.688C15.593 59.28-42.187 198.55 92.72 245.375h-1.095c.635.086 1.274.186 1.906.28 8.985 3.077 18.83 5.733 29.532 7.94C173.36 273.35 209.74 321.22 212.69 368c-33.514 23.096-59.47 62.844-59.47 62.844L179.5 469.53 138.28 493h81.97c-40.425-40.435-11.76-85.906 36.125-85.906 48.54 0 73.945 48.112 36.156 85.906h81.126l-40.375-23.47 26.283-38.686s-26.376-40.4-60.282-63.406c3.204-46.602 39.5-94.167 89.595-113.844 10.706-2.207 20.546-4.86 29.53-7.938.633-.095 1.273-.195 1.908-.28h-1.125c134.927-46.82 77.163-186.094-73.157-226.69-40.722 39.37 6.54 101.683 43.626 56.877 36.9 69.08 8.603 127.587-72.28 83.406-11.88 24.492-34.213 41.374-60.688 41.374-26.703 0-49.168-17.167-60.97-42-81.774 45.38-110.512-13.372-73.437-82.78 37.09 44.805 84.35-17.508 43.626-56.876zm90.79 35.92c-27.388 0-51.33 27.556-51.33 63.61 0 36.056 23.942 62.995 51.33 62.995 27.387 0 51.327-26.94 51.327-62.994 0-36.058-23.94-63.61-51.328-63.61z"}}]})(s)}function M4(s){return Ue({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M77.492 18.457l-17.726 3.127L69.09 74.47a1630.67 1630.67 0 0 0-15.8 2.54l-6.503-36.89-17.726 3.124 6.49 36.795a1877.847 1877.847 0 0 0-17.196 3.112l3.292 17.696c5.728-1.066 11.397-2.09 17.028-3.084l7.056 40.02 17.727-3.124-7.04-39.93c5.304-.88 10.57-1.725 15.798-2.54l9.777 55.45 17.727-3.126-9.697-54.99c8.483-1.218 16.866-2.338 25.18-3.38 15.54 46.39 34.697 99.995 66.936 134.448C190.86 250.992 192 268 214.56 310 192 348 176 412 167.21 471l-48 6v15H192c16-48 64-144 64-144s48 96 64 144h72.79v-15l-48-6C336 412 320 348 294 310c26-42 24.175-59.585 35.83-89.377 32.25-34.452 51.42-88.075 66.967-134.478 8.314 1.04 16.697 2.16 25.18 3.38l-9.696 54.99 17.728 3.124 9.777-55.45c5.23.815 10.494 1.66 15.8 2.54l-7.042 39.93 17.727 3.125 7.056-40.02c5.63.993 11.3 2.017 17.028 3.083l3.292-17.696c-5.78-1.075-11.507-2.11-17.195-3.113l6.49-36.796-17.727-3.125-6.504 36.89c-5.303-.88-10.57-1.727-15.8-2.54l9.324-52.886-17.726-3.127-9.406 53.35C365.982 63.31 310.982 59.04 256 59.04c-54.98 0-109.983 4.27-169.102 12.767l-9.406-53.35zM256 76.98c35.53 0 71.07 1.83 107.822 5.463-14.082 34.858-38.454 73.504-63.203 101.967C290.293 199.27 274.35 209 256 209c-18.35 0-34.294-9.73-44.62-24.59-24.748-28.463-49.12-67.11-63.202-101.967 36.75-3.633 72.29-5.463 107.822-5.463zM256 97c-20.835 0-39 20.24-39 47s18.165 47 39 47 39-20.24 39-47-18.165-47-39-47z"}}]})(s)}const Up="YOUR_RECAPTCHA_SITE_KEY",wo={monthly:{id:"monthly",title:"Monthly Plan",description:"Access the full coaching suite for 30 days.",amount:200,accent:"from-emerald-500/70 to-cyan-500/60"},twoMonth:{id:"twoMonth",title:"2 Month Plan",description:"Lock in momentum with a focused 60-day sprint.",amount:390,accent:"from-amber-500/70 to-orange-500/60"},threeMonth:{id:"threeMonth",title:"3 Month Plan",description:"Transformation starter pack with milestone reviews.",amount:599,accent:"from-blue-500/70 to-sky-500/60"},yearly:{id:"yearly",title:"Yearly Plan",description:"Best value. Includes VIP onboarding calls.",amount:2300,accent:"from-fuchsia-500/70 to-indigo-500/60"}},L4={fullName:"",email:"",phoneNumber:"",address:"",country:"",city:"",gender:"",dateOfBirth:"",notes:""},O4=()=>{const[s,e]=_.useState(L4),[t,n]=_.useState("monthly"),[r,i]=_.useState({}),[o,l]=_.useState(!1),[c,u]=_.useState(!1),[h,m]=_.useState(!1),[p,N]=_.useState(["","","","","",""]),[v,I]=_.useState(!1),[g,S]=_.useState(!1),[C,T]=_.useState(null),[V,P]=_.useState(null),k=_.useRef(!1),{showNotification:b}=yt(),x=ft(),w=_.useMemo(()=>[V4,D4,M4],[]);_.useEffect(()=>{k.current},[]);const E=async()=>(console.warn(" reCAPTCHA not configured, skipping verification"),.9),A=M=>{const{name:L,value:Y}=M.target;e(z=>({...z,[L]:Y})),r[L]&&i(z=>({...z,[L]:""}))},D=()=>{const M={};return s.fullName.trim()||(M.fullName="Full name is required"),s.email.trim()||(M.email="Email is required"),s.phoneNumber.trim()||(M.phoneNumber="Phone number is required"),s.address.trim()||(M.address="Address is required"),s.country.trim()||(M.country="Country is required"),s.city.trim()||(M.city="City is required"),s.gender.trim()||(M.gender="Gender is required"),s.dateOfBirth.trim()||(M.dateOfBirth="Date of birth is required"),i(M),Object.keys(M).length===0},j=M=>{const L=M.replace(/\D/g,"");return L.length===10?`+1${L}`:L.startsWith("1")&&L.length===11?`+${L}`:L.startsWith("+")?L:`+${L}`},K=async()=>{if(!s.phoneNumber.trim()){b({type:"error",message:"Please enter a phone number first"});return}if(!ls){b({type:"error",message:"Phone verification is not available. Please configure Firebase settings."});return}S(!0);try{const M=j(s.phoneNumber),L=EA("recaptcha-container"),Y=await Z2(ls,M,L);T(Y),m(!0),b({type:"success",message:"Verification code sent to your phone!"})}catch(M){console.error("OTP send error:",M);let L="Failed to send verification code. Please try again.";M.code==="auth/operation-not-allowed"?L="SMS verification is not enabled for your region. Please contact support or use a different phone number.":M.code==="auth/invalid-phone-number"?L="Invalid phone number format. Please include country code (e.g., +1234567890).":M.code==="auth/too-many-requests"?L="Too many requests. Please wait a few minutes before trying again.":M.code==="auth/quota-exceeded"?L="SMS quota exceeded. Please contact support.":M.message&&(L=M.message),b({type:"error",message:L})}finally{S(!1)}},X=(M,L)=>{if(!/^\d*$/.test(L))return;const Y=[...p];if(Y[M]=L.slice(-1),L&&M<5){const z=document.getElementById(`otp-${M+1}`);z&&z.focus()}N(Y)},W=async()=>{const M=p.join("");if(M.length!==6){b({type:"error",message:"Please enter the complete 6-digit code"});return}if(!C){b({type:"error",message:"Please request a new verification code"});return}I(!0);try{await C.confirm(M),u(!0),b({type:"success",message:"Phone number verified successfully!"})}catch(L){console.error("OTP verification error:",L),b({type:"error",message:"Invalid verification code. Please try again."}),N(["","","","","",""])}finally{I(!1)}},se=async M=>{var L,Y;if(M.preventDefault(),!D()){b({type:"error",message:"Please fill all required fields."});return}l(!0);try{const z=await E(),le={fullName:s.fullName.trim(),email:s.email.trim().toLowerCase(),phone:s.phoneNumber.trim(),address:s.address.trim(),country:s.country.trim(),city:s.city.trim(),gender:s.gender,dateOfBirth:s.dateOfBirth,notes:s.notes||"",selectedPlan:t,amount:wo[t].amount,recaptchaScore:z,phoneVerified:c||!1,status:"pending"};await ce.post("http://localhost:3000/api/employee-requests",le),b({type:"success",message:"Request submitted! Admin will review and create your account soon."}),x("/employee/payment-success",{state:{name:s.fullName,plan:wo[t].title,amount:wo[t].amount}})}catch(z){console.error("Employee request submission error:",z);const le=((Y=(L=z.response)==null?void 0:L.data)==null?void 0:Y.message)||z.message||"Unable to submit request. Please try again.";b({type:"error",message:le})}finally{l(!1)}};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[a.jsx("div",{className:"absolute -top-10 -left-10 w-72 h-72 bg-emerald-500/20 blur-[140px]"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-indigo-500/20 blur-[160px]"})]}),a.jsxs("div",{className:"relative max-w-6xl mx-auto px-4 py-20 space-y-14",children:[a.jsxs("header",{className:"text-center space-y-5",children:[a.jsx("p",{className:"uppercase tracking-[0.6em] text-xs text-emerald-400",children:"FitFix Coaches"}),a.jsx("h1",{className:"text-4xl md:text-5xl font-black",children:"Join the Elite Coaching Program"}),a.jsx("p",{className:"text-slate-300 max-w-3xl mx-auto",children:"Submit your details, optionally verify your phone, choose your subscription, and lock your seat."}),a.jsx("div",{className:"flex justify-center gap-6",children:w.map((M,L)=>a.jsx(Ur.div,{className:"w-14 h-14 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center",animate:{y:[0,-8,0]},transition:{duration:2+L*.3,repeat:1/0},children:a.jsx(M,{className:"text-2xl text-emerald-400"})},M.name))})]}),a.jsxs("div",{className:"grid lg:grid-cols-2 gap-10",children:[a.jsxs("form",{onSubmit:se,className:"bg-slate-900/70 border border-slate-800 rounded-3xl p-8 space-y-6 backdrop-blur",children:[a.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Personal Information"}),[{name:"fullName",label:"Full Name",type:"text"},{name:"email",label:"Email",type:"email"},{name:"address",label:"Address",type:"text"},{name:"country",label:"Country",type:"text"},{name:"city",label:"City",type:"text"}].map(M=>a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:M.type,name:M.name,value:s[M.name],onChange:A,className:`w-full bg-black/30 border ${r[M.name]?"border-rose-500/80":"border-slate-800"} rounded-2xl px-4 pt-5 pb-2 text-base focus:outline-none focus:border-emerald-400 transition`,placeholder:" "}),a.jsx("label",{className:"absolute top-2 left-4 text-xs uppercase tracking-[0.3em] text-slate-500",children:M.label}),r[M.name]&&a.jsx("p",{className:"text-rose-300 text-sm mt-1",children:r[M.name]})]},M.name)),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"tel",name:"phoneNumber",value:s.phoneNumber,onChange:A,disabled:c,className:`w-full bg-black/30 border ${r.phoneNumber?"border-rose-500/80":c?"border-emerald-500/50":"border-slate-800"} rounded-2xl px-4 pt-5 pb-2 text-base focus:outline-none focus:border-emerald-400 transition disabled:opacity-60`,placeholder:" "}),a.jsxs("label",{className:"absolute top-2 left-4 text-xs uppercase tracking-[0.3em] text-slate-500",children:["Phone Number ",ls&&a.jsx("span",{className:"text-slate-600",children:"(Optional verification)"})]}),c&&a.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2 text-emerald-400",children:[a.jsx(js,{className:"text-xl"}),a.jsx("span",{className:"text-xs",children:"Verified"})]}),r.phoneNumber&&a.jsx("p",{className:"text-rose-300 text-sm mt-1",children:r.phoneNumber}),ls&&!c&&a.jsx("p",{className:"text-slate-400 text-xs mt-1",children:" Phone verification is optional. You can verify now or submit without verification."}),!ls&&a.jsx("p",{className:"text-slate-400 text-xs mt-1",children:" Phone verification is not available. You can still submit the form."})]}),!c&&ls&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Optional: Verify your phone number for added security"}),h?a.jsxs(Ur.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Enter the 6-digit code sent to your phone"}),a.jsx("div",{className:"flex gap-2 justify-center",children:p.map((M,L)=>a.jsx("input",{id:`otp-${L}`,type:"text",inputMode:"numeric",maxLength:1,value:M,onChange:Y=>X(L,Y.target.value),className:"w-12 h-12 bg-black/30 border border-slate-800 rounded-xl text-center text-xl font-semibold focus:outline-none focus:border-emerald-400 transition"},L))}),a.jsxs("button",{type:"button",onClick:W,disabled:v||p.join("").length!==6,className:"w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-black font-semibold rounded-2xl py-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(xi,{className:"text-lg"}),v?"Verifying...":"Verify Code"]}),a.jsx("button",{type:"button",onClick:()=>{m(!1),N(["","","","","",""]),T(null)},className:"w-full text-slate-400 hover:text-white text-sm transition",children:"Request new code"})]}):a.jsxs("button",{type:"button",onClick:K,disabled:g||!s.phoneNumber.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-semibold rounded-2xl py-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(bi,{className:"text-lg"}),g?"Sending...":"Verify Phone (Optional)"]})]})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsxs("select",{name:"gender",value:s.gender,onChange:A,className:`w-full bg-black/30 border ${r.gender?"border-rose-500/80":"border-slate-800"} rounded-2xl px-4 pt-6 pb-2 text-base focus:outline-none focus:border-emerald-400 appearance-none`,children:[a.jsx("option",{value:"",children:"Select gender"}),a.jsx("option",{value:"female",children:"Female"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"other",children:"Other"})]}),a.jsx("label",{className:"absolute top-2 left-4 text-xs uppercase tracking-[0.3em] text-slate-500",children:"Gender"}),r.gender&&a.jsx("p",{className:"text-rose-300 text-sm mt-1",children:r.gender})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"date",name:"dateOfBirth",value:s.dateOfBirth,onChange:A,className:`w-full bg-black/30 border ${r.dateOfBirth?"border-rose-500/80":"border-slate-800"} rounded-2xl px-4 pt-6 pb-2 text-base focus:outline-none focus:border-emerald-400`}),a.jsx("label",{className:"absolute top-2 left-4 text-xs uppercase tracking-[0.3em] text-slate-500",children:"Date of Birth"}),r.dateOfBirth&&a.jsx("p",{className:"text-rose-300 text-sm mt-1",children:r.dateOfBirth})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("textarea",{name:"notes",value:s.notes,onChange:A,rows:3,className:"w-full bg-black/30 border border-slate-800 rounded-2xl px-4 pt-6 pb-2 text-base focus:outline-none focus:border-emerald-400 resize-none",placeholder:" "}),a.jsx("label",{className:"absolute top-2 left-4 text-xs uppercase tracking-[0.3em] text-slate-500",children:"Notes (optional)"})]}),a.jsxs("button",{type:"submit",disabled:o,className:"w-full bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 text-black font-semibold rounded-2xl py-4 flex items-center justify-center gap-3 shadow-xl shadow-emerald-500/40 hover:scale-[1.01] transition disabled:opacity-50 disabled:cursor-not-allowed",children:[o?"Submitting...":"Submit Request",!o&&a.jsx(PA,{className:"text-xl"})]}),a.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Note: Phone verification is optional. You can submit without verifying your phone number."})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/70 border border-slate-800 rounded-3xl p-8 backdrop-blur",children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-emerald-400 mb-3",children:"Choose your subscription plan"}),a.jsx("div",{className:"grid gap-4",children:Object.values(wo).map(M=>a.jsx(Ur.button,{type:"button",onClick:()=>n(M.id),whileHover:{scale:1.01},className:`relative text-left p-6 rounded-3xl border transition ${t===M.id?"border-transparent bg-gradient-to-br "+M.accent+" shadow-lg shadow-emerald-500/30":"border-slate-800 bg-black/40 hover:border-emerald-400/40"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/70",children:M.title}),a.jsxs("p",{className:"text-3xl font-bold mt-2",children:["$",M.amount]}),a.jsx("p",{className:"text-slate-200 mt-2",children:M.description})]}),t===M.id&&a.jsx("span",{className:"w-10 h-10 rounded-full bg-black/20 border border-white/30 flex items-center justify-center",children:a.jsx(js,{className:"text-2xl"})})]})},M.id))})]}),a.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl border border-slate-800 p-8 min-h-[220px] relative overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 opacity-20 blur-3xl bg-gradient-to-r from-emerald-500 to-cyan-500"}),a.jsxs("div",{className:"relative z-10 space-y-3",children:[a.jsx("h3",{className:"text-2xl font-semibold",children:"What happens next?"}),a.jsxs("ul",{className:"space-y-3 text-slate-200",children:[a.jsx("li",{children:"1. Fill in your personal information."}),a.jsx("li",{children:"2. (Optional) Verify your phone number with OTP."}),a.jsx("li",{children:"3. Pick the subscription that matches your goals."}),a.jsx("li",{children:"4. Submit your request for admin review."}),a.jsx("li",{children:"5. Admin approves and creates your account."}),a.jsx("li",{children:"6. You receive login credentials via email."})]})]})]})]})]})]}),a.jsx("div",{id:"recaptcha-container"})]})},F4=()=>{var i,o,l;const s=ft(),e=Tn(),t=(i=e.state)==null?void 0:i.name,n=(o=e.state)==null?void 0:o.plan,r=(l=e.state)==null?void 0:l.amount;return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white flex items-center justify-center px-4 py-12",children:a.jsxs(Ur.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"relative max-w-3xl w-full bg-slate-900/80 border border-slate-800 rounded-[36px] p-12 text-center backdrop-blur overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 blur-3xl opacity-60"}),a.jsxs("div",{className:"relative z-10 space-y-6",children:[a.jsx(Ur.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.1},className:"w-28 h-28 mx-auto rounded-full border-4 border-emerald-400 flex items-center justify-center",children:a.jsx(js,{className:"text-4xl text-emerald-300"})}),a.jsx("p",{className:"uppercase text-xs tracking-[0.5em] text-emerald-400",children:"Payment Received"}),a.jsx("h1",{className:"text-4xl font-black",children:"Welcome to the FitFix Team!"}),a.jsx("p",{className:"text-slate-300 max-w-2xl mx-auto",children:"Your payment has been recorded. The admin team will verify your details and send your dashboard credentials shortly."}),a.jsxs("div",{className:"grid sm:grid-cols-3 gap-4 text-left",children:[a.jsxs("div",{className:"bg-black/40 border border-slate-800 rounded-3xl p-5",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Coach"}),a.jsx("p",{className:"text-xl font-semibold mt-2",children:t||"Pending"})]}),a.jsxs("div",{className:"bg-black/40 border border-slate-800 rounded-3xl p-5",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Plan"}),a.jsx("p",{className:"text-xl font-semibold mt-2",children:n||""})]}),a.jsxs("div",{className:"bg-black/40 border border-slate-800 rounded-3xl p-5",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Amount"}),a.jsx("p",{className:"text-xl font-semibold mt-2",children:typeof r=="number"?`$${r.toFixed(2)}`:r?`$${r}`:"$"})]})]}),a.jsxs("div",{className:"space-y-2 text-slate-400",children:[a.jsx("p",{children:"Next steps:"}),a.jsx("p",{children:"1. Admin reviews your submission."}),a.jsx("p",{children:"2. Admin creates your employee account manually."}),a.jsx("p",{children:"3. Admin sends you an email with your login details."})]}),a.jsxs("div",{className:"flex flex-wrap gap-4 justify-center pt-4",children:[a.jsx("button",{onClick:()=>s("/login"),className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-emerald-500 to-teal-500 text-black font-semibold shadow-lg",children:"Back to Login"}),a.jsx("button",{onClick:()=>s("/contact-admin"),className:"px-6 py-3 rounded-2xl border border-slate-700 hover:border-emerald-400 transition",children:"Submit another request"})]}),a.jsxs("p",{className:"text-sm text-slate-500",children:["Need help? Email ",a.jsx("span",{className:"text-emerald-300",children:"support@fitfix.com"})]})]})]})})},$4=()=>{ft();const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState({email:"",password:"",displayName:"",phoneNumber:""}),[r,i]=_.useState([]),[o,l]=_.useState(!1),[c,u]=_.useState(!0),[h,m]=_.useState(null),[p,N]=_.useState({displayName:"",phoneNumber:"",isActive:!0}),[v,I]=_.useState(!1),[g,S]=_.useState({uid:"",email:"",name:"",newPassword:""}),[C,T]=_.useState(!1);_.useEffect(()=>{V();const M=()=>{console.log("Employee approved event received, refreshing employee list..."),P()};return window.addEventListener("employeeApproved",M),()=>{window.removeEventListener("employeeApproved",M)}},[]);const V=async()=>{await P()},P=async()=>{var M,L,Y,z,le,he;try{u(!0);const Ne=localStorage.getItem("token"),{data:_e}=await ce.get("http://localhost:3000/api/admin/employees",{headers:{Authorization:`Bearer ${Ne}`}});console.log("Employees API response:",_e),i(_e.data||[])}catch(Ne){console.error("Failed to load employees:",Ne),console.error("Error details:",{message:Ne.message,response:(M=Ne.response)==null?void 0:M.data,status:(L=Ne.response)==null?void 0:L.status,config:Ne.config});let _e="Failed to load employees";((Y=Ne.response)==null?void 0:Y.status)===401?(_e="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):((z=Ne.response)==null?void 0:z.status)===403?_e="Access denied. Admin access required.":Ne.response?(he=(le=Ne.response)==null?void 0:le.data)!=null&&he.message&&(_e=Ne.response.data.message):_e="Cannot connect to server. Make sure the backend is running.",s({type:"error",message:_e})}finally{u(!1)}},k=M=>{n({...t,[M.target.name]:M.target.value})},b=async M=>{var L,Y;if(M.preventDefault(),!t.email||!t.password){s({type:"error",message:"Email and password are required"});return}try{l(!0);const z=localStorage.getItem("token"),le=await ce.post("http://localhost:3000/api/admin/employees",t,{headers:{Authorization:`Bearer ${z}`}});s({type:"success",message:" Employee created! Credentials sent via email."}),n({email:"",password:"",displayName:"",phoneNumber:""}),await V(),T(!1)}catch(z){console.error("Create employee error:",z);const le=((Y=(L=z.response)==null?void 0:L.data)==null?void 0:Y.message)||"Failed to create employee";s({type:"error",message:le})}finally{l(!1)}},x=M=>{m(M.uid),N({displayName:M.displayName||"",phoneNumber:M.phoneNumber||"",isActive:M.isActive!==!1})},w=M=>{N({...p,[M.target.name]:M.target.value})},E=()=>{m(null),N({displayName:"",phoneNumber:"",isActive:!0})},A=async M=>{var L,Y;try{const z=localStorage.getItem("token");await ce.put(`http://localhost:3000/api/admin/employees/${M}`,p,{headers:{Authorization:`Bearer ${z}`}}),s({type:"success",message:" Employee updated successfully"}),m(null),await P()}catch(z){console.error("Update employee error:",z),s({type:"error",message:((Y=(L=z.response)==null?void 0:L.data)==null?void 0:Y.message)||"Failed to update employee"})}},D=async(M,L)=>{try{const Y=localStorage.getItem("token");await ce.put(`http://localhost:3000/api/admin/employees/${M}`,{isActive:!L},{headers:{Authorization:`Bearer ${Y}`}}),s({type:"success",message:`Employee ${L?"deactivated":"activated"}`}),await P()}catch(Y){console.error("Toggle status error:",Y),s({type:"error",message:"Failed to update status"})}},j=async(M,L)=>{var Y,z;if(window.confirm(`Are you sure you want to delete ${L}? This action cannot be undone.`))try{const le=localStorage.getItem("token");await ce.delete(`http://localhost:3000/api/admin/employees/${M}`,{headers:{Authorization:`Bearer ${le}`}}),s({type:"success",message:" Employee deleted successfully"}),await P()}catch(le){console.error("Delete employee error:",le),s({type:"error",message:((z=(Y=le.response)==null?void 0:Y.data)==null?void 0:z.message)||"Failed to delete employee"})}},K=M=>{S({uid:M.uid,email:M.email,name:M.displayName||M.email,newPassword:""}),I(!0)},X=()=>{I(!1),S({uid:"",email:"",name:"",newPassword:""})},W=M=>{S({...g,newPassword:M.target.value})},se=async()=>{var M,L;if(!g.newPassword||g.newPassword.length<6){s({type:"error",message:"Password must be at least 6 characters"});return}try{l(!0);const Y=localStorage.getItem("token");await ce.post("http://localhost:3000/api/admin/reset-employee-password",{uid:g.uid,email:g.email,name:g.name,newPassword:g.newPassword},{headers:{Authorization:`Bearer ${Y}`}}),s({type:"success",message:" Password updated & email sent to employee!"}),X()}catch(Y){console.error("Reset password error:",Y),s({type:"error",message:((L=(M=Y.response)==null?void 0:M.data)==null?void 0:L.message)||"Failed to reset password"})}finally{l(!1)}};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("header",{className:"mb-8",children:[a.jsx("h1",{className:`text-4xl font-black mb-2 ${e?"text-white":"text-gray-900"}`,children:"Employee Management"}),a.jsx("p",{className:e?"text-slate-400":"text-gray-600",children:"Manage your team members"})]}),a.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-8",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["All Employees (",r.length,")"]}),a.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Manage your team members"})]})}),c?a.jsxs("div",{className:"text-center py-10",children:[a.jsx("div",{className:"inline-block w-8 h-8 border-4 border-[#1f36ff] border-t-transparent rounded-full animate-spin"}),a.jsx("p",{className:"text-slate-400 mt-4",children:"Loading employees..."})]}):r.length===0?a.jsxs("div",{className:"text-center py-10",children:[a.jsx("p",{className:"text-slate-500",children:"No employees found"}),a.jsx("p",{className:"text-xs text-slate-600 mt-2",children:'Click "Add Employee" to create your first employee'})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-slate-700",children:[a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Employee"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Contact"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Join Date"}),a.jsx("th",{className:"text-right py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{children:r.map(M=>{var L;return a.jsxs("tr",{className:"border-b border-slate-800 hover:bg-slate-800/50 transition",children:[a.jsx("td",{className:"py-4 px-4",children:h===M.uid?a.jsx("input",{type:"text",name:"displayName",value:p.displayName,onChange:w,className:"bg-black/30 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-[#1f36ff]",placeholder:"Full Name"}):a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-white",children:M.displayName||"N/A"}),a.jsx("p",{className:"text-xs text-slate-500",children:M.uid})]})}),a.jsx("td",{className:"py-4 px-4",children:h===M.uid?a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-slate-400",children:M.email}),a.jsx("input",{type:"tel",name:"phoneNumber",value:p.phoneNumber,onChange:w,className:"bg-black/30 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:border-[#1f36ff] w-full",placeholder:"Phone Number"})]}):a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-white",children:M.email}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:M.phoneNumber||"No phone"})]})}),a.jsx("td",{className:"py-4 px-4",children:a.jsx("button",{onClick:()=>D(M.uid,M.isActive),className:`px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-2 transition ${M.isActive?"bg-emerald-500/20 text-emerald-300 hover:bg-emerald-500/30":"bg-slate-700/50 text-slate-400 hover:bg-slate-700"}`,children:M.isActive?a.jsxs(a.Fragment,{children:[a.jsx(FA,{className:"text-lg"}),"Active"]}):a.jsxs(a.Fragment,{children:[a.jsx(OA,{className:"text-lg"}),"Inactive"]})})}),a.jsx("td",{className:"py-4 px-4",children:a.jsx("p",{className:"text-sm text-slate-400",children:(L=M.createdAt)!=null&&L.toDate?new Date(M.createdAt.toDate()).toLocaleDateString():"N/A"})}),a.jsx("td",{className:"py-4 px-4",children:h===M.uid?a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{onClick:()=>A(M.uid),className:"p-2 rounded-lg bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 transition",title:"Save Changes",children:a.jsx(Jl,{})}),a.jsx("button",{onClick:E,className:"p-2 rounded-lg bg-slate-700/50 text-slate-400 hover:bg-slate-700 transition",title:"Cancel",children:a.jsx(mt,{})})]}):a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{onClick:()=>x(M),className:"p-2 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition",title:"Edit Employee",children:a.jsx(is,{})}),a.jsx("button",{onClick:()=>K(M),className:"p-2 rounded-lg bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition",title:"Reset Password",children:a.jsx(Tg,{})}),a.jsx("button",{onClick:()=>j(M.uid,M.displayName),className:"p-2 rounded-lg bg-rose-500/20 text-rose-400 hover:bg-rose-500/30 transition",title:"Delete Employee",children:a.jsx(xt,{})})]})})]},M.uid)})})]})})]})]})}),C&&a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto",children:a.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-3xl w-full max-w-2xl my-8",children:a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-[#1f36ff]/20 flex items-center justify-center",children:a.jsx(hl,{className:"text-[#1f36ff] text-xl"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Add New Employee"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Credentials will be sent via email"})]})]}),a.jsx("button",{onClick:()=>T(!1),className:"p-2 hover:bg-slate-800 rounded-lg transition",title:"Close",children:a.jsx(mt,{className:"text-2xl"})})]}),a.jsxs("form",{onSubmit:b,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-slate-300 mb-2",children:[a.jsx(Bi,{className:"inline mr-2"}),"Full Name"]}),a.jsx("input",{type:"text",name:"displayName",value:t.displayName,onChange:k,className:"w-full bg-black/30 border border-slate-700 rounded-2xl px-4 py-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-[#1f36ff] transition",placeholder:"John Doe",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-slate-300 mb-2",children:[a.jsx(Qu,{className:"inline mr-2"}),"Email Address"]}),a.jsx("input",{type:"email",name:"email",value:t.email,onChange:k,className:"w-full bg-black/30 border border-slate-700 rounded-2xl px-4 py-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-[#1f36ff] transition",placeholder:"employee@fitfix.com",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-slate-300 mb-2",children:[a.jsx(xi,{className:"inline mr-2"}),"Temporary Password"]}),a.jsx("input",{type:"text",name:"password",value:t.password,onChange:k,className:"w-full bg-black/30 border border-slate-700 rounded-2xl px-4 py-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-[#1f36ff] transition",placeholder:"TempPass123",required:!0}),a.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Employee will be asked to change this on first login"})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-slate-300 mb-2",children:[a.jsx(DA,{className:"inline mr-2"}),"Phone Number (Optional)"]}),a.jsx("input",{type:"tel",name:"phoneNumber",value:t.phoneNumber,onChange:k,className:"w-full bg-black/30 border border-slate-700 rounded-2xl px-4 py-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-[#1f36ff] transition",placeholder:"+1 234 567 8900"})]}),a.jsxs("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"submit",disabled:o,className:"flex-1 bg-gradient-to-r from-[#1f36ff] to-[#15b5ff] text-white py-4 rounded-2xl font-bold hover:shadow-lg hover:shadow-blue-500/50 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Creating Account & Sending Email...":"Create Employee Account"}),a.jsx("button",{type:"button",onClick:()=>T(!1),disabled:o,className:"px-6 bg-slate-800 text-slate-300 py-4 rounded-2xl font-bold hover:bg-slate-700 transition disabled:opacity-50",children:"Cancel"})]})]})]})})}),v&&a.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-3xl p-8 max-w-md w-full shadow-2xl",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center",children:a.jsx(Tg,{className:"text-purple-400 text-xl"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl font-bold",children:"Reset Password"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Update employee login credentials"})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"bg-black/30 border border-slate-700 rounded-2xl p-4 mb-4",children:[a.jsx("p",{className:"text-sm text-slate-400",children:"Employee"}),a.jsx("p",{className:"font-semibold text-white mt-1",children:g.name}),a.jsx("p",{className:"text-sm text-slate-500 mt-1",children:g.email})]}),a.jsxs("label",{className:"block text-sm font-semibold text-slate-300 mb-2",children:[a.jsx(xi,{className:"inline mr-2"}),"New Password"]}),a.jsx("input",{type:"text",value:g.newPassword,onChange:W,className:"w-full bg-black/30 border border-slate-700 rounded-2xl px-4 py-3 text-white placeholder:text-slate-500 focus:outline-none focus:border-purple-400 transition",placeholder:"Enter new password (min 6 characters)",autoFocus:!0}),a.jsx("p",{className:"text-xs text-slate-500 mt-2",children:" Employee will receive an email with the new password"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:se,disabled:o,className:"flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-2xl font-bold hover:shadow-lg hover:shadow-purple-500/50 transition disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Updating...":"Update & Send Email"}),a.jsx("button",{onClick:X,disabled:o,className:"px-6 bg-slate-800 text-slate-300 py-3 rounded-2xl font-bold hover:bg-slate-700 transition disabled:opacity-50",children:"Cancel"})]})]})})]})},U4=()=>{ft();const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState(!0),[o,l]=_.useState(!1);_.useEffect(()=>{c(!0);const g=setInterval(()=>{c(!1)},3e4);return()=>clearInterval(g)},[]);const c=async(g=!0)=>{var S,C,T,V,P,k;try{g&&i(!0);const b=localStorage.getItem("token"),{data:x}=await ce.get("http://localhost:3000/api/subscriptions",{headers:{Authorization:`Bearer ${b}`}}),w=(x.data||[]).sort((E,A)=>{var K,X;const D=(K=E.createdAt)!=null&&K.toDate?E.createdAt.toDate():new Date(E.createdAt||0);return((X=A.createdAt)!=null&&X.toDate?A.createdAt.toDate():new Date(A.createdAt||0))-D});n(w)}catch(b){console.error("Failed to load subscriptions:",b),console.error("Error details:",{message:b.message,response:(S=b.response)==null?void 0:S.data,status:(C=b.response)==null?void 0:C.status,config:b.config});let x="Failed to load subscriptions";((T=b.response)==null?void 0:T.status)===401?(x="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):((V=b.response)==null?void 0:V.status)===403?x="Access denied. Admin access required.":b.response?(k=(P=b.response)==null?void 0:P.data)!=null&&k.message&&(x=b.response.data.message):x="Cannot connect to server. Make sure the backend is running.",g&&s({type:"error",message:x})}finally{g&&i(!1)}},u=async()=>{try{l(!0);const g=localStorage.getItem("token");await ce.post("http://localhost:3000/api/subscriptions/check-expirations",{},{headers:{Authorization:`Bearer ${g}`}}),s({type:"success",message:"Subscription expirations checked successfully"}),await c()}catch(g){console.error("Failed to check expirations:",g),s({type:"error",message:"Failed to check expirations"})}finally{l(!1)}},h=g=>{if(g.status==="expired"||!g.isActive)return a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-rose-500/20 text-rose-400 flex items-center gap-1",children:[a.jsx(Fr,{})," Expired"]});if(!g.expirationDate)return a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-slate-500/20 text-slate-400 flex items-center gap-1",children:[a.jsx(Ac,{})," Unknown"]});const S=new Date,C=m(g.expirationDate);if(!C)return a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-slate-500/20 text-slate-400 flex items-center gap-1",children:[a.jsx(Ac,{})," Unknown"]});const T=Math.ceil((C-S)/(1e3*60*60*24));return T<=2&&T>0?a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-yellow-500/20 text-yellow-400 flex items-center gap-1",children:[a.jsx(Ac,{})," Expiring Soon"]}):T<=0?a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-rose-500/20 text-rose-400 flex items-center gap-1",children:[a.jsx(Fr,{})," Expired"]}):a.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-emerald-500/20 text-emerald-400 flex items-center gap-1",children:[a.jsx(js,{})," Active"]})},m=g=>{if(!g)return null;try{if(g&&typeof g.toDate=="function")return g.toDate();if(g&&g.seconds)return new Date(g.seconds*1e3);if(g&&g._seconds)return new Date(g._seconds*1e3);if(g instanceof Date)return g;{const S=new Date(g);return isNaN(S.getTime())?null:S}}catch(S){return console.error("Error converting timestamp:",S,g),null}},p=g=>{const S=m(g);return S?S.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"},N=g=>{if(!g.expirationDate)return"N/A";const S=new Date,C=m(g.expirationDate);if(!C)return"N/A";const T=Math.ceil((C-S)/(1e3*60*60*24));return T<0?`Expired ${Math.abs(T)} days ago`:T===0?"Expires today":T===1?"Expires tomorrow":`${T} days remaining`},v=t.filter(g=>g.status==="active"&&g.isActive),I=t.filter(g=>g.status==="expired"||!g.isActive);return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("header",{className:"mb-8",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-4xl font-black mb-2",children:"Subscriptions"}),a.jsx("p",{className:"text-slate-400",children:"Manage employee subscriptions and expirations"})]}),a.jsxs("button",{onClick:u,disabled:o,className:"flex items-center gap-2 bg-gradient-to-r from-[#1f36ff] to-[#15b5ff] text-white px-6 py-3 rounded-2xl font-bold hover:shadow-lg hover:shadow-blue-500/50 transition disabled:opacity-50",children:[a.jsx(yi,{className:`text-xl ${o?"animate-spin":""}`}),o?"Checking...":"Check Expirations"]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Total Subscriptions"}),a.jsx("p",{className:"text-3xl font-bold",children:t.length})]}),a.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:a.jsx(Hu,{className:"text-blue-400 text-xl"})})]})}),a.jsx("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Active"}),a.jsx("p",{className:"text-3xl font-bold text-emerald-400",children:v.length})]}),a.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center",children:a.jsx(js,{className:"text-emerald-400 text-xl"})})]})}),a.jsx("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"Expired"}),a.jsx("p",{className:"text-3xl font-bold text-rose-400",children:I.length})]}),a.jsx("div",{className:"w-12 h-12 rounded-full bg-rose-500/20 flex items-center justify-center",children:a.jsx(Fr,{className:"text-rose-400 text-xl"})})]})})]}),a.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-8",children:[a.jsx("h2",{className:"text-2xl font-bold mb-6",children:"All Subscriptions"}),r?a.jsxs("div",{className:"text-center py-10",children:[a.jsx("div",{className:"inline-block w-8 h-8 border-4 border-[#1f36ff] border-t-transparent rounded-full animate-spin"}),a.jsx("p",{className:"text-slate-400 mt-4",children:"Loading subscriptions..."})]}):t.length===0?a.jsx("div",{className:"text-center py-10",children:a.jsx("p",{className:"text-slate-500",children:"No subscriptions found"})}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-slate-700",children:[a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"User"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Subscription Plan"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Payment Date"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Account Created"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Expire Date"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Status"}),a.jsx("th",{className:"text-left py-4 px-4 text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Time Remaining"})]})}),a.jsx("tbody",{children:t.map(g=>a.jsxs("tr",{className:"border-b border-slate-800 hover:bg-slate-800/50 transition",children:[a.jsx("td",{className:"py-4 px-4",children:a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-white",children:g.employeeName||"N/A"}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:g.employeeEmail})]})}),a.jsx("td",{className:"py-4 px-4",children:a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-semibold text-white",children:g.planLabel||g.planType||"N/A"}),a.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["$",g.amount||0]})]})}),a.jsx("td",{className:"py-4 px-4",children:(()=>{const S=g.paymentDate||g.startDate||g.createdAt,C=m(S);return C?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-white font-medium",children:p(S)}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:C.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}):a.jsx("span",{className:"text-sm text-slate-500",children:"N/A"})})()}),a.jsx("td",{className:"py-4 px-4",children:(()=>{if(!g.accountCreatedAt)return a.jsx("span",{className:"text-sm text-slate-500 italic",children:"Not created yet"});const S=m(g.accountCreatedAt);return S?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-white font-medium",children:p(g.accountCreatedAt)}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:S.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}):a.jsx("span",{className:"text-sm text-slate-500",children:"Invalid Date"})})()}),a.jsx("td",{className:"py-4 px-4",children:(()=>{if(!g.expirationDate)return a.jsx("span",{className:"text-sm text-slate-500",children:"N/A"});const S=m(g.expirationDate);return S?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-sm text-white font-medium",children:p(g.expirationDate)}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:S.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}):a.jsx("span",{className:"text-sm text-slate-500",children:"Invalid Date"})})()}),a.jsx("td",{className:"py-4 px-4",children:h(g)}),a.jsx("td",{className:"py-4 px-4",children:a.jsx("p",{className:"text-sm text-slate-300 font-medium",children:N(g)})})]},g.id))})]})})]})]})})]})},Bp={pending:"bg-amber-500/15 text-amber-200 border border-amber-400/40",approved:"bg-emerald-500/15 text-emerald-200 border border-emerald-400/40",rejected:"bg-rose-500/15 text-rose-200 border border-rose-400/40"},B4=()=>{var V;const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState(!0),[o,l]=_.useState(null),[c,u]=_.useState(null),[h,m]=_.useState(!1),[p,N]=_.useState("all"),v=async()=>{try{i(!0);const P=localStorage.getItem("token"),k=await ce.get("http://localhost:3000/api/employee-requests",{headers:{Authorization:`Bearer ${P}`}});n(k.data.data||[])}catch(P){console.error("Failed to load requests",P),s({type:"error",message:"Unable to fetch requests."})}finally{i(!1)}};_.useEffect(()=>{v();const P=setInterval(v,3e4);return()=>clearInterval(P)},[]);const I=async P=>{var k,b,x;if(window.confirm("Are you sure you want to approve this request? An employee account will be created.")){l(P);try{const w=localStorage.getItem("token"),D=(k=((await ce.post(`http://localhost:3000/api/employee-requests/approve/${P}`,{},{headers:{Authorization:`Bearer ${w}`}})).data||{}).data)==null?void 0:k.employeeUid;s({type:"success",message:"Request approved! Employee account created and credentials sent via email."}),await v(),window.dispatchEvent(new CustomEvent("employeeApproved",{detail:{employeeUid:D}}))}catch(w){console.error("Approve error",w),s({type:"error",message:((x=(b=w.response)==null?void 0:b.data)==null?void 0:x.message)||"Failed to approve request"})}finally{l(null)}}},g=async P=>{var b,x;const k=window.prompt("Enter rejection reason (optional):");if(k!==null){l(P);try{const w=localStorage.getItem("token");await ce.post(`http://localhost:3000/api/employee-requests/reject/${P}`,{reason:k},{headers:{Authorization:`Bearer ${w}`}}),s({type:"success",message:"Request rejected successfully"}),await v()}catch(w){console.error("Reject error",w),s({type:"error",message:((x=(b=w.response)==null?void 0:b.data)==null?void 0:x.message)||"Failed to reject request"})}finally{l(null)}}},S=P=>{u(P),m(!0)},C=t.filter(P=>p==="all"?!0:P.status===p),T={total:t.length,pending:t.filter(P=>P.status==="pending").length,approved:t.filter(P=>P.status==="approved").length,rejected:t.filter(P=>P.status==="rejected").length};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 px-4 py-12",children:a.jsxs("div",{className:"max-w-7xl mx-auto space-y-10",children:[a.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.5em] text-emerald-400 mb-2",children:"Admin Control"}),a.jsx("h1",{className:"text-4xl font-black",children:"Employee Requests"}),a.jsx("p",{className:"text-slate-300 mt-2",children:"Review and approve employee registration requests"})]}),a.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-2xl px-6 py-4 flex items-center gap-3",children:[a.jsx(MA,{className:"text-3xl text-emerald-400"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-400",children:"Pending Requests"}),a.jsx("p",{className:"text-2xl font-semibold",children:T.pending})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(P=>a.jsx("button",{onClick:()=>N(P),className:`px-4 py-2 rounded-xl text-sm font-semibold transition ${p===P?"bg-emerald-500 text-black":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:P.charAt(0).toUpperCase()+P.slice(1)},P))}),a.jsxs("button",{onClick:v,className:"flex items-center gap-2 text-sm text-slate-300 hover:text-white",children:[a.jsx(yi,{className:"animate-spin-slower"}),"Refresh"]})]}),a.jsx("div",{className:"bg-slate-900/80 border border-slate-800 rounded-3xl p-6 backdrop-blur",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-left text-sm min-w-[720px]",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-slate-400 uppercase text-xs tracking-[0.3em]",children:[a.jsx("th",{className:"py-3",children:"Employee"}),a.jsx("th",{className:"py-3",children:"Contact"}),a.jsx("th",{className:"py-3",children:"Location"}),a.jsx("th",{className:"py-3",children:"Plan"}),a.jsx("th",{className:"py-3",children:"Verification"}),a.jsx("th",{className:"py-3",children:"Status"}),a.jsx("th",{className:"py-3 text-right",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-800",children:r?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"py-10 text-center text-slate-400",children:"Loading requests..."})}):C.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:"7",className:"py-12 text-center",children:a.jsxs("div",{className:"inline-flex items-center gap-2 text-slate-500",children:[a.jsx("span",{className:"w-8 h-8 rounded-full border border-dashed border-slate-700"}),"No requests found."]})})}):C.map(P=>{var k;return a.jsxs("tr",{className:"hover:bg-slate-900/60 transition",children:[a.jsxs("td",{className:"py-4",children:[a.jsx("p",{className:"font-semibold text-white",children:P.fullName}),a.jsx("p",{className:"text-slate-500 text-xs mt-1",children:P.email})]}),a.jsx("td",{className:"py-4",children:a.jsx("p",{className:"text-slate-300",children:P.phone})}),a.jsx("td",{className:"py-4",children:a.jsxs("p",{className:"text-slate-300",children:[P.city,", ",P.country]})}),a.jsxs("td",{className:"py-4",children:[a.jsx("p",{className:"font-semibold text-white",children:P.selectedPlanLabel||P.selectedPlan}),a.jsxs("p",{className:"text-slate-500 text-xs mt-1",children:["$",P.amount]})]}),a.jsx("td",{className:"py-4",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`w-2 h-2 rounded-full ${P.phoneVerified?"bg-emerald-400":"bg-rose-400"}`}),a.jsxs("span",{className:"text-xs text-slate-400",children:["Phone: ",P.phoneVerified?"Verified":"Not Verified"]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`w-2 h-2 rounded-full ${P.recaptchaScore>=.5?"bg-emerald-400":"bg-rose-400"}`}),a.jsxs("span",{className:"text-xs text-slate-400",children:["reCAPTCHA: ",((k=P.recaptchaScore)==null?void 0:k.toFixed(2))||"N/A"]})]})]})}),a.jsx("td",{className:"py-4",children:a.jsx("span",{className:`px-4 py-1 rounded-full text-xs uppercase tracking-[0.3em] ${Bp[P.status]}`,children:P.status})}),a.jsx("td",{className:"py-4",children:a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:()=>S(P),className:"p-2 rounded-xl bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition",title:"View Details",children:a.jsx(Ju,{})}),P.status==="pending"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>g(P.id),disabled:o===P.id,className:"p-2 rounded-xl bg-rose-500/20 text-rose-400 hover:bg-rose-500/30 transition disabled:opacity-50",title:"Reject",children:a.jsx(Fr,{})}),a.jsx("button",{onClick:()=>I(P.id),disabled:o===P.id,className:"p-2 rounded-xl bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 transition disabled:opacity-50 flex items-center gap-1",title:"Approve",children:a.jsx(js,{})})]})]})})]},P.id)})})]})})})]})}),h&&c&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:a.jsxs(Ur.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900 border border-slate-800 rounded-3xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Request Details"}),a.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-white",children:a.jsx(Fr,{className:"text-2xl"})})]}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Full Name"}),a.jsx("p",{className:"text-white font-semibold",children:c.fullName})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Email"}),a.jsx("p",{className:"text-white",children:c.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Phone"}),a.jsx("p",{className:"text-white",children:c.phone})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Gender"}),a.jsx("p",{className:"text-white capitalize",children:c.gender})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Date of Birth"}),a.jsx("p",{className:"text-white",children:c.dateOfBirth})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Location"}),a.jsxs("p",{className:"text-white",children:[c.city,", ",c.country]})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Address"}),a.jsx("p",{className:"text-white",children:c.address})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Subscription Plan"}),a.jsx("p",{className:"text-white font-semibold",children:c.selectedPlanLabel||c.selectedPlan}),a.jsxs("p",{className:"text-slate-400 text-sm",children:["$",c.amount]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Status"}),a.jsx("span",{className:`px-3 py-1 rounded-full text-xs uppercase tracking-[0.3em] ${Bp[c.status]}`,children:c.status})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Phone Verified"}),a.jsx("p",{className:`${c.phoneVerified?"text-emerald-400":"text-rose-400"}`,children:c.phoneVerified?"Yes":"No"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"reCAPTCHA Score"}),a.jsx("p",{className:"text-white",children:((V=c.recaptchaScore)==null?void 0:V.toFixed(2))||"N/A"})]}),c.notes&&a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 mb-1",children:"Notes"}),a.jsx("p",{className:"text-white",children:c.notes})]})]})}),c.status==="pending"&&a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:()=>{m(!1),g(c.id)},className:"flex-1 bg-rose-500/20 text-rose-400 border border-rose-500/40 rounded-xl py-3 font-semibold hover:bg-rose-500/30 transition",children:"Reject Request"}),a.jsx("button",{onClick:()=>{m(!1),I(c.id)},className:"flex-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/40 rounded-xl py-3 font-semibold hover:bg-emerald-500/30 transition",children:"Approve & Create Account"})]})]})})]})},No=s=>s?s.toDate&&typeof s.toDate=="function"?s.toDate():s instanceof Date?s:s.seconds?new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6):null:null,z4=()=>{const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState([]),[o,l]=_.useState(null),[c,u]=_.useState([]),[h,m]=_.useState(""),[p,N]=_.useState(""),[v,I]=_.useState(!0),[g,S]=_.useState(!1),[C,T]=_.useState({}),[V,P]=_.useState({}),[k,b]=_.useState(!1),x=_.useRef(null),w=_.useRef(null),E=_.useRef(null),A=_.useRef({}),D=_.useRef({}),j=_.useRef(new Map),[K,X]=_.useState(null),W=_.useRef(null),se=_.useRef(null),M=_.useRef([]),L=JSON.parse(localStorage.getItem("user")||"{}"),Y=["","","","","",""],z=(B,Z)=>{Z.preventDefault(),W.current=setTimeout(()=>{X(K===B?null:B)},500)},le=()=>{W.current&&(clearTimeout(W.current),W.current=null)};_.useEffect(()=>{Ke(),it(),he("online");const B=setInterval(()=>{he("online")},2e4);return()=>{E.current&&E.current(),se.current&&(clearInterval(se.current),se.current=null),he("offline"),clearInterval(B),Object.values(A.current).forEach(Z=>Z()),Object.values(D.current).forEach(Z=>Z())}},[]),_.useEffect(()=>(o&&o.chatId&&(console.log("[AdminChat] Chat selected, loading messages for:",o.chatId),u([]),M.current=[],at(o.chatId).then(()=>{console.log("[AdminChat] Messages loaded successfully"),setTimeout(()=>ie(),200)}).catch(B=>{console.error("[AdminChat] Failed to load messages:",B)}),Ae(o.chatId),Ne(o.otherParticipant.uid),_e(o.chatId)),()=>{var B;if(o){const Z=(B=o.otherParticipant)==null?void 0:B.uid,me=o.chatId;Z&&A.current[Z]&&(A.current[Z](),delete A.current[Z]),me&&D.current[me]&&(D.current[me](),delete D.current[me])}E.current&&(E.current(),E.current=null),se.current&&(clearInterval(se.current),se.current=null)}),[o==null?void 0:o.chatId]);const he=async B=>{try{const Z=localStorage.getItem("token");await ce.post("http://localhost:3000/api/chat/presence",{status:B},{headers:{Authorization:`Bearer ${Z}`}})}catch(Z){console.error("Failed to update presence:",Z)}},Ne=B=>{if(!Dt||!B)return;A.current[B]&&A.current[B]();const Z=ll(Dt,"presence",B),me=Vs(Z,be=>{var Re,Se;if(be.exists()){const Fe=be.data(),He=((Se=(Re=Fe.lastSeen)==null?void 0:Re.toDate)==null?void 0:Se.call(Re))||new Date,ne=(new Date-He)/1e3,xe=Fe.status==="online"&&ne<30;T(F=>({...F,[B]:xe?"online":"offline"}))}else T(Fe=>({...Fe,[B]:"offline"}))});A.current[B]=me},_e=B=>{if(!Dt||!B)return;D.current[B]&&D.current[B]();const Z=ll(Dt,"typing",B),me=Vs(Z,be=>{var Re;if(be.exists()){const Se=be.data(),Fe=(Re=o==null?void 0:o.otherParticipant)==null?void 0:Re.uid;Fe&&Se[Fe]?P(He=>({...He,[B]:!0})):P(He=>({...He,[B]:!1}))}else P(Se=>({...Se,[B]:!1}))});D.current[B]=me},Ve=B=>{if(!(o!=null&&o.chatId))return;b(B),x.current&&clearTimeout(x.current);const Z=localStorage.getItem("token");ce.post("http://localhost:3000/api/chat/typing",{chatId:o.chatId,isTyping:B},{headers:{Authorization:`Bearer ${Z}`}}).catch(me=>console.error("Failed to update typing:",me)),B&&(x.current=setTimeout(()=>{Ve(!1)},3e3))},Ke=async()=>{try{const B=localStorage.getItem("token"),me=(await ce.get("http://localhost:3000/api/admin/employees",{headers:{Authorization:`Bearer ${B}`}})).data.data||[];n(me),me.forEach(be=>{Ne(be.uid)})}catch(B){console.error("Failed to load employees:",B),s({type:"error",message:"Failed to load employees"})}},it=async()=>{var B,Z,me,be,Re;try{I(!0);const Se=localStorage.getItem("token");if(!Se){console.error("No token found"),s({type:"error",message:"Not authenticated. Please login again."});return}const Fe=await ce.get("http://localhost:3000/api/chat/chats",{headers:{Authorization:`Bearer ${Se}`}});Fe.data.success?i(Fe.data.data||[]):(console.error("API returned error:",Fe.data),s({type:"error",message:Fe.data.message||"Failed to load chats"}))}catch(Se){console.error("Failed to load chats:",Se),console.error("Error details:",{message:Se.message,response:(B=Se.response)==null?void 0:B.data,status:(Z=Se.response)==null?void 0:Z.status});let Fe="Failed to load chats";((me=Se.response)==null?void 0:me.status)===401?(Fe="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):(Re=(be=Se.response)==null?void 0:be.data)!=null&&Re.message?Fe=Se.response.data.message:Se.response||(Fe="Cannot connect to server. Make sure the backend is running."),s({type:"error",message:Fe}),i([])}finally{I(!1)}},at=async B=>{var Z,me,be,Re,Se,Fe,He,$,ne,xe,F;try{const O=localStorage.getItem("token");if(!O){s({type:"error",message:"Not authenticated. Please login again."});return}console.log(`[AdminChat] Loading messages for chatId: ${B}`);const U=await ce.get(`http://localhost:3000/api/chat/messages/${B}`,{headers:{Authorization:`Bearer ${O}`}});if(U.data.success){const q=U.data.data||[];console.log(`[AdminChat] Loaded ${q.length} messages from API`),console.log("[AdminChat] Messages data:",q);const re=q.map(de=>({messageId:de.messageId||de._id||`msg_${Date.now()}_${Math.random()}`,chatId:de.chatId||B,senderId:de.senderId,senderRole:de.senderRole,recipientId:de.recipientId,content:de.content||de.text||"",type:de.type||"text",read:de.read||!1,readAt:de.readAt?No(de.readAt):null,createdAt:de.createdAt?No(de.createdAt):new Date(de.timestamp||Date.now()),reactions:de.reactions||{},_optimistic:!1}));console.log(`[AdminChat] Formatted ${re.length} messages`),re.sort((de,Q)=>{const ge=de.createdAt?new Date(de.createdAt).getTime():0,Te=Q.createdAt?new Date(Q.createdAt).getTime():0;return ge-Te}),console.log("[AdminChat] Messages sorted, first message:",(me=(Z=re[0])==null?void 0:Z.content)==null?void 0:me.substring(0,50)),console.log("[AdminChat] Messages sorted, last message:",(Re=(be=re[re.length-1])==null?void 0:be.content)==null?void 0:Re.substring(0,50)),M.current=re,u(re),setTimeout(()=>{ie(),console.log("[AdminChat] Scrolled to bottom after loading messages")},100)}else throw new Error(U.data.message||"Failed to load messages");if(Dt&&Wa&&Ka&&dl&&Vs){se.current&&(clearInterval(se.current),se.current=null),E.current&&E.current();try{const q=Wa(Dt,"chats",B,"messages"),re=Ka(q,dl("createdAt","asc"));E.current=Vs(re,de=>{if(B!==(o==null?void 0:o.chatId)){console.log("[AdminChat] Chat changed, ignoring update");return}const Q=q.current,ge=de.docs.map(Te=>{const fe=Te.data();return{messageId:fe.messageId||Te.id,chatId:fe.chatId||B,senderId:fe.senderId,senderRole:fe.senderRole,recipientId:fe.recipientId,content:fe.content||fe.text||"",type:fe.type||"text",read:fe.read||!1,readAt:No(fe.readAt),createdAt:No(fe.createdAt)||new Date,reactions:fe.reactions||{},_optimistic:!1}});if(console.log("[AdminChat] Real-time update: received",ge.length,"messages from Firestore"),ge.length>0||Q.length===0){const Te=`chat_${B}`,fe=j.current.get(Te)||[],ke=new Set(ge.map(Oe=>Oe.messageId)),Pe=fe.filter(Oe=>!ke.has(Oe.messageId)),Me=[...ge,...Pe];Me.sort((Oe,Je)=>{const et=Oe.createdAt?new Date(Oe.createdAt).getTime():0,tt=Je.createdAt?new Date(Je.createdAt).getTime():0;return et-tt}),console.log("[AdminChat] Setting",Me.length,"total messages (Firestore:",ge.length,"optimistic:",Pe.length,")"),q.current=Me,u(Me)}else console.log("[AdminChat] Firestore returned empty, keeping existing",Q.length,"messages from API");setTimeout(()=>ie(),100)},de=>{console.error("[AdminChat] Error listening to messages subcollection:",de),console.error("[AdminChat] Error details:",{code:de.code,message:de.message,stack:de.stack}),console.log("[AdminChat] Falling back to polling for messages"),oe(B)})}catch(q){console.error("[AdminChat] Failed to set up real-time listener:",q),oe(B)}}else console.warn("[AdminChat] Firebase not available, using polling fallback"),oe(B)}catch(O){console.error("[AdminChat] Failed to load messages:",O),console.error("[AdminChat] Error details:",{message:O.message,response:(Se=O.response)==null?void 0:Se.data,status:(Fe=O.response)==null?void 0:Fe.status});let U="Failed to load messages";((He=O.response)==null?void 0:He.status)===401?(U="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):(($=O.response)==null?void 0:$.status)===404?(U="Chat not found. Starting a new conversation...",(ne=o==null?void 0:o.otherParticipant)!=null&&ne.uid&&setTimeout(()=>{G(o.otherParticipant)},1e3)):(F=(xe=O.response)==null?void 0:xe.data)!=null&&F.message?U=O.response.data.message:O.message?U=O.message:O.response||(U="Cannot connect to server. Make sure the backend is running."),s({type:"error",message:U}),u([])}},oe=B=>{se.current&&clearInterval(se.current),se.current=setInterval(async()=>{if((o==null?void 0:o.chatId)===B)try{const Z=localStorage.getItem("token");if(!Z)return;const me=await ce.get(`http://localhost:3000/api/chat/messages/${B}`,{headers:{Authorization:`Bearer ${Z}`}});if(me.data.success){const be=me.data.data||[],Re=`chat_${B}`,Se=j.current.get(Re)||[],Fe=new Set(be.map(ne=>ne.messageId)),He=Se.filter(ne=>!Fe.has(ne.messageId)),$=[...be,...He];$.sort((ne,xe)=>{const F=ne.createdAt?new Date(ne.createdAt).getTime():0,O=xe.createdAt?new Date(xe.createdAt).getTime():0;return F-O}),u($),setTimeout(()=>ie(),100)}}catch(Z){console.error("[AdminChat] Polling error:",Z)}else se.current&&(clearInterval(se.current),se.current=null)},2e3)},Ae=async B=>{try{const Z=localStorage.getItem("token");await ce.post(`http://localhost:3000/api/chat/mark-read/${B}`,{},{headers:{Authorization:`Bearer ${Z}`}}),it()}catch(Z){console.error("Failed to mark as read:",Z)}},ee=async B=>{var $,ne;if(B.preventDefault(),!h.trim()||!o||g)return;const Z=h.trim(),me=o.otherParticipant.uid,be=o.chatId;if(!be){s({type:"error",message:"Chat ID not found. Please select a chat first."});return}const Re=`opt_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,Se={messageId:Re,chatId:be,senderId:L.uid,senderRole:L.role,recipientId:me,content:Z,type:"text",read:!1,readAt:null,createdAt:new Date,_optimistic:!0};console.log("[AdminChat] Adding optimistic message:",Se),u(xe=>{const F=[...xe,Se];return console.log("[AdminChat] Messages after adding optimistic:",F.length),F});const Fe=`chat_${be}`,He=j.current.get(Fe)||[];j.current.set(Fe,[...He,Se]),m(""),ie(),S(!0);try{const xe=localStorage.getItem("token"),F=await ce.post("http://localhost:3000/api/chat/send",{recipientId:me,content:Z,type:"text"},{headers:{Authorization:`Bearer ${xe}`}});if(F.data.success){const O=F.data.data,U=He.filter(q=>q.messageId!==Re);if(j.current.set(Fe,U),console.log("[AdminChat] Message sent successfully, real message:",O),u(q=>{const de=[...q.filter(Q=>Q.messageId!==Re),{...O,_optimistic:!1}];return de.sort((Q,ge)=>{const Te=Q.createdAt?new Date(Q.createdAt).getTime():0,fe=ge.createdAt?new Date(ge.createdAt).getTime():0;return Te-fe}),console.log("[AdminChat] Updated messages list:",de.length,"messages"),de}),setTimeout(()=>ie(),100),setTimeout(()=>ie(),100),o.chatId)i(q=>q.map(re=>re.chatId===be?{...re,lastMessage:{content:Z,senderId:L.uid,senderRole:L.role,createdAt:O.createdAt},lastActivity:O.createdAt}:re));else{const q={chatId:O.chatId,otherParticipant:o.otherParticipant,lastMessage:{content:Z,senderId:L.uid,senderRole:L.role,createdAt:O.createdAt},unreadCount:0,lastActivity:O.createdAt,createdAt:O.createdAt};l(q),i(re=>re.find(Q=>Q.chatId===q.chatId)?re.map(Q=>Q.chatId===q.chatId?q:Q):[...re,q])}ie()}}catch(xe){console.error("[AdminChat] Failed to send message:",xe);const F=(j.current.get(Fe)||[]).filter(O=>O.messageId!==Re);j.current.set(Fe,F),u(O=>O.filter(U=>U.messageId!==Re)),s({type:"error",message:((ne=($=xe.response)==null?void 0:$.data)==null?void 0:ne.message)||"Failed to send message"})}finally{S(!1)}},ie=()=>{var B;(B=w.current)==null||B.scrollIntoView({behavior:"smooth"})};_.useEffect(()=>{console.log("[AdminChat] Messages state changed:",c.length,"messages"),c.length>0&&(console.log("[AdminChat] First message:",c[0]),console.log("[AdminChat] Last message:",c[c.length-1])),ie()},[c]),_.useEffect(()=>{const B=Z=>{K&&!Z.target.closest(".reaction-picker-container")&&!Z.target.closest('button[title="Add reaction"]')&&X(null)};return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[K]);const G=async B=>{var me,be;const Z=r.find(Re=>Re.otherParticipant.uid===B.uid);if(Z){l(Z);return}try{const Re=localStorage.getItem("token");if(!Re){s({type:"error",message:"Not authenticated. Please login again."});return}u([]);const Se=await ce.post("http://localhost:3000/api/chat/create-or-get",{otherUserId:B.uid},{headers:{Authorization:`Bearer ${Re}`}});if(Se.data.success){const Fe=Se.data.data;l(Fe),i(He=>He.find(ne=>ne.chatId===Fe.chatId)?He:[...He,Fe])}else throw new Error(Se.data.message||"Failed to create chat")}catch(Re){console.error("[AdminChat] Failed to create chat:",Re),s({type:"error",message:((be=(me=Re.response)==null?void 0:me.data)==null?void 0:be.message)||"Failed to create chat"})}},Ie=t.filter(B=>{if(!p)return!0;const Z=p.toLowerCase();return(B.displayName||"").toLowerCase().includes(Z)||(B.email||"").toLowerCase().includes(Z)});r.filter(B=>{if(!p)return!0;const Z=p.toLowerCase();return(B.otherParticipant.displayName||"").toLowerCase().includes(Z)||(B.otherParticipant.email||"").toLowerCase().includes(Z)});const ye=B=>{if(!B)return"";const Z=B instanceof Date?B:new Date(B),me=Z.getHours(),be=Z.getMinutes(),Re=me>=12?"PM":"AM",Se=me%12||12,Fe=be<10?`0${be}`:be;return`${Se}:${Fe} ${Re}`},we=async(B,Z)=>{if(!(o!=null&&o.chatId))return;const me=c.find(He=>He.messageId===B),be=(me==null?void 0:me.reactions)||{},Re=be[Z]||[],Se=Re.includes(L.uid),Fe={...be};if(Se){const He=Re.filter($=>$!==L.uid);He.length===0?delete Fe[Z]:Fe[Z]=He}else Fe[Z]=[...Re,L.uid];u(He=>He.map($=>$.messageId===B?{...$,reactions:Fe}:$)),X(null);try{const He=localStorage.getItem("token");await ce.post("http://localhost:3000/api/chat/reaction",{chatId:o.chatId,messageId:B,emoji:Z},{headers:{Authorization:`Bearer ${He}`}})}catch(He){console.error("[AdminChat] Failed to update reaction:",He),u($=>$.map(ne=>ne.messageId===B?{...ne,reactions:be}:ne)),s({type:"error",message:"Failed to update reaction"})}};return a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(8px) scale(0.96);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .message-bubble {
          transition: transform 0.1s ease, box-shadow 0.1s ease;
        }
        .message-bubble:hover {
          transform: translateY(-1px);
        }
        .typing-dots span {
          animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) {
          animation-delay: 0s;
        }
        .typing-dots span:nth-child(2) {
          animation-delay: 0.2s;
        }
        .typing-dots span:nth-child(3) {
          animation-delay: 0.4s;
        }
        @keyframes typing {
          0%, 60%, 100% {
            transform: translateY(0);
            opacity: 0.7;
          }
          30% {
            transform: translateY(-8px);
            opacity: 1;
          }
        }
      `}),a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#111b21] text-white":"bg-[#e5ddd5] text-gray-900"}`,children:[a.jsx(_n,{}),a.jsxs("div",{className:"flex-1 flex",children:[a.jsxs("div",{className:`w-80 border-r ${e?"border-slate-800 bg-[#0a0a15]":"border-gray-200 bg-white"} flex flex-col`,children:[a.jsx("div",{className:"p-4 border-b border-slate-800",children:a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:p,onChange:B=>N(B.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-100 border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:a.jsxs("div",{className:"p-2",children:[a.jsxs("h3",{className:"text-xs uppercase tracking-wider text-slate-400 px-3 py-2",children:["Employees (",Ie.length,")"]}),Ie.map(B=>{var be;const Z=r.find(Re=>Re.otherParticipant.uid===B.uid),me=((be=o==null?void 0:o.otherParticipant)==null?void 0:be.uid)===B.uid;return a.jsx("div",{onClick:()=>G(B),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${me?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[B.photoURL?a.jsx("img",{src:B.photoURL,alt:B.displayName||B.email,className:"w-10 h-10 rounded-full object-cover",onError:Re=>{Re.target.style.display="none",Re.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full bg-[#1f36ff] flex items-center justify-center text-white font-semibold ${B.photoURL?"hidden":""}`,children:(B.displayName||B.email||"E")[0].toUpperCase()}),C[B.uid]==="online"&&a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:B.displayName||B.email}),(Z==null?void 0:Z.lastMessage)&&a.jsx("p",{className:`text-xs truncate ${me?"text-white/80":"text-slate-400"}`,children:Z.lastMessage.content})]})]}),(Z==null?void 0:Z.unreadCount)>0&&a.jsx("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0",children:Z.unreadCount})]})},B.uid)})]})})]}),a.jsx("div",{className:"flex-1 flex flex-col",children:o?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`px-5 py-3.5 border-b ${e?"border-slate-700 bg-[#202c33] shadow-lg":"border-gray-200 bg-white shadow-sm"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[o.otherParticipant.photoURL?a.jsx("img",{src:o.otherParticipant.photoURL,alt:o.otherParticipant.displayName||o.otherParticipant.email,className:"w-12 h-12 rounded-full object-cover shadow-md",onError:B=>{B.target.style.display="none",B.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-12 h-12 rounded-full bg-gradient-to-br from-[#1f36ff] to-[#1b2ed1] flex items-center justify-center text-white font-semibold text-lg shadow-md ${o.otherParticipant.photoURL?"hidden":""}`,children:(o.otherParticipant.displayName||o.otherParticipant.email||"E")[0].toUpperCase()}),C[o.otherParticipant.uid]==="online"&&a.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("p",{className:"font-semibold text-base text-gray-900 dark:text-white truncate",children:o.otherParticipant.displayName||o.otherParticipant.email})}),a.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:V[o.chatId]?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"typing"}),a.jsxs("div",{className:"typing-dots flex gap-1",children:[a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"})]})]}):C[o.otherParticipant.uid]==="online"?a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"online"}):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"offline"})})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto relative",style:{backgroundImage:e?"radial-gradient(circle at 20% 50%, rgba(32, 44, 51, 0.2) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(32, 44, 51, 0.2) 0%, transparent 50%)":"radial-gradient(circle at 20% 50%, rgba(240, 242, 245, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(240, 242, 245, 0.3) 0%, transparent 50%)",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat"},children:a.jsxs("div",{className:"px-4 py-3 space-y-2",children:[c.length===0?a.jsxs("div",{className:"text-center text-gray-400 py-12",children:[a.jsx(Bs,{className:"text-4xl mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No messages yet. Start the conversation!"})]}):a.jsxs(a.Fragment,{children:[c.map((B,Z)=>{const me=B.senderId===L.uid,be=B.reactions||{},Re=Object.keys(be).length>0;return a.jsx("div",{className:`flex ${me?"justify-end":"justify-start"} group animate-fadeIn`,style:{animation:`fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1) ${Z*.03}s both`},children:a.jsxs("div",{className:"relative max-w-[70%] lg:max-w-[65%] group/message",children:[a.jsxs("div",{className:`message-bubble relative px-4 py-2.5 rounded-[22px] ${me?"bg-[#DCF8C6] text-gray-900 shadow-[0_1px_2px_rgba(0,0,0,0.1)]":e?"bg-[#2a3942] text-white shadow-[0_1px_2px_rgba(0,0,0,0.2)]":"bg-white text-gray-900 shadow-[0_1px_2px_rgba(0,0,0,0.08)]"}`,onContextMenu:Se=>{Se.preventDefault(),X(K===B.messageId?null:B.messageId)},onDoubleClick:()=>{X(K===B.messageId?null:B.messageId)},onTouchStart:Se=>z(B.messageId,Se),onTouchEnd:le,onMouseDown:Se=>{Se.button===0&&z(B.messageId,Se)},onMouseUp:le,onMouseLeave:le,children:[a.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words mb-1",children:B.content}),a.jsxs("div",{className:`flex items-center justify-end gap-1.5 ${me?"text-gray-600":"text-gray-500"}`,children:[a.jsx("span",{className:"text-[11px] opacity-55 font-normal",children:ye(B.createdAt)}),me&&a.jsx("span",{className:"flex items-center",children:B.read?a.jsx(js,{className:"w-4 h-4 text-[#53bdeb]"}):a.jsx(Jl,{className:"w-4 h-4 text-gray-500"})})]}),a.jsx("button",{onClick:Se=>{Se.stopPropagation(),X(K===B.messageId?null:B.messageId)},className:`absolute -bottom-1.5 ${me?"-left-1.5":"-right-1.5"} opacity-0 group-hover/message:opacity-100 transition-all duration-200 bg-white dark:bg-[#2a3942] rounded-full p-2 shadow-lg border border-gray-200 dark:border-gray-600 hover:scale-110 hover:shadow-xl z-20`,title:"Add reaction",children:a.jsx(ul,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),K===B.messageId&&a.jsx("div",{className:`reaction-picker-container absolute bottom-full mb-2 bg-white dark:bg-[#2a3942] rounded-full px-3 py-2.5 shadow-2xl border border-gray-200 dark:border-gray-600 flex gap-2.5 z-30 animate-fadeIn ${me?"left-0":"right-0"}`,onClick:Se=>Se.stopPropagation(),children:Y.map(Se=>a.jsx("button",{onClick:Fe=>{Fe.stopPropagation(),we(B.messageId,Se)},className:"text-2xl hover:scale-150 active:scale-125 transition-transform duration-150 p-1.5 cursor-pointer rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",title:Se,children:Se},Se))})]}),Re&&a.jsx("div",{className:`flex gap-1 mt-1.5 ${me?"justify-end":"justify-start"}`,children:a.jsx("div",{className:"bg-white dark:bg-[#2a3942] rounded-full px-2.5 py-1 shadow-md border border-gray-200 dark:border-gray-600 flex gap-2 items-center cursor-pointer hover:shadow-lg transition-all duration-200",onClick:Se=>{Se.stopPropagation(),X(K===B.messageId?null:B.messageId)},children:Object.entries(be).map(([Se,Fe])=>{const He=Fe.length,$=Fe.includes(L.uid);return a.jsxs("span",{className:`text-sm flex items-center gap-1 px-1.5 py-0.5 rounded-full transition-colors ${$?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[a.jsx("span",{className:"text-base",children:Se}),He>1&&a.jsx("span",{className:"text-[10px] opacity-75 font-semibold text-gray-700 dark:text-gray-300",children:He})]},Se)})})})]})},B.messageId)}),V[o.chatId]&&a.jsx("div",{className:"flex justify-start animate-fadeIn",children:a.jsx("div",{className:`px-4 py-3 rounded-[22px] rounded-tl-none ${e?"bg-[#2a3942]":"bg-white"} shadow-sm`,children:a.jsxs("div",{className:"typing-dots flex gap-1.5",children:[a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"})]})})})]}),a.jsx("div",{ref:w})]})}),a.jsx("div",{className:`px-5 py-4 border-t ${e?"border-slate-700 bg-[#202c33] shadow-lg":"border-gray-200 bg-[#f0f2f5] shadow-sm"}`,children:a.jsxs("form",{onSubmit:ee,className:"flex items-end gap-3",children:[a.jsxs("div",{className:"flex-1 flex items-center gap-3 bg-white dark:bg-[#2a3942] rounded-full px-5 py-3 shadow-inner border border-gray-200 dark:border-gray-600",children:[a.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:a.jsx(ul,{className:"w-5 h-5"})}),a.jsx("input",{type:"text",value:h,onChange:B=>{m(B.target.value),B.target.value&&!k?Ve(!0):!B.target.value&&k&&Ve(!1)},onKeyDown:()=>{k||Ve(!0)},placeholder:"Type a message",className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500",disabled:g})]}),a.jsx("button",{type:"submit",disabled:!h.trim()||g,className:`w-12 h-12 rounded-full transition-all duration-200 flex items-center justify-center shadow-md ${h.trim()?"bg-[#25d366] hover:bg-[#20ba5a] active:bg-[#1da851] text-white hover:scale-105 active:scale-95":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:a.jsx(bi,{className:"w-5 h-5"})})]})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-slate-400",children:[a.jsx(Bs,{className:"text-6xl mx-auto mb-4 opacity-50"}),a.jsx("p",{className:"text-lg",children:"Select an employee to start chatting"})]})})})]})]})]})},G4=[{key:"dashboard",label:"Dashboard",icon:a.jsx(Nb,{}),path:"/employee-dashboard"},{key:"users",label:"My Users",icon:a.jsx(es,{}),path:"/employee/my-users"},{key:"mealPlans",label:"Meal Plans",icon:a.jsx(hr,{}),path:"#",submenu:[{key:"addMealPlan",label:"Add Meal Plan",path:"/employee/meal-plans/add"},{key:"selectReadyPlan",label:"Select Ready Plan",path:"/employee/meal-plans/select"},{key:"viewUsersPlan",label:"View Users Plan",path:"/employee/meal-plans/view"}]},{key:"gym",label:"Gym",icon:a.jsx(Td,{}),path:"#",submenu:[{key:"exercises",label:"Exercises Library",path:"/employee/exercises"},{key:"gymPlans",label:"Gym Plans",path:"/employee/gym-plans"},{key:"usersWorkoutPlans",label:"Users Workout Plans",path:"/employee/workout-plans-overview"}]},{key:"chat",label:"Chat",icon:a.jsx(Bs,{}),path:"/employee/chat"},{key:"settings",label:"Settings",icon:a.jsx(_b,{}),path:"/employee/settings"}],$t=()=>{const s=ft(),e=Tn(),{isDarkMode:t,toggleTheme:n}=Tt(),[r,i]=_.useState(()=>JSON.parse(localStorage.getItem("user")||"{}")),[o,l]=_.useState(null);_.useEffect(()=>{const N=()=>{const v=JSON.parse(localStorage.getItem("user")||"{}");i(v)};return window.addEventListener("storage",N),window.addEventListener("profileUpdated",N),()=>{window.removeEventListener("storage",N),window.removeEventListener("profileUpdated",N)}},[]);const c=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),s("/login")},u=N=>{N&&N!=="#"&&s(N)},h=()=>{const N=e.pathname;return N==="/employee-dashboard"||N.startsWith("/employee/")&&N.match(/\/employee\/[^/]+$/)&&N!=="/employee/chat"&&N!=="/employee/settings"&&N!=="/employee/my-users"&&!N.startsWith("/employee/meal-plans")&&!N.startsWith("/employee/exercises")&&!N.startsWith("/employee/gym-plans")?"dashboard":N==="/employee/my-users"?"users":N==="/employee/meal-plans/add"?"addMealPlan":N==="/employee/meal-plans/select"?"selectReadyPlan":N==="/employee/meal-plans/view"?"viewUsersPlan":N.startsWith("/employee/meal-plans")||N==="/meal-plans"?"mealPlans":N.startsWith("/employee/exercises")?"exercises":N.startsWith("/employee/gym-plans")?"gymPlans":N.startsWith("/employee/workout-plans-overview")?"usersWorkoutPlans":N==="/employee/chat"?"chat":N==="/employee/settings"?"settings":"dashboard"};_.useEffect(()=>{e.pathname.startsWith("/employee/meal-plans")&&l("mealPlans"),(e.pathname.startsWith("/employee/gym-plans")||e.pathname.startsWith("/employee/exercises")||e.pathname.startsWith("/employee/workout-plans-overview"))&&l("gym")},[e.pathname]);const m=h(),p=N=>{l(o===N?null:N)};return a.jsxs("aside",{className:`w-64 rounded-r-[32px] p-6 flex flex-col gap-10 transition-colors overflow-y-auto ${t?"bg-[#0f111f]":"bg-white border-r border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[r.photoURL?a.jsx("img",{src:r.photoURL,alt:"avatar",className:`w-14 h-14 rounded-2xl object-cover border ${t?"border-white/10":"border-gray-200"}`,onError:N=>{N.target.style.display="none",N.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br from-[#1f36ff] to-[#15b5ff] flex items-center justify-center text-white font-bold text-lg border ${t?"border-white/10":"border-gray-200"} ${r.photoURL?"hidden":""}`,children:(r.displayName||r.email||"E")[0].toUpperCase()}),a.jsxs("div",{children:[a.jsx("p",{className:`font-semibold text-lg ${t?"text-white":"text-gray-900"}`,children:r.displayName||"Employee"}),a.jsx("span",{className:`text-xs ${t?"text-white/60":"text-gray-500"}`,children:"Employee"})]})]}),a.jsx("nav",{className:"flex flex-col gap-4",children:G4.map(({key:N,label:v,icon:I,path:g,submenu:S})=>a.jsxs("div",{children:[a.jsxs("button",{onClick:()=>S?p(N):u(g),className:`w-full flex items-center gap-3 text-sm font-semibold px-4 py-3 rounded-2xl transition ${m===N||S&&S.some(C=>m===C.key)?"bg-[#1f36ff] text-white shadow-lg shadow-blue-900/40":t?"text-white/70 hover:bg-white/5":"text-gray-600 hover:bg-gray-100"}`,children:[a.jsx("span",{className:"text-lg",children:I}),v,S&&a.jsx("span",{className:`ml-auto transition-transform ${o===N?"rotate-180":""}`,children:""})]}),S&&o===N&&a.jsx("div",{className:"mt-2 ml-4 flex flex-col gap-2",children:S.map(C=>a.jsx("button",{onClick:()=>u(C.path),className:`flex items-center gap-2 text-sm px-4 py-2 rounded-xl transition ${m===C.key?"bg-[#1f36ff]/20 text-[#1f36ff] font-semibold":t?"text-white/60 hover:bg-white/5":"text-gray-600 hover:bg-gray-100"}`,children:C.label},C.key))})]},N))}),a.jsx("div",{className:"mt-auto",children:a.jsxs("button",{onClick:n,className:`w-full flex items-center justify-between text-xs p-3 rounded-2xl transition ${t?"bg-white/5 hover:bg-white/10":"bg-gray-100 hover:bg-gray-200"}`,children:[a.jsx("span",{className:t?"text-white/60":"text-gray-600",children:"Light"}),a.jsx("div",{className:`flex items-center gap-2 rounded-full px-3 py-1 text-xs transition-all ${t?"bg-[#1f36ff] text-white":"bg-gray-300 text-gray-700"}`,children:a.jsx("span",{children:"Dark"})})]})}),a.jsx("button",{onClick:c,className:"mt-4 px-4 py-2 bg-red-600/80 hover:bg-red-600 text-white rounded-2xl transition-colors font-medium text-sm",children:"Logout"})]})},_o=s=>s?s.toDate&&typeof s.toDate=="function"?s.toDate():s instanceof Date?s:s.seconds?new Date(s.seconds*1e3+(s.nanoseconds||0)/1e6):null:null,q4=()=>{var He;const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState([]),[o,l]=_.useState(null),[c,u]=_.useState(null),[h,m]=_.useState([]),[p,N]=_.useState(""),[v,I]=_.useState(""),[g,S]=_.useState(!0),[C,T]=_.useState(!1),[V,P]=_.useState("chats"),[k,b]=_.useState({}),[x,w]=_.useState({}),[E,A]=_.useState(!1),D=_.useRef(null),j=_.useRef(null),K=_.useRef(null),X=_.useRef({}),W=_.useRef({}),se=_.useRef(new Map),[M,L]=_.useState(null),Y=_.useRef(null),z=_.useRef(null),le=_.useRef([]),he=JSON.parse(localStorage.getItem("user")||"{}"),Ne=["","","","","",""],_e=($,ne)=>{ne.preventDefault(),Y.current=setTimeout(()=>{L(M===$?null:$)},500)},Ve=()=>{Y.current&&(clearTimeout(Y.current),Y.current=null)};_.useEffect(()=>{if(Ke(),ee(),ie(),it("online"),Dt){const ne=Ka(Wa(Dt,"chats"),vA("participants","array-contains",he.uid)),xe=Vs(ne,F=>{n(O=>{const U=[...O];let q=!1;return F.forEach(re=>{var ge;const de=re.data(),Q=U.findIndex(Te=>Te.chatId===de.chatId);Q>=0?U[Q]={...U[Q],lastMessage:de.lastMessage,unreadCount:((ge=de.unreadCount)==null?void 0:ge[he.uid])||0,lastActivity:de.lastActivity}:q=!0}),q&&(console.log("[EmployeeChat] New chat detected, reloading chats list"),Ke()),U})},F=>{console.error("Error listening to chats:",F)});return()=>{xe(),K.current&&K.current(),z.current&&(clearInterval(z.current),z.current=null),it("offline"),Object.values(X.current).forEach(F=>F()),Object.values(W.current).forEach(F=>F())}}const $=setInterval(()=>{it("online")},2e4);return()=>{K.current&&K.current(),z.current&&(clearInterval(z.current),z.current=null),it("offline"),clearInterval($),Object.values(X.current).forEach(ne=>ne()),Object.values(W.current).forEach(ne=>ne())}},[]),_.useEffect(()=>(c&&c.chatId&&(console.log("[EmployeeChat] Chat selected, loading messages for:",c.chatId),m([]),G(c.chatId).then(()=>{console.log("[EmployeeChat] Messages loaded successfully"),setTimeout(()=>B(),200)}).catch($=>{console.error("[EmployeeChat] Failed to load messages:",$)}),ye(c.chatId),at(c.otherParticipant.uid),oe(c.chatId)),()=>{var $;if(c){const ne=($=c.otherParticipant)==null?void 0:$.uid,xe=c.chatId;ne&&X.current[ne]&&(X.current[ne](),delete X.current[ne]),xe&&W.current[xe]&&(W.current[xe](),delete W.current[xe])}K.current&&(K.current(),K.current=null),z.current&&(clearInterval(z.current),z.current=null)}),[c==null?void 0:c.chatId]);const Ke=async()=>{var $,ne,xe,F,O;try{S(!0);const U=localStorage.getItem("token");if(!U){console.error("No token found"),s({type:"error",message:"Not authenticated. Please login again."});return}const q=await ce.get("http://localhost:3000/api/chat/chats",{headers:{Authorization:`Bearer ${U}`}});if(q.data.success){const re=q.data.data||[];console.log("[EmployeeChat] Loaded",re.length,"chats from API"),console.log("[EmployeeChat] Chats:",re.map(de=>{var Q,ge,Te,fe,ke;return{chatId:de.chatId,otherParticipant:((Q=de.otherParticipant)==null?void 0:Q.displayName)||((ge=de.otherParticipant)==null?void 0:ge.email),role:(Te=de.otherParticipant)==null?void 0:Te.role,lastMessage:(ke=(fe=de.lastMessage)==null?void 0:fe.content)==null?void 0:ke.substring(0,30),unreadCount:de.unreadCount}})),n(re),console.log("[EmployeeChat] Chats state updated, total:",re.length)}else console.error("API returned error:",q.data),s({type:"error",message:q.data.message||"Failed to load chats"}),n([])}catch(U){console.error("Failed to load chats:",U),console.error("Error details:",{message:U.message,response:($=U.response)==null?void 0:$.data,status:(ne=U.response)==null?void 0:ne.status});let q="Failed to load chats";((xe=U.response)==null?void 0:xe.status)===401?(q="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):(O=(F=U.response)==null?void 0:F.data)!=null&&O.message?q=U.response.data.message:U.response||(q="Cannot connect to server. Make sure the backend is running."),s({type:"error",message:q}),n([])}finally{S(!1)}},it=async $=>{try{const ne=localStorage.getItem("token");await ce.post("http://localhost:3000/api/chat/presence",{status:$},{headers:{Authorization:`Bearer ${ne}`}})}catch(ne){console.error("Failed to update presence:",ne)}},at=$=>{if(!Dt||!$)return;X.current[$]&&X.current[$]();const ne=ll(Dt,"presence",$),xe=Vs(ne,F=>{var O,U;if(F.exists()){const q=F.data(),re=((U=(O=q.lastSeen)==null?void 0:O.toDate)==null?void 0:U.call(O))||new Date,Q=(new Date-re)/1e3,ge=q.status==="online"&&Q<30;b(Te=>({...Te,[$]:ge?"online":"offline"}))}else b(q=>({...q,[$]:"offline"}))});X.current[$]=xe},oe=$=>{if(!Dt||!$)return;W.current[$]&&W.current[$]();const ne=ll(Dt,"typing",$),xe=Vs(ne,F=>{var O;if(F.exists()){const U=F.data(),q=(O=c==null?void 0:c.otherParticipant)==null?void 0:O.uid;q&&U[q]?w(re=>({...re,[$]:!0})):w(re=>({...re,[$]:!1}))}else w(U=>({...U,[$]:!1}))});W.current[$]=xe},Ae=$=>{if(!(c!=null&&c.chatId))return;A($),D.current&&clearTimeout(D.current);const ne=localStorage.getItem("token");ce.post("http://localhost:3000/api/chat/typing",{chatId:c.chatId,isTyping:$},{headers:{Authorization:`Bearer ${ne}`}}).catch(xe=>console.error("Failed to update typing:",xe)),$&&(D.current=setTimeout(()=>{Ae(!1)},3e3))},ee=async()=>{try{const $=localStorage.getItem("token"),xe=(await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${$}`}})).data.data||[];i(xe),xe.forEach(F=>{at(F.uid)}),o&&at(o.uid)}catch($){console.error("Failed to load users:",$)}},ie=async()=>{var $;try{const ne=localStorage.getItem("token"),xe=await ce.get("http://localhost:3000/api/employee/admin",{headers:{Authorization:`Bearer ${ne}`}});if(xe.data.success&&xe.data.data){const F=xe.data.data;l(F),at(F.uid),console.log("[EmployeeChat] Admin info loaded:",F)}}catch(ne){console.error("Failed to load admin info:",ne),console.error("Error details:",(($=ne.response)==null?void 0:$.data)||ne.message)}},G=async $=>{var ne,xe,F,O,U,q,re,de,Q,ge,Te;try{const fe=localStorage.getItem("token");if(!fe){s({type:"error",message:"Not authenticated. Please login again."});return}console.log(`[EmployeeChat] Loading messages for chatId: ${$}`);const ke=await ce.get(`http://localhost:3000/api/chat/messages/${$}`,{headers:{Authorization:`Bearer ${fe}`}});if(ke.data.success){const Pe=ke.data.data||[];console.log(`[EmployeeChat] Loaded ${Pe.length} messages from API`),console.log("[EmployeeChat] Messages data:",Pe);const Me=Pe.map(Oe=>({messageId:Oe.messageId||Oe._id||`msg_${Date.now()}_${Math.random()}`,chatId:Oe.chatId||$,senderId:Oe.senderId,senderRole:Oe.senderRole,recipientId:Oe.recipientId,content:Oe.content||Oe.text||"",type:Oe.type||"text",read:Oe.read||!1,readAt:Oe.readAt?_o(Oe.readAt):null,createdAt:Oe.createdAt?_o(Oe.createdAt):new Date(Oe.timestamp||Date.now()),reactions:Oe.reactions||{},_optimistic:!1}));console.log(`[EmployeeChat] Formatted ${Me.length} messages`),Me.sort((Oe,Je)=>{const et=Oe.createdAt?new Date(Oe.createdAt).getTime():0,tt=Je.createdAt?new Date(Je.createdAt).getTime():0;return et-tt}),console.log("[EmployeeChat] Messages sorted, first message:",(xe=(ne=Me[0])==null?void 0:ne.content)==null?void 0:xe.substring(0,50)),console.log("[EmployeeChat] Messages sorted, last message:",(O=(F=Me[Me.length-1])==null?void 0:F.content)==null?void 0:O.substring(0,50)),le.current=Me,m(Me),setTimeout(()=>{B(),console.log("[EmployeeChat] Scrolled to bottom after loading messages")},100)}else throw new Error(ke.data.message||"Failed to load messages");if(Dt&&Wa&&Ka&&dl&&Vs){z.current&&(clearInterval(z.current),z.current=null),K.current&&K.current();try{const Pe=Wa(Dt,"chats",$,"messages"),Me=Ka(Pe,dl("createdAt","asc"));K.current=Vs(Me,Oe=>{if($!==(c==null?void 0:c.chatId))return;const Je=Oe.docs.map(ts=>{const nt=ts.data();return{messageId:nt.messageId||ts.id,chatId:nt.chatId||$,senderId:nt.senderId,senderRole:nt.senderRole,recipientId:nt.recipientId,content:nt.content,type:nt.type,read:nt.read||!1,readAt:_o(nt.readAt),createdAt:_o(nt.createdAt)||new Date,reactions:nt.reactions||{},_optimistic:!1}}),et=`chat_${$}`,tt=se.current.get(et)||[],$e=new Set(Je.map(ts=>ts.messageId)),bt=tt.filter(ts=>!$e.has(ts.messageId)),St=[...Je,...bt];St.sort((ts,nt)=>{const Ki=ts.createdAt?new Date(ts.createdAt).getTime():0,Pn=nt.createdAt?new Date(nt.createdAt).getTime():0;return Ki-Pn}),m(St),setTimeout(()=>B(),100)},Oe=>{console.error("[EmployeeChat] Error listening to messages subcollection:",Oe),console.error("[EmployeeChat] Error details:",{code:Oe.code,message:Oe.message,stack:Oe.stack}),console.log("[EmployeeChat] Falling back to polling for messages"),Ie($)})}catch(Pe){console.error("[EmployeeChat] Failed to set up real-time listener:",Pe),Ie($)}}else console.warn("[EmployeeChat] Firebase not available, using polling fallback"),Ie($)}catch(fe){console.error("[EmployeeChat] Failed to load messages:",fe),console.error("[EmployeeChat] Error details:",{message:fe.message,response:(U=fe.response)==null?void 0:U.data,status:(q=fe.response)==null?void 0:q.status});let ke="Failed to load messages";((re=fe.response)==null?void 0:re.status)===401?(ke="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):((de=fe.response)==null?void 0:de.status)===404?(ke="Chat not found. Starting a new conversation...",(Q=c==null?void 0:c.otherParticipant)!=null&&Q.uid&&setTimeout(()=>{Z(c.otherParticipant)},1e3)):(Te=(ge=fe.response)==null?void 0:ge.data)!=null&&Te.message?ke=fe.response.data.message:fe.message?ke=fe.message:fe.response||(ke="Cannot connect to server. Make sure the backend is running."),s({type:"error",message:ke}),m([])}},Ie=$=>{z.current&&clearInterval(z.current),z.current=setInterval(async()=>{if((c==null?void 0:c.chatId)===$)try{const ne=localStorage.getItem("token");if(!ne)return;const xe=await ce.get(`http://localhost:3000/api/chat/messages/${$}`,{headers:{Authorization:`Bearer ${ne}`}});if(xe.data.success){const F=xe.data.data||[],O=`chat_${$}`,U=se.current.get(O)||[],q=new Set(F.map(Q=>Q.messageId)),re=U.filter(Q=>!q.has(Q.messageId)),de=[...F,...re];de.sort((Q,ge)=>{const Te=Q.createdAt?new Date(Q.createdAt).getTime():0,fe=ge.createdAt?new Date(ge.createdAt).getTime():0;return Te-fe}),m(de),setTimeout(()=>B(),100)}}catch(ne){console.error("[EmployeeChat] Polling error:",ne)}else z.current&&(clearInterval(z.current),z.current=null)},2e3)},ye=async $=>{try{const ne=localStorage.getItem("token");await ce.post(`http://localhost:3000/api/chat/mark-read/${$}`,{},{headers:{Authorization:`Bearer ${ne}`}}),Ke()}catch(ne){console.error("Failed to mark as read:",ne)}},we=async $=>{var de,Q,ge,Te,fe,ke,Pe;if($.preventDefault(),!p.trim()||!c||C)return;const ne=p.trim(),xe=c.otherParticipant.uid,F=c.chatId;if(!F){s({type:"error",message:"Chat ID not found. Please select a chat first."});return}const O=`opt_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,U={messageId:O,chatId:F,senderId:he.uid,senderRole:he.role,recipientId:xe,content:ne,type:"text",read:!1,readAt:null,createdAt:new Date,_optimistic:!0};m(Me=>[...Me,U]);const q=`chat_${F}`,re=se.current.get(q)||[];se.current.set(q,[...re,U]),N(""),B(),T(!0);try{const Me=localStorage.getItem("token"),Oe=await ce.post("http://localhost:3000/api/chat/send",{recipientId:xe,content:ne,type:"text"},{headers:{Authorization:`Bearer ${Me}`}});if(Oe.data.success){const Je=Oe.data.data,et=re.filter(tt=>tt.messageId!==O);if(se.current.set(q,et),m(tt=>[...tt.filter(bt=>bt.messageId!==O),{...Je,_optimistic:!1}].sort((bt,St)=>{const ts=bt.createdAt?new Date(bt.createdAt).getTime():0,nt=St.createdAt?new Date(St.createdAt).getTime():0;return ts-nt})),c.chatId)n(tt=>tt.map($e=>$e.chatId===F?{...$e,lastMessage:{content:ne,senderId:he.uid,senderRole:he.role,createdAt:Je.createdAt},lastActivity:Je.createdAt}:$e));else{const tt={chatId:Je.chatId,otherParticipant:c.otherParticipant,lastMessage:{content:ne,senderId:he.uid,senderRole:he.role,createdAt:Je.createdAt},unreadCount:0,lastActivity:Je.createdAt,createdAt:Je.createdAt};u(tt),n($e=>$e.find(St=>St.chatId===tt.chatId)?$e.map(St=>St.chatId===tt.chatId?tt:St):[...$e,tt])}B()}}catch(Me){console.error("[EmployeeChat] Failed to send message:",Me);const Oe=(se.current.get(q)||[]).filter(et=>et.messageId!==O);se.current.set(q,Oe),m(et=>et.filter(tt=>tt.messageId!==O)),N(ne);let Je="Failed to send message";((de=Me.response)==null?void 0:de.status)===401?(Je="Authentication failed. Please login again.",localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"):((Q=Me.response)==null?void 0:Q.status)===403?Je=((Te=(ge=Me.response)==null?void 0:ge.data)==null?void 0:Te.message)||"You do not have permission to send messages to this user.":((fe=Me.response)==null?void 0:fe.status)===404?Je="Recipient not found. Please try again.":(Pe=(ke=Me.response)==null?void 0:ke.data)!=null&&Pe.message?Je=Me.response.data.message:Me.response||(Je="Cannot connect to server. Please check your connection."),s({type:"error",message:Je})}finally{T(!1)}},B=()=>{var $;($=j.current)==null||$.scrollIntoView({behavior:"smooth"})};_.useEffect(()=>{var $,ne,xe,F;console.log("[EmployeeChat] Messages state changed:",h.length,"messages"),le.current=h,h.length>0&&(console.log("[EmployeeChat] First message:",(ne=($=h[0])==null?void 0:$.content)==null?void 0:ne.substring(0,50)),console.log("[EmployeeChat] Last message:",(F=(xe=h[h.length-1])==null?void 0:xe.content)==null?void 0:F.substring(0,50))),B()},[h]),_.useEffect(()=>{const $=ne=>{if(M){const xe=ne.target.closest(".reaction-picker-container"),F=ne.target.closest('button[title="Add reaction"]'),O=ne.target.closest(".reaction-picker-container button");!xe&&!F&&!O&&L(null)}};return document.addEventListener("mousedown",$),document.addEventListener("touchstart",$),()=>{document.removeEventListener("mousedown",$),document.removeEventListener("touchstart",$)}},[M]);const Z=async $=>{var xe,F;const ne=t.find(O=>O.otherParticipant.uid===$.uid);if(ne){u(ne);return}try{const O=localStorage.getItem("token");if(!O){s({type:"error",message:"Not authenticated. Please login again."});return}m([]);const U=await ce.post("http://localhost:3000/api/chat/create-or-get",{otherUserId:$.uid},{headers:{Authorization:`Bearer ${O}`}});if(U.data.success){const q=U.data.data;u(q),n(re=>re.find(Q=>Q.chatId===q.chatId)?re:[...re,q])}else throw new Error(U.data.message||"Failed to create chat")}catch(O){console.error("[EmployeeChat] Failed to create chat:",O),s({type:"error",message:((F=(xe=O.response)==null?void 0:xe.data)==null?void 0:F.message)||"Failed to create chat"})}},me=t.filter($=>{if(!v)return!0;const ne=v.toLowerCase();return($.otherParticipant.displayName||"").toLowerCase().includes(ne)||($.otherParticipant.email||"").toLowerCase().includes(ne)}),be=o&&t.some($=>{var xe,F;return((xe=$.otherParticipant)==null?void 0:xe.uid)===o.uid||((F=$.otherParticipant)==null?void 0:F.role)==="admin"});console.log("[EmployeeChat] Admin chat exists:",be,"Total chats:",t.length,"Admin info:",o==null?void 0:o.uid);const Re=r.filter($=>{if(!v)return!0;const ne=v.toLowerCase();return($.displayName||"").toLowerCase().includes(ne)||($.email||"").toLowerCase().includes(ne)}),Se=$=>{if(!$)return"";const ne=$ instanceof Date?$:new Date($),xe=ne.getHours(),F=ne.getMinutes(),O=xe>=12?"PM":"AM",U=xe%12||12,q=F<10?`0${F}`:F;return`${U}:${q} ${O}`},Fe=async($,ne)=>{if(!(c!=null&&c.chatId))return;const xe=h.find(re=>re.messageId===$),F=(xe==null?void 0:xe.reactions)||{},O=F[ne]||[],U=O.includes(he.uid),q={...F};if(U){const re=O.filter(de=>de!==he.uid);re.length===0?delete q[ne]:q[ne]=re}else q[ne]=[...O,he.uid];m(re=>re.map(de=>de.messageId===$?{...de,reactions:q}:de)),L(null);try{const re=localStorage.getItem("token");await ce.post("http://localhost:3000/api/chat/reaction",{chatId:c.chatId,messageId:$,emoji:ne},{headers:{Authorization:`Bearer ${re}`}})}catch(re){console.error("[EmployeeChat] Failed to update reaction:",re),m(de=>de.map(Q=>Q.messageId===$?{...Q,reactions:F}:Q)),s({type:"error",message:"Failed to update reaction"})}};return a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(8px) scale(0.96);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .message-bubble {
          transition: transform 0.1s ease, box-shadow 0.1s ease;
        }
        .message-bubble:hover {
          transform: translateY(-1px);
        }
        .typing-dots span {
          animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dots span:nth-child(1) {
          animation-delay: 0s;
        }
        .typing-dots span:nth-child(2) {
          animation-delay: 0.2s;
        }
        .typing-dots span:nth-child(3) {
          animation-delay: 0.4s;
        }
        @keyframes typing {
          0%, 60%, 100% {
            transform: translateY(0);
            opacity: 0.7;
          }
          30% {
            transform: translateY(-8px);
            opacity: 1;
          }
        }
      `}),a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#111b21] text-white":"bg-[#e5ddd5] text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("div",{className:"flex-1 flex",children:[a.jsxs("div",{className:`w-80 border-r ${e?"border-slate-800 bg-[#0a0a15]":"border-gray-200 bg-white"} flex flex-col`,children:[a.jsxs("div",{className:"flex border-b border-slate-800",children:[a.jsx("button",{onClick:()=>P("chats"),className:`flex-1 py-3 px-4 text-sm font-semibold transition ${V==="chats"?"bg-[#1f36ff] text-white":e?"text-slate-300 hover:bg-slate-800":"text-gray-600 hover:bg-gray-100"}`,children:"Chats"}),a.jsx("button",{onClick:()=>P("users"),className:`flex-1 py-3 px-4 text-sm font-semibold transition ${V==="users"?"bg-[#1f36ff] text-white":e?"text-slate-300 hover:bg-slate-800":"text-gray-600 hover:bg-gray-100"}`,children:"Users"})]}),a.jsx("div",{className:"p-4 border-b border-slate-800",children:a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),a.jsx("input",{type:"text",placeholder:V==="chats"?"Search chats...":"Search users...",value:v,onChange:$=>I($.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-100 border-gray-300 text-gray-900"} border focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:V==="chats"?a.jsxs("div",{className:"p-2",children:[t.length===0&&!o&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx(Bs,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No chats yet"}),a.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:"Start a conversation to see chats here"})]}),g&&t.length===0&&a.jsx("div",{className:"text-center py-12",children:a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading chats..."})}),o&&(()=>{var xe,F;const $=me.filter(O=>{var q,re;return((q=O.otherParticipant)==null?void 0:q.uid)===o.uid||((re=O.otherParticipant)==null?void 0:re.role)==="admin"});$.length>1&&console.warn("[EmployeeChat] Multiple admin chats found:",$.length,$.map(O=>O.chatId));const ne=$.length>0?$.sort((O,U)=>{const q=O.lastActivity?new Date(O.lastActivity).getTime():0;return(U.lastActivity?new Date(U.lastActivity).getTime():0)-q})[0]:null;if(ne){const O=((xe=c==null?void 0:c.otherParticipant)==null?void 0:xe.uid)===ne.otherParticipant.uid;return a.jsx("div",{onClick:()=>u(ne),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${O?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[ne.otherParticipant.photoURL?a.jsx("img",{src:ne.otherParticipant.photoURL,alt:"Admin",className:"w-10 h-10 rounded-full object-cover flex-shrink-0",onError:U=>{U.target.style.display="none",U.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white font-semibold flex-shrink-0 ${ne.otherParticipant.photoURL?"hidden":""}`,children:"A"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:"Admin"}),ne.lastMessage?a.jsx("p",{className:`text-xs truncate ${O?"text-white/80":"text-slate-400"}`,children:ne.lastMessage.content}):a.jsx("p",{className:`text-xs truncate ${O?"text-white/60":"text-slate-500"}`,children:ne.otherParticipant.email})]})]}),ne.unreadCount>0&&a.jsx("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0",children:ne.unreadCount})]})},ne.chatId)}return a.jsx("div",{onClick:()=>Z(o),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${((F=c==null?void 0:c.otherParticipant)==null?void 0:F.uid)===o.uid?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[o.photoURL?a.jsx("img",{src:o.photoURL,alt:"Admin",className:"w-10 h-10 rounded-full object-cover",onError:O=>{O.target.style.display="none",O.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white font-semibold ${o.photoURL?"hidden":""}`,children:"A"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:"Admin"}),a.jsx("p",{className:"text-xs text-slate-400 truncate",children:o.email})]})]})})})(),me.filter($=>{var xe,F;return!(((xe=$.otherParticipant)==null?void 0:xe.role)==="admin"||((F=$.otherParticipant)==null?void 0:F.uid)===(o==null?void 0:o.uid))}).map($=>{var F;const ne=((F=c==null?void 0:c.otherParticipant)==null?void 0:F.uid)===$.otherParticipant.uid,xe=$.otherParticipant.role==="admin";return a.jsx("div",{onClick:()=>u($),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${ne?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[$.otherParticipant.photoURL?a.jsx("img",{src:$.otherParticipant.photoURL,alt:$.otherParticipant.displayName||$.otherParticipant.email,className:"w-10 h-10 rounded-full object-cover flex-shrink-0",onError:O=>{O.target.style.display="none",O.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold flex-shrink-0 ${xe?"bg-emerald-500":"bg-[#1f36ff]"} ${$.otherParticipant.photoURL?"hidden":""}`,children:xe?"A":($.otherParticipant.displayName||$.otherParticipant.email||"U")[0].toUpperCase()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:xe?"Admin":$.otherParticipant.displayName||$.otherParticipant.email}),$.lastMessage?a.jsx("p",{className:`text-xs truncate ${ne?"text-white/80":"text-slate-400"}`,children:$.lastMessage.content}):a.jsx("p",{className:`text-xs truncate ${ne?"text-white/60":"text-slate-500"}`,children:$.otherParticipant.email})]})]}),$.unreadCount>0&&a.jsx("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0",children:$.unreadCount})]})},$.chatId)}),!1]}):a.jsxs("div",{className:"p-2",children:[o&&a.jsx("div",{onClick:()=>Z(o),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${((He=c==null?void 0:c.otherParticipant)==null?void 0:He.uid)===o.uid?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[o.photoURL?a.jsx("img",{src:o.photoURL,alt:"Admin",className:"w-10 h-10 rounded-full object-cover",onError:$=>{$.target.style.display="none",$.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white font-semibold ${o.photoURL?"hidden":""}`,children:"A"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:"Admin"}),a.jsx("p",{className:"text-xs text-slate-400 truncate",children:o.email})]})]})}),Re.map($=>{var ne;return a.jsx("div",{onClick:()=>Z($),className:`p-3 rounded-lg cursor-pointer transition mb-1 ${((ne=c==null?void 0:c.otherParticipant)==null?void 0:ne.uid)===$.uid?"bg-[#1f36ff] text-white":e?"hover:bg-slate-800":"hover:bg-gray-100"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[$.photoURL?a.jsx("img",{src:$.photoURL,alt:$.displayName||$.email,className:"w-10 h-10 rounded-full object-cover",onError:xe=>{xe.target.style.display="none",xe.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-10 h-10 rounded-full bg-[#1f36ff] flex items-center justify-center text-white font-semibold ${$.photoURL?"hidden":""}`,children:($.displayName||$.email||"U")[0].toUpperCase()}),k[$.uid]==="online"&&a.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-semibold truncate",children:$.displayName||$.email}),a.jsx("p",{className:"text-xs text-slate-400 truncate",children:$.email})]})]})},$.uid)})]})})]}),a.jsx("div",{className:"flex-1 flex flex-col",children:c?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`px-5 py-3.5 border-b ${e?"border-slate-700 bg-[#202c33] shadow-lg":"border-gray-200 bg-white shadow-sm"}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[c.otherParticipant.photoURL?a.jsx("img",{src:c.otherParticipant.photoURL,alt:c.otherParticipant.displayName||c.otherParticipant.email,className:"w-12 h-12 rounded-full object-cover shadow-md",onError:$=>{$.target.style.display="none",$.target.nextSibling.style.display="flex"}}):null,a.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-lg shadow-md ${c.otherParticipant.role==="admin"?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-[#1f36ff] to-[#1b2ed1]"} ${c.otherParticipant.photoURL?"hidden":""}`,children:(c.otherParticipant.displayName||c.otherParticipant.email||(c.otherParticipant.role==="admin"?"A":"U"))[0].toUpperCase()}),k[c.otherParticipant.uid]==="online"&&a.jsx("div",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-green-500 rounded-full border-2 border-white shadow-sm"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("p",{className:"font-semibold text-base text-gray-900 dark:text-white truncate",children:c.otherParticipant.displayName||c.otherParticipant.email})}),a.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:x[c.chatId]?a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"typing"}),a.jsxs("div",{className:"typing-dots flex gap-1",children:[a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"}),a.jsx("span",{className:"w-1.5 h-1.5 bg-gray-400 rounded-full"})]})]}):k[c.otherParticipant.uid]==="online"?a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"online"}):a.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"offline"})})]})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto relative",style:{backgroundImage:e?"radial-gradient(circle at 20% 50%, rgba(32, 44, 51, 0.2) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(32, 44, 51, 0.2) 0%, transparent 50%)":"radial-gradient(circle at 20% 50%, rgba(240, 242, 245, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(240, 242, 245, 0.3) 0%, transparent 50%)",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat"},children:a.jsxs("div",{className:"px-4 py-3 space-y-2",children:[h.length===0?a.jsxs("div",{className:"text-center text-gray-400 py-12",children:[a.jsx(Bs,{className:"text-4xl mx-auto mb-4 opacity-50"}),a.jsx("p",{children:"No messages yet. Start the conversation!"})]}):a.jsxs(a.Fragment,{children:[h.map(($,ne)=>{const xe=$.senderId===he.uid,F=$.reactions||{},O=Object.keys(F).length>0;return a.jsx("div",{className:`flex ${xe?"justify-end":"justify-start"} group animate-fadeIn`,style:{animation:`fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1) ${ne*.03}s both`},children:a.jsxs("div",{className:"relative max-w-[70%] lg:max-w-[65%] group/message",children:[a.jsxs("div",{className:`message-bubble relative px-4 py-2.5 rounded-[22px] ${xe?"bg-[#DCF8C6] text-gray-900 shadow-[0_1px_2px_rgba(0,0,0,0.1)]":e?"bg-[#2a3942] text-white shadow-[0_1px_2px_rgba(0,0,0,0.2)]":"bg-white text-gray-900 shadow-[0_1px_2px_rgba(0,0,0,0.08)]"}`,onContextMenu:U=>{U.preventDefault(),L(M===$.messageId?null:$.messageId)},onDoubleClick:()=>{L(M===$.messageId?null:$.messageId)},onTouchStart:U=>_e($.messageId,U),onTouchEnd:Ve,onMouseDown:U=>{U.button===0&&_e($.messageId,U)},onMouseUp:Ve,onMouseLeave:Ve,children:[a.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words mb-1",children:$.content}),!xe&&a.jsx("div",{className:"mb-1",children:a.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${$.senderRole==="admin"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-400":"bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-400"}`,children:$.senderRole==="admin"?"Admin":$.senderRole==="employee"?"Employee":"User"})}),a.jsxs("div",{className:`flex items-center justify-end gap-1.5 ${xe?"text-gray-600":"text-gray-500"}`,children:[a.jsx("span",{className:"text-[11px] opacity-55 font-normal",children:Se($.createdAt)}),xe&&a.jsx("span",{className:"flex items-center",children:$.read?a.jsx(js,{className:"w-4 h-4 text-[#53bdeb]"}):a.jsx(Jl,{className:"w-4 h-4 text-gray-500"})})]}),a.jsx("button",{onClick:U=>{U.stopPropagation(),U.preventDefault(),L(M===$.messageId?null:$.messageId)},className:`absolute -bottom-1.5 ${xe?"-left-1.5":"-right-1.5"} opacity-0 group-hover/message:opacity-100 transition-all duration-200 bg-white dark:bg-[#2a3942] rounded-full p-2 shadow-lg border border-gray-200 dark:border-gray-600 hover:scale-110 hover:shadow-xl z-20`,title:"Add reaction",children:a.jsx(ul,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),M===$.messageId&&a.jsx("div",{className:`reaction-picker-container absolute bottom-full mb-2 bg-white dark:bg-[#2a3942] rounded-full px-3 py-2.5 shadow-2xl border border-gray-200 dark:border-gray-600 flex gap-2.5 z-30 animate-fadeIn ${xe?"left-0":"right-0"}`,onClick:U=>U.stopPropagation(),children:Ne.map(U=>a.jsx("button",{onClick:q=>{q.stopPropagation(),Fe($.messageId,U)},className:"text-2xl hover:scale-150 active:scale-125 transition-transform duration-150 p-1.5 cursor-pointer rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",title:U,children:U},U))})]}),O&&a.jsx("div",{className:`flex gap-1 mt-1.5 ${xe?"justify-end":"justify-start"}`,children:a.jsx("div",{className:"bg-white dark:bg-[#2a3942] rounded-full px-2.5 py-1 shadow-md border border-gray-200 dark:border-gray-600 flex gap-2 items-center cursor-pointer hover:shadow-lg transition-all duration-200",onClick:U=>{U.stopPropagation(),L(M===$.messageId?null:$.messageId)},children:Object.entries(F).map(([U,q])=>{const re=q.length,de=q.includes(he.uid);return a.jsxs("span",{className:`text-sm flex items-center gap-1 px-1.5 py-0.5 rounded-full transition-colors ${de?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[a.jsx("span",{className:"text-base",children:U}),re>1&&a.jsx("span",{className:"text-[10px] opacity-75 font-semibold text-gray-700 dark:text-gray-300",children:re})]},U)})})})]})},$.messageId)}),x[c.chatId]&&a.jsx("div",{className:"flex justify-start animate-fadeIn",children:a.jsx("div",{className:`px-4 py-3 rounded-[22px] rounded-tl-none ${e?"bg-[#2a3942]":"bg-white"} shadow-sm`,children:a.jsxs("div",{className:"typing-dots flex gap-1.5",children:[a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("span",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full"})]})})})]}),a.jsx("div",{ref:j})]})}),a.jsx("div",{className:`px-5 py-4 border-t ${e?"border-slate-700 bg-[#202c33] shadow-lg":"border-gray-200 bg-[#f0f2f5] shadow-sm"}`,children:a.jsxs("form",{onSubmit:we,className:"flex items-end gap-3",children:[a.jsxs("div",{className:"flex-1 flex items-center gap-3 bg-white dark:bg-[#2a3942] rounded-full px-5 py-3 shadow-inner border border-gray-200 dark:border-gray-600",children:[a.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",children:a.jsx(ul,{className:"w-5 h-5"})}),a.jsx("input",{type:"text",value:p,onChange:$=>{N($.target.value),$.target.value&&!E?Ae(!0):!$.target.value&&E&&Ae(!1)},onKeyDown:()=>{E||Ae(!0)},placeholder:"Type a message",className:"flex-1 bg-transparent border-none outline-none text-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500",disabled:C})]}),a.jsx("button",{type:"submit",disabled:!p.trim()||C,className:`w-12 h-12 rounded-full transition-all duration-200 flex items-center justify-center shadow-md ${p.trim()?"bg-[#25d366] hover:bg-[#20ba5a] active:bg-[#1da851] text-white hover:scale-105 active:scale-95":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,children:a.jsx(bi,{className:"w-5 h-5"})})]})})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center text-slate-400",children:[a.jsx(Bs,{className:"text-6xl mx-auto mb-4 opacity-50"}),a.jsx("p",{className:"text-lg",children:"Select a chat to start messaging"})]})})})]})]})]})},W4=()=>{const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState(null),[r,i]=_.useState(!0),[o,l]=_.useState(""),[c,u]=_.useState(""),[h,m]=_.useState(""),[p,N]=_.useState(""),[v,I]=_.useState(""),[g,S]=_.useState(""),[C,T]=_.useState(""),[V,P]=_.useState(""),[k,b]=_.useState(!1),[x,w]=_.useState(!1),[E,A]=_.useState(""),[D,j]=_.useState(""),[K,X]=_.useState(!1),[W,se]=_.useState(!1),[M,L]=_.useState(!1),[Y,z]=_.useState(""),[le,he]=_.useState(!1),[Ne,_e]=_.useState(!1),[Ve,Ke]=_.useState(!1);_.useEffect(()=>{it()},[]);const it=async()=>{var ye,we;try{const B=localStorage.getItem("token");if(!B){s({type:"error",message:"Not authenticated. Please login again."});return}const Z=await ce.get("http://localhost:3000/api/user/profile",{headers:{Authorization:`Bearer ${B}`}});if(Z.data.success){const me=Z.data.data;n(me),l(me.displayName||""),u(me.email||""),m(me.bio||""),N(me.photoURL||""),I(me.photoURL||"")}}catch(B){console.error("Failed to load profile:",B),s({type:"error",message:((we=(ye=B.response)==null?void 0:ye.data)==null?void 0:we.message)||"Failed to load profile"})}finally{i(!1)}},at=ye=>{const we=ye.target.files[0];if(!we)return;if(!we.type.startsWith("image/")){s({type:"error",message:"Please select an image file"});return}if(we.size>5*1024*1024){s({type:"error",message:"Image size must be less than 5MB"});return}const B=new FileReader;B.onloadend=()=>{I(B.result)},B.readAsDataURL(we),oe(we)},oe=async ye=>{var we,B;Ke(!0);try{const Z=new FileReader;Z.onloadend=async()=>{const me=Z.result,be=localStorage.getItem("token");await ce.patch("http://localhost:3000/api/user/profile",{photoURL:me},{headers:{Authorization:`Bearer ${be}`}}),N(me),s({type:"success",message:"Profile photo updated successfully"});const Se={...JSON.parse(localStorage.getItem("user")||"{}"),photoURL:me};localStorage.setItem("user",JSON.stringify(Se)),window.dispatchEvent(new Event("profileUpdated")),it()},Z.readAsDataURL(ye)}catch(Z){console.error("Failed to upload photo:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to upload photo"}),I(p)}finally{Ke(!1)}},Ae=async()=>{var ye,we;if(!o.trim()){s({type:"error",message:"Display name cannot be empty"});return}_e(!0);try{const B=localStorage.getItem("token"),Z=await ce.patch("http://localhost:3000/api/user/profile",{displayName:o.trim()},{headers:{Authorization:`Bearer ${B}`}});if(Z.data.success){s({type:"success",message:"Display name updated successfully"}),n(Z.data.data);const be={...JSON.parse(localStorage.getItem("user")||"{}"),displayName:o.trim()};localStorage.setItem("user",JSON.stringify(be)),window.dispatchEvent(new Event("profileUpdated"))}}catch(B){console.error("Failed to update display name:",B),s({type:"error",message:((we=(ye=B.response)==null?void 0:ye.data)==null?void 0:we.message)||"Failed to update display name"})}finally{_e(!1)}},ee=async()=>{var ye,we;_e(!0);try{const B=localStorage.getItem("token"),Z=await ce.patch("http://localhost:3000/api/user/profile",{bio:h.trim()},{headers:{Authorization:`Bearer ${B}`}});Z.data.success&&(s({type:"success",message:"Bio updated successfully"}),n(Z.data.data))}catch(B){console.error("Failed to update bio:",B),s({type:"error",message:((we=(ye=B.response)==null?void 0:ye.data)==null?void 0:we.message)||"Failed to update bio"})}finally{_e(!1)}},ie=async ye=>{var we,B;if(ye.preventDefault(),!g||!C||!V){s({type:"error",message:"All password fields are required"});return}if(C.length<6){s({type:"error",message:"New password must be at least 6 characters"});return}if(C!==V){s({type:"error",message:"New passwords do not match"});return}w(!0);try{const Z=localStorage.getItem("token");(await ce.post("http://localhost:3000/api/user/change-password",{currentPassword:g,newPassword:C},{headers:{Authorization:`Bearer ${Z}`}})).data.success&&(s({type:"success",message:"Password changed successfully"}),S(""),T(""),P(""),b(!1))}catch(Z){console.error("Failed to change password:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to change password"})}finally{w(!1)}},G=async ye=>{var B,Z;if(ye.preventDefault(),!E||!D){s({type:"error",message:"Email and password are required"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E)){s({type:"error",message:"Invalid email format"});return}se(!0);try{const me=localStorage.getItem("token"),be=await ce.post("http://localhost:3000/api/user/change-email",{newEmail:E.trim(),password:D},{headers:{Authorization:`Bearer ${me}`}});be.data.success&&(s({type:"success",message:be.data.message||"Email changed successfully"}),A(""),j(""),X(!1),it())}catch(me){console.error("Failed to change email:",me),s({type:"error",message:((Z=(B=me.response)==null?void 0:B.data)==null?void 0:Z.message)||"Failed to change email"})}finally{se(!1)}},Ie=async()=>{var ye,we;if(!Y){s({type:"error",message:"Password is required to delete account"});return}he(!0);try{const B=localStorage.getItem("token");(await ce.delete("http://localhost:3000/api/user/account",{data:{password:Y},headers:{Authorization:`Bearer ${B}`}})).data.success&&(s({type:"success",message:"Account deleted successfully"}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login")}catch(B){console.error("Failed to delete account:",B),s({type:"error",message:((we=(ye=B.response)==null?void 0:ye.data)==null?void 0:we.message)||"Failed to delete account"}),z("")}finally{he(!1)}};return r?a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1f36ff] mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"Loading settings..."})]})})]}):a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx(_n,{}),a.jsx("div",{className:"flex-1 p-6",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("header",{className:"mb-8",children:[a.jsx("h1",{className:"text-4xl font-black mb-2",children:"Settings"}),a.jsx("p",{className:"text-slate-400",children:"Manage your account settings and preferences"})]}),a.jsx("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gradient-to-br from-[#1f36ff] to-[#15b5ff] flex items-center justify-center text-white text-3xl font-bold",children:v?a.jsx("img",{src:v,alt:"Profile",className:"w-full h-full object-cover"}):(o||c||"U")[0].toUpperCase()}),a.jsx("label",{htmlFor:"photo-upload",className:"absolute bottom-0 right-0 w-8 h-8 rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-110 bg-[#1f36ff] text-white shadow-lg",title:"Change photo",children:Ve?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):a.jsx(bb,{className:"w-4 h-4"})}),a.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:at,className:"hidden",disabled:Ve})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-xl font-bold mb-1",children:"Profile Photo"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Upload a new profile picture (max 5MB)"})]})]})}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Bi,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Full Name"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("input",{type:"text",value:o,onChange:ye=>l(ye.target.value),placeholder:"Enter your full name",className:`flex-1 px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`}),a.jsx("button",{onClick:Ae,disabled:Ne||!o.trim()||o===(t==null?void 0:t.displayName),className:`px-6 py-3 rounded-lg font-semibold transition ${Ne||!o.trim()||o===(t==null?void 0:t.displayName)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:Ne?"Saving...":"Save"})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Qu,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold",children:"Email Address"}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Current: ",c]})]})]}),a.jsx("button",{onClick:()=>X(!K),className:`px-4 py-2 rounded-lg font-semibold transition ${e?"bg-slate-800 hover:bg-slate-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:K?a.jsx(mt,{className:"w-5 h-5"}):a.jsx(is,{className:"w-5 h-5"})})]}),K&&a.jsxs("form",{onSubmit:G,className:"mt-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"New Email"}),a.jsx("input",{type:"email",value:E,onChange:ye=>A(ye.target.value),placeholder:"Enter new email address",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Current Password"}),a.jsx("input",{type:"password",value:D,onChange:ye=>j(ye.target.value),placeholder:"Enter your password to confirm",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"submit",disabled:W,className:`px-6 py-3 rounded-lg font-semibold transition ${W?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:W?"Updating...":"Update Email"}),a.jsx("button",{type:"button",onClick:()=>{X(!1),A(""),j("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(xi,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Password"})]}),a.jsx("button",{onClick:()=>b(!k),className:`px-4 py-2 rounded-lg font-semibold transition ${e?"bg-slate-800 hover:bg-slate-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:k?a.jsx(mt,{className:"w-5 h-5"}):a.jsx(is,{className:"w-5 h-5"})})]}),k&&a.jsxs("form",{onSubmit:ie,className:"mt-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Current Password"}),a.jsx("input",{type:"password",value:g,onChange:ye=>S(ye.target.value),placeholder:"Enter current password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"New Password"}),a.jsx("input",{type:"password",value:C,onChange:ye=>T(ye.target.value),placeholder:"Enter new password (min 6 characters)",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0,minLength:6})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Confirm New Password"}),a.jsx("input",{type:"password",value:V,onChange:ye=>P(ye.target.value),placeholder:"Confirm new password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0,minLength:6})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"submit",disabled:x,className:`px-6 py-3 rounded-lg font-semibold transition ${x?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:x?"Updating...":"Update Password"}),a.jsx("button",{type:"button",onClick:()=>{b(!1),S(""),T(""),P("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(is,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Bio / About Me"})]}),a.jsx("textarea",{value:h,onChange:ye=>m(ye.target.value),placeholder:"Tell us about yourself...",rows:4,className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff] resize-none`}),a.jsx("div",{className:"mt-4 flex justify-end",children:a.jsx("button",{onClick:ee,disabled:Ne||h===(t==null?void 0:t.bio),className:`px-6 py-3 rounded-lg font-semibold transition ${Ne||h===(t==null?void 0:t.bio)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:Ne?"Saving...":"Save Bio"})})]}),a.jsx("div",{className:`mb-6 rounded-2xl p-6 shadow-lg border-2 ${e?"bg-[#0a0a15] border-red-900/50":"bg-white border-red-200"}`,children:a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(xt,{className:"w-5 h-5 text-red-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Danger Zone"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Permanently delete your account and all associated data"})]}),a.jsx("button",{onClick:()=>L(!0),className:"px-6 py-3 rounded-lg font-semibold bg-red-600 hover:bg-red-700 text-white transition",children:"Delete Account"})]})})]})}),M&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-md w-full shadow-2xl ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-2",children:"Delete Account"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"This action cannot be undone. This will permanently delete your account and all associated data."}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Enter your password to confirm"}),a.jsx("input",{type:"password",value:Y,onChange:ye=>z(ye.target.value),placeholder:"Enter your password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`,autoFocus:!0})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:Ie,disabled:le||!Y,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition ${le||!Y?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,children:le?"Deleting...":"Delete Account"}),a.jsx("button",{onClick:()=>{L(!1),z("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})})]})},K4=()=>{const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),t=ft(),[n,r]=_.useState(null),[i,o]=_.useState(!0),[l,c]=_.useState(""),[u,h]=_.useState(""),[m,p]=_.useState(""),[N,v]=_.useState(""),[I,g]=_.useState(""),[S,C]=_.useState(""),[T,V]=_.useState(""),[P,k]=_.useState(""),[b,x]=_.useState(!1),[w,E]=_.useState(!1),[A,D]=_.useState(""),[j,K]=_.useState(""),[X,W]=_.useState(!1),[se,M]=_.useState(!1),[L,Y]=_.useState(!1),[z,le]=_.useState(""),[he,Ne]=_.useState(!1),[_e,Ve]=_.useState(!1),[Ke,it]=_.useState(!1);_.useEffect(()=>{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="employee"){s({type:"error",message:"Access denied. Employee access required."}),t("/login",{replace:!0});return}at()},[]);const at=async()=>{var we,B;try{const Z=localStorage.getItem("token");if(!Z){s({type:"error",message:"Not authenticated. Please login again."}),t("/login");return}const me=await ce.get("http://localhost:3000/api/user/profile",{headers:{Authorization:`Bearer ${Z}`}});if(me.data.success){const be=me.data.data;r(be),c(be.displayName||""),h(be.email||""),p(be.bio||""),v(be.photoURL||""),g(be.photoURL||"")}}catch(Z){console.error("Failed to load profile:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to load profile"})}finally{o(!1)}},oe=we=>{const B=we.target.files[0];if(!B)return;if(!B.type.startsWith("image/")){s({type:"error",message:"Please select an image file"});return}if(B.size>5*1024*1024){s({type:"error",message:"Image size must be less than 5MB"});return}const Z=new FileReader;Z.onloadend=()=>{g(Z.result)},Z.readAsDataURL(B),Ae(B)},Ae=async we=>{var B,Z;it(!0);try{const me=new FileReader;me.onloadend=async()=>{const be=me.result,Re=localStorage.getItem("token");await ce.patch("http://localhost:3000/api/user/profile",{photoURL:be},{headers:{Authorization:`Bearer ${Re}`}}),v(be),s({type:"success",message:"Profile photo updated successfully"});const Fe={...JSON.parse(localStorage.getItem("user")||"{}"),photoURL:be};localStorage.setItem("user",JSON.stringify(Fe)),window.dispatchEvent(new Event("profileUpdated")),at()},me.readAsDataURL(we)}catch(me){console.error("Failed to upload photo:",me),s({type:"error",message:((Z=(B=me.response)==null?void 0:B.data)==null?void 0:Z.message)||"Failed to upload photo"}),g(N)}finally{it(!1)}},ee=async()=>{var we,B;if(!l.trim()){s({type:"error",message:"Display name cannot be empty"});return}Ve(!0);try{const Z=localStorage.getItem("token"),me=await ce.patch("http://localhost:3000/api/user/profile",{displayName:l.trim()},{headers:{Authorization:`Bearer ${Z}`}});if(me.data.success){s({type:"success",message:"Display name updated successfully"}),r(me.data.data);const Re={...JSON.parse(localStorage.getItem("user")||"{}"),displayName:l.trim()};localStorage.setItem("user",JSON.stringify(Re)),window.dispatchEvent(new Event("profileUpdated"))}}catch(Z){console.error("Failed to update display name:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to update display name"})}finally{Ve(!1)}},ie=async()=>{var we,B;Ve(!0);try{const Z=localStorage.getItem("token"),me=await ce.patch("http://localhost:3000/api/user/profile",{bio:m.trim()},{headers:{Authorization:`Bearer ${Z}`}});me.data.success&&(s({type:"success",message:"Bio updated successfully"}),r(me.data.data))}catch(Z){console.error("Failed to update bio:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to update bio"})}finally{Ve(!1)}},G=async we=>{var B,Z;if(we.preventDefault(),!S||!T||!P){s({type:"error",message:"All password fields are required"});return}if(T.length<6){s({type:"error",message:"New password must be at least 6 characters"});return}if(T!==P){s({type:"error",message:"New passwords do not match"});return}E(!0);try{const me=localStorage.getItem("token");(await ce.post("http://localhost:3000/api/user/change-password",{currentPassword:S,newPassword:T},{headers:{Authorization:`Bearer ${me}`}})).data.success&&(s({type:"success",message:"Password changed successfully"}),C(""),V(""),k(""),x(!1))}catch(me){console.error("Failed to change password:",me),s({type:"error",message:((Z=(B=me.response)==null?void 0:B.data)==null?void 0:Z.message)||"Failed to change password"})}finally{E(!1)}},Ie=async we=>{var Z,me;if(we.preventDefault(),!A||!j){s({type:"error",message:"Email and password are required"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A)){s({type:"error",message:"Invalid email format"});return}M(!0);try{const be=localStorage.getItem("token"),Re=await ce.post("http://localhost:3000/api/user/change-email",{newEmail:A.trim(),password:j},{headers:{Authorization:`Bearer ${be}`}});Re.data.success&&(s({type:"success",message:Re.data.message||"Email changed successfully"}),D(""),K(""),W(!1),at())}catch(be){console.error("Failed to change email:",be),s({type:"error",message:((me=(Z=be.response)==null?void 0:Z.data)==null?void 0:me.message)||"Failed to change email"})}finally{M(!1)}},ye=async()=>{var we,B;if(!z){s({type:"error",message:"Password is required to delete account"});return}Ne(!0);try{const Z=localStorage.getItem("token");(await ce.delete("http://localhost:3000/api/user/account",{data:{password:z},headers:{Authorization:`Bearer ${Z}`}})).data.success&&(s({type:"success",message:"Account deleted successfully"}),localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login")}catch(Z){console.error("Failed to delete account:",Z),s({type:"error",message:((B=(we=Z.response)==null?void 0:we.data)==null?void 0:B.message)||"Failed to delete account"}),le("")}finally{Ne(!1)}};return i?a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1f36ff] mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500",children:"Loading settings..."})]})})]}):a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("div",{className:"flex-1 p-6 overflow-y-auto",children:[a.jsxs("div",{className:"max-w-5xl mx-auto",children:[a.jsx("div",{className:"mb-8",children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>t(-1),className:`p-2 rounded-lg transition ${e?"bg-slate-800 hover:bg-slate-700 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:a.jsx(kA,{className:"w-5 h-5"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-4xl font-black mb-2",children:"Settings"}),a.jsx("p",{className:"text-slate-400",children:"Manage your account settings and preferences"})]})]})})}),a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsx("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gradient-to-br from-[#1f36ff] to-[#15b5ff] flex items-center justify-center text-white text-3xl font-bold",children:I?a.jsx("img",{src:I,alt:"Profile",className:"w-full h-full object-cover"}):(l||u||"U")[0].toUpperCase()}),a.jsx("label",{htmlFor:"photo-upload",className:"absolute bottom-0 right-0 w-8 h-8 rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-110 bg-[#1f36ff] text-white shadow-lg",title:"Change photo",children:Ke?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):a.jsx(bb,{className:"w-4 h-4"})}),a.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:oe,className:"hidden",disabled:Ke})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-xl font-bold mb-1",children:"Profile Photo"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Upload a new profile picture (max 5MB)"})]})]})}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Bi,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Full Name"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("input",{type:"text",value:l,onChange:we=>c(we.target.value),placeholder:"Enter your full name",className:`flex-1 px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`}),a.jsx("button",{onClick:ee,disabled:_e||!l.trim()||l===(n==null?void 0:n.displayName),className:`px-6 py-3 rounded-lg font-semibold transition ${_e||!l.trim()||l===(n==null?void 0:n.displayName)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:_e?"Saving...":"Save"})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Qu,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold",children:"Email Address"}),a.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Current: ",u]})]})]}),a.jsx("button",{onClick:()=>W(!X),className:`px-4 py-2 rounded-lg font-semibold transition ${e?"bg-slate-800 hover:bg-slate-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:X?a.jsx(mt,{className:"w-5 h-5"}):a.jsx(is,{className:"w-5 h-5"})})]}),X&&a.jsxs("form",{onSubmit:Ie,className:"mt-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"New Email"}),a.jsx("input",{type:"email",value:A,onChange:we=>D(we.target.value),placeholder:"Enter new email address",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Current Password"}),a.jsx("input",{type:"password",value:j,onChange:we=>K(we.target.value),placeholder:"Enter your password to confirm",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"submit",disabled:se,className:`px-6 py-3 rounded-lg font-semibold transition ${se?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:se?"Updating...":"Update Email"}),a.jsx("button",{type:"button",onClick:()=>{W(!1),D(""),K("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(xi,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Password"})]}),a.jsx("button",{onClick:()=>x(!b),className:`px-4 py-2 rounded-lg font-semibold transition ${e?"bg-slate-800 hover:bg-slate-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:b?a.jsx(mt,{className:"w-5 h-5"}):a.jsx(is,{className:"w-5 h-5"})})]}),b&&a.jsxs("form",{onSubmit:G,className:"mt-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Current Password"}),a.jsx("input",{type:"password",value:S,onChange:we=>C(we.target.value),placeholder:"Enter current password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"New Password"}),a.jsx("input",{type:"password",value:T,onChange:we=>V(we.target.value),placeholder:"Enter new password (min 6 characters)",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0,minLength:6})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Confirm New Password"}),a.jsx("input",{type:"password",value:P,onChange:we=>k(we.target.value),placeholder:"Confirm new password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff]`,required:!0,minLength:6})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"submit",disabled:w,className:`px-6 py-3 rounded-lg font-semibold transition ${w?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:w?"Updating...":"Update Password"}),a.jsx("button",{type:"button",onClick:()=>{x(!1),C(""),V(""),k("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})]}),a.jsxs("div",{className:`mb-6 rounded-2xl p-6 shadow-lg ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(is,{className:"w-5 h-5 text-[#1f36ff]"}),a.jsx("h2",{className:"text-xl font-bold",children:"Bio / About Me"})]}),a.jsx("textarea",{value:m,onChange:we=>p(we.target.value),placeholder:"Tell us about yourself...",rows:4,className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-[#1f36ff] resize-none`}),a.jsx("div",{className:"mt-4 flex justify-end",children:a.jsx("button",{onClick:ie,disabled:_e||m===(n==null?void 0:n.bio),className:`px-6 py-3 rounded-lg font-semibold transition ${_e||m===(n==null?void 0:n.bio)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-[#1f36ff] text-white hover:bg-[#1b2ed1]"}`,children:_e?"Saving...":"Save Bio"})})]}),a.jsx("div",{className:`mb-6 rounded-2xl p-6 shadow-lg border-2 ${e?"bg-[#0a0a15] border-red-900/50":"bg-white border-red-200"}`,children:a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(xt,{className:"w-5 h-5 text-red-500"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-xl font-bold text-red-600",children:"Danger Zone"}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Permanently delete your account and all associated data"})]}),a.jsx("button",{onClick:()=>Y(!0),className:"px-6 py-3 rounded-lg font-semibold bg-red-600 hover:bg-red-700 text-white transition",children:"Delete Account"})]})})]})]}),L&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-md w-full shadow-2xl ${e?"bg-[#0a0a15] border border-slate-800":"bg-white border border-gray-200"}`,children:[a.jsx("h3",{className:"text-2xl font-bold text-red-600 mb-2",children:"Delete Account"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"This action cannot be undone. This will permanently delete your account and all associated data."}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Enter your password to confirm"}),a.jsx("input",{type:"password",value:z,onChange:we=>le(we.target.value),placeholder:"Enter your password",className:`w-full px-4 py-3 rounded-lg border ${e?"bg-slate-900 border-slate-700 text-white":"bg-gray-50 border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-red-500`,autoFocus:!0})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:ye,disabled:he||!z,className:`flex-1 px-6 py-3 rounded-lg font-semibold transition ${he||!z?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,children:he?"Deleting...":"Delete Account"}),a.jsx("button",{onClick:()=>{Y(!1),le("")},className:"px-6 py-3 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 text-gray-700 transition",children:"Cancel"})]})]})})]})]})},H4=`
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
`,zp=()=>{const{userId:s}=tN(),e=ft(),{showNotification:t}=yt(),{isDarkMode:n}=Tt(),[r,i]=_.useState(null),[o,l]=_.useState(null),{stats:c,weeklyStats:u,userActivity:h,refresh:m}=jb("employee",s);return _.useEffect(()=>{const p=JSON.parse(localStorage.getItem("user")||"{}");i(p);const N=window.location.pathname;if(["/employee-dashboard","/employee/my-users","/employee/add-user","/employee/add-meal-plan","/employee/chat","/employee/settings"].some(C=>N===C||N.startsWith(C+"/"))&&!N.includes(`/employee/${p.uid}`)&&N!=="/employee-dashboard")return;if(!s&&p.uid){e(`/employee/${p.uid}`,{replace:!0});return}const g=s&&/^[a-zA-Z0-9]{20,}$/.test(s);if(s&&g&&p.uid!==s){t({type:"error",message:"Access denied. You can only view your own dashboard."}),e(`/employee/${p.uid}`,{replace:!0});return}if(p.role!=="employee"){t({type:"error",message:"Access denied. Employee access required."}),e("/login",{replace:!0});return}if(!localStorage.getItem("token")){e("/login",{replace:!0});return}},[s,e,t]),_.useEffect(()=>{const p=()=>{setTimeout(()=>{m()},500)};return window.addEventListener("userCreated",p),()=>{window.removeEventListener("userCreated",p)}},[m]),a.jsxs(a.Fragment,{children:[a.jsx("style",{children:H4}),a.jsxs("div",{className:`min-h-screen flex transition-colors ${n?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("main",{className:"flex-1 px-10 py-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),o&&a.jsxs("div",{className:"mt-2 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm",children:[" ",o]})]}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("button",{className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 active:scale-95 transition-all duration-200 flex items-center justify-center hover:shadow-lg hover:shadow-white/10",children:a.jsx(Bs,{className:"text-lg transition-transform duration-200 hover:scale-110"})})})]}),a.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[a.jsxs("div",{className:"col-span-12 lg:col-span-8 space-y-6",children:[a.jsxs("section",{className:"bg-gradient-to-r from-[#f8eedf] to-[#fbe3d3] rounded-[32px] p-6 flex flex-col lg:flex-row gap-6 text-[#111324] opacity-0 animate-[fadeIn_0.6s_ease-out_0.1s_forwards] hover:shadow-2xl hover:shadow-[#f8eedf]/20 transition-all duration-300 hover:-translate-y-1",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-semibold mb-2 tracking-wide",children:"Welcome back!"}),a.jsx("h2",{className:"text-3xl font-black leading-tight tracking-tight",children:"Ready to help your clients?"}),a.jsx("p",{className:"text-sm text-black/60 mt-3 leading-relaxed",children:"Your guidance powers every member's journey"})]}),a.jsx("div",{className:"w-full lg:w-56 h-56 rounded-[28px] overflow-hidden border border-black/5 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:a.jsx("img",{src:"/hero-image.png",alt:"athlete",className:"w-full h-full object-cover transition-transform duration-300 hover:scale-110"})})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white/10 rounded-[28px] p-6 backdrop-blur opacity-0 animate-[fadeIn_0.6s_ease-out_0.2s_forwards] hover:bg-white/15 hover:shadow-2xl hover:shadow-[#1f9fff]/20 hover:-translate-y-2 active:scale-[0.98] transition-all duration-300 cursor-pointer border border-white/5 hover:border-white/20",children:[a.jsx("p",{className:"text-sm text-white/70 mb-4 font-medium tracking-wide",children:"Assigned Users"}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-5xl font-black leading-none transition-all duration-300 hover:scale-110 inline-block",children:c.totalUsers}),a.jsx("p",{className:"text-sm text-white/60 mt-2 font-medium",children:"Active clients"})]}),a.jsx(es,{className:"text-5xl text-[#1f9fff] transition-transform duration-300 hover:scale-110 hover:rotate-12"})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-white/10",children:a.jsx("p",{className:"text-xs text-white/50 font-medium",children:"Updates in real-time"})})]}),a.jsxs("div",{className:"bg-[#1f36ff] rounded-[28px] p-6 text-white opacity-0 animate-[fadeIn_0.6s_ease-out_0.3s_forwards] hover:shadow-2xl hover:shadow-[#1f36ff]/40 hover:-translate-y-2 active:scale-[0.98] transition-all duration-300 cursor-pointer border border-[#1f36ff]/50 hover:border-white/30",children:[a.jsx("p",{className:"text-sm text-white/80 mb-4 font-medium tracking-wide",children:"Progress Entries"}),a.jsxs("div",{className:"flex items-end gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-5xl font-black leading-none transition-all duration-300 hover:scale-110 inline-block",children:c.totalProgressEntries}),a.jsx("span",{className:"text-sm text-white/70 mt-1 block font-medium",children:"Total tracked"})]}),a.jsx($A,{className:"text-5xl transition-transform duration-300 hover:scale-110 hover:rotate-12"})]}),a.jsx("div",{className:"mt-6 h-24 rounded-2xl bg-white/15 flex items-end gap-1 p-2",children:Array.from({length:20}).map((p,N)=>a.jsx("span",{className:"flex-1 rounded-full bg-white/70 transition-all duration-300 hover:bg-white/90",style:{height:`${30+N*2}px`}},N))})]})]}),a.jsxs("section",{className:"bg-gradient-to-r from-[#1f36ff] to-[#15b5ff] rounded-[32px] p-6 flex items-center justify-between opacity-0 animate-[fadeIn_0.6s_ease-out_0.5s_forwards] hover:shadow-2xl hover:shadow-[#1f36ff]/30 hover:-translate-y-1 transition-all duration-300",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 font-semibold mb-1",children:"Great work!"}),a.jsx("h3",{className:"text-2xl font-semibold leading-tight",children:"Your clients are making excellent progress."})]}),a.jsx("button",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30 active:scale-90 transition-all duration-200 hover:rotate-90 hover:shadow-lg",children:""})]})]}),a.jsx("div",{className:"col-span-12 lg:col-span-4 space-y-6",children:a.jsxs("section",{className:"bg-[#111324] rounded-[32px] p-6 space-y-6 border border-white/5 opacity-0 animate-[fadeIn_0.6s_ease-out_0.5s_forwards] hover:border-white/10 hover:shadow-2xl hover:shadow-black/20 transition-all duration-300",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 mb-4 font-semibold",children:"User Signups This Week"}),a.jsx("div",{className:"bg-white/5 rounded-2xl p-4 h-48 flex gap-2 items-end",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((p,N)=>{const v=u[p]||0,I=Math.max(...Object.values(u),1),g=v/I*100,S=v>0?20:10,C=Math.max(S,g);return a.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2 group opacity-0 animate-[fadeInUp_0.5s_ease-out_forwards]",style:{animationDelay:`${N*50}ms`},children:[a.jsxs("div",{className:"relative w-full flex items-end justify-center",style:{height:"140px"},children:[a.jsx("div",{className:"w-full rounded-full bg-gradient-to-t from-[#1f36ff] to-[#15b5ff] transition-all duration-300 group-hover:from-[#2547ff] group-hover:to-[#20c5ff] group-hover:shadow-lg group-hover:shadow-[#1f36ff]/40 group-hover:scale-105",style:{height:`${C}%`}}),v>0&&a.jsx("span",{className:"absolute -top-6 text-xs font-bold text-white/90 transition-all duration-300 group-hover:text-white group-hover:scale-110",children:v})]}),a.jsx("span",{className:"text-xs text-white/60 font-medium transition-colors duration-300 group-hover:text-white/80",children:p})]},p)})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm uppercase tracking-[0.4em] text-white/60 mb-4 font-semibold",children:"User Status"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-2xl p-5 flex items-center justify-between hover:bg-emerald-500/20 hover:border-emerald-500/50 hover:shadow-lg hover:shadow-emerald-500/20 hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 cursor-pointer",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110 hover:rotate-12",children:a.jsx(es,{className:"text-emerald-400 text-xl"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-lg font-bold text-white transition-all duration-300 hover:scale-105 inline-block",children:h.active}),a.jsx("p",{className:"text-xs text-white/60 mt-0.5 font-medium",children:"Active Users"})]})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110",children:a.jsx("span",{className:"text-emerald-400 text-xs font-bold",children:""})})]}),a.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-2xl p-5 flex items-center justify-between hover:bg-red-500/20 hover:border-red-500/50 hover:shadow-lg hover:shadow-red-500/20 hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 cursor-pointer",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110 hover:rotate-12",children:a.jsx(es,{className:"text-red-400 text-xl"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-lg font-bold text-white transition-all duration-300 hover:scale-105 inline-block",children:h.inactive}),a.jsx("p",{className:"text-xs text-white/60 mt-0.5 font-medium",children:"Inactive Users"})]})]}),a.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center transition-transform duration-300 hover:scale-110",children:a.jsx("span",{className:"text-red-400 text-xs font-bold",children:""})})]})]})]})]})})]})]})]})]})},Gp=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState(null),[i,o]=_.useState(null),[l,c]=_.useState(!1),[u,h]=_.useState({fullName:"",email:"",height:"",weight:"",gender:"",age:"",planType:""}),[m,p]=_.useState({});_.useEffect(()=>{const g=JSON.parse(localStorage.getItem("user")||"{}");if(r(g),g.role!=="employee"){e({type:"error",message:"Access denied. Employee access required."}),s("/login",{replace:!0});return}if(!localStorage.getItem("token")){s("/login",{replace:!0});return}},[s,e]),_.useEffect(()=>{const g=()=>{};return window.addEventListener("userCreated",g),()=>{window.removeEventListener("userCreated",g)}},[]);const N=g=>{const{name:S,value:C}=g.target;h(T=>({...T,[S]:C})),m[S]&&p(T=>({...T,[S]:""}))},v=()=>{const g={};return u.fullName.trim()||(g.fullName="Full Name is required"),u.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.email)||(g.email="Please enter a valid email address"):g.email="Email is required",u.height.trim()?(isNaN(u.height)||parseFloat(u.height)<=0)&&(g.height="Please enter a valid height"):g.height="Height is required",u.weight.trim()?(isNaN(u.weight)||parseFloat(u.weight)<=0)&&(g.weight="Please enter a valid weight"):g.weight="Weight is required",u.gender||(g.gender="Gender is required"),u.age.trim()?(isNaN(u.age)||parseInt(u.age)<=0||parseInt(u.age)>120)&&(g.age="Please enter a valid age"):g.age="Age is required",u.planType||(g.planType="Plan Type is required"),p(g),Object.keys(g).length===0},I=async g=>{var S,C;if(g.preventDefault(),!v()){e({type:"error",message:"Please fill in all required fields correctly"});return}c(!0),o(null);try{const T=localStorage.getItem("token");if(!T){s("/login");return}const V=await ce.post("http://localhost:3000/api/employee/users",{email:u.email,displayName:u.fullName,height:parseFloat(u.height),weight:parseFloat(u.weight),gender:u.gender,age:parseInt(u.age),planType:u.planType,role:"user"},{headers:{Authorization:`Bearer ${T}`}});if(V.data.success)e({type:"success",message:`User "${u.fullName}" created successfully! Welcome email sent with login credentials.`}),h({fullName:"",email:"",height:"",weight:"",gender:"",age:"",planType:""}),p({}),window.dispatchEvent(new CustomEvent("userCreated"));else throw new Error(V.data.message||"Failed to create user")}catch(T){console.error("Error creating user:",T);const V=((C=(S=T.response)==null?void 0:S.data)==null?void 0:C.message)||T.message||"Failed to create user. Please try again.";o(V),e({type:"error",message:V})}finally{c(!1)}};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("main",{className:"flex-1 px-10 py-8",children:[a.jsx("div",{className:"flex items-center justify-between mb-8",children:a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[a.jsx(hl,{className:"text-4xl text-[#1f36ff]"}),"Add New User"]}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Create a new client account"}),i&&a.jsxs("div",{className:"mt-2 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm",children:[" ",i]})]})}),a.jsx("div",{className:"max-w-4xl",children:a.jsx("section",{className:`rounded-[32px] p-8 border transition-all duration-300 ${t?"bg-[#111324] border-white/5":"bg-white border-gray-200 shadow-lg"}`,children:a.jsxs("form",{onSubmit:I,className:"space-y-6",children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"fullName",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Full Name ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"text",id:"fullName",name:"fullName",value:u.fullName,onChange:N,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.fullName?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none placeholder:text-gray-400`,placeholder:"John Doe"}),m.fullName&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.fullName})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"email",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Email ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"email",id:"email",name:"email",value:u.email,onChange:N,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.email?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none placeholder:text-gray-400`,placeholder:"user@example.com"}),m.email&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.email})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"height",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Height (cm) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",id:"height",name:"height",value:u.height,onChange:N,min:"0",step:"0.1",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.height?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none placeholder:text-gray-400`,placeholder:"175"}),m.height&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.height})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"weight",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Weight (kg) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",id:"weight",name:"weight",value:u.weight,onChange:N,min:"0",step:"0.1",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.weight?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none placeholder:text-gray-400`,placeholder:"70"}),m.weight&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.weight})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"gender",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Gender ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{id:"gender",name:"gender",value:u.gender,onChange:N,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.gender?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none`,children:[a.jsx("option",{value:"",children:"Select Gender"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"female",children:"Female"}),a.jsx("option",{value:"other",children:"Other"})]}),m.gender&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.gender})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"age",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Age ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",id:"age",name:"age",value:u.age,onChange:N,min:"1",max:"120",className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.age?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none placeholder:text-gray-400`,placeholder:"25"}),m.age&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.age})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"planType",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Plan Type ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{id:"planType",name:"planType",value:u.planType,onChange:N,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${m.planType?"border-red-500/70 focus:ring-2 focus:ring-red-400 focus:border-red-400":t?"border-white/10 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white/5 text-white":"border-gray-300 focus:ring-2 focus:ring-[#1f36ff] focus:border-[#1f36ff] bg-white text-gray-900"} focus:outline-none`,children:[a.jsx("option",{value:"",children:"Select Plan Type"}),a.jsx("option",{value:"Weight Loss",children:"Weight Loss"}),a.jsx("option",{value:"Muscle Gain / Weight Gain",children:"Muscle Gain / Weight Gain"}),a.jsx("option",{value:"Maintenance / Fitness / Healthy Lifestyle",children:"Maintenance / Fitness / Healthy Lifestyle"})]}),m.planType&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:m.planType})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"assignedTrainer",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:"Assigned Trainer/Coach"}),a.jsx("input",{type:"text",id:"assignedTrainer",value:(n==null?void 0:n.displayName)||(n==null?void 0:n.email)||"Loading...",readOnly:!0,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${t?"border-white/10 bg-white/5 text-white/60 cursor-not-allowed":"border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed"}`})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"role",className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:"Role"}),a.jsx("input",{type:"text",id:"role",value:"User",readOnly:!0,className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 ${t?"border-white/10 bg-white/5 text-white/60 cursor-not-allowed":"border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed"}`})]}),a.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t border-white/10",children:[a.jsx("button",{type:"button",onClick:()=>{h({fullName:"",email:"",height:"",weight:"",gender:"",age:"",planType:""}),p({}),o(null)},className:`px-6 py-3 rounded-xl font-medium transition-all duration-300 ${t?"bg-white/10 hover:bg-white/20 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Clear Form"}),a.jsx("button",{type:"submit",disabled:l,className:`px-8 py-3 rounded-xl font-medium transition-all duration-300 ${l?"bg-[#1f36ff]/60 cursor-not-allowed text-white/60":"bg-[#1f36ff] hover:bg-[#1b2ed1] text-white hover:shadow-lg hover:shadow-[#1f36ff]/40 hover:-translate-y-0.5 active:scale-[0.98]"}`,children:l?a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating User..."]}):a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(hl,{className:"text-lg"}),"Add User"]})})]})]})})})]})]})},J4=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(!0),[u,h]=_.useState(""),[m,p]=_.useState("createdAt"),[N,v]=_.useState("desc"),[I,g]=_.useState(!1),[S,C]=_.useState(null),[T,V]=_.useState(null),[P,k]=_.useState(null),[b,x]=_.useState(null),[w,E]=_.useState(null),[A,D]=_.useState(!1),[j,K]=_.useState({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),[X,W]=_.useState({}),se=_.useCallback(async()=>{var oe,Ae;try{c(!0);const ee=localStorage.getItem("token");if(!ee){s("/login");return}const ie=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${ee}`}});if(ie.data.success)r(ie.data.data||[]);else throw new Error(ie.data.message||"Failed to fetch users")}catch(ee){console.error("Error fetching users:",ee),e({type:"error",message:((Ae=(oe=ee.response)==null?void 0:oe.data)==null?void 0:Ae.message)||ee.message||"Failed to load users"})}finally{c(!1)}},[s,e]);_.useEffect(()=>{se();const oe=()=>{se()};window.addEventListener("userCreated",oe);const Ae=setInterval(se,3e4);return()=>{window.removeEventListener("userCreated",oe),clearInterval(Ae)}},[se]),_.useEffect(()=>{let oe=[...n];if(u){const Ae=u.toLowerCase();oe=oe.filter(ee=>{var ie,G,Ie;return((ie=ee.displayName)==null?void 0:ie.toLowerCase().includes(Ae))||((G=ee.realEmail)==null?void 0:G.toLowerCase().includes(Ae))||((Ie=ee.loginEmail)==null?void 0:Ie.toLowerCase().includes(Ae))})}oe.sort((Ae,ee)=>{let ie=Ae[m],G=ee[m];return(m==="createdAt"||m==="lastLogin")&&(ie=ie?new Date(ie).getTime():0,G=G?new Date(G).getTime():0),typeof ie=="string"&&(ie=ie.toLowerCase(),G=(G||"").toLowerCase()),N==="asc"?ie>G?1:ie<G?-1:0:ie<G?1:ie>G?-1:0}),o(oe)},[n,u,m,N]);const M=oe=>{const{name:Ae,value:ee}=oe.target;K(ie=>({...ie,[Ae]:ee})),X[Ae]&&W(ie=>({...ie,[Ae]:""}))},L=()=>{const oe={};return j.displayName.trim()||(oe.displayName="Full Name is required"),j.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j.email)||(oe.email="Please enter a valid email address"):oe.email="Email is required",j.gender||(oe.gender="Gender is required"),j.age.trim()?(isNaN(j.age)||parseInt(j.age)<=0||parseInt(j.age)>120)&&(oe.age="Please enter a valid age"):oe.age="Age is required",j.height.trim()?(isNaN(j.height)||parseFloat(j.height)<=0)&&(oe.height="Please enter a valid height"):oe.height="Height is required",j.weight.trim()?(isNaN(j.weight)||parseFloat(j.weight)<=0)&&(oe.weight="Please enter a valid weight"):oe.weight="Weight is required",j.planType||(oe.planType="Plan Type is required"),W(oe),Object.keys(oe).length===0},Y=async oe=>{var Ae,ee;if(oe.preventDefault(),!L()){e({type:"error",message:"Please fill in all required fields correctly"});return}D(!0);try{const ie=localStorage.getItem("token");if(!ie){s("/login");return}const G=await ce.post("http://localhost:3000/api/employee/users",{email:j.email,displayName:j.displayName,height:parseFloat(j.height),weight:parseFloat(j.weight),gender:j.gender,age:parseInt(j.age),planType:j.planType,role:"user"},{headers:{Authorization:`Bearer ${ie}`}});if(G.data.success)e({type:"success",message:`User "${j.displayName}" created successfully! Welcome email sent with login credentials.`}),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({}),g(!1),se(),window.dispatchEvent(new CustomEvent("userCreated"));else throw new Error(G.data.message||"Failed to create user")}catch(ie){console.error("Error creating user:",ie),e({type:"error",message:((ee=(Ae=ie.response)==null?void 0:Ae.data)==null?void 0:ee.message)||ie.message||"Failed to create user. Please try again."})}finally{D(!1)}},z=oe=>{var Ae,ee,ie;C(oe),K({displayName:oe.displayName||"",email:oe.realEmail||"",gender:oe.gender||"",age:((Ae=oe.age)==null?void 0:Ae.toString())||"",height:((ee=oe.height)==null?void 0:ee.toString())||"",weight:((ie=oe.weight)==null?void 0:ie.toString())||"",planType:oe.planType||""}),W({})},le=async oe=>{var Ae,ee;if(oe.preventDefault(),!L()){e({type:"error",message:"Please fill in all required fields correctly"});return}D(!0);try{const ie=localStorage.getItem("token");if(!ie){s("/login");return}const G=await ce.put(`http://localhost:3000/api/employee/users/${S.uid}`,{displayName:j.displayName,realEmail:j.email,height:parseFloat(j.height),weight:parseFloat(j.weight),gender:j.gender,age:parseInt(j.age),planType:j.planType},{headers:{Authorization:`Bearer ${ie}`}});if(G.data.success)e({type:"success",message:`User "${j.displayName}" updated successfully!`}),C(null),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({}),se();else throw new Error(G.data.message||"Failed to update user")}catch(ie){console.error("Error updating user:",ie),e({type:"error",message:((ee=(Ae=ie.response)==null?void 0:Ae.data)==null?void 0:ee.message)||ie.message||"Failed to update user. Please try again."})}finally{D(!1)}},he=oe=>{k({...oe,mealPlan:oe.mealPlan||null})},Ne=async()=>{var oe,Ae;if(w){D(!0);try{const ee=localStorage.getItem("token");if(!ee){s("/login");return}const ie=await ce.delete(`http://localhost:3000/api/mealPlans/${w.uid}`,{headers:{Authorization:`Bearer ${ee}`}});if(ie.data.success)e({type:"success",message:"Meal plan deleted successfully"}),E(null),se();else throw new Error(ie.data.message||"Failed to delete meal plan")}catch(ee){console.error("Error deleting meal plan:",ee),e({type:"error",message:((Ae=(oe=ee.response)==null?void 0:oe.data)==null?void 0:Ae.message)||ee.message||"Failed to delete meal plan"})}finally{D(!1)}}},_e=async oe=>{var Ae,ee;if(b){D(!0);try{const ie=localStorage.getItem("token");if(!ie){s("/login");return}const G=await ce.put(`http://localhost:3000/api/mealPlans/${b.uid}`,{mealPlan:oe},{headers:{Authorization:`Bearer ${ie}`}});if(G.data.success)e({type:"success",message:"Meal plan updated successfully"}),x(null),se();else throw new Error(G.data.message||"Failed to update meal plan")}catch(ie){console.error("Error updating meal plan:",ie),e({type:"error",message:((ee=(Ae=ie.response)==null?void 0:Ae.data)==null?void 0:ee.message)||ie.message||"Failed to update meal plan"})}finally{D(!1)}}},Ve=async()=>{var oe,Ae;if(T){D(!0);try{const ee=localStorage.getItem("token");if(!ee){s("/login");return}const ie=await ce.delete(`http://localhost:3000/api/employee/users/${T.uid}`,{headers:{Authorization:`Bearer ${ee}`}});if(ie.data.success)e({type:"success",message:`User "${T.displayName}" deleted successfully!`}),V(null),se();else throw new Error(ie.data.message||"Failed to delete user")}catch(ee){console.error("Error deleting user:",ee),e({type:"error",message:((Ae=(oe=ee.response)==null?void 0:oe.data)==null?void 0:Ae.message)||ee.message||"Failed to delete user. Please try again."})}finally{D(!1)}}},Ke=oe=>{m===oe?v(N==="asc"?"desc":"asc"):(p(oe),v("asc"))},it=oe=>{if(!oe)return"Never";try{return new Date(oe).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},at=oe=>m!==oe?null:N==="asc"?a.jsx(CA,{className:"inline ml-1"}):a.jsx(AA,{className:"inline ml-1"});return a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#05050c] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("main",{className:"flex-1 px-6 py-8 overflow-x-auto",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[a.jsx(es,{className:"text-4xl text-[#1f36ff]"}),"My Users"]}),a.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Manage your assigned clients (",i.length," ",i.length===1?"user":"users",")"]})]})}),a.jsx("div",{className:"mb-6",children:a.jsxs("button",{onClick:()=>{g(!I),C(null),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({})},className:`flex items-center gap-2 px-6 py-3 rounded-xl font-semibold transition-all duration-300 ${I?"bg-red-500 hover:bg-red-600 text-white":"bg-[#1f36ff] hover:bg-[#1b2ed1] text-white hover:shadow-lg hover:shadow-[#1f36ff]/40 hover:-translate-y-0.5 active:scale-[0.98]"}`,children:[a.jsx(hl,{className:"text-lg"}),I?"Cancel":"Add New User",I?a.jsx(mt,{className:"ml-1"}):a.jsx(gi,{className:"ml-1"})]})}),I&&a.jsxs("div",{className:`mb-6 rounded-2xl p-6 border transition-all duration-300 ${t?"bg-[#111324] border-white/5":"bg-white border-gray-200 shadow-lg"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Add New User"}),a.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Full Name ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"text",name:"displayName",value:j.displayName,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.displayName?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,placeholder:"John Doe"}),X.displayName&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.displayName})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Real Email ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"email",name:"email",value:j.email,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.email?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,placeholder:"user@example.com"}),X.email&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.email})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Gender ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{name:"gender",value:j.gender,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.gender?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,children:[a.jsx("option",{value:"",children:"Select Gender"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"female",children:"Female"}),a.jsx("option",{value:"other",children:"Other"})]}),X.gender&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.gender})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Age ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"age",value:j.age,onChange:M,min:"1",max:"120",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.age?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,placeholder:"25"}),X.age&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.age})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Height (cm) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"height",value:j.height,onChange:M,min:"0",step:"0.1",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.height?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,placeholder:"175"}),X.height&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.height})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Weight (kg) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"weight",value:j.weight,onChange:M,min:"0",step:"0.1",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.weight?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,placeholder:"70"}),X.weight&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.weight})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Plan Type ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{name:"planType",value:j.planType,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.planType?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,children:[a.jsx("option",{value:"",children:"Select Plan Type"}),a.jsx("option",{value:"Weight Loss",children:"Weight Loss"}),a.jsx("option",{value:"Muscle Gain / Weight Gain",children:"Muscle Gain / Weight Gain"}),a.jsx("option",{value:"Maintenance / Fitness / Healthy Lifestyle",children:"Maintenance / Fitness / Healthy Lifestyle"})]}),X.planType&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.planType})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{g(!1),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({})},className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-white/10 hover:bg-white/20 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{type:"submit",disabled:A,className:`px-6 py-2 rounded-lg font-medium transition-all ${A?"bg-[#1f36ff]/60 cursor-not-allowed text-white/60":"bg-[#1f36ff] hover:bg-[#1b2ed1] text-white hover:shadow-lg"}`,children:A?"Creating...":"Create User"})]})]})]}),a.jsx("div",{className:`mb-6 rounded-xl p-4 ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:a.jsx("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(Nn,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${t?"text-white/40":"text-gray-400"}`}),a.jsx("input",{type:"text",placeholder:"Search by name or email...",value:u,onChange:oe=>h(oe.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border transition-all ${t?"border-white/10 bg-white/5 text-white placeholder:text-white/40":"border-gray-300 bg-white text-gray-900"}`})]})})}),l?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#1f36ff]"})}):i.length===0?a.jsxs("div",{className:`text-center py-12 rounded-xl ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:[a.jsx(es,{className:"mx-auto text-6xl text-gray-400 mb-4"}),a.jsx("p",{className:"text-lg font-semibold text-gray-400",children:u?"No users found matching your search":"No users yet"}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:u?"Try a different search term":'Click "Add New User" to get started'})]}):a.jsx("div",{className:`rounded-xl overflow-hidden border ${t?"bg-[#111324] border-white/5":"bg-white border-gray-200"}`,children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:t?"bg-white/5":"bg-gray-50",children:a.jsxs("tr",{children:[a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("displayName"),children:["Full Name ",at("displayName")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("loginEmail"),children:["Login Email ",at("loginEmail")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("realEmail"),children:["Real Email ",at("realEmail")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("age"),children:["Age ",at("age")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("gender"),children:["Gender ",at("gender")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("planType"),children:["Plan Type ",at("planType")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("createdAt"),children:["Created At ",at("createdAt")]}),a.jsxs("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>Ke("lastLogin"),children:["Last Login ",at("lastLogin")]}),a.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-white/5",children:i.map(oe=>a.jsxs("tr",{className:`hover:bg-white/5 transition-colors ${t?"":"hover:bg-gray-50"}`,children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:oe.displayName||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:oe.loginEmail||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:oe.realEmail||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:oe.age||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm capitalize",children:oe.gender||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:oe.planType||"N/A"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:it(oe.createdAt)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:it(oe.lastLogin)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>he(oe),className:"p-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 text-green-400 transition-colors",title:"View meal plan",children:a.jsx(hr,{})}),a.jsx("button",{onClick:()=>z(oe),className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 transition-colors",title:"Edit user",children:a.jsx(is,{})}),a.jsx("button",{onClick:()=>V(oe),className:"p-2 rounded-lg bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-colors",title:"Delete user",children:a.jsx(xt,{})})]})})]},oe.uid))})]})})}),S&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-bold",children:"Edit User"}),a.jsx("button",{onClick:()=>{C(null),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({})},className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:a.jsx(mt,{})})]}),a.jsxs("form",{onSubmit:le,className:"space-y-4",children:[a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Full Name ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"text",name:"displayName",value:j.displayName,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.displayName?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`}),X.displayName&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.displayName})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Real Email ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"email",name:"email",value:j.email,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.email?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`}),X.email&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.email})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Gender ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{name:"gender",value:j.gender,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.gender?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,children:[a.jsx("option",{value:"",children:"Select Gender"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"female",children:"Female"}),a.jsx("option",{value:"other",children:"Other"})]}),X.gender&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.gender})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Age ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"age",value:j.age,onChange:M,min:"1",max:"120",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.age?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`}),X.age&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.age})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Height (cm) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"height",value:j.height,onChange:M,min:"0",step:"0.1",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.height?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`}),X.height&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.height})]}),a.jsxs("div",{children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Weight (kg) ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsx("input",{type:"number",name:"weight",value:j.weight,onChange:M,min:"0",step:"0.1",className:`w-full px-4 py-2 rounded-lg border transition-all ${X.weight?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`}),X.weight&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.weight})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsxs("label",{className:`block text-sm font-semibold mb-2 ${t?"text-white/80":"text-gray-700"}`,children:["Plan Type ",a.jsx("span",{className:"text-red-400",children:"*"})]}),a.jsxs("select",{name:"planType",value:j.planType,onChange:M,className:`w-full px-4 py-2 rounded-lg border transition-all ${X.planType?"border-red-500":t?"border-white/10 bg-white/5 text-white":"border-gray-300 bg-white"}`,children:[a.jsx("option",{value:"",children:"Select Plan Type"}),a.jsx("option",{value:"Weight Loss",children:"Weight Loss"}),a.jsx("option",{value:"Muscle Gain / Weight Gain",children:"Muscle Gain / Weight Gain"}),a.jsx("option",{value:"Maintenance / Fitness / Healthy Lifestyle",children:"Maintenance / Fitness / Healthy Lifestyle"})]}),X.planType&&a.jsx("p",{className:"mt-1 text-sm text-red-400",children:X.planType})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:()=>{C(null),K({displayName:"",email:"",gender:"",age:"",height:"",weight:"",planType:""}),W({})},className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-white/10 hover:bg-white/20 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{type:"submit",disabled:A,className:`px-6 py-2 rounded-lg font-medium transition-all ${A?"bg-[#1f36ff]/60 cursor-not-allowed text-white/60":"bg-[#1f36ff] hover:bg-[#1b2ed1] text-white hover:shadow-lg"}`,children:A?"Updating...":"Update User"})]})]})]})}),w&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-md w-full ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Meal Plan"}),a.jsxs("p",{className:"text-gray-400 mb-6",children:["Are you sure you want to delete the meal plan for ",a.jsx("strong",{children:w.displayName}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>E(null),className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-white/10 hover:bg-white/20 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:Ne,disabled:A,className:`px-6 py-2 rounded-lg font-medium transition-all ${A?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:A?"Deleting...":"Delete Meal Plan"})]})]})}),b&&b.mealPlan&&a.jsx(Q4,{user:b,mealPlan:b.mealPlan,onSave:_e,onCancel:()=>x(null),isDarkMode:t,isSubmitting:A,showNotification:e}),T&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-md w-full ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete User"}),a.jsxs("p",{className:"text-gray-400 mb-6",children:["Are you sure you want to delete ",a.jsx("strong",{children:T.displayName}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>V(null),className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-white/10 hover:bg-white/20 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:Ve,disabled:A,className:`px-6 py-2 rounded-lg font-medium transition-all ${A?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:A?"Deleting...":"Delete User"})]})]})}),P&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-[#111324] border border-white/5":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Meal Plan - ",P.displayName||"Unknown User"]}),a.jsx("button",{onClick:()=>k(null),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${t?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),P.mealPlan?a.jsxs("div",{className:"space-y-6",children:[(()=>{const oe=P.mealPlan.goal||(P.planType==="Weight Loss"?"Lose Weight":P.planType==="Muscle Gain / Weight Gain"?"Gain Weight":"Maintain Weight"),Ae=ee=>{const ie=ee.toLowerCase();return ie.includes("lose")?t?"bg-red-500/20 text-red-400 border-red-500/30":"bg-red-100 text-red-700 border-red-300":ie.includes("gain")?t?"bg-green-500/20 text-green-400 border-green-500/30":"bg-green-100 text-green-700 border-green-300":t?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-blue-100 text-blue-700 border-blue-300"};return a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full border font-semibold text-sm ${Ae(oe)}`,children:["Goal: ",oe]})})})(),a.jsxs("div",{className:`grid grid-cols-5 gap-4 p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Total Calories"}),a.jsx("div",{className:"text-xl font-bold",children:P.mealPlan.totalCalories||P.mealPlan.calories||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"BMI"}),a.jsx("div",{className:"text-xl font-bold",children:P.mealPlan.bmi||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"BMR"}),a.jsx("div",{className:"text-xl font-bold",children:P.mealPlan.bmr||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"TDEE"}),a.jsx("div",{className:"text-xl font-bold",children:P.mealPlan.tdee||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Portion Scale"}),a.jsxs("div",{className:"text-xl font-bold",children:[P.mealPlan.portionScale||"N/A","x"]})]})]}),P.mealPlan.createdAt&&a.jsxs("div",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["Created: ",it(P.mealPlan.createdAt)]}),P.mealPlan.breakfast&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Breakfast: ",P.mealPlan.breakfast.title]}),a.jsx("ul",{className:"list-disc list-inside ml-4 space-y-1",children:P.mealPlan.breakfast.items.map((oe,Ae)=>{const ee=typeof oe=="string"?oe:oe.name||"",ie=typeof oe=="object"&&oe.grams?oe.grams:null,G=typeof oe=="object"&&oe.baseGrams?oe.baseGrams:null;return a.jsxs("li",{children:[ee,ie&&`: ${ie}g`,G&&` (base: ${G}g)`]},Ae)})})]}),P.mealPlan.lunch&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Lunch: ",P.mealPlan.lunch.title]}),a.jsx("ul",{className:"list-disc list-inside ml-4 space-y-1",children:P.mealPlan.lunch.items.map((oe,Ae)=>{const ee=typeof oe=="string"?oe:oe.name||"",ie=typeof oe=="object"&&oe.grams?oe.grams:null,G=typeof oe=="object"&&oe.baseGrams?oe.baseGrams:null;return a.jsxs("li",{children:[ee,ie&&`: ${ie}g`,G&&` (base: ${G}g)`]},Ae)})})]}),P.mealPlan.dinner&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Dinner: ",P.mealPlan.dinner.title]}),a.jsx("ul",{className:"list-disc list-inside ml-4 space-y-1",children:P.mealPlan.dinner.items.map((oe,Ae)=>{const ee=typeof oe=="string"?oe:oe.name||"",ie=typeof oe=="object"&&oe.grams?oe.grams:null,G=typeof oe=="object"&&oe.baseGrams?oe.baseGrams:null;return a.jsxs("li",{children:[ee,ie&&`: ${ie}g`,G&&` (base: ${G}g)`]},Ae)})})]}),P.mealPlan.snacks&&P.mealPlan.snacks.length>0&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-800":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:" Snacks"}),P.mealPlan.snacks.map((oe,Ae)=>a.jsxs("div",{className:"mb-4 last:mb-0",children:[a.jsx("h4",{className:"font-medium mb-2",children:oe.title}),a.jsx("ul",{className:"list-disc list-inside ml-4 space-y-1",children:oe.items.map((ee,ie)=>{const G=typeof ee=="string"?ee:ee.name||"",Ie=typeof ee=="object"&&ee.grams?ee.grams:null,ye=typeof ee=="object"&&ee.baseGrams?ee.baseGrams:null;return a.jsxs("li",{children:[G,Ie&&`: ${Ie}g`,ye&&` (base: ${ye}g)`]},ie)})})]},Ae))]})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-600"}`,children:"No meal plan assigned to this user yet."}),a.jsx("p",{className:"text-sm mt-2 text-gray-500",children:'Use the "Add Meal Plan" page to create and assign a meal plan.'})]})]})})]})]})},Q4=({user:s,mealPlan:e,onSave:t,onCancel:n,isDarkMode:r,isSubmitting:i,showNotification:o})=>{const[l,c]=_.useState(JSON.parse(JSON.stringify(e))),u=(g,S,C)=>{c(T=>{const V={...T};if(g==="breakfast"||g==="lunch"||g==="dinner"){const P=[...V[g].items];P[S]={...P[S],name:C},V[g]={...V[g],items:P}}else if(g.startsWith("snack-")){const P=parseInt(g.split("-")[1]),k=[...V.snacks],b=[...k[P].items];b[S]={...b[S],name:C},k[P]={...k[P],items:b},V.snacks=k}return V})},h=(g,S,C)=>{c(T=>{const V={...T},P=C===""?0:parseFloat(C)||0,k=T.portionScale||1,b=Math.round(P*k);if(g==="breakfast"||g==="lunch"||g==="dinner"){const x=[...V[g].items];x[S]={...x[S],baseGrams:P,grams:b},V[g]={...V[g],items:x}}else if(g.startsWith("snack-")){const x=parseInt(g.split("-")[1]),w=[...V.snacks],E=[...w[x].items];E[S]={...E[S],baseGrams:P,grams:b},w[x]={...w[x],items:E},V.snacks=w}return V})},m=(g,S)=>{c(C=>{const T={...C};if(g==="breakfast"||g==="lunch"||g==="dinner")T[g]={...T[g],title:S};else if(g.startsWith("snack-")){const V=parseInt(g.split("-")[1]),P=[...T.snacks];P[V]={...P[V],title:S},T.snacks=P}return T})},p=g=>{c(S=>{const C={...S};if(S.portionScale,g==="breakfast"||g==="lunch"||g==="dinner")C[g]={...C[g],items:[...C[g].items,{name:"",baseGrams:0,grams:0}]};else if(g.startsWith("snack-")){const T=parseInt(g.split("-")[1]),V=[...C.snacks];V[T]={...V[T],items:[...V[T].items,{name:"",baseGrams:0,grams:0}]},C.snacks=V}return C})},N=(g,S)=>{c(C=>{const T={...C};if(g==="breakfast"||g==="lunch"||g==="dinner")T[g]={...T[g],items:T[g].items.filter((V,P)=>P!==S)};else if(g.startsWith("snack-")){const V=parseInt(g.split("-")[1]),P=[...T.snacks];P[V]={...P[V],items:P[V].items.filter((k,b)=>b!==S)},T.snacks=P}return T})},v=()=>{const g=l.portionScale||1,S={...l,breakfast:{...l.breakfast,items:l.breakfast.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},lunch:{...l.lunch,items:l.lunch.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},dinner:{...l.dinner,items:l.dinner.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},snacks:l.snacks.map(C=>({...C,items:C.items.map(T=>({...T,grams:Math.round((T.baseGrams||0)*g)}))}))};t(S)},I=(g,S)=>{const C=l[g];return a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[S," Title"]}),a.jsx("input",{type:"text",value:C.title,onChange:T=>m(g,T.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),C.items.map((T,V)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:T.name||"",onChange:P=>u(g,V,P.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:T.baseGrams||"",onChange:P=>h(g,V,P.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",T.grams||0,"g"]}),C.items.length>1&&a.jsx("button",{type:"button",onClick:()=>N(g,V),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},V)),a.jsxs("button",{type:"button",onClick:()=>p(g),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${r?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Edit Meal Plan - ",s.displayName]}),a.jsx("button",{onClick:n,className:`p-2 rounded-lg hover:bg-white/10 ${r?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"space-y-4",children:[I("breakfast","Breakfast"),I("lunch","Lunch"),I("dinner","Dinner"),a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Snacks"}),l.snacks.map((g,S)=>a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Snack ",S+1," Title"]}),a.jsx("input",{type:"text",value:g.title,onChange:C=>m(`snack-${S}`,C.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),g.items.map((C,T)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:C.name||"",onChange:V=>u(`snack-${S}`,T,V.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:C.baseGrams||"",onChange:V=>h(`snack-${S}`,T,V.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",C.grams||0,"g"]}),g.items.length>1&&a.jsx("button",{type:"button",onClick:()=>N(`snack-${S}`,T),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},T)),a.jsxs("button",{type:"button",onClick:()=>p(`snack-${S}`),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]},S))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:n,className:`px-6 py-2 rounded-lg ${r?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:v,disabled:i,className:`px-6 py-2 rounded-lg font-medium ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:i?"Saving...":"Save Changes"})]})]})})},Y4=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(""),[u,h]=_.useState(!0),[m,p]=_.useState(!1),[N,v]=_.useState(!1),[I,g]=_.useState([]),[S,C]=_.useState(!1),[T,V]=_.useState({breakfast:{title:"",items:[{name:"",baseGrams:""}]},lunch:{title:"",items:[{name:"",baseGrams:""}]},dinner:{title:"",items:[{name:"",baseGrams:""}]},snacks:[{title:"",items:[{name:"",baseGrams:""}]}]});_.useEffect(()=>{(async()=>{try{h(!0);const Y=localStorage.getItem("token");if(!Y){s("/login");return}const z=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${Y}`}});z.data.success&&r(z.data.data||[])}catch(Y){console.error("Error fetching users:",Y),e({type:"error",message:"Failed to load users"})}finally{h(!1)}})()},[s,e]);const P=(L,Y,z)=>{V(le=>({...le,[L]:{...le[L],[Y]:z}}))},k=(L,Y,z)=>{V(le=>{const he={...le};if(L==="breakfast"||L==="lunch"||L==="dinner"){const Ne=[...he[L].items];Ne[Y]={...Ne[Y],name:z},he[L]={...he[L],items:Ne}}else if(L.startsWith("snack-")){const Ne=parseInt(L.split("-")[1]),_e=[...he.snacks],Ve=[..._e[Ne].items];Ve[Y]={...Ve[Y],name:z},_e[Ne]={..._e[Ne],items:Ve},he.snacks=_e}return he})},b=(L,Y,z)=>{V(le=>{const he={...le},Ne=z===""?"":parseFloat(z)||0;if(L==="breakfast"||L==="lunch"||L==="dinner"){const _e=[...he[L].items];_e[Y]={..._e[Y],baseGrams:Ne},he[L]={...he[L],items:_e}}else if(L.startsWith("snack-")){const _e=parseInt(L.split("-")[1]),Ve=[...he.snacks],Ke=[...Ve[_e].items];Ke[Y]={...Ke[Y],baseGrams:Ne},Ve[_e]={...Ve[_e],items:Ke},he.snacks=Ve}return he})},x=L=>{V(Y=>{const z={...Y};if(L==="breakfast"||L==="lunch"||L==="dinner")z[L]={...z[L],items:[...z[L].items,{name:"",baseGrams:""}]};else if(L.startsWith("snack-")){const le=parseInt(L.split("-")[1]),he=[...z.snacks];he[le]={...he[le],items:[...he[le].items,{name:"",baseGrams:""}]},z.snacks=he}return z})},w=(L,Y)=>{V(z=>{const le={...z};if(L==="breakfast"||L==="lunch"||L==="dinner")le[L]={...le[L],items:le[L].items.filter((he,Ne)=>Ne!==Y)};else if(L.startsWith("snack-")){const he=parseInt(L.split("-")[1]),Ne=[...le.snacks];Ne[he]={...Ne[he],items:Ne[he].items.filter((_e,Ve)=>Ve!==Y)},le.snacks=Ne}return le})},E=()=>{T.snacks.length<3?V(L=>({...L,snacks:[...L.snacks,{title:"",items:[{name:"",baseGrams:""}]}]})):e({type:"warning",message:"Maximum 3 snacks allowed"})},A=L=>{T.snacks.length>1&&V(Y=>({...Y,snacks:Y.snacks.filter((z,le)=>le!==L)}))},D=()=>{const L=Y=>typeof Y=="string"?Y.trim()!=="":Y.name&&Y.name.trim()!==""&&Y.baseGrams&&parseFloat(Y.baseGrams)>0;if(!T.breakfast.title||T.breakfast.items.filter(L).length===0)return"Breakfast title and at least one valid item (with name and base grams) are required";if(!T.lunch.title||T.lunch.items.filter(L).length===0)return"Lunch title and at least one valid item (with name and base grams) are required";if(!T.dinner.title||T.dinner.items.filter(L).length===0)return"Dinner title and at least one valid item (with name and base grams) are required";for(let Y=0;Y<T.snacks.length;Y++){const z=T.snacks[Y];if(!z.title||z.items.filter(L).length===0)return`Snack ${Y+1} title and at least one valid item (with name and base grams) are required`}return null},j=async()=>{var Y,z;if(I.length===0){e({type:"error",message:"Please select at least one user"});return}const L=D();if(L){e({type:"error",message:L});return}try{p(!0);const le=localStorage.getItem("token"),he=_e=>_e.filter(Ve=>typeof Ve=="string"?Ve.trim()!=="":Ve.name&&Ve.name.trim()!==""&&Ve.baseGrams&&parseFloat(Ve.baseGrams)>0).map(Ve=>typeof Ve=="string"?{name:Ve.trim(),baseGrams:100}:{name:Ve.name.trim(),baseGrams:parseFloat(Ve.baseGrams)||0});if((await ce.post("http://localhost:3000/api/mealPlans/bulkAssign",{mealPlanTemplate:{breakfast:{title:T.breakfast.title,items:he(T.breakfast.items)},lunch:{title:T.lunch.title,items:he(T.lunch.items)},dinner:{title:T.dinner.title,items:he(T.dinner.items)},snacks:T.snacks.map(_e=>({title:_e.title,items:he(_e.items)}))},selectedUserIds:I},{headers:{Authorization:`Bearer ${le}`}})).data.success){if(e({type:"success",message:`Meal plan assigned to ${I.length} user(s) successfully`}),v(!1),g([]),window.confirm("Would you like to save this meal plan as a template for future use?")){const Ve=window.prompt("Enter a name for this meal plan template:");if(Ve&&Ve.trim())try{(await ce.post("http://localhost:3000/api/mealPlans/templates",{name:Ve.trim(),mealPlanTemplate:{breakfast:{title:T.breakfast.title,items:he(T.breakfast.items)},lunch:{title:T.lunch.title,items:he(T.lunch.items)},dinner:{title:T.dinner.title,items:he(T.dinner.items)},snacks:T.snacks.map(it=>({title:it.title,items:he(it.items)}))}},{headers:{Authorization:`Bearer ${le}`}})).data.success&&e({type:"success",message:"Meal plan template saved successfully"})}catch(Ke){console.error("Error saving template:",Ke)}}V({breakfast:{title:"",items:[{name:"",baseGrams:""}]},lunch:{title:"",items:[{name:"",baseGrams:""}]},dinner:{title:"",items:[{name:"",baseGrams:""}]},snacks:[{title:"",items:[{name:"",baseGrams:""}]}]})}}catch(le){console.error("Error assigning meal plan:",le),e({type:"error",message:((z=(Y=le.response)==null?void 0:Y.data)==null?void 0:z.message)||"Failed to assign meal plan"})}finally{p(!1)}},K=L=>{if(c(L),L){const Y=i.find(z=>z.id===L);Y&&Y.mealPlanTemplate&&(V(JSON.parse(JSON.stringify(Y.mealPlanTemplate))),e({type:"success",message:"Template loaded successfully"}))}else V({breakfast:{title:"",items:[{name:"",baseGrams:""}]},lunch:{title:"",items:[{name:"",baseGrams:""}]},dinner:{title:"",items:[{name:"",baseGrams:""}]},snacks:[{title:"",items:[{name:"",baseGrams:""}]}]})},X=L=>{g(Y=>Y.includes(L)?Y.filter(z=>z!==L):[...Y,L])},W=()=>{I.length===n.length?g([]):g(n.map(L=>L.uid))},se=(L,Y)=>{const z=T[L];return a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsx("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:Y}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[Y," Title"]}),a.jsx("input",{type:"text",value:z.title,onChange:le=>P(L,"title",le.target.value),placeholder:`e.g., ${Y} Meal`,className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Food Items (Grams will be calculated automatically based on each user's body data)"}),z.items.map((le,he)=>{const Ne=typeof le=="string"?le:le.name||"",_e=typeof le=="string"?"":le.baseGrams||"";return a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:Ne,onChange:Ve=>k(L,he,Ve.target.value),placeholder:`Item ${he+1} name`,className:`flex-1 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),a.jsx("input",{type:"number",value:_e,onChange:Ve=>b(L,he,Ve.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-36 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),z.items.length>1&&a.jsx("button",{type:"button",onClick:()=>w(L,he),className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]},he)}),a.jsxs("button",{type:"button",onClick:()=>x(L),className:`mt-2 px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Item"]})]})]})},M=L=>{const Y=T.snacks[L];return a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:["Snack ",L+1]}),T.snacks.length>1&&a.jsx("button",{type:"button",onClick:()=>A(L),className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Snack Title"}),a.jsx("input",{type:"text",value:Y.title,onChange:z=>{const le=[...T.snacks];le[L]={...le[L],title:z.target.value},V(he=>({...he,snacks:le}))},placeholder:"e.g., Morning Snack",className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Food Items (Grams will be calculated automatically based on each user's body data)"}),Y.items.map((z,le)=>{const he=typeof z=="string"?z:z.name||"",Ne=typeof z=="string"?"":z.baseGrams||"";return a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:he,onChange:_e=>k(`snack-${L}`,le,_e.target.value),placeholder:`Item ${le+1} name`,className:`flex-1 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),a.jsx("input",{type:"number",value:Ne,onChange:_e=>b(`snack-${L}`,le,_e.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-36 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),Y.items.length>1&&a.jsx("button",{type:"button",onClick:()=>w(`snack-${L}`,le),className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]},le)}),a.jsxs("button",{type:"button",onClick:()=>x(`snack-${L}`),className:`mt-2 px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Item"]})]})]},L)};return u?a.jsxs("div",{className:"flex h-screen",children:[a.jsx($t,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Loading..."})]})})]}):a.jsxs("div",{className:"flex h-screen overflow-hidden",children:[a.jsx($t,{}),a.jsx("div",{className:`flex-1 overflow-y-auto ${t?"bg-gray-900":"bg-gray-50"}`,children:a.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Create Meal Plan Template"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Create a meal plan template and assign it to multiple users. Portions will be automatically adjusted based on each user's body data."})]}),i.length>0&&a.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Existing Template (Optional)"}),a.jsxs("select",{value:l,onChange:L=>K(L.target.value),className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[a.jsx("option",{value:"",children:"Create New Meal Plan"}),i.map(L=>a.jsx("option",{value:L.id,children:L.name},L.id))]}),l&&a.jsx("p",{className:`mt-2 text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Template loaded. You can edit it below or use it as-is."})]}),a.jsxs("div",{className:"mb-6",children:[se("breakfast","Breakfast"),se("lunch","Lunch"),se("dinner","Dinner"),a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Snacks"}),T.snacks.length<3&&a.jsxs("button",{type:"button",onClick:E,className:`px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-green-600 hover:bg-green-700 text-white":"bg-green-100 hover:bg-green-200 text-green-700"} transition-colors`,children:[a.jsx(kt,{})," Add Snack"]})]}),T.snacks.map((L,Y)=>M(Y))]})]}),a.jsx("div",{className:"mb-6 flex gap-4",children:a.jsxs("button",{type:"button",onClick:()=>C(!S),className:`px-6 py-3 rounded-lg font-medium flex items-center gap-2 ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"} transition-colors`,children:[S?a.jsx(Sd,{}):a.jsx(gi,{}),S?"Hide Preview":"Show Preview"]})}),S&&a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Meal Plan Preview"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-lg mb-2",children:[" Breakfast: ",T.breakfast.title||"Untitled"]}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:T.breakfast.items.filter(L=>(typeof L=="string"?L:L.name||"").trim()!=="").map((L,Y)=>{const z=typeof L=="string"?L:L.name||"";return a.jsx("li",{children:z},Y)})})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-lg mb-2",children:[" Lunch: ",T.lunch.title||"Untitled"]}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:T.lunch.items.filter(L=>(typeof L=="string"?L:L.name||"").trim()!=="").map((L,Y)=>{const z=typeof L=="string"?L:L.name||"";return a.jsx("li",{children:z},Y)})})]}),a.jsxs("div",{children:[a.jsxs("h3",{className:"font-semibold text-lg mb-2",children:[" Dinner: ",T.dinner.title||"Untitled"]}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:T.dinner.items.filter(L=>(typeof L=="string"?L:L.name||"").trim()!=="").map((L,Y)=>{const z=typeof L=="string"?L:L.name||"";return a.jsx("li",{children:z},Y)})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg mb-2",children:" Snacks"}),T.snacks.map((L,Y)=>a.jsxs("div",{className:"ml-4 mb-2",children:[a.jsx("h4",{className:"font-medium",children:L.title||`Snack ${Y+1}`}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:L.items.filter(z=>(typeof z=="string"?z:z.name||"").trim()!=="").map((z,le)=>{const he=typeof z=="string"?z:z.name||"";return a.jsx("li",{children:he},le)})})]},Y))]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs("button",{type:"button",onClick:()=>v(!0),disabled:m,className:`px-8 py-3 rounded-lg font-semibold flex items-center gap-2 ${m?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"} transition-colors`,children:[a.jsx(es,{})," Bulk Assign Meal Plan"]})})]})}),N&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:`${t?"bg-gray-800":"bg-white"} rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Select Users to Assign Meal Plan"}),a.jsx("button",{onClick:()=>{v(!1),g([])},className:`p-2 rounded-lg ${t?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("button",{type:"button",onClick:W,className:`px-4 py-2 rounded-lg ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:I.length===n.length?"Deselect All":"Select All"}),a.jsxs("span",{className:"ml-4",children:[I.length," user(s) selected"]})]}),a.jsx("div",{className:"mb-6 max-h-96 overflow-y-auto",children:n.length===0?a.jsx("p",{className:"text-center py-8",children:"No users available"}):a.jsx("div",{className:"space-y-2",children:n.map(L=>a.jsxs("label",{className:`flex items-center p-4 rounded-lg cursor-pointer ${t?I.includes(L.uid)?"bg-blue-900":"bg-gray-700 hover:bg-gray-600":I.includes(L.uid)?"bg-blue-50":"bg-gray-50 hover:bg-gray-100"} transition-colors`,children:[a.jsx("input",{type:"checkbox",checked:I.includes(L.uid),onChange:()=>X(L.uid),className:"mr-3 w-5 h-5"}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:L.displayName||"Unknown"}),a.jsx("div",{className:"text-sm opacity-75",children:L.loginEmail||L.email})]})]},L.uid))})}),a.jsxs("div",{className:"flex gap-4 justify-end",children:[a.jsx("button",{onClick:()=>{v(!1),g([])},className:`px-6 py-2 rounded-lg ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"} transition-colors`,children:"Cancel"}),a.jsx("button",{onClick:j,disabled:m||I.length===0,className:`px-6 py-2 rounded-lg font-medium flex items-center gap-2 ${m||I.length===0?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"} transition-colors`,children:m?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Assigning..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Jl,{})," Confirm Assignment"]})})]})]})})]})},X4=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(!0),[u,h]=_.useState(null),[m,p]=_.useState(null),[N,v]=_.useState(null),[I,g]=_.useState(!1);_.useEffect(()=>{(async()=>{try{c(!0);const b=localStorage.getItem("token");if(!b){s("/login");return}const x=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${b}`}});if(x.data.success){const w=x.data.data||[];r(w);const E=w.filter(A=>A.mealPlan&&A.mealPlan.breakfast);o(E)}}catch(b){console.error("Error fetching users:",b),e({type:"error",message:"Failed to load users"})}finally{c(!1)}})()},[s,e]);const S=k=>{if(!k)return"N/A";try{return(k instanceof Date?k:new Date(k)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"N/A"}},C=k=>k?"Employee":"N/A",T=k=>{k.mealPlan&&(p({...k,mealPlan:JSON.parse(JSON.stringify(k.mealPlan))}),h(null))},V=async()=>{var k,b;if(N){g(!0);try{const x=localStorage.getItem("token");if(!x){s("/login");return}const w=await ce.delete(`http://localhost:3000/api/mealPlans/${N.uid}`,{headers:{Authorization:`Bearer ${x}`}});if(w.data.success){e({type:"success",message:"Meal plan deleted successfully"}),v(null);const E=n.filter(D=>D.uid!==N.uid||!D.mealPlan);r(E);const A=E.filter(D=>D.mealPlan&&D.mealPlan.breakfast);o(A)}else throw new Error(w.data.message||"Failed to delete meal plan")}catch(x){console.error("Error deleting meal plan:",x),e({type:"error",message:((b=(k=x.response)==null?void 0:k.data)==null?void 0:b.message)||x.message||"Failed to delete meal plan"})}finally{g(!1)}}},P=async k=>{var b,x;if(m){g(!0);try{const w=localStorage.getItem("token");if(!w){s("/login");return}const E=await ce.put(`http://localhost:3000/api/mealPlans/${m.uid}`,{mealPlan:k},{headers:{Authorization:`Bearer ${w}`}});if(E.data.success){e({type:"success",message:"Meal plan updated successfully"}),p(null);const A=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${w}`}});if(A.data.success){const D=A.data.data||[];r(D);const j=D.filter(K=>K.mealPlan&&K.mealPlan.breakfast);o(j)}}else throw new Error(E.data.message||"Failed to update meal plan")}catch(w){console.error("Error updating meal plan:",w),e({type:"error",message:((x=(b=w.response)==null?void 0:b.data)==null?void 0:x.message)||w.message||"Failed to update meal plan"})}finally{g(!1)}}};return l?a.jsxs("div",{className:"flex h-screen",children:[a.jsx($t,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Loading meal plans..."})]})})]}):a.jsxs("div",{className:"flex h-screen overflow-hidden",children:[a.jsx($t,{}),a.jsx("div",{className:`flex-1 overflow-y-auto ${t?"bg-gray-900":"bg-gray-50"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[a.jsx(hr,{className:"text-blue-600"}),"View Users Plan"]}),a.jsxs("p",{className:t?"text-gray-400":"text-gray-600",children:[i.length," user(s) with assigned meal plans"]})]}),i.length===0?a.jsxs("div",{className:`text-center py-12 rounded-lg ${t?"bg-gray-800":"bg-white"}`,children:[a.jsx(hr,{className:"mx-auto text-6xl text-gray-400 mb-4"}),a.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-600"}`,children:"No meal plans assigned yet"}),a.jsx("p",{className:"text-sm mt-2 text-gray-500",children:'Use "Add Meal Plan" to create and assign meal plans to users'})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(k=>a.jsxs("div",{onClick:()=>h(k),className:`p-6 rounded-lg cursor-pointer transition-all ${t?"bg-gray-800 hover:bg-gray-700 border border-gray-700":"bg-white hover:bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t?"bg-blue-600/20":"bg-blue-100"}`,children:a.jsx(Bi,{className:`text-xl ${t?"text-blue-400":"text-blue-600"}`})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-lg",children:k.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:k.loginEmail||k.email||"N/A"})]})]}),a.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:"Click to view meal plan"})]},k.uid))})]})}),u&&u.mealPlan&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-700",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Meal Plan - ",u.displayName||"Unknown User"]}),a.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:u.loginEmail||u.email||"N/A"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>T(u),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(is,{})," Edit"]}),a.jsxs("button",{onClick:()=>{h(null),v(u)},className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:[a.jsx(xt,{})," Delete"]}),a.jsx("button",{onClick:()=>h(null),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${t?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]})]}),(()=>{var x;let k=(x=u.mealPlan)==null?void 0:x.goal;if(!k&&u.planType){const w=u.planType;if(w==="Weight Loss")k="Lose Weight";else if(w==="Muscle Gain / Weight Gain")k="Gain Weight";else if(w==="Maintenance / Fitness / Healthy Lifestyle")k="Maintain Weight";else{const E=w.toLowerCase();E.includes("loss")||E.includes("weight loss")?k="Lose Weight":E.includes("gain")||E.includes("muscle")?k="Gain Weight":(E.includes("maintain")||E.includes("maintenance")||E.includes("fitness")||E.includes("healthy"))&&(k="Maintain Weight")}}k||(k="Maintain Weight");const b=w=>{const E=w.toLowerCase();return E.includes("lose")?t?"bg-red-500/20 text-red-400 border-red-500/30":"bg-red-100 text-red-700 border-red-300":E.includes("gain")?t?"bg-green-500/20 text-green-400 border-green-500/30":"bg-green-100 text-green-700 border-green-300":t?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-blue-100 text-blue-700 border-blue-300"};return a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full border font-semibold text-sm ${b(k)}`,children:["Goal: ",k]})})})(),a.jsxs("div",{className:`grid grid-cols-5 gap-4 mb-6 p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"Total Calories"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.totalCalories||u.mealPlan.calories||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"BMI"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.bmi||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"BMR"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.bmr||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"TDEE"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.tdee||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"Portion Scale"}),a.jsxs("div",{className:"text-xl font-bold",children:[u.mealPlan.portionScale||"N/A","x"]})]})]}),a.jsxs("div",{className:"space-y-4",children:[u.mealPlan.breakfast&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Breakfast: ",u.mealPlan.breakfast.title]}),a.jsx("ul",{className:"space-y-2",children:u.mealPlan.breakfast.items&&u.mealPlan.breakfast.items.map((k,b)=>{const x=typeof k=="string"?k:k.name||"",w=typeof k=="object"&&k.grams?k.grams:null,E=typeof k=="object"&&k.baseGrams?k.baseGrams:null;return a.jsx("li",{className:"flex justify-between items-center",children:a.jsxs("span",{children:[x,w&&`: ${w}g`,E&&a.jsxs("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`,children:["(base: ",E,"g)"]})]})},b)})})]}),u.mealPlan.lunch&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Lunch: ",u.mealPlan.lunch.title]}),a.jsx("ul",{className:"space-y-2",children:u.mealPlan.lunch.items&&u.mealPlan.lunch.items.map((k,b)=>{const x=typeof k=="string"?k:k.name||"",w=typeof k=="object"&&k.grams?k.grams:null,E=typeof k=="object"&&k.baseGrams?k.baseGrams:null;return a.jsx("li",{className:"flex justify-between items-center",children:a.jsxs("span",{children:[x,w&&`: ${w}g`,E&&a.jsxs("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`,children:["(base: ",E,"g)"]})]})},b)})})]}),u.mealPlan.dinner&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Dinner: ",u.mealPlan.dinner.title]}),a.jsx("ul",{className:"space-y-2",children:u.mealPlan.dinner.items&&u.mealPlan.dinner.items.map((k,b)=>{const x=typeof k=="string"?k:k.name||"",w=typeof k=="object"&&k.grams?k.grams:null,E=typeof k=="object"&&k.baseGrams?k.baseGrams:null;return a.jsx("li",{className:"flex justify-between items-center",children:a.jsxs("span",{children:[x,w&&`: ${w}g`,E&&a.jsxs("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`,children:["(base: ",E,"g)"]})]})},b)})})]}),u.mealPlan.snacks&&u.mealPlan.snacks.length>0&&a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:" Snacks"}),u.mealPlan.snacks.map((k,b)=>a.jsxs("div",{className:"mb-4 last:mb-0",children:[a.jsx("h4",{className:"font-medium mb-2",children:k.title}),a.jsx("ul",{className:"space-y-2",children:k.items&&k.items.map((x,w)=>{const E=typeof x=="string"?x:x.name||"",A=typeof x=="object"&&x.grams?x.grams:null,D=typeof x=="object"&&x.baseGrams?x.baseGrams:null;return a.jsx("li",{className:"flex justify-between items-center",children:a.jsxs("span",{children:[E,A&&`: ${A}g`,D&&a.jsxs("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`,children:["(base: ",D,"g)"]})]})},w)})})]},b))]}),a.jsxs("div",{className:`mt-6 pt-4 border-t border-gray-700 text-sm space-y-2 ${t?"text-gray-400":"text-gray-600"}`,children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Assigned By:"}),a.jsx("span",{className:"font-medium",children:C(u.mealPlan.assignedBy)})]}),u.mealPlan.createdAt&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Created At:"}),a.jsx("span",{className:"font-medium",children:S(u.mealPlan.createdAt)})]})]})]})]})}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-md w-full ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Meal Plan"}),a.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["Are you sure you want to delete the meal plan for ",a.jsx("strong",{children:N.displayName}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>v(null),className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:V,disabled:I,className:`px-6 py-2 rounded-lg font-medium transition-all ${I?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:I?"Deleting...":"Delete Meal Plan"})]})]})}),m&&m.mealPlan&&a.jsx(Z4,{user:m,mealPlan:m.mealPlan,onSave:P,onCancel:()=>p(null),isDarkMode:t,isSubmitting:I,showNotification:e})]})},Z4=({user:s,mealPlan:e,onSave:t,onCancel:n,isDarkMode:r,isSubmitting:i,showNotification:o})=>{const[l,c]=_.useState(JSON.parse(JSON.stringify(e))),u=(g,S,C)=>{c(T=>{const V={...T};if(g==="breakfast"||g==="lunch"||g==="dinner"){const P=[...V[g].items];P[S]={...P[S],name:C},V[g]={...V[g],items:P}}else if(g.startsWith("snack-")){const P=parseInt(g.split("-")[1]),k=[...V.snacks],b=[...k[P].items];b[S]={...b[S],name:C},k[P]={...k[P],items:b},V.snacks=k}return V})},h=(g,S,C)=>{c(T=>{const V={...T},P=C===""?0:parseFloat(C)||0,k=T.portionScale||1,b=Math.round(P*k);if(g==="breakfast"||g==="lunch"||g==="dinner"){const x=[...V[g].items];x[S]={...x[S],baseGrams:P,grams:b},V[g]={...V[g],items:x}}else if(g.startsWith("snack-")){const x=parseInt(g.split("-")[1]),w=[...V.snacks],E=[...w[x].items];E[S]={...E[S],baseGrams:P,grams:b},w[x]={...w[x],items:E},V.snacks=w}return V})},m=(g,S)=>{c(C=>{const T={...C};if(g==="breakfast"||g==="lunch"||g==="dinner")T[g]={...T[g],title:S};else if(g.startsWith("snack-")){const V=parseInt(g.split("-")[1]),P=[...T.snacks];P[V]={...P[V],title:S},T.snacks=P}return T})},p=g=>{c(S=>{const C={...S};if(S.portionScale,g==="breakfast"||g==="lunch"||g==="dinner")C[g]={...C[g],items:[...C[g].items,{name:"",baseGrams:0,grams:0}]};else if(g.startsWith("snack-")){const T=parseInt(g.split("-")[1]),V=[...C.snacks];V[T]={...V[T],items:[...V[T].items,{name:"",baseGrams:0,grams:0}]},C.snacks=V}return C})},N=(g,S)=>{c(C=>{const T={...C};if(g==="breakfast"||g==="lunch"||g==="dinner")T[g]={...T[g],items:T[g].items.filter((V,P)=>P!==S)};else if(g.startsWith("snack-")){const V=parseInt(g.split("-")[1]),P=[...T.snacks];P[V]={...P[V],items:P[V].items.filter((k,b)=>b!==S)},T.snacks=P}return T})},v=()=>{const g=l.portionScale||1,S={...l,breakfast:{...l.breakfast,items:l.breakfast.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},lunch:{...l.lunch,items:l.lunch.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},dinner:{...l.dinner,items:l.dinner.items.map(C=>({...C,grams:Math.round((C.baseGrams||0)*g)}))},snacks:l.snacks.map(C=>({...C,items:C.items.map(T=>({...T,grams:Math.round((T.baseGrams||0)*g)}))}))};t(S)},I=(g,S)=>{const C=l[g];return a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[S," Title"]}),a.jsx("input",{type:"text",value:C.title,onChange:T=>m(g,T.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),C.items.map((T,V)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:T.name||"",onChange:P=>u(g,V,P.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:T.baseGrams||"",onChange:P=>h(g,V,P.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",T.grams||0,"g"]}),C.items.length>1&&a.jsx("button",{type:"button",onClick:()=>N(g,V),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},V)),a.jsxs("button",{type:"button",onClick:()=>p(g),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${r?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Edit Meal Plan - ",s.displayName]}),a.jsx("button",{onClick:n,className:`p-2 rounded-lg hover:bg-white/10 ${r?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"space-y-4",children:[I("breakfast","Breakfast"),I("lunch","Lunch"),I("dinner","Dinner"),a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Snacks"}),l.snacks.map((g,S)=>a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Snack ",S+1," Title"]}),a.jsx("input",{type:"text",value:g.title,onChange:C=>m(`snack-${S}`,C.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),g.items.map((C,T)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:C.name||"",onChange:V=>u(`snack-${S}`,T,V.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:C.baseGrams||"",onChange:V=>h(`snack-${S}`,T,V.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",C.grams||0,"g"]}),g.items.length>1&&a.jsx("button",{type:"button",onClick:()=>N(`snack-${S}`,T),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},T)),a.jsxs("button",{type:"button",onClick:()=>p(`snack-${S}`),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]},S))]})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:n,className:`px-6 py-2 rounded-lg ${r?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:v,disabled:i,className:`px-6 py-2 rounded-lg font-medium ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:i?"Saving...":"Save Changes"})]})]})})},e3=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(""),[u,h]=_.useState(!0),[m,p]=_.useState(!1),[N,v]=_.useState(!1),[I,g]=_.useState([]),[S,C]=_.useState(!1),[T,V]=_.useState("Maintain Weight"),[P,k]=_.useState(!1),b=["protein","carbs","fats","meat","chicken","fish"],x=()=>({protein:[{name:"",baseGrams:""}],carbs:[{name:"",baseGrams:""}],fats:[{name:"",baseGrams:""}],meat:[{name:"",baseGrams:""}],chicken:[{name:"",baseGrams:""}],fish:[{name:"",baseGrams:""}]}),w=F=>F?b.flatMap(O=>F[O]||[]):[],[E,A]=_.useState({"breakfasts-0":!0,"lunches-0":!0,"dinners-0":!0,"snacks-0":!1}),[D,j]=_.useState({activeInput:null,suggestions:[],showSuggestions:!1}),[K,X]=_.useState(null),[W,se]=_.useState(null),[M,L]=_.useState(null),Y=[{name:"Chicken Breast",grams:100},{name:"Rice (white)",grams:130},{name:"Oats",grams:40},{name:"Egg",grams:60},{name:"Cheese",grams:30},{name:"Chickpeas",grams:50},{name:"Salmon",grams:120},{name:"Broccoli",grams:100},{name:"Sweet Potato",grams:150},{name:"Greek Yogurt",grams:200},{name:"Banana",grams:120},{name:"Almonds",grams:30},{name:"Quinoa",grams:100},{name:"Spinach",grams:50},{name:"Tuna",grams:100},{name:"Avocado",grams:100},{name:"Brown Rice",grams:130},{name:"Turkey Breast",grams:100},{name:"Cottage Cheese",grams:150},{name:"Apple",grams:150}],[z,le]=_.useState({breakfasts:[{title:"",categories:x(),items:w(x())}],lunches:[{title:"",categories:x(),items:w(x())}],dinners:[{title:"",categories:x(),items:w(x())}],snacks:[{title:"",categories:x(),items:w(x())}]});_.useEffect(()=>{(async()=>{try{h(!0);const O=localStorage.getItem("token");if(!O){s("/login");return}const[U,q]=await Promise.all([ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${O}`}}),ce.get("http://localhost:3000/api/mealPlans/templates",{headers:{Authorization:`Bearer ${O}`}})]);U.data.success&&r(U.data.data||[]),q.data.success&&o(q.data.data||[])}catch(O){console.error("Error fetching data:",O),e({type:"error",message:"Failed to fetch data"})}finally{h(!1)}})()},[s,e]);const he=F=>{if(c(F),F){const O=i.find(U=>U.id===F);if(O&&O.mealPlanTemplate){const U=O.mealPlanTemplate||{},q=(Q,ge)=>Array.isArray(U[ge])&&U[ge].length>0?U[ge]:U[Q]?[U[Q]]:[{title:"",items:[{name:"",baseGrams:""}]}],re=Q=>{const ge=Q||{title:""};let Te=ge.categories;if(!Te){const ke=ge.items||[],Pe=x();Pe.protein=ke.length>0?ke:Pe.protein,Te=Pe}const fe={};return b.forEach(ke=>{const Pe=Te[ke];Array.isArray(Pe)&&Pe.length>0?fe[ke]=Pe.map(Me=>({name:Me.name||"",baseGrams:Me.baseGrams||""})):fe[ke]=[{name:"",baseGrams:""}]}),{title:ge.title||"",categories:fe,items:w(fe)}},de={breakfasts:q("breakfast","breakfasts").map(re),lunches:q("lunch","lunches").map(re),dinners:q("dinner","dinners").map(re),snacks:(Array.isArray(U.snacks)&&U.snacks.length>0?U.snacks:[{title:"",items:[{name:"",baseGrams:""}]}]).map(re)};le(JSON.parse(JSON.stringify(de))),A(Q=>{const ge={};return de.breakfasts.forEach((Te,fe)=>{ge[`breakfasts-${fe}`]=fe===0}),de.lunches.forEach((Te,fe)=>{ge[`lunches-${fe}`]=fe===0}),de.dinners.forEach((Te,fe)=>{ge[`dinners-${fe}`]=fe===0}),de.snacks.forEach((Te,fe)=>{ge[`snacks-${fe}`]=!1}),ge}),O.mealPlanType&&V(O.mealPlanType),e({type:"success",message:"Template loaded successfully"})}}else{const O=x();le({breakfasts:[{title:"",categories:O,items:w(O)}],lunches:[{title:"",categories:O,items:w(O)}],dinners:[{title:"",categories:O,items:w(O)}],snacks:[{title:"",categories:O,items:w(O)}]}),A({"breakfasts-0":!0,"lunches-0":!0,"dinners-0":!0,"snacks-0":!1}),V("Maintain Weight")}},Ne=F=>{const[O,U]=F.split("-"),q=U!==void 0?parseInt(U,10):0;return{sectionKey:O,sectionIndex:q}},_e=(F,O,U)=>{const{sectionKey:q,sectionIndex:re}=Ne(F);le(de=>{const Q=[...de[q]];return Q[re]={...Q[re],[O]:U},{...de,[q]:Q}})},Ve=(F,O,U,q)=>{const{sectionKey:re,sectionIndex:de}=Ne(F);le(Q=>{const ge={...Q},Te=[...ge[re]],fe={...Te[de]},ke={...fe.categories},Pe=[...ke[O]||[]];return Pe[U]={...Pe[U],name:q},ke[O]=Pe,fe.categories=ke,fe.items=w(ke),Te[de]=fe,ge[re]=Te,ge})},Ke=(F,O,U,q)=>{const{sectionKey:re,sectionIndex:de}=Ne(F);le(Q=>{const ge={...Q},Te=q===""?"":parseFloat(q)||0,fe=[...ge[re]],ke={...fe[de]},Pe={...ke.categories},Me=[...Pe[O]||[]];return Me[U]={...Me[U],baseGrams:Te},Pe[O]=Me,ke.categories=Pe,ke.items=w(Pe),fe[de]=ke,ge[re]=fe,ge})},it=(F,O)=>{const{sectionKey:U,sectionIndex:q}=Ne(F);le(re=>{const de={...re},Q=[...de[U]],ge={...Q[q]},Te={...ge.categories},fe=[...Te[O]||[]];return fe.push({name:"",baseGrams:""}),Te[O]=fe,ge.categories=Te,ge.items=w(Te),Q[q]=ge,de[U]=Q,de})},at=(F,O,U)=>{const{sectionKey:q,sectionIndex:re}=Ne(F);le(de=>{const Q={...de},ge=[...Q[q]],Te={...ge[re]},fe={...Te.categories},ke=[...fe[O]||[]].filter((Pe,Me)=>Me!==U);return fe[O]=ke.length>0?ke:[{name:"",baseGrams:""}],Te.categories=fe,Te.items=w(fe),ge[re]=Te,Q[q]=ge,Q})},oe=()=>{if(z.snacks.length>=3)return;const O=z.snacks.length;le(U=>({...U,snacks:[...U.snacks,{title:"",items:[{name:"",baseGrams:""}]}]})),A(U=>({...U,[`snacks-${O}`]:!1}))},Ae=F=>{z.snacks.length>1&&(le(O=>({...O,snacks:O.snacks.filter((U,q)=>q!==F)})),A(O=>{const U={...O};return delete U[`snacks-${F}`],z.snacks.filter((re,de)=>de!==F).forEach((re,de)=>{const Q=de>=F?de+1:de;U[`snacks-${Q}`]!==void 0&&(U[`snacks-${de}`]=U[`snacks-${Q}`],de!==Q&&delete U[`snacks-${Q}`])}),U}))},ee=()=>{const F=[{key:"breakfasts",label:"Breakfast"},{key:"lunches",label:"Lunch"},{key:"dinners",label:"Dinner"}];for(const{key:O,label:U}of F){if(!z[O]||z[O].length===0)return`${U} section is required`;for(let q=0;q<z[O].length;q++){const re=z[O][q];if(!re.title.trim())return`${U} ${q+1} title is required`;if(!re.items.some(de=>(typeof de=="string"?de:de.name||"").trim()!==""))return`${U} ${q+1} must have at least one item`}}for(let O=0;O<z.snacks.length;O++){const U=z.snacks[O];if(!U.title.trim())return`Snack ${O+1} title is required`;if(!b.some(re=>{var de;return(((de=U.categories)==null?void 0:de[re])||[]).some(Q=>(typeof Q=="string"?Q:Q.name||"").trim()!=="")}))return`Snack ${O+1} must have at least one item`}return null},ie=async()=>{var O,U;const F=ee();if(F){e({type:"error",message:F});return}if(I.length===0){e({type:"error",message:"Please select at least one user"});return}try{p(!0);const q=localStorage.getItem("token"),re=Q=>Q.filter(ge=>typeof ge=="string"?ge.trim()!=="":ge.name&&ge.name.trim()!==""&&ge.baseGrams&&parseFloat(ge.baseGrams)>0).map(ge=>typeof ge=="string"?{name:ge.trim(),baseGrams:100}:{name:ge.name.trim(),baseGrams:parseFloat(ge.baseGrams)||0});if((await ce.post("http://localhost:3000/api/mealPlans/bulkAssign",{mealPlanTemplate:{breakfasts:z.breakfasts.map(Q=>({title:Q.title,items:re(Q.items)})),lunches:z.lunches.map(Q=>({title:Q.title,items:re(Q.items)})),dinners:z.dinners.map(Q=>({title:Q.title,items:re(Q.items)})),snacks:z.snacks.map(Q=>({title:Q.title,items:re(Q.items)}))},mealPlanType:T,selectedUserIds:I},{headers:{Authorization:`Bearer ${q}`}})).data.success){if(e({type:"success",message:`Meal plan assigned to ${I.length} user(s) successfully`}),v(!1),g([]),window.confirm("Would you like to save this meal plan as a template for future use?")){const ge=window.prompt("Enter a name for this meal plan template:");if(ge&&ge.trim())try{(await ce.post("http://localhost:3000/api/mealPlans/templates",{name:ge.trim(),mealPlanType:T,mealPlanTemplate:{breakfasts:z.breakfasts.map(fe=>({title:fe.title,categories:fe.categories||{},items:re(fe.items)})),lunches:z.lunches.map(fe=>({title:fe.title,categories:fe.categories||{},items:re(fe.items)})),dinners:z.dinners.map(fe=>({title:fe.title,categories:fe.categories||{},items:re(fe.items)})),snacks:z.snacks.map(fe=>({title:fe.title,categories:fe.categories||{},items:re(fe.items)}))}},{headers:{Authorization:`Bearer ${q}`}})).data.success&&e({type:"success",message:"Meal plan template saved successfully"})}catch(Te){console.error("Error saving template:",Te)}}le({breakfasts:[{title:"",items:[{name:"",baseGrams:""}]}],lunches:[{title:"",items:[{name:"",baseGrams:""}]}],dinners:[{title:"",items:[{name:"",baseGrams:""}]}],snacks:[{title:"",items:[{name:"",baseGrams:""}]}]}),A({"breakfasts-0":!0,"lunches-0":!0,"dinners-0":!0,"snacks-0":!1}),V("Maintain Weight")}}catch(q){console.error("Error assigning meal plan:",q),e({type:"error",message:((U=(O=q.response)==null?void 0:O.data)==null?void 0:U.message)||"Failed to assign meal plan"})}finally{p(!1)}},G=F=>{g(O=>O.includes(F)?O.filter(U=>U!==F):[...O,F])},Ie=()=>{I.length===n.length?g([]):g(n.map(F=>F.uid))},ye=F=>{A(O=>({...O,[F]:!O[F]}))},we=(F,O,U,q)=>{if(Ve(F,O,U,q),q.trim().length>0){const re=Y.filter(de=>de.name.toLowerCase().includes(q.toLowerCase()));j({activeInput:`${F}-${O}-${U}`,suggestions:re,showSuggestions:re.length>0})}else j({activeInput:null,suggestions:[],showSuggestions:!1})},B=(F,O,U,q)=>{Ve(F,O,U,q.name),Ke(F,O,U,q.grams.toString()),j({activeInput:null,suggestions:[],showSuggestions:!1})},Z=(F,O,U,q)=>{X({mealType:O,categoryKey:U,itemIndex:q}),F.dataTransfer.effectAllowed="move"},me=F=>{F.preventDefault(),F.dataTransfer.dropEffect="move"},be=(F,O,U,q)=>{if(F.preventDefault(),!K)return;const{mealType:re,categoryKey:de,itemIndex:Q}=K;if(re===O&&de===U&&Q!==q){const{sectionKey:ge,sectionIndex:Te}=Ne(O);le(fe=>{const ke={...fe},Pe=[...ke[ge]],Me={...Pe[Te]},Oe={...Me.categories},Je=[...Oe[U]||[]],[et]=Je.splice(Q,1);return Je.splice(q,0,et),Oe[U]=Je,Me.categories=Oe,Me.items=w(Oe),Pe[Te]=Me,ke[ge]=Pe,ke})}X(null)},Re=(F,O)=>{se(O),F.dataTransfer.effectAllowed="move"},Se=(F,O)=>{F.preventDefault(),!(W===null||W===O)&&(le(U=>{const q=[...U.snacks],[re]=q.splice(W,1);return q.splice(O,0,re),{...U,snacks:q}}),se(null))},Fe=F=>{const{sectionKey:O,sectionIndex:U}=Ne(F),q=O==="snacks",re=q?z.snacks[U]:z[O][U];L({type:q?"snack":O,meal:JSON.parse(JSON.stringify(re))});const de=O==="breakfasts"?"Breakfast":O==="lunches"?"Lunch":O==="dinners"?"Dinner":"Snack",Q=U+1;e({type:"success",message:`${de} ${Q} copied to clipboard`})},He=async F=>{var O;try{k(!0);const U="AIzaSyCbkv8tc2Hc-vHsdDaYKkQQ0sYfk9VGAbI",q=F.goal||"Maintain Weight",re={parts:[{text:`You are a professional dietitian.
Generate a healthy and realistic one-day meal plan according to the user goal: ${q}.

Return ONLY valid JSON (no markdown).
Use this exact structure:

{
  "breakfasts": [
    {
      "title": "Breakfast 1",
      "protein":   [ { "name":"string", "baseGrams":number } ],
      "carbs":     [ { "name":"string", "baseGrams":number } ],
      "fats":      [ { "name":"string", "baseGrams":number } ],
      "meat":      [ { "name":"string", "baseGrams":number } ],
      "chicken":   [ { "name":"string", "baseGrams":number } ],
      "fish":      [ { "name":"string", "baseGrams":number } ]
    }
    // exactly 10 breakfast objects total
  ],
  "lunches": [
    {
      "title": "Lunch 1",
      "protein":   [ { "name":"string", "baseGrams":number } ],
      "carbs":     [ { "name":"string", "baseGrams":number } ],
      "fats":      [ { "name":"string", "baseGrams":number } ],
      "meat":      [ { "name":"string", "baseGrams":number } ],
      "chicken":   [ { "name":"string", "baseGrams":number } ],
      "fish":      [ { "name":"string", "baseGrams":number } ]
    }
    // exactly 10 lunch objects total
  ],
  "dinners": [
    {
      "title": "Dinner 1",
      "protein":   [ { "name":"string", "baseGrams":number } ],
      "carbs":     [ { "name":"string", "baseGrams":number } ],
      "fats":      [ { "name":"string", "baseGrams":number } ],
      "meat":      [ { "name":"string", "baseGrams":number } ],
      "chicken":   [ { "name":"string", "baseGrams":number } ],
      "fish":      [ { "name":"string", "baseGrams":number } ]
    }
    // exactly 10 dinner objects total
  ],
  "snacks": [
    {
      "title": "Snack 1",
      "protein":   [ { "name":"string", "baseGrams":number } ],
      "carbs":     [ { "name":"string", "baseGrams":number } ],
      "fats":      [ { "name":"string", "baseGrams":number } ],
      "meat":      [ { "name":"string", "baseGrams":number } ],
      "chicken":   [ { "name":"string", "baseGrams":number } ],
      "fish":      [ { "name":"string", "baseGrams":number } ]
    }
    // exactly 10 snack objects total
  ]
}

Rules:
- Generate 10 UNIQUE breakfasts, 10 UNIQUE lunches, 10 UNIQUE dinners, and 10 UNIQUE snacks.
- Do NOT repeat the same combination of foods between meals.
- Each category (protein, carbs, fats, meat, chicken, fish) should contain 03 items.
- baseGrams MUST be an integer (no decimals).
- Foods must be realistic, healthy, and commonly available.
- For weight loss  prioritize lower carbs, moderate protein, controlled fats.
- For weight gain  prioritize higher carbs and higher protein, with moderate fats.
- For maintenance  balanced carbs, protein, and fats.
- Total items per meal (sum of all categories) should be around 515 items.
- Respond with JSON only  no explanations, no markdown.`}]},de={parts:[{text:`Create a plan for a user with the goal: "${q}".`}]},Q=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${U}`,ge=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_instruction:re,contents:[de],generationConfig:{responseMimeType:"application/json",temperature:.7}})});if(!ge.ok){const et=await ge.json().catch(()=>({}));throw new Error(((O=et.error)==null?void 0:O.message)||`Gemini API Error: ${ge.status} ${ge.statusText}`)}const Te=await ge.json();if(!Te.candidates||!Te.candidates[0]||!Te.candidates[0].content)throw new Error("Unexpected response format from AI");const fe=Te.candidates[0].content.parts[0].text,ke=JSON.parse(fe),Pe=et=>(et||[]).map(tt=>({name:tt.name||"",baseGrams:Number.isFinite(parseInt(tt.baseGrams,10))?parseInt(tt.baseGrams,10):100})),Me=et=>{const tt=et||{},$e={};return b.forEach(bt=>{const St=tt[bt]||[];$e[bt]=Pe(St)}),$e},Oe=(et,tt)=>Array.isArray(et)?et.map(($e,bt)=>{const St=Me($e);return{title:$e.title||`${tt} ${bt+1}`,categories:St,items:w(St)}}):[],Je={breakfasts:Oe(ke.breakfasts,"Breakfast"),lunches:Oe(ke.lunches,"Lunch"),dinners:Oe(ke.dinners,"Dinner"),snacks:Oe(ke.snacks,"Snack")};le(Je),V(q),e({type:"success",message:"AI Meal Plan generated with Gemini 2.5!"})}catch(U){console.error("AI generation error:",U),e({type:"error",message:U.message||"Failed to generate AI meal plan"})}finally{k(!1)}},$=F=>{const{sectionKey:O,sectionIndex:U}=Ne(F);if(!M){e({type:"error",message:"No meal in clipboard"});return}const q=O==="snacks";if(!q&&M.type==="snack"){e({type:"error",message:"Cannot paste snack into a meal section"});return}if(q&&M.type!=="snack"){e({type:"error",message:"Cannot paste meal into snack section"});return}le(Q=>{const ge=[...Q[O]];return ge[U]=JSON.parse(JSON.stringify(M.meal)),{...Q,[O]:ge}});const re=O==="breakfasts"?"Breakfast":O==="lunches"?"Lunch":O==="dinners"?"Dinner":"Snack",de=U+1;e({type:"success",message:`${re} ${de} pasted successfully`})},ne=(F,O,U)=>{const q=`${F}-${O}`,re=z[F][O],de=E[q];return a.jsxs("div",{className:`mb-6 rounded-lg overflow-hidden ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsxs("button",{type:"button",onClick:()=>ye(q),className:`w-full flex items-center justify-between p-4 hover:bg-opacity-80 transition-colors ${t?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[de?a.jsx(gi,{}):a.jsx(Sd,{}),a.jsx("h3",{className:"text-lg font-semibold",children:U})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:Q=>{Q.stopPropagation(),Fe(q)},className:`p-2 rounded-lg transition-colors ${t?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-100 text-gray-600"}`,title:"Copy meal",children:a.jsx(Ig,{})}),a.jsx("button",{type:"button",onClick:Q=>{Q.stopPropagation(),$(q)},className:`p-2 rounded-lg transition-colors ${M?t?"hover:bg-gray-700 text-blue-400":"hover:bg-gray-100 text-blue-600":t?"text-gray-600 cursor-not-allowed":"text-gray-400 cursor-not-allowed"}`,title:"Paste meal",disabled:!M,children:a.jsx(Ad,{})})]})]}),de&&a.jsxs("div",{className:"p-6 pt-0",children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[U," Title"]}),a.jsx("input",{type:"text",value:re.title,onChange:Q=>_e(q,"title",Q.target.value),className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Food Items by Category (Grams will be calculated automatically based on each user's body data)"}),b.map(Q=>{var fe;const ge=((fe=re.categories)==null?void 0:fe[Q])||[],Te=Q.charAt(0).toUpperCase()+Q.slice(1);return a.jsxs("div",{className:"mb-4 border-t border-gray-600/20 pt-3",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("h4",{className:"text-sm font-semibold",children:Te})}),ge.map((ke,Pe)=>{const Me=typeof ke=="string"?ke:ke.name||"",Oe=typeof ke=="string"?"":ke.baseGrams||"",Je=`${q}-${Q}-${Pe}`,et=D.activeInput===Je&&D.showSuggestions,tt=(K==null?void 0:K.mealType)===q&&(K==null?void 0:K.categoryKey)===Q&&(K==null?void 0:K.itemIndex)===Pe;return a.jsxs("div",{className:`flex gap-2 mb-2 items-center transition-opacity ${tt?"opacity-50":"opacity-100"}`,draggable:!0,onDragStart:$e=>Z($e,q,Q,Pe),onDragOver:me,onDrop:$e=>be($e,q,Q,Pe),children:[a.jsx("div",{className:`cursor-move p-2 ${t?"text-gray-400":"text-gray-500"}`,title:"Drag to reorder",children:a.jsx(kc,{})}),a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("input",{type:"text",value:Me,onChange:$e=>we(q,Q,Pe,$e.target.value),onFocus:()=>{if(Me.trim().length>0){const $e=Y.filter(bt=>bt.name.toLowerCase().includes(Me.toLowerCase()));j({activeInput:Je,suggestions:$e,showSuggestions:$e.length>0})}},onBlur:()=>{setTimeout(()=>{j($e=>({...$e,showSuggestions:!1}))},200)},placeholder:`Item ${Pe+1} name`,className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),et&&D.suggestions.length>0&&a.jsx("div",{className:`absolute z-10 w-full mt-1 rounded-lg shadow-lg border ${t?"bg-gray-700 border-gray-600":"bg-white border-gray-300"} max-h-48 overflow-y-auto`,children:D.suggestions.map(($e,bt)=>a.jsxs("button",{type:"button",onClick:()=>B(q,Q,Pe,$e),className:`w-full text-left px-4 py-2 hover:bg-opacity-50 transition-colors ${t?"hover:bg-gray-600 text-white":"hover:bg-gray-100 text-gray-900"}`,children:[a.jsx("div",{className:"font-medium",children:$e.name}),a.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:[$e.grams,"g"]})]},bt))})]}),a.jsx("input",{type:"number",value:Oe,onChange:$e=>Ke(q,Q,Pe,$e.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-36 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),ge.length>1&&a.jsx("button",{type:"button",onClick:()=>at(q,Q,Pe),className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]},Pe)}),a.jsxs("button",{type:"button",onClick:()=>it(q,Q),className:`mt-1 px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Item in ",Te]})]},Q)})]})]})]})},xe=F=>{const O=z.snacks[F],U=`snacks-${F}`,q=E[U],re=`snacks-${F}`,de=W===F;return a.jsxs("div",{className:`mb-6 rounded-lg overflow-hidden transition-all ${de?"opacity-50":"opacity-100"} ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,draggable:z.snacks.length>1,onDragStart:Q=>Re(Q,F),onDragOver:me,onDrop:Q=>Se(Q,F),children:[a.jsxs("button",{type:"button",onClick:()=>ye(U),className:`w-full flex items-center justify-between p-4 hover:bg-opacity-80 transition-colors ${t?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[a.jsxs("div",{className:"flex items-center gap-3",children:[z.snacks.length>1&&a.jsx("div",{className:`cursor-move p-1 ${t?"text-gray-400":"text-gray-500"}`,title:"Drag to reorder snacks",onClick:Q=>Q.stopPropagation(),children:a.jsx(kc,{})}),q?a.jsx(gi,{}):a.jsx(Sd,{}),a.jsxs("h3",{className:"text-lg font-semibold",children:["Snack ",F+1]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:Q=>{Q.stopPropagation(),Fe(re)},className:`p-2 rounded-lg transition-colors ${t?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-100 text-gray-600"}`,title:"Copy snack",children:a.jsx(Ig,{})}),a.jsx("button",{type:"button",onClick:Q=>{Q.stopPropagation(),$(re)},className:`p-2 rounded-lg transition-colors ${M&&M.type==="snack"?t?"hover:bg-gray-700 text-blue-400":"hover:bg-gray-100 text-blue-600":t?"text-gray-600 cursor-not-allowed":"text-gray-400 cursor-not-allowed"}`,title:"Paste snack",disabled:!M||M.type!=="snack",children:a.jsx(Ad,{})}),z.snacks.length>1&&a.jsx("button",{type:"button",onClick:Q=>{Q.stopPropagation(),Ae(F)},className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]})]}),q&&a.jsxs("div",{className:"p-6 pt-0",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Snack Title"}),a.jsx("input",{type:"text",value:O.title,onChange:Q=>{const ge=[...z.snacks];ge[F]={...ge[F],title:Q.target.value},le(Te=>({...Te,snacks:ge}))},className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Food Items by Category (Grams will be calculated automatically based on each user's body data)"}),b.map(Q=>{var fe;const ge=((fe=O.categories)==null?void 0:fe[Q])||[],Te=Q.charAt(0).toUpperCase()+Q.slice(1);return a.jsxs("div",{className:"mb-4 border-t border-gray-600/20 pt-3",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("h4",{className:"text-sm font-semibold",children:Te})}),ge.map((ke,Pe)=>{const Me=typeof ke=="string"?ke:ke.name||"",Oe=typeof ke=="string"?"":ke.baseGrams||"",Je=`${re}-${Q}-${Pe}`,et=D.activeInput===Je&&D.showSuggestions,tt=(K==null?void 0:K.mealType)===re&&(K==null?void 0:K.categoryKey)===Q&&(K==null?void 0:K.itemIndex)===Pe;return a.jsxs("div",{className:`flex gap-2 mb-2 items-center transition-opacity ${tt?"opacity-50":"opacity-100"}`,draggable:!0,onDragStart:$e=>Z($e,re,Q,Pe),onDragOver:me,onDrop:$e=>be($e,re,Q,Pe),children:[a.jsx("div",{className:`cursor-move p-2 ${t?"text-gray-400":"text-gray-500"}`,title:"Drag to reorder",children:a.jsx(kc,{})}),a.jsxs("div",{className:"flex-1 relative",children:[a.jsx("input",{type:"text",value:Me,onChange:$e=>we(re,Q,Pe,$e.target.value),onFocus:()=>{if(Me.trim().length>0){const $e=Y.filter(bt=>bt.name.toLowerCase().includes(Me.toLowerCase()));j({activeInput:Je,suggestions:$e,showSuggestions:$e.length>0})}},onBlur:()=>{setTimeout(()=>{j($e=>({...$e,showSuggestions:!1}))},200)},placeholder:`Item ${Pe+1} name`,className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),et&&D.suggestions.length>0&&a.jsx("div",{className:`absolute z-10 w-full mt-1 rounded-lg shadow-lg border ${t?"bg-gray-700 border-gray-600":"bg-white border-gray-300"} max-h-48 overflow-y-auto`,children:D.suggestions.map(($e,bt)=>a.jsxs("button",{type:"button",onClick:()=>B(re,Q,Pe,$e),className:`w-full text-left px-4 py-2 hover:bg-opacity-50 transition-colors ${t?"hover:bg-gray-600 text-white":"hover:bg-gray-100 text-gray-900"}`,children:[a.jsx("div",{className:"font-medium",children:$e.name}),a.jsxs("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:[$e.grams,"g"]})]},bt))})]}),a.jsx("input",{type:"number",value:Oe,onChange:$e=>Ke(re,Q,Pe,$e.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-36 px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`}),ge.length>1&&a.jsx("button",{type:"button",onClick:()=>at(re,Q,Pe),className:`px-3 py-2 rounded-lg ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"} transition-colors`,children:a.jsx(xt,{})})]},Pe)}),a.jsxs("button",{type:"button",onClick:()=>it(re,Q),className:`mt-1 px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Item in ",Te]})]},Q)})]})]})]},F)};return u?a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Loading meal plans..."})]})})]}):a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("div",{className:`flex-1 overflow-y-auto ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Create Meal Plan Template"}),a.jsx("p",{className:t?"text-gray-400":"text-gray-600",children:"Create a meal plan template and assign it to multiple users. Portions will be automatically adjusted based on each user's body data."})]}),i.length>0&&a.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Existing Template (Optional)"}),a.jsxs("select",{value:l,onChange:F=>he(F.target.value),className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[a.jsx("option",{value:"",children:"Create New Meal Plan"}),i.map(F=>a.jsx("option",{value:F.id,children:F.name},F.id))]}),l&&a.jsx("p",{className:`mt-2 text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Template loaded. You can edit it below or use it as-is."})]}),a.jsxs("div",{className:`mb-6 p-4 rounded-lg ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Meal Plan Type ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:T,onChange:F=>V(F.target.value),className:`w-full px-4 py-2 rounded-lg border ${t?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"} focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[a.jsx("option",{value:"Weight Loss",children:"Weight Loss"}),a.jsx("option",{value:"Weight Gain",children:"Weight Gain"}),a.jsx("option",{value:"Maintain Weight",children:"Maintain Weight"})]})]}),a.jsx("div",{className:"mb-6",children:a.jsx("button",{type:"button",onClick:()=>{He({goal:T})},disabled:P,className:`px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-colors ${P?"bg-gray-400 cursor-not-allowed text-white/60":"bg-purple-600 hover:bg-purple-700 text-white"}`,children:P?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Generating..."]}):a.jsxs(a.Fragment,{children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"AI Generate"]})})}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Breakfast"}),a.jsxs("button",{type:"button",onClick:()=>{le(F=>F.breakfasts.length>=3?F:{...F,breakfasts:[...F.breakfasts,{title:"",items:[{name:"",baseGrams:""}]}]}),A(F=>{const O=z.breakfasts.length;return{...F,[`breakfasts-${O}`]:!0}})},className:`px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Breakfast"]})]}),z.breakfasts.map((F,O)=>ne("breakfasts",O,`Breakfast ${O+1}`))]}),a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Lunch"}),a.jsxs("button",{type:"button",onClick:()=>{le(F=>F.lunches.length>=3?F:{...F,lunches:[...F.lunches,{title:"",items:[{name:"",baseGrams:""}]}]}),A(F=>{const O=z.lunches.length;return{...F,[`lunches-${O}`]:!0}})},className:`px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Lunch"]})]}),z.lunches.map((F,O)=>ne("lunches",O,`Lunch ${O+1}`))]}),a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Dinner"}),a.jsxs("button",{type:"button",onClick:()=>{le(F=>F.dinners.length>=3?F:{...F,dinners:[...F.dinners,{title:"",items:[{name:"",baseGrams:""}]}]}),A(F=>{const O=z.dinners.length;return{...F,[`dinners-${O}`]:!0}})},className:`px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Dinner"]})]}),z.dinners.map((F,O)=>ne("dinners",O,`Dinner ${O+1}`))]}),a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-2xl font-semibold",children:"Snacks"}),z.snacks.length<3&&a.jsxs("button",{type:"button",onClick:oe,className:`px-4 py-2 rounded-lg flex items-center gap-2 ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"} transition-colors`,children:[a.jsx(kt,{})," Add Snack"]})]}),z.snacks.map((F,O)=>xe(O))]})]}),S&&a.jsxs("div",{className:`mb-6 p-6 rounded-lg ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200"}`,children:[a.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Meal Plan Preview"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg mb-2",children:" Breakfast"}),z.breakfasts.map((F,O)=>a.jsxs("div",{className:"ml-4 mb-2",children:[a.jsx("h4",{className:"font-medium",children:F.title||`Breakfast ${O+1}`}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:F.items.filter(U=>(typeof U=="string"?U:U.name||"").trim()!=="").map((U,q)=>{const re=typeof U=="string"?U:U.name||"";return a.jsx("li",{children:re},q)})})]},O))]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg mb-2",children:" Lunch"}),z.lunches.map((F,O)=>a.jsxs("div",{className:"ml-4 mb-2",children:[a.jsx("h4",{className:"font-medium",children:F.title||`Lunch ${O+1}`}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:F.items.filter(U=>(typeof U=="string"?U:U.name||"").trim()!=="").map((U,q)=>{const re=typeof U=="string"?U:U.name||"";return a.jsx("li",{children:re},q)})})]},O))]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg mb-2",children:" Dinner"}),z.dinners.map((F,O)=>a.jsxs("div",{className:"ml-4 mb-2",children:[a.jsx("h4",{className:"font-medium",children:F.title||`Dinner ${O+1}`}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:F.items.filter(U=>(typeof U=="string"?U:U.name||"").trim()!=="").map((U,q)=>{const re=typeof U=="string"?U:U.name||"";return a.jsx("li",{children:re},q)})})]},O))]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg mb-2",children:" Snacks"}),z.snacks.map((F,O)=>a.jsxs("div",{className:"ml-4 mb-2",children:[a.jsx("h4",{className:"font-medium",children:F.title||`Snack ${O+1}`}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:F.items.filter(U=>(typeof U=="string"?U:U.name||"").trim()!=="").map((U,q)=>{const re=typeof U=="string"?U:U.name||"";return a.jsx("li",{children:re},q)})})]},O))]})]})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("button",{type:"button",onClick:()=>{const F=ee();if(F){e({type:"error",message:F});return}v(!0)},className:"px-6 py-3 rounded-lg font-medium flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white transition-colors",children:[a.jsx(es,{})," Assign Meal Plan"]})})]}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Assign Meal Plan to Users"}),a.jsx("button",{onClick:()=>v(!1),className:`p-2 rounded-lg hover:bg-white/10 ${t?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Select Users"}),a.jsx("button",{onClick:Ie,className:`text-sm px-3 py-1 rounded ${t?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:I.length===n.length?"Deselect All":"Select All"})]}),a.jsx("div",{className:`max-h-96 overflow-y-auto border rounded-lg p-4 ${t?"border-gray-700 bg-gray-900":"border-gray-200 bg-gray-50"}`,children:n.length===0?a.jsx("p",{className:`text-center py-4 ${t?"text-gray-400":"text-gray-600"}`,children:"No users available"}):n.map(F=>{var U;const O=((U=F.mealPlan)==null?void 0:U.mealPlanType)||F.planType||"No plan assigned";return a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${t?I.includes(F.uid)?"bg-blue-600/20 border border-blue-500/30":"hover:bg-gray-700":I.includes(F.uid)?"bg-blue-100 border border-blue-300":"hover:bg-gray-100"}`,children:[a.jsx("input",{type:"checkbox",checked:I.includes(F.uid),onChange:()=>G(F.uid),className:"w-5 h-5 rounded"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium",children:F.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:F.loginEmail||F.email||"N/A"}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Plan: ",O]})]})]},F.uid)})})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:()=>v(!1),className:`px-6 py-2 rounded-lg font-medium ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:ie,disabled:m||I.length===0,className:`px-6 py-2 rounded-lg font-medium ${m||I.length===0?"bg-gray-400 cursor-not-allowed text-white/60":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:m?"Assigning...":`Assign to ${I.length} User(s)`})]})]})})]})]})},t3=()=>{const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(!0),[u,h]=_.useState(!1),[m,p]=_.useState(null),[N,v]=_.useState(null),[I,g]=_.useState(null),[S,C]=_.useState(null),[T,V]=_.useState([]);_.useEffect(()=>{P(),k()},[]);const P=async()=>{var j,K,X,W;try{c(!0);const se=localStorage.getItem("token");if(!se){s("/login");return}const M=await ce.get("http://localhost:3000/api/mealPlans/templates",{headers:{Authorization:`Bearer ${se}`}});if(M.data.success)r(M.data.data||[]);else throw new Error(M.data.message||"Failed to fetch templates")}catch(se){console.error("Error fetching templates:",se);const M=((K=(j=se.response)==null?void 0:j.data)==null?void 0:K.message)||((W=(X=se.response)==null?void 0:X.data)==null?void 0:W.error)||se.message||"Failed to fetch meal plan templates";e({type:"error",message:M})}finally{c(!1)}},k=async()=>{try{const j=localStorage.getItem("token");if(!j)return;const K=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${j}`}});K.data.success&&o(K.data.data||[])}catch(j){console.error("Error fetching users:",j)}},b=async()=>{var j,K;if(S){h(!0);try{const X=localStorage.getItem("token");(await ce.delete(`http://localhost:3000/api/mealPlans/templates/${S.id}`,{headers:{Authorization:`Bearer ${X}`}})).data.success&&(e({type:"success",message:"Meal plan template deleted successfully"}),C(null),P())}catch(X){console.error("Error deleting template:",X),e({type:"error",message:((K=(j=X.response)==null?void 0:j.data)==null?void 0:K.message)||"Failed to delete template"})}finally{h(!1)}}},x=async()=>{var j,K,X,W;if(!N||T.length===0){e({type:"error",message:"Please select at least one user"});return}h(!0);try{const se=localStorage.getItem("token"),M=await ce.post("http://localhost:3000/api/mealPlans/bulkAssign",{mealPlanTemplate:N.mealPlanTemplate,selectedUserIds:T},{headers:{Authorization:`Bearer ${se}`}});M.data.success&&(e({type:"success",message:`Meal plan assigned to ${((K=(j=M.data.results)==null?void 0:j.success)==null?void 0:K.length)||0} user(s) successfully`}),v(null),V([]),P())}catch(se){console.error("Error assigning meal plan:",se),e({type:"error",message:((W=(X=se.response)==null?void 0:X.data)==null?void 0:W.message)||"Failed to assign meal plan"})}finally{h(!1)}},w=async j=>{var K,X;h(!0);try{const W=localStorage.getItem("token");(await ce.put(`http://localhost:3000/api/mealPlans/templates/${I.id}`,{name:j.name,mealPlanTemplate:j.mealPlanTemplate},{headers:{Authorization:`Bearer ${W}`}})).data.success&&(e({type:"success",message:"Meal plan template updated successfully"}),g(null),P())}catch(W){console.error("Error updating template:",W),e({type:"error",message:((X=(K=W.response)==null?void 0:K.data)==null?void 0:X.message)||"Failed to update template"})}finally{h(!1)}},E=j=>j?(j instanceof Date?j:new Date(j)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",A=j=>{V(K=>K.includes(j)?K.filter(X=>X!==j):[...K,j])},D=()=>{T.length===i.length?V([]):V(i.map(j=>j.uid))};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("main",{className:`flex-1 p-8 transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Ready Plans"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"Create, manage, and assign meal plan templates to users"})]}),a.jsxs("button",{onClick:()=>s("/employee/meal-plans/add"),className:"px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-all bg-blue-600 hover:bg-blue-700 text-white",children:[a.jsx(kt,{})," Create New Template"]})]}),l?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):n.length===0?a.jsxs("div",{className:`text-center py-20 rounded-lg ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsx(hr,{className:"mx-auto text-6xl mb-4 opacity-50"}),a.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Meal Plan Templates"}),a.jsx("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:"Create your first meal plan template to get started"}),a.jsx("button",{onClick:()=>s("/employee/meal-plans/add"),className:"px-6 py-3 rounded-lg font-medium bg-blue-600 hover:bg-blue-700 text-white",children:"Create Template"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(j=>a.jsxs("div",{className:`p-6 rounded-lg transition-all ${t?"bg-gray-800 border border-gray-700 hover:bg-gray-750":"bg-white border border-gray-200 hover:shadow-lg"}`,children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xl font-semibold mb-1",children:j.name}),a.jsxs("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:["Created: ",E(j.createdAt)]})]})}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[a.jsxs("button",{onClick:()=>p(j),className:`px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-all ${t?"bg-blue-600/20 hover:bg-blue-600/30 text-blue-400":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(Ju,{})," View"]}),a.jsxs("button",{onClick:()=>{v(j),V([])},className:`px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-all ${t?"bg-green-600/20 hover:bg-green-600/30 text-green-400":"bg-green-100 hover:bg-green-200 text-green-700"}`,children:[a.jsx(es,{})," Assign"]}),a.jsxs("button",{onClick:()=>g(j),className:`px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-all ${t?"bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400":"bg-yellow-100 hover:bg-yellow-200 text-yellow-700"}`,children:[a.jsx(is,{})," Edit"]}),a.jsxs("button",{onClick:()=>C(j),className:`px-4 py-2 rounded-lg flex items-center gap-2 text-sm transition-all ${t?"bg-red-600/20 hover:bg-red-600/30 text-red-400":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:[a.jsx(xt,{})," Delete"]})]})]},j.id))}),m&&a.jsx(s3,{template:m,onClose:()=>p(null),isDarkMode:t}),N&&a.jsx(n3,{template:N,users:i,selectedUserIds:T,onToggleUser:A,onToggleSelectAll:D,onAssign:x,onClose:()=>{v(null),V([])},isDarkMode:t,isSubmitting:u}),I&&a.jsx(r3,{template:I,onSave:w,onClose:()=>g(null),isDarkMode:t,isSubmitting:u}),S&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-md w-full ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Meal Plan Template"}),a.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["Are you sure you want to delete ",a.jsx("strong",{children:S.name}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>C(null),className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:b,disabled:u,className:`px-6 py-2 rounded-lg font-medium transition-all ${u?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:u?"Deleting...":"Delete Template"})]})]})})]})})]})},s3=({template:s,onClose:e,isDarkMode:t})=>{const n=o=>o.map((l,c)=>{const u=typeof l=="string"?l:l.name||"",h=typeof l=="object"&&l.baseGrams?l.baseGrams:null;return u.trim()?a.jsxs("li",{className:"mb-1",children:[u,h&&a.jsxs("span",{className:`ml-2 text-xs ${t?"text-gray-400":"text-gray-500"}`,children:["(",h,"g base)"]})]},c):null}),r=(o,l)=>{if(!l||!o.categories)return a.jsx("ul",{className:"list-disc list-inside ml-4",children:n(o.items||[])});const c=["protein","carbs","fats","meat","chicken","fish"],u={protein:"Protein",carbs:"Carbs",fats:"Fats",meat:"Meat",chicken:"Chicken",fish:"Fish"};return a.jsx("div",{className:"space-y-3 ml-4",children:c.map(h=>{const m=o.categories[h]||[];return m.length===0?null:a.jsxs("div",{children:[a.jsx("h5",{className:`text-sm font-semibold mb-1 ${t?"text-blue-400":"text-blue-600"}`,children:u[h]}),a.jsx("ul",{className:"list-disc list-inside ml-4",children:n(m)})]},h)})})},i=s.mealPlanTemplate.breakfasts||s.mealPlanTemplate.lunches||s.mealPlanTemplate.dinners;return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold",children:s.name}),a.jsx("button",{onClick:e,className:`p-2 rounded-lg hover:bg-white/10 ${t?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"space-y-4",children:[i&&s.mealPlanTemplate.breakfasts&&s.mealPlanTemplate.breakfasts.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-2",children:" Breakfasts"}),s.mealPlanTemplate.breakfasts.map((o,l)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:o.title||`Breakfast ${l+1}`}),r(o,!0)]},`breakfast-${l}`))]}):s.mealPlanTemplate.breakfast?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Breakfast: ",s.mealPlanTemplate.breakfast.title]}),r(s.mealPlanTemplate.breakfast,!1)]}):null,i&&s.mealPlanTemplate.lunches&&s.mealPlanTemplate.lunches.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Lunches"}),s.mealPlanTemplate.lunches.map((o,l)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:o.title||`Lunch ${l+1}`}),r(o,!0)]},`lunch-${l}`))]}):s.mealPlanTemplate.lunch?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Lunch: ",s.mealPlanTemplate.lunch.title]}),r(s.mealPlanTemplate.lunch,!1)]}):null,i&&s.mealPlanTemplate.dinners&&s.mealPlanTemplate.dinners.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Dinners"}),s.mealPlanTemplate.dinners.map((o,l)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:o.title||`Dinner ${l+1}`}),r(o,!0)]},`dinner-${l}`))]}):s.mealPlanTemplate.dinner?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[" Dinner: ",s.mealPlanTemplate.dinner.title]}),r(s.mealPlanTemplate.dinner,!1)]}):null,s.mealPlanTemplate.snacks&&s.mealPlanTemplate.snacks.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Snacks"}),s.mealPlanTemplate.snacks.map((o,l)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:o.title||`Snack ${l+1}`}),r(o,!!o.categories)]},l))]})]}),a.jsx("div",{className:"mt-6 pt-4 border-t border-gray-700",children:a.jsx("button",{onClick:e,className:`px-6 py-2 rounded-lg font-medium ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Close"})})]})})},n3=({template:s,users:e,selectedUserIds:t,onToggleUser:n,onToggleSelectAll:r,onAssign:i,onClose:o,isDarkMode:l,isSubmitting:c})=>a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto ${l?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Assign: ",s.name]}),a.jsx("button",{onClick:o,className:`p-2 rounded-lg hover:bg-white/10 ${l?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Select Users"}),a.jsx("button",{onClick:r,className:`text-sm px-3 py-1 rounded ${l?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:t.length===e.length?"Deselect All":"Select All"})]}),a.jsx("div",{className:`max-h-96 overflow-y-auto border rounded-lg p-4 ${l?"border-gray-700 bg-gray-900":"border-gray-200 bg-gray-50"}`,children:e.length===0?a.jsx("p",{className:`text-center py-4 ${l?"text-gray-400":"text-gray-600"}`,children:"No users available"}):e.map(u=>{var m;const h=((m=u.mealPlan)==null?void 0:m.mealPlanType)||u.planType||"No plan assigned";return a.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${l?t.includes(u.uid)?"bg-blue-600/20 border border-blue-500/30":"hover:bg-gray-700":t.includes(u.uid)?"bg-blue-100 border border-blue-300":"hover:bg-gray-100"}`,children:[a.jsx("input",{type:"checkbox",checked:t.includes(u.uid),onChange:()=>n(u.uid),className:"w-5 h-5 rounded"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium",children:u.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${l?"text-gray-400":"text-gray-600"}`,children:u.loginEmail||u.email||"N/A"}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Plan: ",h]})]})]},u.uid)})})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:o,className:`px-6 py-2 rounded-lg font-medium ${l?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:i,disabled:c||t.length===0,className:`px-6 py-2 rounded-lg font-medium ${c||t.length===0?"bg-gray-400 cursor-not-allowed text-white/60":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:c?"Assigning...":`Assign to ${t.length} User(s)`})]})]})}),r3=({template:s,onSave:e,onClose:t,isDarkMode:n,isSubmitting:r})=>{const[i,o]=_.useState(s.name),[l,c]=_.useState(JSON.parse(JSON.stringify(s.mealPlanTemplate))),u=()=>{if(!i.trim()){alert("Template name is required");return}e({name:i.trim(),mealPlanTemplate:l})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${n?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Edit Template"}),a.jsx("button",{onClick:t,className:`p-2 rounded-lg hover:bg-white/10 ${n?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Template Name"}),a.jsx("input",{type:"text",value:i,onChange:h=>o(h.target.value),className:`w-full px-4 py-2 rounded-lg border ${n?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"Enter template name"})]}),a.jsx("div",{className:`p-4 rounded-lg mb-6 ${n?"bg-blue-900/20 border border-blue-500/30":"bg-blue-50 border border-blue-200"}`,children:a.jsxs("p",{className:`text-sm ${n?"text-blue-300":"text-blue-700"}`,children:[a.jsx("strong",{children:"Note:"}),' To edit meal plan contents, navigate to "Add Meal Plan" page, load this template, make your changes, and save as a new template or update this one.']})}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:t,className:`px-6 py-2 rounded-lg font-medium ${n?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:u,disabled:r,className:`px-6 py-2 rounded-lg font-medium ${r?"bg-gray-400 cursor-not-allowed text-white/60":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:r?"Saving...":"Save Changes"})]})]})})},a3=()=>{var k;const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(!0),[u,h]=_.useState(null),[m,p]=_.useState(null),[N,v]=_.useState(null),[I,g]=_.useState(!1);_.useEffect(()=>{(async()=>{try{c(!0);const x=localStorage.getItem("token");if(!x){s("/login");return}const w=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${x}`}});if(w.data.success){const E=w.data.data||[];r(E);const A=E.filter(D=>D.mealPlan&&(D.mealPlan.breakfast||D.mealPlan.breakfasts));o(A)}}catch(x){console.error("Error fetching users:",x),e({type:"error",message:"Failed to load users"})}finally{c(!1)}})()},[s,e]);const S=b=>{if(!b)return"N/A";try{return(b instanceof Date?b:new Date(b)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"N/A"}},C=b=>b?"Employee":"N/A",T=b=>{b.mealPlan&&(p({...b,mealPlan:JSON.parse(JSON.stringify(b.mealPlan))}),h(null))},V=async()=>{var b,x;if(N){g(!0);try{const w=localStorage.getItem("token");if(!w){s("/login");return}const E=await ce.delete(`http://localhost:3000/api/mealPlans/${N.uid}`,{headers:{Authorization:`Bearer ${w}`}});if(E.data.success){e({type:"success",message:"Meal plan deleted successfully"}),v(null);const A=n.filter(j=>j.uid!==N.uid||!j.mealPlan);r(A);const D=A.filter(j=>j.mealPlan&&(j.mealPlan.breakfast||j.mealPlan.breakfasts));o(D)}else throw new Error(E.data.message||"Failed to delete meal plan")}catch(w){console.error("Error deleting meal plan:",w),e({type:"error",message:((x=(b=w.response)==null?void 0:b.data)==null?void 0:x.message)||w.message||"Failed to delete meal plan"})}finally{g(!1)}}},P=async b=>{var x,w;if(m){g(!0);try{const E=localStorage.getItem("token");if(!E){s("/login");return}const A=await ce.put(`http://localhost:3000/api/mealPlans/${m.uid}`,{mealPlan:b},{headers:{Authorization:`Bearer ${E}`}});if(A.data.success){e({type:"success",message:"Meal plan updated successfully"}),p(null);const D=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${E}`}});if(D.data.success){const j=D.data.data||[];r(j);const K=j.filter(X=>X.mealPlan&&(X.mealPlan.breakfast||X.mealPlan.breakfasts));o(K)}}else throw new Error(A.data.message||"Failed to update meal plan")}catch(E){console.error("Error updating meal plan:",E),e({type:"error",message:((w=(x=E.response)==null?void 0:x.data)==null?void 0:w.message)||E.message||"Failed to update meal plan"})}finally{g(!1)}}};return l?a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:t?"text-gray-300":"text-gray-600",children:"Loading meal plans..."})]})})]}):a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("div",{className:`flex-1 overflow-y-auto ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-3",children:[a.jsx(hr,{className:"text-blue-600"}),"View Users Plan"]}),a.jsxs("p",{className:t?"text-gray-400":"text-gray-600",children:[i.length," user(s) with assigned meal plans"]})]}),i.length===0?a.jsxs("div",{className:`text-center py-12 rounded-lg ${t?"bg-gray-800":"bg-white"}`,children:[a.jsx(hr,{className:"mx-auto text-6xl text-gray-400 mb-4"}),a.jsx("p",{className:`text-lg ${t?"text-gray-400":"text-gray-600"}`,children:"No meal plans assigned yet"}),a.jsx("p",{className:"text-sm mt-2 text-gray-500",children:'Use "Add Meal Plan" to create and assign meal plans to users'})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(b=>a.jsxs("div",{onClick:()=>h(b),className:`p-6 rounded-lg cursor-pointer transition-all ${t?"bg-gray-800 hover:bg-gray-700 border border-gray-700":"bg-white hover:bg-gray-50 border border-gray-200 shadow-sm hover:shadow-md"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[a.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t?"bg-blue-600/20":"bg-blue-100"}`,children:a.jsx(Bi,{className:`text-xl ${t?"text-blue-400":"text-blue-600"}`})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold text-lg",children:b.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:b.loginEmail||b.email||"N/A"})]})]}),a.jsx("div",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:"Click to view meal plan"})]},b.uid))})]}),u&&u.mealPlan&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-700",children:[a.jsxs("div",{children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Meal Plan - ",u.displayName||"Unknown User"]}),a.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:u.loginEmail||u.email||"N/A"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>T(u),className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(is,{})," Edit"]}),a.jsxs("button",{onClick:()=>{h(null),v(u)},className:`px-4 py-2 rounded-lg flex items-center gap-2 transition-colors ${t?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:[a.jsx(xt,{})," Delete"]}),a.jsx("button",{onClick:()=>h(null),className:`p-2 rounded-lg hover:bg-white/10 transition-colors ${t?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]})]}),a.jsxs("div",{className:"mb-6 flex items-center gap-3 flex-wrap",children:[((k=u.mealPlan)==null?void 0:k.mealPlanType)&&(()=>{const b=u.mealPlan.mealPlanType,x=w=>w==="Weight Loss"?t?"bg-red-500/20 text-red-400 border-red-500/30":"bg-red-100 text-red-700 border-red-300":w==="Weight Gain"?t?"bg-green-500/20 text-green-400 border-green-500/30":"bg-green-100 text-green-700 border-green-300":t?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-blue-100 text-blue-700 border-blue-300";return a.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full border font-semibold text-sm ${x(b)}`,children:["Plan Type: ",b]})})(),(()=>{var w;let b=(w=u.mealPlan)==null?void 0:w.goal;if(!b&&u.planType){const E=u.planType;if(E==="Weight Loss")b="Lose Weight";else if(E==="Muscle Gain / Weight Gain")b="Gain Weight";else if(E==="Maintenance / Fitness / Healthy Lifestyle")b="Maintain Weight";else{const A=E.toLowerCase();A.includes("loss")||A.includes("weight loss")?b="Lose Weight":A.includes("gain")||A.includes("muscle")?b="Gain Weight":(A.includes("maintain")||A.includes("maintenance")||A.includes("fitness")||A.includes("healthy"))&&(b="Maintain Weight")}}b||(b="Maintain Weight");const x=E=>{const A=E.toLowerCase();return A.includes("lose")?t?"bg-red-500/20 text-red-400 border-red-500/30":"bg-red-100 text-red-700 border-red-300":A.includes("gain")?t?"bg-green-500/20 text-green-400 border-green-500/30":"bg-green-100 text-green-700 border-green-300":t?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-blue-100 text-blue-700 border-blue-300"};return a.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full border font-semibold text-sm ${x(b)}`,children:["Goal: ",b]})})()]}),a.jsxs("div",{className:`grid grid-cols-5 gap-4 mb-6 p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"Total Calories"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.totalCalories||u.mealPlan.calories||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"BMI"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.bmi||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"BMR"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.bmr||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"TDEE"}),a.jsx("div",{className:"text-xl font-bold",children:u.mealPlan.tdee||"N/A"})]}),a.jsxs("div",{children:[a.jsx("div",{className:`text-xs mb-1 ${t?"text-gray-400":"text-gray-600"}`,children:"Portion Scale"}),a.jsxs("div",{className:"text-xl font-bold",children:[u.mealPlan.portionScale||"N/A","x"]})]})]}),a.jsxs("div",{className:"space-y-4",children:[(()=>{const b=(w,E)=>{if(!E||!w.categories)return a.jsx("ul",{className:"space-y-2",children:w.items&&w.items.map((K,X)=>{const W=typeof K=="string"?K:K.name||"",se=typeof K=="object"&&K.grams?K.grams:null,M=typeof K=="object"&&K.baseGrams?K.baseGrams:null;return a.jsx("li",{className:"flex justify-between items-center",children:a.jsxs("span",{children:[W,se&&`: ${se}g`,M&&a.jsx("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`})]})},X)})});const A=w.categories,D=["protein","carbs","fats","meat","chicken","fish"],j={protein:"Protein",carbs:"Carbs",fats:"Fats",meat:"Meat",chicken:"Chicken",fish:"Fish"};return a.jsx("div",{className:"space-y-3",children:D.map(K=>{const X=A[K]||[];return X.length===0?null:a.jsxs("div",{children:[a.jsx("h5",{className:`text-sm font-semibold mb-1 ${t?"text-blue-400":"text-blue-600"}`,children:j[K]}),a.jsx("ul",{className:"space-y-1 ml-4",children:X.map((W,se)=>{const M=typeof W=="string"?W:W.name||"",L=typeof W=="object"&&W.grams?W.grams:null,Y=typeof W=="object"&&W.baseGrams?W.baseGrams:null;return M.trim()?a.jsx("li",{className:"flex justify-between items-center text-sm",children:a.jsxs("span",{children:[M,L&&`: ${L}g`,Y&&a.jsx("span",{className:`text-xs ml-2 ${t?"text-gray-400":"text-gray-500"}`})]})},se):null})})]},K)})})},x=u.mealPlan.breakfasts||u.mealPlan.lunches||u.mealPlan.dinners;return a.jsxs(a.Fragment,{children:[x&&u.mealPlan.breakfasts&&u.mealPlan.breakfasts.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-2",children:" Breakfasts"}),u.mealPlan.breakfasts.map((w,E)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:w.title||`Breakfast ${E+1}`}),b(w,!0)]},`breakfast-${E}`))]}):u.mealPlan.breakfast?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Breakfast: ",u.mealPlan.breakfast.title]}),b(u.mealPlan.breakfast,!1)]}):null,x&&u.mealPlan.lunches&&u.mealPlan.lunches.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Lunches"}),u.mealPlan.lunches.map((w,E)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:w.title||`Lunch ${E+1}`}),b(w,!0)]},`lunch-${E}`))]}):u.mealPlan.lunch?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Lunch: ",u.mealPlan.lunch.title]}),b(u.mealPlan.lunch,!1)]}):null,x&&u.mealPlan.dinners&&u.mealPlan.dinners.length>0?a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Dinners"}),u.mealPlan.dinners.map((w,E)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:w.title||`Dinner ${E+1}`}),b(w,!0)]},`dinner-${E}`))]}):u.mealPlan.dinner?a.jsxs("div",{className:`p-4 rounded-lg ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:[" Dinner: ",u.mealPlan.dinner.title]}),b(u.mealPlan.dinner,!1)]}):null,u.mealPlan.snacks&&u.mealPlan.snacks.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold mb-4 mt-6",children:" Snacks"}),u.mealPlan.snacks.map((w,E)=>a.jsxs("div",{className:`p-4 rounded-lg mb-3 ${t?"bg-gray-900":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:w.title||`Snack ${E+1}`}),b(w,!!w.categories)]},E))]})]})})(),a.jsxs("div",{className:`mt-6 pt-4 border-t border-gray-700 text-sm space-y-2 ${t?"text-gray-400":"text-gray-600"}`,children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Assigned By:"}),a.jsx("span",{className:"font-medium",children:C(u.mealPlan.assignedBy)})]}),u.mealPlan.createdAt&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Created At:"}),a.jsx("span",{className:"font-medium",children:S(u.mealPlan.createdAt)})]})]})]})]})}),N&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-md w-full ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Meal Plan"}),a.jsxs("p",{className:`mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["Are you sure you want to delete the meal plan for ",a.jsx("strong",{children:N.displayName}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>v(null),className:`px-6 py-2 rounded-lg font-medium transition-all ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:V,disabled:I,className:`px-6 py-2 rounded-lg font-medium transition-all ${I?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:I?"Deleting...":"Delete Meal Plan"})]})]})}),m&&m.mealPlan&&a.jsx(i3,{user:m,mealPlan:m.mealPlan,onSave:P,onCancel:()=>p(null),isDarkMode:t,isSubmitting:I,showNotification:e})]})]})},i3=({user:s,mealPlan:e,onSave:t,onCancel:n,isDarkMode:r,isSubmitting:i,showNotification:o})=>{const[l,c]=_.useState(JSON.parse(JSON.stringify(e))),u=["protein","carbs","fats","meat","chicken","fish"],h={protein:"Protein",carbs:"Carbs",fats:"Fats",meat:"Meat",chicken:"Chicken",fish:"Fish"},m=l.breakfasts||l.lunches||l.dinners,p=k=>{const b=k.split("-");return b.length>=2?{sectionKey:b[0],sectionIndex:parseInt(b[1]),category:b[2]||null}:{sectionKey:k,sectionIndex:-1,category:null}},N=(k,b,x)=>{c(w=>{const E={...w},A=p(k);if(m){const D=E[A.sectionKey][A.sectionIndex];if(A.category&&D.categories){const j=[...D.categories[A.category]];j[b]={...j[b],name:x},D.categories[A.category]=j,D.items=I(D.categories)}}else if(k==="breakfast"||k==="lunch"||k==="dinner"){const D=[...E[k].items];D[b]={...D[b],name:x},E[k]={...E[k],items:D}}else if(k.startsWith("snack-")){const D=parseInt(k.split("-")[1]),j=[...E.snacks],K=[...j[D].items];K[b]={...K[b],name:x},j[D]={...j[D],items:K},E.snacks=j}return E})},v=(k,b,x)=>{c(w=>{const E={...w},A=x===""?0:parseFloat(x)||0,D=w.portionScale||1,j=Math.round(A*D),K=p(k);if(m){const X=E[K.sectionKey][K.sectionIndex];if(K.category&&X.categories){const W=[...X.categories[K.category]];W[b]={...W[b],baseGrams:A,grams:j},X.categories[K.category]=W,X.items=I(X.categories)}}else if(k==="breakfast"||k==="lunch"||k==="dinner"){const X=[...E[k].items];X[b]={...X[b],baseGrams:A,grams:j},E[k]={...E[k],items:X}}else if(k.startsWith("snack-")){const X=parseInt(k.split("-")[1]),W=[...E.snacks],se=[...W[X].items];se[b]={...se[b],baseGrams:A,grams:j},W[X]={...W[X],items:se},E.snacks=W}return E})},I=k=>{let b=[];return u.forEach(x=>{b=b.concat(k[x]||[])}),b},g=(k,b)=>{c(x=>{const w={...x},E=p(k);if(m)w[E.sectionKey][E.sectionIndex].title=b;else if(k==="breakfast"||k==="lunch"||k==="dinner")w[k]={...w[k],title:b};else if(k.startsWith("snack-")){const A=parseInt(k.split("-")[1]),D=[...w.snacks];D[A]={...D[A],title:b},w.snacks=D}return w})},S=k=>{c(b=>{const x={...b};b.portionScale;const w=p(k);if(m){const E=x[w.sectionKey][w.sectionIndex];w.category&&E.categories&&(E.categories[w.category]=[...E.categories[w.category],{name:"",baseGrams:0,grams:0}],E.items=I(E.categories))}else if(k==="breakfast"||k==="lunch"||k==="dinner")x[k]={...x[k],items:[...x[k].items,{name:"",baseGrams:0,grams:0}]};else if(k.startsWith("snack-")){const E=parseInt(k.split("-")[1]),A=[...x.snacks];A[E]={...A[E],items:[...A[E].items,{name:"",baseGrams:0,grams:0}]},x.snacks=A}return x})},C=(k,b)=>{c(x=>{const w={...x},E=p(k);if(m){const A=w[E.sectionKey][E.sectionIndex];E.category&&A.categories&&(A.categories[E.category]=A.categories[E.category].filter((D,j)=>j!==b),A.items=I(A.categories))}else if(k==="breakfast"||k==="lunch"||k==="dinner")w[k]={...w[k],items:w[k].items.filter((A,D)=>D!==b)};else if(k.startsWith("snack-")){const A=parseInt(k.split("-")[1]),D=[...w.snacks];D[A]={...D[A],items:D[A].items.filter((j,K)=>K!==b)},w.snacks=D}return w})},T=()=>{const k=l.portionScale||1;let b={...l};m?["breakfasts","lunches","dinners","snacks"].forEach(x=>{b[x]&&(b[x]=b[x].map(w=>{if(w.categories){const E={};return u.forEach(A=>{E[A]=(w.categories[A]||[]).map(D=>({...D,grams:Math.round((D.baseGrams||0)*k)}))}),{...w,categories:E,items:I(E)}}return w}))}):b={...l,breakfast:{...l.breakfast,items:l.breakfast.items.map(x=>({...x,grams:Math.round((x.baseGrams||0)*k)}))},lunch:{...l.lunch,items:l.lunch.items.map(x=>({...x,grams:Math.round((x.baseGrams||0)*k)}))},dinner:{...l.dinner,items:l.dinner.items.map(x=>({...x,grams:Math.round((x.baseGrams||0)*k)}))},snacks:l.snacks.map(x=>({...x,items:x.items.map(w=>({...w,grams:Math.round((w.baseGrams||0)*k)}))}))},t(b)},V=(k,b)=>{const x=l[k];return a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[b," Title"]}),a.jsx("input",{type:"text",value:x.title,onChange:w=>g(k,w.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),x.items.map((w,E)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:w.name||"",onChange:A=>N(k,E,A.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:w.baseGrams||"",onChange:A=>v(k,E,A.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",w.grams||0,"g"]}),x.items.length>1&&a.jsx("button",{type:"button",onClick:()=>C(k,E),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},E)),a.jsxs("button",{type:"button",onClick:()=>S(k),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]})},P=(k,b,x)=>{const w=l[k][b];return a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:[x," Title"]}),a.jsx("input",{type:"text",value:w.title,onChange:E=>g(`${k}-${b}`,E.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),u.map(E=>{var D;const A=((D=w.categories)==null?void 0:D[E])||[];return a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-semibold mb-2 text-blue-500",children:h[E]}),A.map((j,K)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:j.name||"",onChange:X=>N(`${k}-${b}-${E}`,K,X.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:j.baseGrams||"",onChange:X=>v(`${k}-${b}-${E}`,K,X.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",j.grams||0,"g"]}),A.length>1&&a.jsx("button",{type:"button",onClick:()=>C(`${k}-${b}-${E}`,K),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},K)),a.jsxs("button",{type:"button",onClick:()=>S(`${k}-${b}-${E}`),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]},E)})]})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto ${r?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:["Edit Meal Plan - ",s.displayName]}),a.jsx("button",{onClick:n,className:`p-2 rounded-lg hover:bg-white/10 ${r?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsx("div",{className:"space-y-4",children:m?a.jsxs(a.Fragment,{children:[l.breakfasts&&l.breakfasts.map((k,b)=>P("breakfasts",b,`Breakfast ${b+1}`)),l.lunches&&l.lunches.map((k,b)=>P("lunches",b,`Lunch ${b+1}`)),l.dinners&&l.dinners.map((k,b)=>P("dinners",b,`Dinner ${b+1}`)),l.snacks&&l.snacks.map((k,b)=>P("snacks",b,`Snack ${b+1}`))]}):a.jsxs(a.Fragment,{children:[V("breakfast","Breakfast"),V("lunch","Lunch"),V("dinner","Dinner"),a.jsxs("div",{className:`mb-4 p-4 rounded-lg ${r?"bg-gray-800":"bg-gray-50"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Snacks"}),l.snacks&&l.snacks.map((k,b)=>a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Snack ",b+1," Title"]}),a.jsx("input",{type:"text",value:k.title,onChange:x=>g(`snack-${b}`,x.target.value),className:`w-full px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Items"}),k.items.map((x,w)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:x.name||"",onChange:E=>N(`snack-${b}`,w,E.target.value),placeholder:"Item name",className:`flex-1 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsx("input",{type:"number",value:x.baseGrams||"",onChange:E=>v(`snack-${b}`,w,E.target.value),placeholder:"Base grams",min:"0",step:"1",className:`w-32 px-3 py-2 rounded-lg border ${r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`}),a.jsxs("span",{className:`px-3 py-2 ${r?"text-gray-400":"text-gray-600"}`,children:[" ",x.grams||0,"g"]}),k.items.length>1&&a.jsx("button",{type:"button",onClick:()=>C(`snack-${b}`,w),className:`px-3 py-2 rounded-lg ${r?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]},w)),a.jsxs("button",{type:"button",onClick:()=>S(`snack-${b}`),className:`mt-2 px-3 py-2 rounded-lg text-sm ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(kt,{className:"inline mr-1"})," Add Item"]})]})]},b))]})]})}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:n,className:`px-6 py-2 rounded-lg ${r?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:T,disabled:i,className:`px-6 py-2 rounded-lg font-medium ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:i?"Saving...":"Save Changes"})]})]})})},qp=async(s,e,t,n=null)=>{if(!s&&!e)throw new Error("At least one GIF file (male or female) is required");if(!t)throw new Error("Exercise ID is required");if(console.log(" Starting GIF uploads:",{maleGif:s?`${s.name} (${(s.size/1024).toFixed(2)} KB)`:"None",femaleGif:e?`${e.name} (${(e.size/1024).toFixed(2)} KB)`:"None",exerciseId:t}),s){const r=yl(s);if(!r.valid)throw new Error(`Male GIF: ${r.error}`)}if(e){const r=yl(e);if(!r.valid)throw new Error(`Female GIF: ${r.error}`)}try{const r=localStorage.getItem("token"),i=new FormData;i.append("exerciseId",t),s&&i.append("maleGif",s),e&&i.append("femaleGif",e);const o=await fetch("http://localhost:3000/api/employee/upload-gifs",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:i});if(!o.ok){const c=await o.json();throw new Error(c.message||"Upload failed")}const l=await o.json();if(l.success)return console.log(" GIFs uploaded successfully:",l.data),n&&n(100),l.data;throw new Error(l.message||"Upload failed")}catch(r){throw console.error(" GIF upload error:",r),new Error("Failed to upload GIF files: "+r.message)}},yl=s=>{if(!s)return{valid:!1,error:"No file selected"};if(s.type!=="image/gif")return{valid:!1,error:"Only GIF files are allowed"};const e=10*1024*1024;return s.size>e?{valid:!1,error:`File size must be less than 10MB (current: ${(s.size/(1024*1024)).toFixed(2)} MB)`}:{valid:!0}},o3=()=>{ft();const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState([]),[o,l]=_.useState(!0),[c,u]=_.useState(""),[h,m]=_.useState(""),[p,N]=_.useState(!1),[v,I]=_.useState(!1),[g,S]=_.useState(!1),[C,T]=_.useState(null),[V,P]=_.useState(!1),k=["Chest","Back","Legs","Shoulders","Arms","Core","Full Body"],b=["Dumbbells","Barbell","Machine","Bodyweight","Cable","Resistance Band","Kettlebell"],[x,w]=_.useState({name:"",muscleGroup:"",equipment:"",defaultSets:3,defaultReps:10,notes:""}),[E,A]=_.useState(null),[D,j]=_.useState(null),[K,X]=_.useState(null),[W,se]=_.useState(null),[M,L]=_.useState(!1),[Y,z]=_.useState(0);_.useEffect(()=>{le()},[]),_.useEffect(()=>{he()},[t,c,h]);const le=async()=>{try{l(!0);const G=localStorage.getItem("token"),Ie=await ce.get("http://localhost:3000/api/employee/exercises",{headers:{Authorization:`Bearer ${G}`}});Ie.data.success&&n(Ie.data.data||[])}catch(G){console.error("Error fetching exercises:",G),s({type:"error",message:"Failed to load exercises"})}finally{l(!1)}},he=()=>{let G=t;c&&(G=G.filter(Ie=>Ie.name.toLowerCase().includes(c.toLowerCase()))),h&&(G=G.filter(Ie=>Ie.muscleGroup===h)),i(G)},Ne=G=>{if(!G)return;const Ie=yl(G);if(!Ie.valid){s({type:"error",message:Ie.error});return}A(G);const ye=new FileReader;ye.onloadend=()=>{X(ye.result)},ye.readAsDataURL(G),console.log(" Male GIF selected:",{name:G.name,size:(G.size/1024).toFixed(0)+" KB"})},_e=G=>{if(!G)return;const Ie=yl(G);if(!Ie.valid){s({type:"error",message:Ie.error});return}j(G);const ye=new FileReader;ye.onloadend=()=>{se(ye.result)},ye.readAsDataURL(G),console.log(" Female GIF selected:",{name:G.name,size:(G.size/1024).toFixed(0)+" KB"})},Ve=()=>{A(null),X(null)},Ke=()=>{j(null),se(null)},it=async()=>{var G;if(!x.name||!x.muscleGroup||!x.equipment){s({type:"error",message:"Please fill in all required fields"});return}P(!0);try{const Ie=localStorage.getItem("token");if(!Ie){s({type:"error",message:"Authentication required. Please login again."}),P(!1);return}let ye=null,we=null;if(E||D){L(!0),z(0);try{console.log(" Uploading GIF files...");const me=`ex_${Date.now()}`,be=await qp(E,D,me,Re=>{z(Re),console.log(` Upload progress: ${Math.round(Re)}%`)});ye=be.gifMaleUrl,we=be.gifFemaleUrl,console.log(" GIF files uploaded successfully:",{gifMaleUrl:ye,gifFemaleUrl:we})}catch(me){console.error(" GIF upload failed:",me),s({type:"error",message:"GIF upload failed: "+me.message}),P(!1),L(!1);return}finally{L(!1),z(0)}}const B={...x,gifMaleUrl:ye,gifFemaleUrl:we};console.log(" Saving exercise to database...",B);const Z=await ce.post("http://localhost:3000/api/employee/exercises",B,{headers:{Authorization:`Bearer ${Ie}`}});if(Z.data.success)console.log(" Exercise added successfully!"),s({type:"success",message:"Exercise added successfully"}),N(!1),ie(),le();else throw new Error(Z.data.message||"Failed to add exercise")}catch(Ie){console.error(" Error adding exercise:",Ie);let ye="Failed to add exercise";Ie.response?ye=((G=Ie.response.data)==null?void 0:G.message)||`Server error: ${Ie.response.status}`:Ie.request?ye="Network error. Please check your connection.":Ie.message&&(ye=Ie.message),s({type:"error",message:ye})}finally{P(!1)}},at=async()=>{var G,Ie;if(!x.name||!x.muscleGroup||!x.equipment){s({type:"error",message:"Please fill in all required fields"});return}P(!0);try{const ye=localStorage.getItem("token");let we=C.gifMaleUrl||null,B=C.gifFemaleUrl||null;if(E||D){L(!0),z(0);try{console.log(" Uploading new GIF files...");const be=await qp(E,D,C.id,Re=>z(Re));be.gifMaleUrl&&(we=be.gifMaleUrl),be.gifFemaleUrl&&(B=be.gifFemaleUrl),console.log(" New GIF files uploaded:",{gifMaleUrl:we,gifFemaleUrl:B})}catch(be){console.error(" GIF upload failed, keeping old GIFs:",be),s({type:"warning",message:"GIF upload failed. Keeping existing GIFs."})}finally{L(!1),z(0)}}const Z={...x,gifMaleUrl:we,gifFemaleUrl:B};(await ce.put(`http://localhost:3000/api/employee/exercises/${C.id}`,Z,{headers:{Authorization:`Bearer ${ye}`}})).data.success&&(s({type:"success",message:"Exercise updated successfully"}),I(!1),ie(),le())}catch(ye){console.error("Error updating exercise:",ye),s({type:"error",message:((Ie=(G=ye.response)==null?void 0:G.data)==null?void 0:Ie.message)||"Failed to update exercise"})}finally{P(!1)}},oe=async()=>{var G,Ie;P(!0);try{const ye=localStorage.getItem("token");(await ce.delete(`http://localhost:3000/api/employee/exercises/${C.id}`,{headers:{Authorization:`Bearer ${ye}`}})).data.success&&(s({type:"success",message:"Exercise deleted successfully"}),S(!1),T(null),le())}catch(ye){console.error("Error deleting exercise:",ye),s({type:"error",message:((Ie=(G=ye.response)==null?void 0:G.data)==null?void 0:Ie.message)||"Failed to delete exercise"})}finally{P(!1)}},Ae=G=>{T(G),w({name:G.name,muscleGroup:G.muscleGroup,equipment:G.equipment,defaultSets:G.defaultSets,defaultReps:G.defaultReps,notes:G.notes||""}),G.gifMaleUrl&&X(G.gifMaleUrl),G.gifFemaleUrl&&se(G.gifFemaleUrl),I(!0)},ee=G=>{T(G),S(!0)},ie=()=>{w({name:"",muscleGroup:"",equipment:"",defaultSets:3,defaultReps:10,notes:""}),A(null),j(null),X(null),se(null),L(!1),z(0),T(null)};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsxs("main",{className:"flex-1 p-8",children:[a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Exercises Library"}),a.jsx("p",{className:`text-sm ${e?"text-gray-400":"text-gray-600"}`,children:"Manage your global exercises library"})]}),a.jsxs("button",{onClick:()=>{ie(),N(!0)},className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium flex items-center gap-2 transition-all",children:[a.jsx(kt,{})," Add Exercise"]})]}),a.jsx("div",{className:`p-6 rounded-lg mb-6 ${e?"bg-gray-800":"bg-white border border-gray-200"}`,children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${e?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"text",placeholder:"Search exercises...",value:c,onChange:G=>u(G.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`})]}),a.jsxs("div",{className:"relative",children:[a.jsx(wb,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${e?"text-gray-400":"text-gray-500"}`}),a.jsxs("select",{value:h,onChange:G=>m(G.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,children:[a.jsx("option",{value:"",children:"All Muscle Groups"}),k.map(G=>a.jsx("option",{value:G,children:G},G))]})]})]})}),o?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.length===0?a.jsx("div",{className:`text-center py-20 rounded-lg ${e?"bg-gray-800":"bg-white border border-gray-200"}`,children:a.jsx("p",{className:`text-lg ${e?"text-gray-400":"text-gray-600"}`,children:"No exercises found. Add your first exercise to get started!"})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(G=>a.jsxs("div",{className:`p-6 rounded-lg transition-all ${e?"bg-gray-800 border border-gray-700 hover:bg-gray-750":"bg-white border border-gray-200 hover:shadow-lg"}`,children:[a.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[a.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[G.gifMaleUrl?a.jsxs("div",{className:"text-center",children:[a.jsx("img",{src:G.gifMaleUrl,alt:`${G.name} - Male`,className:"w-20 h-20 object-cover rounded-lg",loading:"lazy"}),a.jsx("span",{className:"text-xs opacity-60 mt-1 block",children:"Male"})]}):a.jsx("div",{className:`w-20 h-20 rounded-lg flex items-center justify-center ${e?"bg-gray-700":"bg-gray-200"}`,children:a.jsx(pi,{className:"text-2xl opacity-30"})}),G.gifFemaleUrl?a.jsxs("div",{className:"text-center",children:[a.jsx("img",{src:G.gifFemaleUrl,alt:`${G.name} - Female`,className:"w-20 h-20 object-cover rounded-lg",loading:"lazy"}),a.jsx("span",{className:"text-xs opacity-60 mt-1 block",children:"Female"})]}):a.jsx("div",{className:`w-20 h-20 rounded-lg flex items-center justify-center ${e?"bg-gray-700":"bg-gray-200"}`,children:a.jsx(pi,{className:"text-2xl opacity-30"})})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xl font-semibold mb-1",children:G.name}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[a.jsx("span",{className:`px-2 py-1 rounded text-xs ${e?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:G.muscleGroup}),a.jsx("span",{className:`px-2 py-1 rounded text-xs ${e?"bg-purple-600/20 text-purple-400":"bg-purple-100 text-purple-700"}`,children:G.equipment})]})]})]}),a.jsxs("div",{className:`text-sm mb-4 ${e?"text-gray-400":"text-gray-600"}`,children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Default:"})," ",G.defaultSets," sets  ",G.defaultReps," reps"]}),G.notes&&a.jsx("p",{className:"mt-2",children:G.notes})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>Ae(G),className:`flex-1 px-4 py-2 rounded-lg flex items-center justify-center gap-2 text-sm transition-all ${e?"bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400":"bg-yellow-100 hover:bg-yellow-200 text-yellow-700"}`,children:[a.jsx(is,{})," Edit"]}),a.jsxs("button",{onClick:()=>ee(G),className:`flex-1 px-4 py-2 rounded-lg flex items-center justify-center gap-2 text-sm transition-all ${e?"bg-red-600/20 hover:bg-red-600/30 text-red-400":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:[a.jsx(xt,{})," Delete"]})]})]},G.id))})]}),(p||v)&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto ${e?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold",children:[p?"Add":"Edit"," Exercise"]}),a.jsx("button",{onClick:()=>{N(!1),I(!1),ie()},className:`p-2 rounded-lg hover:bg-white/10 ${e?"text-white":"text-gray-700"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Exercise Name *"}),a.jsx("input",{type:"text",value:x.name,onChange:G=>w({...x,name:G.target.value}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,placeholder:"e.g., Bench Press"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Muscle Group *"}),a.jsxs("select",{value:x.muscleGroup,onChange:G=>w({...x,muscleGroup:G.target.value}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,children:[a.jsx("option",{value:"",children:"Select..."}),k.map(G=>a.jsx("option",{value:G,children:G},G))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Equipment *"}),a.jsxs("select",{value:x.equipment,onChange:G=>w({...x,equipment:G.target.value}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,children:[a.jsx("option",{value:"",children:"Select..."}),b.map(G=>a.jsx("option",{value:G,children:G},G))]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Default Sets"}),a.jsx("input",{type:"number",value:x.defaultSets,onChange:G=>w({...x,defaultSets:parseInt(G.target.value)||0}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,min:"1"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Default Reps"}),a.jsx("input",{type:"number",value:x.defaultReps,onChange:G=>w({...x,defaultReps:parseInt(G.target.value)||0}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,min:"1"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Male GIF (optional)"}),a.jsx("p",{className:"text-xs opacity-60 mb-3",children:"Upload animated GIF for male users (max 10MB)"}),K?a.jsxs("div",{className:"relative inline-block",children:[a.jsx("img",{src:K,alt:"Male GIF Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-blue-500"}),a.jsx("button",{type:"button",onClick:Ve,className:"absolute -top-2 -right-2 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full",children:a.jsx(mt,{size:16})})]}):a.jsxs("label",{className:`inline-flex flex-col items-center justify-center w-32 h-32 rounded-lg border-2 border-dashed cursor-pointer transition-all ${e?"border-gray-600 hover:border-blue-500 bg-gray-800 hover:bg-gray-750":"border-gray-300 hover:border-blue-400 bg-white hover:bg-gray-50"}`,children:[a.jsx(Sg,{className:"text-xl mb-1"}),a.jsx("span",{className:"text-xs",children:"Upload Male"}),a.jsx("input",{type:"file",accept:"image/gif",onChange:G=>Ne(G.target.files[0]),className:"hidden"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Female GIF (optional)"}),a.jsx("p",{className:"text-xs opacity-60 mb-3",children:"Upload animated GIF for female users (max 10MB)"}),W?a.jsxs("div",{className:"relative inline-block",children:[a.jsx("img",{src:W,alt:"Female GIF Preview",className:"w-32 h-32 object-cover rounded-lg border-2 border-pink-500"}),a.jsx("button",{type:"button",onClick:Ke,className:"absolute -top-2 -right-2 p-1 bg-red-500 hover:bg-red-600 text-white rounded-full",children:a.jsx(mt,{size:16})})]}):a.jsxs("label",{className:`inline-flex flex-col items-center justify-center w-32 h-32 rounded-lg border-2 border-dashed cursor-pointer transition-all ${e?"border-gray-600 hover:border-pink-500 bg-gray-800 hover:bg-gray-750":"border-gray-300 hover:border-pink-400 bg-white hover:bg-gray-50"}`,children:[a.jsx(Sg,{className:"text-xl mb-1"}),a.jsx("span",{className:"text-xs",children:"Upload Female"}),a.jsx("input",{type:"file",accept:"image/gif",onChange:G=>_e(G.target.files[0]),className:"hidden"})]})]}),M&&a.jsxs("div",{className:"col-span-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[a.jsx("span",{children:"Uploading GIF files..."}),a.jsxs("span",{children:[Math.round(Y),"%"]})]}),a.jsx("div",{className:`h-2 rounded-full overflow-hidden ${e?"bg-gray-600":"bg-gray-200"}`,children:a.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${Y}%`}})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes (optional)"}),a.jsx("textarea",{value:x.notes,onChange:G=>w({...x,notes:G.target.value}),className:`w-full px-4 py-2 rounded-lg border ${e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300"}`,rows:"3",placeholder:"Tips, form cues, etc..."})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-700",children:[a.jsx("button",{onClick:()=>{N(!1),I(!1),ie()},className:`px-6 py-2 rounded-lg font-medium ${e?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:p?it:at,disabled:V||M,className:`px-6 py-2 rounded-lg font-medium ${V||M?"bg-gray-400 cursor-not-allowed text-white/60":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:M?`Uploading... ${Math.round(Y)}%`:V?"Saving...":p?"Add Exercise":"Save Changes"})]})]})}),g&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-lg p-6 max-w-md w-full ${e?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-xl"}`,children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Delete Exercise"}),a.jsxs("p",{className:`mb-6 ${e?"text-gray-400":"text-gray-600"}`,children:["Are you sure you want to delete ",a.jsx("strong",{children:C==null?void 0:C.name}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:()=>{S(!1),T(null)},className:`px-6 py-2 rounded-lg font-medium ${e?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:oe,disabled:V,className:`px-6 py-2 rounded-lg font-medium ${V?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:V?"Deleting...":"Delete Exercise"})]})]})})]})]})},l3=({isOpen:s,onClose:e,onSelectExercise:t,exercises:n=[],isDarkMode:r,dayTitle:i="Workout Day"})=>{const[o,l]=_.useState(""),[c,u]=_.useState(""),[h,m]=_.useState([]),p=["Chest","Back","Legs","Shoulders","Arms","Core","Full Body"];if(_.useEffect(()=>{let v=n;if(o){const I=o.toLowerCase();v=v.filter(g=>{var S;return g.name.toLowerCase().includes(I)||((S=g.equipment)==null?void 0:S.toLowerCase().includes(I))})}c&&(v=v.filter(I=>I.muscleGroup===c)),m(v)},[n,o,c]),_.useEffect(()=>{s&&(l(""),u(""))},[s]),!s)return null;const N=v=>{const I={exerciseId:v.id,name:v.name,sets:v.defaultSets||3,reps:v.defaultReps||10,muscleGroup:v.muscleGroup,equipment:v.equipment,gifMaleUrl:v.gifMaleUrl||null,gifFemaleUrl:v.gifFemaleUrl||null};t(I),e()};return a.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-3xl max-h-[85vh] overflow-hidden flex flex-col ${r?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-2xl"}`,children:[a.jsxs("div",{className:`p-6 border-b ${r?"border-gray-700":"border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Add Exercise"}),a.jsxs("p",{className:`text-sm mt-1 ${r?"text-gray-400":"text-gray-600"}`,children:["Adding to: ",a.jsx("span",{className:"font-medium",children:i})]})]}),a.jsx("button",{onClick:e,className:`p-2 rounded-xl transition-all ${r?"hover:bg-white/10 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${r?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"text",placeholder:"Search exercises...",value:o,onChange:v=>l(v.target.value),className:`w-full pl-10 pr-4 py-3 rounded-xl border transition-all ${r?"bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`})]}),a.jsxs("div",{className:"relative",children:[a.jsx(wb,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${r?"text-gray-400":"text-gray-500"}`}),a.jsxs("select",{value:c,onChange:v=>u(v.target.value),className:`w-full pl-10 pr-4 py-3 rounded-xl border appearance-none transition-all ${r?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[a.jsx("option",{value:"",children:"All Muscle Groups"}),p.map(v=>a.jsx("option",{value:v,children:v},v))]})]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:h.length===0?a.jsxs("div",{className:`text-center py-16 ${r?"text-gray-400":"text-gray-600"}`,children:[a.jsx(Nn,{className:"mx-auto text-4xl mb-3 opacity-50"}),a.jsx("p",{className:"text-lg font-medium",children:"No exercises found"}),a.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your search or filters"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(v=>a.jsxs("button",{onClick:()=>N(v),className:`p-4 rounded-xl text-left transition-all flex items-start gap-4 group ${r?"bg-gray-700/50 hover:bg-gray-700 border border-gray-600 hover:border-blue-500":"bg-gray-50 hover:bg-white border border-gray-200 hover:border-blue-500 hover:shadow-md"}`,children:[a.jsx("div",{className:"flex-shrink-0",children:v.gifMaleUrl?a.jsx("img",{src:v.gifMaleUrl,alt:v.name,className:"w-16 h-16 object-cover rounded-lg",loading:"lazy"}):a.jsx("div",{className:`w-16 h-16 rounded-lg flex items-center justify-center ${r?"bg-gray-600":"bg-gray-200"}`,children:a.jsx(pi,{className:"text-xl opacity-40"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold truncate group-hover:text-blue-500 transition-colors",children:v.name}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${r?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:v.muscleGroup}),a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${r?"bg-purple-600/20 text-purple-400":"bg-purple-100 text-purple-700"}`,children:v.equipment})]}),a.jsxs("p",{className:`text-xs mt-2 ${r?"text-gray-400":"text-gray-500"}`,children:["Default: ",v.defaultSets||3," sets  ",v.defaultReps||10," reps"]})]}),a.jsx("div",{className:`flex-shrink-0 p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all ${r?"bg-blue-600":"bg-blue-500"}`,children:a.jsx(kt,{className:"text-white"})})]},v.id))})}),a.jsx("div",{className:`p-4 border-t ${r?"border-gray-700 bg-gray-800/50":"border-gray-200 bg-gray-50"}`,children:a.jsxs("p",{className:`text-sm text-center ${r?"text-gray-400":"text-gray-600"}`,children:["Showing ",h.length," of ",n.length," exercises"]})})]})})},c3=()=>{var Ae;ft();const{showNotification:s}=yt(),{isDarkMode:e}=Tt(),[t,n]=_.useState([]),[r,i]=_.useState(null),[o,l]=_.useState(null),[c,u]=_.useState(!0),[h,m]=_.useState(!1),[p,N]=_.useState(!1),[v,I]=_.useState(""),[g,S]=_.useState([]),[C,T]=_.useState(!1),V=_.useRef(null),[P,k]=_.useState([]),[b,x]=_.useState(!1),[w,E]=_.useState(!1),[A,D]=_.useState(null),[j,K]=_.useState({goal:"",experience:"",daysPerWeek:3,days:[]}),X=["Gain Muscle","Lose Fat","Maintain","Strength","Endurance"],W=["Beginner","Intermediate","Advanced"];_.useEffect(()=>{se(),M()},[]),_.useEffect(()=>{r?L(r.uid):(l(null),Y())},[r]),_.useEffect(()=>{if(v.trim()==="")S(t);else{const ee=v.toLowerCase(),ie=t.filter(G=>G.displayName&&G.displayName.toLowerCase().includes(ee)||G.loginEmail&&G.loginEmail.toLowerCase().includes(ee)||G.email&&G.email.toLowerCase().includes(ee));S(ie)}},[v,t]),_.useEffect(()=>{const ee=ie=>{V.current&&!V.current.contains(ie.target)&&T(!1)};return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[]);const se=async()=>{try{u(!0);const ee=localStorage.getItem("token"),ie=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${ee}`}});ie.data.success&&(n(ie.data.data||[]),S(ie.data.data||[]))}catch(ee){console.error("Error fetching users:",ee),s({type:"error",message:"Failed to load users"})}finally{u(!1)}},M=async()=>{var ee;try{x(!0);const ie=localStorage.getItem("token"),G=await ce.get("http://localhost:3000/api/employee/exercises",{headers:{Authorization:`Bearer ${ie}`}});G.data.success&&(k(G.data.data||[]),console.log(" Loaded exercises library:",((ee=G.data.data)==null?void 0:ee.length)||0,"exercises"))}catch(ie){console.error("Error fetching exercises:",ie)}finally{x(!1)}},L=async ee=>{var ie;try{m(!0);const G=localStorage.getItem("token"),Ie=await ce.get(`http://localhost:3000/api/employee/workout-plans/${ee}`,{headers:{Authorization:`Bearer ${G}`}});Ie.data.success&&(l(Ie.data.data),K({goal:Ie.data.data.goal||"",experience:Ie.data.data.experience||"",daysPerWeek:Ie.data.data.daysPerWeek||3,days:Ie.data.data.days||[]}))}catch(G){((ie=G.response)==null?void 0:ie.status)===404?(l(null),Y()):(console.error("Error fetching workout plan:",G),s({type:"error",message:"Failed to load workout plan"}))}finally{m(!1)}},Y=()=>{K({goal:"",experience:"",daysPerWeek:3,days:[]})},z=ee=>{i(ee),I(ee.displayName||ee.loginEmail||ee.email||""),T(!1)},le=()=>{i(null),I(""),T(!1)},he=()=>{K({...j,days:[...j.days,{title:`Day ${j.days.length+1}`,warmup:[],exercises:[],cooldown:[]}]})},Ne=ee=>{K({...j,days:j.days.filter((ie,G)=>G!==ee)})},_e=(ee,ie,G)=>{const Ie=[...j.days];Ie[ee]={...Ie[ee],[ie]:G},K({...j,days:Ie})},Ve=ee=>{D(ee),E(!0)},Ke=ee=>{if(A===null)return;const ie=[...j.days];ie[A].exercises||(ie[A].exercises=[]),ie[A].exercises.push(ee),K({...j,days:ie}),s({type:"success",message:`Added "${ee.name}" to ${ie[A].title}`})},it=(ee,ie)=>{const G=[...j.days];G[ee].exercises.splice(ie,1),K({...j,days:G})},at=(ee,ie,G,Ie)=>{const ye=[...j.days];ye[ee].exercises[ie]={...ye[ee].exercises[ie],[G]:parseInt(Ie)||1},K({...j,days:ye})},oe=async()=>{var ee,ie;if(!r){s({type:"error",message:"Please select a user first"});return}if(!j.goal||!j.experience){s({type:"error",message:"Please fill in goal and experience level"});return}N(!0);try{const G=localStorage.getItem("token");(await ce.post(`http://localhost:3000/api/employee/workout-plans/${r.uid}`,j,{headers:{Authorization:`Bearer ${G}`}})).data.success&&(s({type:"success",message:o?"Workout plan updated successfully":"Workout plan created successfully"}),L(r.uid))}catch(G){console.error("Error saving workout plan:",G),s({type:"error",message:((ie=(ee=G.response)==null?void 0:ee.data)==null?void 0:ie.message)||"Failed to save workout plan"})}finally{N(!1)}};return a.jsxs("div",{className:`min-h-screen flex transition-colors ${e?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("main",{className:"flex-1 p-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Gym Plans"}),a.jsx("p",{className:`text-sm ${e?"text-gray-400":"text-gray-600"}`,children:"Create and assign workout plans to your users"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsxs("div",{className:`lg:col-span-1 p-6 rounded-2xl h-fit ${e?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(es,{})," Select User"]}),c?a.jsx("div",{className:"flex justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{ref:V,className:"relative",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 ${e?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"text",placeholder:"Search user by name or email...",value:v,onChange:ee=>{I(ee.target.value),T(!0)},onFocus:()=>T(!0),className:`w-full pl-10 pr-10 py-3 rounded-xl border transition-all ${e?"bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"}`}),r&&a.jsx("button",{onClick:le,className:`absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full transition-colors ${e?"hover:bg-gray-600 text-gray-400":"hover:bg-gray-200 text-gray-500"}`,children:a.jsx(mt,{size:16})}),!r&&a.jsx(gi,{className:`absolute right-3 top-1/2 transform -translate-y-1/2 transition-transform ${C?"rotate-180":""} ${e?"text-gray-400":"text-gray-500"}`})]}),C&&a.jsx("div",{className:`absolute z-20 w-full mt-2 rounded-xl border shadow-xl max-h-[300px] overflow-y-auto ${e?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:g.length===0?a.jsx("div",{className:`p-4 text-center ${e?"text-gray-400":"text-gray-500"}`,children:"No users found"}):g.map(ee=>a.jsxs("button",{onClick:()=>z(ee),className:`w-full p-4 text-left transition-all border-b last:border-b-0 ${(r==null?void 0:r.uid)===ee.uid?e?"bg-blue-600/20 border-gray-600":"bg-blue-50 border-gray-100":e?"hover:bg-gray-600 border-gray-600":"hover:bg-gray-50 border-gray-100"}`,children:[a.jsx("p",{className:`font-medium ${(r==null?void 0:r.uid)===ee.uid?"text-blue-500":""}`,children:ee.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${e?"text-gray-400":"text-gray-500"}`,children:ee.loginEmail||ee.email})]},ee.uid))})]}),r&&a.jsxs("div",{className:`p-4 rounded-xl border-2 ${e?"bg-blue-600/10 border-blue-500/50":"bg-blue-50 border-blue-200"}`,children:[a.jsx("p",{className:"text-sm font-medium text-blue-500 mb-1",children:"Selected User"}),a.jsx("p",{className:"font-semibold",children:r.displayName||"Unknown"}),a.jsx("p",{className:`text-sm ${e?"text-gray-400":"text-gray-600"}`,children:r.loginEmail||r.email})]}),a.jsxs("p",{className:`text-xs text-center ${e?"text-gray-500":"text-gray-400"}`,children:[t.length," users available"]})]})]}),a.jsx("div",{className:`lg:col-span-2 p-6 rounded-2xl ${e?"bg-gray-800":"bg-white border border-gray-200"}`,children:r?h?a.jsx("div",{className:"flex justify-center py-20",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{children:a.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Workout Plan for ",r.displayName]})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Goal *"}),a.jsxs("select",{value:j.goal,onChange:ee=>K({...j,goal:ee.target.value}),className:`w-full px-4 py-3 rounded-xl border transition-all ${e?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[a.jsx("option",{value:"",children:"Select goal..."}),X.map(ee=>a.jsx("option",{value:ee,children:ee},ee))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Experience *"}),a.jsxs("select",{value:j.experience,onChange:ee=>K({...j,experience:ee.target.value}),className:`w-full px-4 py-3 rounded-xl border transition-all ${e?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,children:[a.jsx("option",{value:"",children:"Select level..."}),W.map(ee=>a.jsx("option",{value:ee,children:ee},ee))]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Days Per Week"}),a.jsx("input",{type:"number",value:j.daysPerWeek,onChange:ee=>K({...j,daysPerWeek:parseInt(ee.target.value)||0}),className:`w-full px-4 py-3 rounded-xl border transition-all ${e?"bg-gray-700 border-gray-600 text-white focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,min:"1",max:"7"})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Workout Days"}),a.jsxs("button",{onClick:he,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl flex items-center gap-2 text-sm transition-all",children:[a.jsx(kt,{})," Add Day"]})]}),j.days.length===0?a.jsxs("div",{className:`text-center py-12 rounded-xl border-2 border-dashed ${e?"border-gray-600 text-gray-400":"border-gray-300 text-gray-600"}`,children:[a.jsx("p",{className:"font-medium",children:"No days added yet"}),a.jsx("p",{className:"text-sm mt-1",children:'Click "Add Day" to create your first workout day'})]}):a.jsx("div",{className:"space-y-4",children:j.days.map((ee,ie)=>a.jsxs("div",{className:`p-5 rounded-xl border ${e?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("input",{type:"text",value:ee.title,onChange:G=>_e(ie,"title",G.target.value),className:`flex-1 px-4 py-2 rounded-xl border font-semibold text-lg ${e?"bg-gray-600 border-gray-500 text-white focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500"}`,placeholder:"Day title (e.g., Chest & Shoulders)"}),a.jsx("button",{onClick:()=>Ne(ie),className:`ml-3 px-4 py-2 rounded-xl text-sm font-medium transition-all ${e?"bg-red-600/20 hover:bg-red-600/30 text-red-400":"bg-red-100 hover:bg-red-200 text-red-600"}`,children:"Remove Day"})]}),a.jsxs("div",{className:"space-y-3",children:[ee.exercises&&ee.exercises.length>0?a.jsx(a.Fragment,{children:ee.exercises.map((G,Ie)=>a.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-4 ${e?"bg-gray-600":"bg-white border border-gray-200"}`,children:[a.jsx("div",{className:"flex-shrink-0",children:G.gifMaleUrl?a.jsx("img",{src:G.gifMaleUrl,alt:G.name,className:"w-14 h-14 object-cover rounded-lg",loading:"lazy"}):a.jsx("div",{className:`w-14 h-14 rounded-lg flex items-center justify-center ${e?"bg-gray-500":"bg-gray-100"}`,children:a.jsx(pi,{className:"text-lg opacity-40"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-semibold truncate",children:G.name}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${e?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:G.muscleGroup}),a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${e?"bg-purple-600/20 text-purple-400":"bg-purple-100 text-purple-700"}`,children:G.equipment})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("label",{className:`text-xs block mb-1 ${e?"text-gray-400":"text-gray-500"}`,children:"Sets"}),a.jsx("input",{type:"number",value:G.sets,onChange:ye=>at(ie,Ie,"sets",ye.target.value),min:"1",className:`w-16 px-2 py-1 rounded-lg border text-center ${e?"bg-gray-500 border-gray-400 text-white":"bg-gray-50 border-gray-300"}`})]}),a.jsx("span",{className:`text-lg ${e?"text-gray-400":"text-gray-500"}`,children:""}),a.jsxs("div",{className:"text-center",children:[a.jsx("label",{className:`text-xs block mb-1 ${e?"text-gray-400":"text-gray-500"}`,children:"Reps"}),a.jsx("input",{type:"number",value:G.reps,onChange:ye=>at(ie,Ie,"reps",ye.target.value),min:"1",className:`w-16 px-2 py-1 rounded-lg border text-center ${e?"bg-gray-500 border-gray-400 text-white":"bg-gray-50 border-gray-300"}`})]})]}),a.jsx("button",{onClick:()=>it(ie,Ie),className:`p-2 rounded-lg transition-all ${e?"hover:bg-red-600/20 text-red-400":"hover:bg-red-100 text-red-500"}`,title:"Remove exercise",children:a.jsx(xt,{})})]},Ie))}):a.jsx("div",{className:`text-center py-6 rounded-xl border border-dashed ${e?"border-gray-500 text-gray-400":"border-gray-300 text-gray-500"}`,children:a.jsx("p",{className:"text-sm",children:"No exercises added to this day yet"})}),a.jsxs("button",{onClick:()=>Ve(ie),className:`w-full py-3 rounded-xl border-2 border-dashed flex items-center justify-center gap-2 text-sm font-medium transition-all ${e?"border-gray-500 text-gray-400 hover:border-blue-500 hover:text-blue-400 hover:bg-blue-600/10":"border-gray-300 text-gray-500 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50"}`,children:[a.jsx(kt,{})," Add Exercise"]})]})]},ie))})]}),a.jsx("div",{className:`pt-6 border-t ${e?"border-gray-700":"border-gray-200"}`,children:a.jsxs("button",{onClick:oe,disabled:p,className:`w-full px-6 py-4 rounded-xl font-semibold flex items-center justify-center gap-2 text-lg transition-all ${p?"bg-gray-400 cursor-not-allowed text-white/60":"bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-600/30 hover:shadow-blue-600/40"}`,children:[a.jsx(VA,{})," ",p?"Saving...":o?"Update Plan":"Create Plan"]})})]}):a.jsxs("div",{className:`text-center py-20 ${e?"text-gray-400":"text-gray-600"}`,children:[a.jsx(es,{className:"mx-auto text-5xl mb-4 opacity-30"}),a.jsx("p",{className:"text-lg font-medium",children:"Select a user to get started"}),a.jsx("p",{className:"text-sm mt-2",children:"Search and select a user from the left panel"})]})})]})]})}),a.jsx(l3,{isOpen:w,onClose:()=>{E(!1),D(null)},onSelectExercise:Ke,exercises:P,isDarkMode:e,dayTitle:A!==null?(Ae=j.days[A])==null?void 0:Ae.title:""})]})},d3=()=>{var K,X;const s=ft(),{showNotification:e}=yt(),{isDarkMode:t}=Tt(),[n,r]=_.useState([]),[i,o]=_.useState([]),[l,c]=_.useState(!0),[u,h]=_.useState(""),[m,p]=_.useState([]),[N,v]=_.useState(!1),[I,g]=_.useState(!1),[S,C]=_.useState(null),[T,V]=_.useState(!1);_.useEffect(()=>{P()},[]),_.useEffect(()=>{if(u.trim()==="")p(n);else{const W=u.toLowerCase();p(n.filter(se=>{const M=k(se.userId);return(M==null?void 0:M.displayName)&&M.displayName.toLowerCase().includes(W)||(M==null?void 0:M.loginEmail)&&M.loginEmail.toLowerCase().includes(W)||(M==null?void 0:M.email)&&M.email.toLowerCase().includes(W)||se.goal&&se.goal.toLowerCase().includes(W)||se.experience&&se.experience.toLowerCase().includes(W)}))}},[u,n,i]);const P=async()=>{try{c(!0);const W=localStorage.getItem("token"),se=await ce.get("http://localhost:3000/api/employee/users",{headers:{Authorization:`Bearer ${W}`}});let M=[];se.data.success&&(M=se.data.data||[],o(M)),console.log(" Fetching workout plans for",M.length,"users...");const L=[],Y=M.map(async he=>{var Ne;try{const _e=await ce.get(`http://localhost:3000/api/employee/workout-plans/${he.uid}`,{headers:{Authorization:`Bearer ${W}`}});return _e.data.success&&_e.data.data?{..._e.data.data,userId:he.uid}:null}catch(_e){return((Ne=_e.response)==null?void 0:Ne.status)!==404&&console.error(`Error fetching plan for user ${he.uid}:`,_e),null}}),le=(await Promise.all(Y)).filter(he=>he!==null);console.log(" Found",le.length,"workout plans"),r(le),p(le)}catch(W){console.error("Error fetching data:",W),e({type:"error",message:"Failed to load workout plans"})}finally{c(!1)}},k=W=>i.find(se=>se.uid===W),b=W=>{C(W),v(!0)},x=W=>{s(`/employee/gym-plans?userId=${W.userId}`)},w=W=>{C(W),g(!0)},E=async()=>{var W,se;if(S){V(!0);try{const M=localStorage.getItem("token");(await ce.delete(`http://localhost:3000/api/employee/workout-plans/${S.userId}`,{headers:{Authorization:`Bearer ${M}`}})).data.success&&(e({type:"success",message:"Workout plan deleted successfully"}),g(!1),C(null),P())}catch(M){console.error("Error deleting workout plan:",M),e({type:"error",message:((se=(W=M.response)==null?void 0:W.data)==null?void 0:se.message)||"Failed to delete workout plan"})}finally{V(!1)}}},A=W=>{if(!W)return"N/A";let se;return W._seconds?se=new Date(W._seconds*1e3):W.seconds?se=new Date(W.seconds*1e3):se=new Date(W),se.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},D=W=>({"Gain Muscle":t?"bg-green-600/20 text-green-400":"bg-green-100 text-green-700","Lose Fat":t?"bg-orange-600/20 text-orange-400":"bg-orange-100 text-orange-700",Maintain:t?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700",Strength:t?"bg-red-600/20 text-red-400":"bg-red-100 text-red-700",Endurance:t?"bg-purple-600/20 text-purple-400":"bg-purple-100 text-purple-700"})[W]||(t?"bg-gray-600/20 text-gray-400":"bg-gray-100 text-gray-700"),j=W=>({Beginner:t?"bg-teal-600/20 text-teal-400":"bg-teal-100 text-teal-700",Intermediate:t?"bg-yellow-600/20 text-yellow-400":"bg-yellow-100 text-yellow-700",Advanced:t?"bg-red-600/20 text-red-400":"bg-red-100 text-red-700"})[W]||(t?"bg-gray-600/20 text-gray-400":"bg-gray-100 text-gray-700");return a.jsxs("div",{className:`min-h-screen flex transition-colors ${t?"bg-[#0a0d1a] text-white":"bg-gray-50 text-gray-900"}`,children:[a.jsx($t,{}),a.jsx("main",{className:"flex-1 p-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Users Workout Plans"}),a.jsx("p",{className:`text-sm ${t?"text-gray-400":"text-gray-600"}`,children:"View and manage all user workout plans"})]}),a.jsxs("div",{className:`px-4 py-2 rounded-xl ${t?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:[a.jsx("span",{className:"font-semibold",children:n.length})," Plans Total"]})]}),a.jsx("div",{className:`p-6 rounded-2xl mb-6 ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:a.jsxs("div",{className:"relative",children:[a.jsx(Nn,{className:`absolute left-4 top-1/2 transform -translate-y-1/2 ${t?"text-gray-400":"text-gray-500"}`}),a.jsx("input",{type:"text",placeholder:"Search by user name, email, goal, or experience...",value:u,onChange:W=>h(W.target.value),className:`w-full pl-12 pr-4 py-3 rounded-xl border transition-all ${t?"bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-blue-500":"bg-white border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"}`})]})}),l?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):m.length===0?a.jsxs("div",{className:`text-center py-20 rounded-2xl ${t?"bg-gray-800":"bg-white border border-gray-200"}`,children:[a.jsx(Td,{className:"mx-auto text-5xl mb-4 opacity-30"}),a.jsx("p",{className:`text-lg font-medium ${t?"text-gray-400":"text-gray-600"}`,children:n.length===0?"No workout plans created yet":"No plans match your search"}),a.jsx("p",{className:"text-sm mt-2 text-gray-500",children:n.length===0?"Create workout plans for your users in the Gym Plans section":"Try a different search term"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((W,se)=>{var Y;const M=k(W.userId),L=((Y=W.days)==null?void 0:Y.reduce((z,le)=>{var he;return z+(((he=le.exercises)==null?void 0:he.length)||0)},0))||0;return a.jsxs("div",{className:`p-6 rounded-2xl transition-all ${t?"bg-gray-800 border border-gray-700 hover:border-gray-600":"bg-white border border-gray-200 hover:shadow-lg"}`,children:[a.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[a.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-lg font-bold ${t?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:((M==null?void 0:M.displayName)||(M==null?void 0:M.email)||"U")[0].toUpperCase()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold truncate",children:(M==null?void 0:M.displayName)||"Unknown User"}),a.jsx("p",{className:`text-sm truncate ${t?"text-gray-400":"text-gray-500"}`,children:(M==null?void 0:M.loginEmail)||(M==null?void 0:M.email)||"No email"})]})]}),a.jsxs("div",{className:"space-y-3 mb-4",children:[a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsxs("span",{className:`px-3 py-1 rounded-lg text-xs font-medium ${D(W.goal)}`,children:[a.jsx(LA,{className:"inline mr-1"}),W.goal||"No goal"]}),a.jsx("span",{className:`px-3 py-1 rounded-lg text-xs font-medium ${j(W.experience)}`,children:W.experience||"No level"})]}),a.jsxs("div",{className:`grid grid-cols-2 gap-3 p-3 rounded-xl ${t?"bg-gray-700/50":"bg-gray-50"}`,children:[a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:"Days/Week"}),a.jsx("p",{className:"text-lg font-bold",children:W.daysPerWeek||0})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:`text-xs ${t?"text-gray-400":"text-gray-500"}`,children:"Exercises"}),a.jsx("p",{className:"text-lg font-bold",children:L})]})]}),a.jsxs("div",{className:`flex items-center gap-2 text-xs ${t?"text-gray-400":"text-gray-500"}`,children:[a.jsx(Hu,{}),a.jsxs("span",{children:["Updated: ",A(W.updatedAt)]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:()=>b(W),className:`flex-1 px-3 py-2 rounded-xl flex items-center justify-center gap-2 text-sm font-medium transition-all ${t?"bg-blue-600/20 hover:bg-blue-600/30 text-blue-400":"bg-blue-100 hover:bg-blue-200 text-blue-700"}`,children:[a.jsx(Ju,{})," View"]}),a.jsxs("button",{onClick:()=>x(W),className:`flex-1 px-3 py-2 rounded-xl flex items-center justify-center gap-2 text-sm font-medium transition-all ${t?"bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400":"bg-yellow-100 hover:bg-yellow-200 text-yellow-700"}`,children:[a.jsx(is,{})," Edit"]}),a.jsx("button",{onClick:()=>w(W),className:`px-3 py-2 rounded-xl flex items-center justify-center transition-all ${t?"bg-red-600/20 hover:bg-red-600/30 text-red-400":"bg-red-100 hover:bg-red-200 text-red-700"}`,children:a.jsx(xt,{})})]})]},W.userId||se)})})]})}),N&&S&&a.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-2xl"}`,children:[a.jsxs("div",{className:`p-6 border-b ${t?"border-gray-700":"border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Workout Plan Details"}),a.jsx("p",{className:`text-sm mt-1 ${t?"text-gray-400":"text-gray-600"}`,children:((K=k(S.userId))==null?void 0:K.displayName)||"Unknown User"})]}),a.jsx("button",{onClick:()=>{v(!1),C(null)},className:`p-2 rounded-xl transition-all ${t?"hover:bg-white/10 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:a.jsx(mt,{size:24})})]}),a.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[a.jsx("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${D(S.goal)}`,children:S.goal}),a.jsx("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${j(S.experience)}`,children:S.experience}),a.jsxs("span",{className:`px-3 py-1 rounded-lg text-sm font-medium ${t?"bg-gray-600/50 text-gray-300":"bg-gray-100 text-gray-700"}`,children:[S.daysPerWeek," days/week"]})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:S.days&&S.days.length>0?a.jsx("div",{className:"space-y-4",children:S.days.map((W,se)=>a.jsxs("div",{className:`p-5 rounded-xl border ${t?"bg-gray-700/50 border-gray-600":"bg-gray-50 border-gray-200"}`,children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:W.title||`Day ${se+1}`}),W.exercises&&W.exercises.length>0?a.jsx("div",{className:"space-y-3",children:W.exercises.map((M,L)=>a.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-4 ${t?"bg-gray-600":"bg-white border border-gray-200"}`,children:[a.jsx("div",{className:"flex-shrink-0",children:M.gifMaleUrl?a.jsx("img",{src:M.gifMaleUrl,alt:M.name,className:"w-16 h-16 object-cover rounded-lg",loading:"lazy"}):a.jsx("div",{className:`w-16 h-16 rounded-lg flex items-center justify-center ${t?"bg-gray-500":"bg-gray-100"}`,children:a.jsx(pi,{className:"text-xl opacity-40"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-semibold truncate",children:M.name}),a.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[M.muscleGroup&&a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t?"bg-blue-600/20 text-blue-400":"bg-blue-100 text-blue-700"}`,children:M.muscleGroup}),M.equipment&&a.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${t?"bg-purple-600/20 text-purple-400":"bg-purple-100 text-purple-700"}`,children:M.equipment})]})]}),a.jsxs("div",{className:`text-center px-4 py-2 rounded-xl ${t?"bg-gray-500":"bg-gray-100"}`,children:[a.jsxs("p",{className:"text-lg font-bold",children:[M.sets,"  ",M.reps]}),a.jsx("p",{className:`text-xs ${t?"text-gray-300":"text-gray-500"}`,children:"Sets  Reps"})]})]},L))}):a.jsx("p",{className:`text-sm text-center py-4 ${t?"text-gray-400":"text-gray-500"}`,children:"No exercises in this day"})]},se))}):a.jsxs("div",{className:`text-center py-12 ${t?"text-gray-400":"text-gray-500"}`,children:[a.jsx(Td,{className:"mx-auto text-4xl mb-3 opacity-50"}),a.jsx("p",{children:"No workout days in this plan"})]})}),a.jsx("div",{className:`p-4 border-t ${t?"border-gray-700":"border-gray-200"}`,children:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsxs("button",{onClick:()=>{v(!1),x(S)},className:`px-6 py-2 rounded-xl font-medium transition-all ${t?"bg-yellow-600/20 hover:bg-yellow-600/30 text-yellow-400":"bg-yellow-100 hover:bg-yellow-200 text-yellow-700"}`,children:[a.jsx(is,{className:"inline mr-2"})," Edit Plan"]}),a.jsx("button",{onClick:()=>{v(!1),C(null)},className:`px-6 py-2 rounded-xl font-medium ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Close"})]})})]})}),I&&S&&a.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:`rounded-2xl p-6 max-w-md w-full ${t?"bg-gray-800 border border-gray-700":"bg-white border border-gray-200 shadow-2xl"}`,children:[a.jsx("div",{className:`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${t?"bg-red-600/20":"bg-red-100"}`,children:a.jsx(xt,{className:`text-2xl ${t?"text-red-400":"text-red-600"}`})}),a.jsx("h2",{className:"text-xl font-bold text-center mb-2",children:"Delete Workout Plan"}),a.jsxs("p",{className:`text-center mb-6 ${t?"text-gray-400":"text-gray-600"}`,children:["Are you sure you want to delete the workout plan for"," ",a.jsx("strong",{children:((X=k(S.userId))==null?void 0:X.displayName)||"this user"}),"? This action cannot be undone."]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>{g(!1),C(null)},className:`flex-1 px-6 py-3 rounded-xl font-medium transition-all ${t?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:"Cancel"}),a.jsx("button",{onClick:E,disabled:T,className:`flex-1 px-6 py-3 rounded-xl font-medium transition-all ${T?"bg-red-500/60 cursor-not-allowed text-white/60":"bg-red-500 hover:bg-red-600 text-white"}`,children:T?"Deleting...":"Delete Plan"})]})]})})]})},u3=()=>{const s=JSON.parse(localStorage.getItem("user")||"{}");return a.jsx("div",{className:"min-h-screen bg-gray-100 p-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Dashboard"}),a.jsxs("p",{className:"mt-4 text-gray-600",children:["Welcome, ",s.displayName||s.email,"!"]}),a.jsx("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:a.jsxs("p",{className:"text-sm text-gray-500",children:["Role: ",a.jsx("span",{className:"font-semibold text-indigo-600",children:s.role})]})})]})})};function V3(){return console.log("App component rendering..."),a.jsx(_N,{children:a.jsx(NN,{children:a.jsx(vN,{children:a.jsx(IA,{children:a.jsxs(xN,{children:[a.jsx(Ze,{path:"/login",element:a.jsx(e_,{})}),a.jsx(Ze,{path:"/login-old",element:a.jsx(Z1,{})}),a.jsx(Ze,{path:"/contact-admin",element:a.jsx(O4,{})}),a.jsx(Ze,{path:"/employee/payment-success",element:a.jsx(F4,{})}),a.jsx(Ze,{path:"/forgot-password",element:a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Forgot Password"}),a.jsx("p",{className:"text-gray-600",children:"Feature coming soon"})]})})}),a.jsx(Ze,{path:"/payments/user",element:a.jsx(ut,{requiredRole:"user",children:a.jsx(HA,{})})}),a.jsx(Ze,{path:"/payments/success",element:a.jsx(ut,{requiredRole:"user",children:a.jsx(tk,{})})}),a.jsx(Ze,{path:"/payments/employee",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(YA,{})})}),a.jsx(Ze,{path:"/payments/admin",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(ek,{})})}),a.jsx(Ze,{path:"/admin",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(Ag,{})})}),a.jsx(Ze,{path:"/admin-dashboard",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(Ag,{})})}),a.jsx(Ze,{path:"/admin/employees",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx($4,{})})}),a.jsx(Ze,{path:"/admin/subscriptions",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(U4,{})})}),a.jsx(Ze,{path:"/admin/employee-requests",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(B4,{})})}),a.jsx(Ze,{path:"/admin/chat",element:a.jsx(ut,{requiredRole:"admin",children:a.jsx(z4,{})})}),a.jsx(Ze,{path:"/employee-dashboard",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(zp,{})})}),a.jsx(Ze,{path:"/employee/add-user",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(Gp,{})})}),a.jsx(Ze,{path:"/employee/my-users",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(J4,{})})}),a.jsx(Ze,{path:"/employee/meal-plans/add",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(e3,{})})}),a.jsx(Ze,{path:"/employee/meal-plans/select",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(t3,{})})}),a.jsx(Ze,{path:"/employee/meal-plans/view",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(a3,{})})}),a.jsx(Ze,{path:"/employee/exercises",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(o3,{})})}),a.jsx(Ze,{path:"/employee/gym-plans",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(c3,{})})}),a.jsx(Ze,{path:"/employee/workout-plans-overview",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(d3,{})})}),a.jsx(Ze,{path:"/employee/add-meal-plan",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(Y4,{})})}),a.jsx(Ze,{path:"/meal-plans",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(X4,{})})}),a.jsx(Ze,{path:"/employee/chat",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(q4,{})})}),a.jsx(Ze,{path:"/employee/settings",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(K4,{})})}),a.jsx(Ze,{path:"/employee/:userId/add-user",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(Gp,{})})}),a.jsx(Ze,{path:"/employee/:userId",element:a.jsx(ut,{requiredRole:"employee",children:a.jsx(zp,{})})}),a.jsx(Ze,{path:"/settings",element:a.jsx(ut,{children:a.jsx(W4,{})})}),a.jsx(Ze,{path:"/dashboard",element:a.jsx(ut,{requiredRole:"user",children:a.jsx(u3,{})})}),a.jsx(Ze,{path:"/",element:a.jsx(zo,{to:"/login",replace:!0})}),a.jsx(Ze,{path:"*",element:a.jsx(zo,{to:"/login",replace:!0})})]})})})})})}export{V3 as default};
